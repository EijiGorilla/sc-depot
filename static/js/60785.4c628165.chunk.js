"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[60785],{60785:(e,t,i)=>{i.r(t),i.d(t,{default:()=>L});var o=i(89379),s=i(35143),r=i(18690),a=i(19276),n=i(54901),l=i(50346),c=i(68134),d=i(88685),u=i(46053),h=(i(81806),i(76460),i(85842)),v=i(24883),m=i(16159),p=i(75747),_=i(76940),g=i(57274),w=i(25329),y=i(54099),b=(i(47249),i(56829));let f=class extends(y.A.EventedMixin(b.g)){constructor(e){super(e)}get cursor(){return"crosshair"}onInputEvent(e){"click"===e.type&&this._handleClick(e)}_handleClick(e){this.emit("click",e)}};(0,s._)([(0,u.MZ)({readOnly:!0})],f.prototype,"cursor",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],f.prototype,"stop",void 0),f=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsSearchTool")],f);var S=i(38745),M=i(91967);let K=class extends M.default{constructor(){super(...arguments),this.layerDetails=!0,this.saveAsButton=!0,this.saveButton=!0}};(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],K.prototype,"layerDetails",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],K.prototype,"saveAsButton",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],K.prototype,"saveButton",void 0),K=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsVisibleElements")],K);const k=K;var I=i(77430),F=i(19448),T=i(94126),x=i(98108),D=(i(76099),i(63582)),E=i(54761);const A="esri-directions",C={base:A,accordion:"".concat(A,"__accordion"),actionContainer:"".concat(A,"__action-container"),addStopButton:"".concat(A,"__add-stop-button"),departureTime:"".concat(A,"__departure-time"),departureTimeOptions:"".concat(A,"__departure-time-options"),directionsHeader:"".concat(A,"__directions-header"),directionsHeaderStopName:"".concat(A,"__directions-header-stop-name"),editFooter:"".concat(A,"__edit-footer"),editToolbar:"".concat(A,"__edit-toolbar"),editToolbarContainer:"".concat(A,"__edit-toolbar-container"),flexColumn:"".concat(A,"__flex-column"),flexRow:"".concat(A,"__flex-row"),headerStops:"".concat(A,"__header-stops"),labelEmphasize:"".concat(A,"__label-emphasize"),labelNoBottomMargin:"".concat(A,"__label-no-bottom-margin"),marginInlineMedium:"".concat(A,"__margin-inline-medium"),optimizeSection:"".concat(A,"__optimize-section"),optimizeSwitches:"".concat(A,"__optimize-switches"),paddingMedium:"".concat(A,"__padding-medium"),primaryFlowItem:"".concat(A,"__primary-flow-item"),primaryFooter:"".concat(A,"__primary-footer"),primaryFooterCentered:"".concat(A,"__primary-footer-centered"),primaryFooterLoader:"".concat(A,"__primary-footer-loader"),routeItem:"".concat(A,"__route-item"),routeItemButton:"".concat(A,"__route-item-button"),routeItemButtonContent:"".concat(A,"__route-item-button-content"),routeItemLabel:"".concat(A,"__route-item-label"),routeItemDescription:"".concat(A,"__route-item-description"),saveError:"".concat(A,"__save-error"),saveErrorIcon:"".concat(A,"__save-error-icon"),saveErrorLabel:"".concat(A,"__save-error-label"),saveProcessLoader:"".concat(A,"__save-process-loader"),selectedFeatureContainer:"".concat(A,"__selected-feature-container"),separator:"".concat(A,"__separator"),solveRoute:"".concat(A,"__solve-route"),stopContainer:"".concat(A,"__stop-container"),stopList:"".concat(A,"__stop-list"),stopItem:"".concat(A,"__stop-item")};let R=class extends w.default{constructor(e,t){super(e,t),this._activeManeuver=null,this._placeholderStops=new a.default([new p.default,new p.default]),this._portalFolderCombobox=null,this._portalFolders=null,this._portalItemNameInput=null,this._portalUserName=null,this._sections=null,this._stopsToSearches=new Map,this._currentFlowItem="primary",this._parentFlowItem="primary",this._saveState="initialized",this._searchTool=null,this.headingLevel=2,this.messages=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new S.default,this.visibleElements=new k,this._solveRouteDebounced=(0,l.debounce)((()=>this._solveRoute()))}initialize(){this.addHandles([(0,c.watch)((()=>this.viewModel.layer),(()=>{try{this.viewModel.load()}catch(e){}}),c.initial),(0,c.watch)((()=>{var e;return null===(e=this.viewModel.layer)||void 0===e?void 0:e.routeInfo}),(()=>{this._sections=this._getStopSections()}),c.initial),(0,c.watch)((()=>{var e;return null===(e=this.viewModel.layer)||void 0===e?void 0:e.stops.toArray()}),(e=>{var t;e&&(null===(t=this.view)||void 0===t?void 0:t.activeTool)&&this._searchTool&&this.view.activeTool===this._searchTool&&!e.includes(this._searchTool.stop)&&(this.view.tools.remove(this._searchTool),this._searchTool=null)}))])}loadDependencies(){return(0,T.W)({accordion:()=>i.e(41439).then(i.bind(i,41439)),"accordion-item":()=>i.e(17095).then(i.bind(i,17095)),action:()=>Promise.resolve().then(i.bind(i,85375)),"block-section":()=>i.e(23948).then(i.bind(i,23948)),button:()=>Promise.resolve().then(i.bind(i,43285)),combobox:()=>Promise.all([i.e(65641),i.e(64880)]).then(i.bind(i,64880)),"combobox-item":()=>i.e(73438).then(i.bind(i,73438)),dropdown:()=>Promise.resolve().then(i.bind(i,24482)),flow:()=>i.e(87473).then(i.bind(i,87473)),"flow-item":()=>i.e(68445).then(i.bind(i,68445)),icon:()=>Promise.resolve().then(i.bind(i,16702)),input:()=>Promise.all([i.e(46870),i.e(38841)]).then(i.bind(i,38841)),"input-date-picker":()=>Promise.all([i.e(46870),i.e(79709),i.e(53433)]).then(i.bind(i,40240)),"input-time-picker":()=>Promise.all([i.e(46870),i.e(5506)]).then(i.bind(i,5506)),label:()=>Promise.resolve().then(i.bind(i,11839)),list:()=>Promise.all([i.e(46870),i.e(38841),i.e(65641),i.e(75802)]).then(i.bind(i,75802)),"list-item":()=>Promise.resolve().then(i.bind(i,70205)),loader:()=>Promise.resolve().then(i.bind(i,35688)),notice:()=>i.e(12261).then(i.bind(i,12261)),panel:()=>Promise.resolve().then(i.bind(i,32647)),switch:()=>Promise.resolve().then(i.bind(i,8989))})}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e);return i.view=t,this._overrideDefaultSources(i),i}const i=new g.default((0,o.A)({icon:!1,popupEnabled:!1,resultGraphicEnabled:!1,view:t},this.searchProperties));return this._normalizeSearchSources(i),this.addHandles([(0,c.on)((()=>i.allSources),"change",(()=>this._normalizeSearchSources(i))),i.on("search-clear",(()=>{var t;e.geometry=null,e.name=null,null===(t=this.viewModel.layer)||void 0===t||t.removeResult()})),i.on("select-result",(()=>{const t=i.selectedResult;e.geometry=null===t||void 0===t?void 0:t.feature.geometry,e.name=null===t||void 0===t?void 0:t.name,this._solveRouteDebounced()})),(0,c.watch)((()=>i.searchTerm),(t=>{e.name=t}))],i),this._stopsToSearches.set(e,i),i}getDirections(){return this.viewModel.getDirections()}render(){return(0,E.K)("div",{class:this.classes(C.base,x.D.widget,x.D.panel)},(0,E.K)("calcite-flow",null,this._renderPrimaryFlowItem(),this._renderDirectionsFlowItem(),this._renderEditFlowItem(),this._renderSaveFlowItem()))}save(){return this.viewModel.save()}saveAs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_applyLocatorSourceOverrides(e){let{allSources:t}=e;for(const o of t){var i;"url"in o&&o.url&&(null!==(i=o.locationType)&&void 0!==i||(o.locationType="street"),(0,F.m$)(o.url)&&this.apiKey&&null==o.apiKey&&(o.apiKey=this.apiKey,o.url=F.jd))}}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_getEffectiveStops(){var e,t;return null!==(e=null===(t=this.viewModel.layer)||void 0===t?void 0:t.stops)&&void 0!==e?e:this._placeholderStops}_getErrorDescription(){var e;switch(null===(e=this.viewModel.lastError)||void 0===e?void 0:e.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_getNetworkFeatureName(e){switch(e.type){case"stop":switch(e.locationType){case"stop":default:return this.messages.networkFeatures.stops.stop;case"waypoint":return this.messages.networkFeatures.stops.waypoint;case"break":return this.messages.networkFeatures.stops.break}case"point-barrier":return this.messages.networkFeatures.pointBarrier;case"polyline-barrier":return this.messages.networkFeatures.polylineBarrier;case"polygon-barrier":return this.messages.networkFeatures.polygonBarrier}}_getRouteCostSummary(){var e,t,i;const o=null===(e=this.viewModel.layer)||void 0===e?void 0:e.routeInfo;if(!o)return null;const s=null!==(t=o.totalDistance)&&void 0!==t?t:0,r=null!==(i=o.totalDuration)&&void 0!==i?i:0,{messagesUnits:a,unit:n}=this;return{distance:(0,I.BO)(a,s,n),duration:(0,I.a3)(r)}}_getStopSections(){if(!this.viewModel.layer)return null;const{directionPoints:e,directionLines:t,stops:i}=this.viewModel.layer;if(!e||!t)return null;const o=[];let s=null;for(const r of e){const{objectId:e,stopId:a}=r;if(null!=a){const e=i.find((e=>{let{objectId:t}=e;return t===a}));s&&s.stop===e||(s={stop:e,directions:[]},o.push(s));continue}if(null==s)continue;const n=t.find((t=>{let{directionPointId:i}=t;return i===e}));null!=n&&s.directions.push({directionPoint:r,directionLine:n})}return o}_handleLocateStopAction(e){const{view:t}=this;if(!t)return;const i="directions-search-tool";this.removeHandles(i),this._searchTool=new f({stop:e,view:t}),this.addHandles([this._searchTool.on("click",(async t=>{if(t.mapPoint&&this._stopsToSearches.has(e)){var o;const i=this._stopsToSearches.get(e),s=await i.search(t.mapPoint),r=null===s||void 0===s||null===(o=s.results)||void 0===o||null===(o=o[0].results)||void 0===o?void 0:o[0];if(r){const{feature:t,name:o}=r;i.searchTerm=o,e.geometry=t.geometry}}this.removeHandles(i)})),(0,n.hA)((()=>{var e;this._searchTool&&(null!==(e=this.view)&&void 0!==e&&e.tools.remove(this._searchTool),this._searchTool=null)}))],i),t.addAndActivateTool(this._searchTool)}_handleEditingDoneClick(){this.viewModel.stopEditing(),this._currentFlowItem="primary"}async _handleSaveLayerAsAction(){var e;const t=v.default.getDefault();try{await t.signIn()}catch(o){if((0,l.isAbortError)(o)||"identity-manager:user-aborted"===o.name)return;return this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",void(this._saveState="connect-to-portal-error")}this._saveState="fetch-portal-information",this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",this._portalUserName=null===(e=t.user)||void 0===e?void 0:e.username;try{var i;this._portalFolders=await(null===(i=t.user)||void 0===i?void 0:i.fetchFolders())}catch(s){return void(this._saveState="fetch-portal-information-error")}this._saveState="save-layer"}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){for(const t of e.viewModel.defaultSources)t.autoNavigate=!1}_renderClearRouteAction(e){return(0,E.K)("calcite-action",(0,o.A)((0,o.A)({icon:"trash",key:"clear-route",onclick:()=>{this._currentFlowItem="primary",this.viewModel.reset()}},e),{},{text:this.messages.common.clear,textEnabled:!0}))}_renderDeleteStopAction(e){const t=this._getEffectiveStops();return(0,E.K)("calcite-action",{icon:"trash",onclick:()=>{t.remove(e),this._disposeSearch(e),this._solveRouteDebounced()},scale:"s",slot:"actions-end",text:this.messages.deleteStop,title:this.messages.deleteStop})}_renderDepartureTime(){const{DEPART_AT:e,NOW:t,UNSPECIFIED:i}=I.jW;return(0,E.K)("calcite-label",{class:C.departureTime,key:"departure-time"},this.messages.departureTime,(0,E.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.departureTime,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.departureOption=i[0].value,this._solveRouteDebounced())}},(0,E.K)("calcite-combobox-item",{heading:this.messages.leaveNow,key:t,label:this.messages.leaveNow,selected:this.viewModel.departureOption===t,value:t}),(0,E.K)("calcite-combobox-item",{heading:this.messages.departAt,key:e,label:this.messages.departAt,selected:this.viewModel.departureOption===e,value:e}),(0,E.K)("calcite-combobox-item",{heading:this.messages.timeUnspecified,key:i,label:this.messages.timeUnspecified,selected:this.viewModel.departureOption===i,value:i})))}_renderDepartureTimeOptions(){return this.viewModel.departureOption!==I.jW.DEPART_AT?null:(0,E.K)("div",{class:C.departureTimeOptions},(0,E.K)("calcite-input-date-picker",{scale:"s",value:this.viewModel.departureIsoDate,onCalciteInputDatePickerChange:e=>{let{currentTarget:{value:t}}=e;Array.isArray(t)||(this.viewModel.departureIsoDate=t,this._solveRouteDebounced())}}),(0,E.K)("calcite-input-time-picker",{scale:"s",value:this.viewModel.departureIsoTime,onCalciteInputTimePickerClose:e=>{let{currentTarget:{value:t}}=e;this.viewModel.departureIsoTime=t,this._solveRouteDebounced()}}))}_renderDirectionsFlowItem(){var e,t,i,o;if("directions"!==this._currentFlowItem)return null;const s=this._getRouteCostSummary();if(!this._sections||!s)return null;const{distance:r,duration:a}=s,{formattedEta:n}=this.viewModel,l=null!==(e=null===(t=this._sections.at(0))||void 0===t?void 0:t.stop.name)&&void 0!==e?e:"",c=null!==(i=null===(o=this._sections.at(-1))||void 0===o?void 0:o.stop.name)&&void 0!==i?i:"";return(0,E.K)("calcite-flow-item",{key:"directions-flow-item",overlayPositioning:"fixed",selected:"directions"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem="primary"}},(0,E.K)("div",{class:C.directionsHeader,slot:"header-content"},(0,E.K)("div",{class:C.headerStops},(0,E.K)("span",null,this.messages.from)," ",(0,E.K)("span",{class:C.directionsHeaderStopName},l),(0,E.K)("span",null,this.messages.to)," ",(0,E.K)("span",{class:C.directionsHeaderStopName},c)),(0,E.K)("div",{class:C.flexColumn},(0,E.K)("span",null,"".concat(a," (").concat(r,")")),n?(0,E.K)("span",null,n):null)),this._renderRouteLayerActions({slot:"header-menu-actions"}),(0,E.K)("calcite-accordion",{class:C.accordion,iconPosition:"start",selectionMode:"single"},this._sections.map(((e,t)=>{const{stop:i,directions:o}=e,{name:s}=i;return(0,E.K)("calcite-accordion-item",{expanded:0===t,heading:null!==s&&void 0!==s?s:"",key:"stop-".concat(t)},(0,E.K)("calcite-action",{icon:"zoom-to-object",onclick:()=>{this.viewModel.centerAt(i)},slot:"actions-end",text:this.messages.panToStop}),this._renderDirectionTurns(o))}))))}_renderDirectionTurns(e){return(0,E.K)("calcite-list",{label:this.messages.drivingDirections,selectionMode:"none"},e.map(((e,t)=>{const{directionPoint:i,directionLine:o}=e,{distance:s,duration:a}=o,n=(0,I.BO)(this.messagesUnits,null!==s&&void 0!==s?s:0,this.unit),l=(0,I.a3)(null!==a&&void 0!==a?a:0),c=n&&l?"".concat(n," | ").concat(l):"".concat(n||l),u=function(e){const{branchName:t,displayText:i,exitName:o,intersectingName:s,name:a,towardName:n}=e;if(null==i)return null;const l=[t,o,s,a,n].filter(r.Ru).sort(((e,t)=>t.length-e.length)).map((e=>(0,d.Cj)(e)));if(!l.length)return i;const c=new RegExp(l.join("|"),"g"),u=i.matchAll(c);let h=0;const v=[];for(const{0:r,index:d}of u)v.push(i.slice(h,d),(0,E.K)("span",{class:C.labelEmphasize,key:"maneuver-".concat(d)},r)),h=d+r.length;return v.push(i.slice(h)),(0,E.K)("span",null,v)}(i),h=(0,I.RU)(i.directionPointType);return(0,E.K)("calcite-list-item",{class:C.labelNoBottomMargin,key:"driving-direction-".concat(t),onpointerenter:()=>{this.viewModel.highlight(o)},onpointerleave:()=>{this.viewModel.clearHighlights()},onCalciteListItemSelect:()=>{this._activeManeuver===o?this.zoomToRoute():(this._activeManeuver=o,this.viewModel.centerAt(o.geometry))}},(0,E.K)("calcite-icon",{icon:h,slot:"content-start"}),(0,E.K)("div",{slot:"content"},(0,E.K)("calcite-label",{layout:"inline",scale:"s"},u),(0,E.K)("calcite-label",{layout:"inline",scale:"s"},c)))})))}_renderEditFlowItem(){var e;return"edit"!==this._currentFlowItem?null:(0,E.K)("calcite-flow-item",{heading:this.messages.editRoute,headingLevel:this.headingLevel,key:"edit-flow-item",loading:"routing"===this.viewModel.state,selected:"edit"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.viewModel.stopEditing(),this._currentFlowItem="primary"}},(0,E.K)("div",{class:C.flexColumn,key:"edit-container"},(0,E.K)("div",{class:C.editToolbarContainer},(0,E.K)("calcite-label",{layout:"inline",scale:"s"},this.messages.automaticallySolve,(0,E.K)("calcite-switch",{checked:this.viewModel.autoSolve,scale:"s",onCalciteSwitchChange:e=>{this.viewModel.autoSolve=e.target.checked}})),(0,E.K)("div",{class:C.editToolbar},(0,E.K)("calcite-action",{icon:"flag",onclick:()=>{this.viewModel.create("stop")},scale:"s",text:this.messages.networkFeatures.stops.stop,textEnabled:!0}),(0,E.K)("calcite-action",{icon:"line",onclick:()=>{this.viewModel.create("polyline-barrier")},scale:"s",text:this.messages.barrier,textEnabled:!0}),(0,E.K)("calcite-action",{class:C.solveRoute,disabled:this.viewModel.autoSolve,icon:"refresh",onclick:()=>{this._solveRouteDebounced()},scale:"s",text:this.messages.solve,textEnabled:!0}))),(0,E.K)("div",{class:C.selectedFeatureContainer},(0,E.K)("calcite-list",{label:this.messages.selectedNetworkFeatures,scale:"s",selectionMode:"none"},null===(e=this.viewModel.selectedNetworkFeatures)||void 0===e?void 0:e.toArray().map(((e,t)=>{var i,o,s;return(0,E.K)("calcite-list-item",{description:this._getNetworkFeatureName(e),key:"network-feature-".concat(t),label:null!==(i=null!==(o=e.name)&&void 0!==o?o:null===(s=e.objectId)||void 0===s?void 0:s.toString())&&void 0!==i?i:this.messages.unnamed},(0,E.K)("calcite-action",{icon:"trash",onclick:()=>{this.viewModel.remove(e)},scale:"s",slot:"actions-end",text:this.messages.common.delete}))})))),(0,E.K)("div",{class:C.editFooter},this._renderEditFooterContent())))}_renderEditFooterContent(){return this.viewModel.lastError?this._renderErrorNotice():(0,E.K)("calcite-button",{appearance:"outline-fill",bind:this,onclick:this._handleEditingDoneClick,width:"full"},this.messages.common.done)}_renderErrorNotice(){return(0,E.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0},(0,E.K)("calcite-label",{class:C.labelNoBottomMargin,slot:"message"},this._getErrorDescription()))}_renderFooter(){var e,t;if(!this.viewModel.layer)return(0,E.K)("div",{class:C.primaryFooter,key:"footer-missing-layer"},(0,E.K)("calcite-notice",{icon:"information",open:!0},(0,E.K)("calcite-label",{class:C.labelNoBottomMargin,slot:"message"},this.messages.missingLayer)));if("unauthenticated"===this.viewModel.state)return(0,E.K)("div",{class:C.primaryFooterCentered,key:"footer-sign-in"},(0,E.K)("calcite-label",null,this.messages.signInRequired),(0,E.K)("calcite-button",{onclick:()=>{this.viewModel.load().catch((()=>{}))}},this.messages.common.auth.signIn));if("routing"===this.viewModel.state)return(0,E.K)("div",{class:this.classes(C.primaryFooter,C.primaryFooterLoader),key:"footer-routing"},(0,E.K)("calcite-loader",{label:this.messages.solve,scale:"s"}));if("error"===this.viewModel.state)return(0,E.K)("div",{class:C.primaryFooter,key:"footer-service-error"},this._renderErrorNotice());if(null===(e=this.viewModel.layer)||void 0===e||!e.routeInfo)return(0,E.K)("div",{class:C.primaryFooter,key:"footer-unsolved-route"},(0,E.K)("calcite-notice",{icon:"information",open:!0},(0,E.K)("calcite-label",{class:C.labelNoBottomMargin,slot:"message"},this.messages.directionsPlaceholder)));const i=this._getRouteCostSummary();if(!i||null===(t=this.viewModel.layer)||void 0===t||!t.directionPoints)return(0,E.K)("div",{class:C.primaryFooter,key:"footer-invalid-route"},(0,E.K)("calcite-notice",{icon:"exclamation-mark-triangle",kind:"danger",open:!0},(0,E.K)("calcite-label",{class:C.labelNoBottomMargin,slot:"message"},this.messages.invalidRoute)));const{distance:o,duration:s}=i,{formattedEta:r}=this.viewModel;return(0,E.K)("div",{class:C.routeItem,key:"footer-directions-summary"},(0,E.K)("button",{"aria-busy":"false","aria-label":this.messages.viewDrivingDirections,"aria-live":"polite",class:C.routeItemButton,onclick:()=>{this._currentFlowItem="directions"},type:"button"},(0,E.K)("div",{class:C.routeItemButtonContent},(0,E.K)("span",{class:C.routeItemLabel},"".concat(s," (").concat(o,")")),(0,E.K)("span",{class:C.routeItemDescription},r)),(0,E.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s"})),(0,E.K)("calcite-dropdown",null,(0,E.K)("calcite-action",{icon:"ellipsis",slot:"trigger",text:"Route actions"}),this._renderRouteLayerActions()))}_renderInteractiveRouteActions(){var e;return(0,E.K)("div",{class:C.actionContainer,key:"interactive-route-action-container"},(0,E.K)("calcite-button",{appearance:"outline",class:C.addStopButton,disabled:this._getEffectiveStops().length>=this.maxStops,iconStart:"plus",kind:"neutral",label:this.messages.addStop,onclick:()=>{var e;const t=new _.default;null===(e=this.viewModel.layer)||void 0===e||e.stops.add(new p.default({symbol:t}))},width:"half"},this.messages.addStop),(0,E.K)("calcite-button",{appearance:"outline",disabled:"2d"!==(null===(e=this.viewModel.view)||void 0===e?void 0:e.type),iconStart:"pencil",kind:"neutral",label:this.messages.editRoute,onclick:()=>{this._currentFlowItem="edit",this.viewModel.startEditing()},width:"half"},this.messages.editRoute))}_renderLocateStopAction(e){var t;if(null!=e.name||null!=e.geometry)return null;const i=this._getEffectiveStops().indexOf(e),o=!(null===(t=this.view)||void 0===t||!t.activeTool)&&this.view.activeTool===this._searchTool&&this._searchTool.stop===e;return(0,E.K)("calcite-action",{active:o,icon:"crosshair",key:"stop-location-action-".concat(i),onclick:()=>this._handleLocateStopAction(e),scale:"s",slot:"actions-end",text:this.messages.pickALocationOnTheMap,title:this.messages.pickALocationOnTheMap})}_renderOptimizeStopOrder(){const{routeParameters:e}=this.viewModel,{findBestSequence:t,preserveFirstStop:i,preserveLastStop:o}=e;return(0,E.K)("calcite-block-section",{class:C.optimizeSection,text:this.messages.optimizeOrder,toggleDisplay:"switch",onCalciteBlockSectionToggle:t=>{let{target:i}=t;e.findBestSequence=i.open,i.open||this._resetStopSequence(),this._solveRouteDebounced()}},t?[(0,E.K)("calcite-label",{class:C.optimizeSwitches,key:"preserve-first-stop",layout:"inline-space-between"},this.messages.preserveFirstStop,(0,E.K)("calcite-switch",{checked:i,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveFirstStop=i,this._resetStopSequence(),this._solveRouteDebounced()}})),(0,E.K)("calcite-label",{class:C.optimizeSwitches,key:"preserve-last-stop",layout:"inline-space-between"},this.messages.preserveLastStop,(0,E.K)("calcite-switch",{checked:o,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveLastStop=i,this._resetStopSequence(),this._solveRouteDebounced()}}))]:null)}_renderPrimaryFlowItem(){return(0,E.K)("calcite-flow-item",{key:"primary-flow-item",loading:"initializing"===this.viewModel.state,selected:"primary"===this._currentFlowItem},(0,E.K)("calcite-panel",{class:C.primaryFlowItem,disabled:!this.viewModel.layer||"unauthenticated"===this.viewModel.state||"error"===this.viewModel.state&&!this.viewModel.serviceDescription},this._renderStops(),this._renderInteractiveRouteActions(),this._renderSeparator(),this._renderRouteSolveOptions()),this._renderFooter())}_renderRouteLayerActions(e){return[this._renderClearRouteAction(e),this._renderSaveLayerAction(e),this._renderSaveLayerAsAction(e),this._renderViewItemDetailsAction(e)]}_renderRouteSolveOptions(){return(0,E.K)("div",{class:C.marginInlineMedium,key:"route-solve-options"},this._renderTravelModes(),this._renderDepartureTime(),this._renderDepartureTimeOptions(),this._renderOptimizeStopOrder())}_renderSaveContent(){switch(this._saveState){case"initialized":return this._renderSaveInitialized();case"connect-to-portal":return this._renderSaveProcessing(this.messages.identity.lblSigning);case"connect-to-portal-error":return this._renderSaveError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderSaveProcessing(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderSaveError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayerSettings();case"saving":return this._renderSaveProcessing(this.messages.processing.saving);case"saving-error":return this._renderSaveError(this.messages.errors.saving)}}_renderSaveError(e){return(0,E.K)("calcite-panel",{class:C.paddingMedium,key:"save-layer-error"},(0,E.K)("div",{class:C.saveError},(0,E.K)("calcite-icon",{class:C.saveErrorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messages.common.errorMessage}),(0,E.K)("calcite-label",{class:C.saveErrorLabel},e)),(0,E.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.close))}_renderSaveInitialized(){return(0,E.K)("calcite-panel",{class:C.paddingMedium,key:"save-layer-initialized"})}_renderSaveFlowItem(){return"save"!==this._currentFlowItem?null:(0,E.K)("calcite-flow-item",{heading:this.messages.saveLayer,headingLevel:this.headingLevel,key:"save-layer-flow-item",selected:"save"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem=this._parentFlowItem}},this._renderSaveContent())}_renderSaveLayerAction(e){var t;if(!this.visibleElements.saveButton)return null;const i=this.viewModel.layer,s=null===i||void 0===i?void 0:i.routeInfo,r=null===i||void 0===i||null===(t=i.portalItem)||void 0===t?void 0:t.itemControl;return(0,E.K)("calcite-action",(0,o.A)((0,o.A)({disabled:!(s&&("admin"===r||"update"===r)),icon:"save",key:"save-route",onclick:()=>{var e;null===(e=this.viewModel.layer)||void 0===e||e.save()}},e),{},{text:this.messages.common.save,textEnabled:!0}))}_renderSaveLayerAsAction(e){var t;if(!this.visibleElements.saveAsButton)return null;const i=!(null!==(t=this.viewModel.layer)&&void 0!==t&&t.routeInfo);return(0,E.K)("calcite-action",(0,o.A)((0,o.A)({disabled:i,icon:"save-as",key:"save-as-route",onclick:()=>{this._handleSaveLayerAsAction()}},e),{},{text:this.messages.common.saveAs,textEnabled:!0}))}_renderSaveLayerSettings(){if(null==this.layer||null==this._portalFolders||null==this._portalUserName)return this._renderSaveInitialized();const{stops:e}=this.layer,t="".concat(e.at(0).name," - ").concat(e.at(-1).name),i=[(0,E.K)("calcite-combobox-item",{heading:"".concat(this._portalUserName," (").concat(this.messages.common.home,")"),key:"".concat(A,"-folder-home"),selected:!0,value:"".concat(A,"-folder-home")}),...this._portalFolders.map((e=>{var t;return(0,E.K)("calcite-combobox-item",{heading:null!==(t=e.title)&&void 0!==t?t:"",key:"".concat(A,"-folder-").concat(e.id),value:e.id})}))];return(0,E.K)("calcite-panel",{key:"save-layer-panel"},(0,E.K)("div",{class:C.paddingMedium},(0,E.K)("calcite-label",null,this.messages.laverName,(0,E.K)("calcite-input",{afterCreate:e=>{this._portalItemNameInput=e},label:this.messages.laverName,value:t})),(0,E.K)("calcite-label",null,this.messages.saveInFolder,(0,E.K)("calcite-combobox",{afterCreate:e=>{this._portalFolderCombobox=e},clearDisabled:!0,label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},i))),(0,E.K)("calcite-button",{onclick:()=>{var e,t;if(this._saveState="saving",null==this.layer||null==this._portalFolders)return;const i=null===(e=this._portalItemNameInput)||void 0===e?void 0:e.value,o=null===(t=this._portalFolderCombobox)||void 0===t?void 0:t.value,s=this._portalFolders.find((e=>{let{id:t}=e;return t===o}));this.layer.saveAs({title:i},{folder:s}).then((()=>{this._currentFlowItem=this._parentFlowItem})).catch((()=>{this._saveState="saving-error"}))},slot:"footer-actions",width:"full"},this.messages.common.save),(0,E.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.cancel))}_renderSaveProcessing(e){return(0,E.K)("calcite-panel",{class:C.marginInlineMedium,key:"save-layer-processing"},(0,E.K)("calcite-loader",{class:C.saveProcessLoader,label:e,text:e}))}_renderSeparator(){return(0,E.K)("div",{class:C.separator})}_renderStop(e){const t=this.acquireSearch(e);null!=e.name&&(t.searchTerm=e.name);const i=this._getEffectiveStops(),o=this._renderLocateStopAction(e),s=i.length>2&&this._renderDeleteStopAction(e);return(0,E.K)("calcite-list-item",{key:e,value:e},o,s,(0,E.K)("div",{class:C.stopItem,slot:"content"},t.render()))}_renderStops(){const e=this._getEffectiveStops();for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);return(0,E.K)("div",{class:C.stopContainer,key:C.stopContainer},(0,E.K)("calcite-list",{class:C.stopList,dragEnabled:!0,label:this.messages.widgetLabel,scale:"s",onCalciteListOrderChange:t=>{let{detail:i}=t;e.reorder(i.dragEl.value,i.newIndex),this._resetStopSequence(),this._solveRouteDebounced()}},e.toArray().map((e=>this._renderStop(e)))),2===e.length&&(0,E.K)("calcite-action",{icon:"arrow-up-down",onclick:()=>{e.reverse(),this._resetStopSequence(),this._solveRouteDebounced()},scale:"s",text:this.messages.reverseStops}))}_renderTravelModes(){return this.viewModel.travelModes.length?(0,E.K)("calcite-label",{key:"travel-modes"},this.messages.mode,(0,E.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.mode,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.selectedTravelMode=i[0].value,this._solveRouteDebounced())}},this.viewModel.travelModes.map((e=>{var t;return(0,E.K)("calcite-combobox-item",{heading:e.name,key:e.id,label:e.name,selected:(null===(t=this.viewModel.selectedTravelMode)||void 0===t?void 0:t.id)===e.id,value:e})})))):null}_renderViewItemDetailsAction(e){var t;if(!this.visibleElements.layerDetails)return null;const i=null===(t=this.viewModel.layer)||void 0===t?void 0:t.portalItem;return(0,E.K)("calcite-action",(0,o.A)((0,o.A)({disabled:!i,icon:"launch",key:"open-route-details-link",onclick:()=>{i&&window.open("".concat(i.portal.url,"/home/item.html?id=").concat(i.id),"_blank")}},e),{},{text:this.messages.viewLayerDetails,textEnabled:!0}))}_resetStopSequence(){var e;null===(e=this.viewModel.layer)||void 0===e||e.stops.forEach((e=>{e.sequence=null}))}async _solveRoute(){var e,t;if(this.viewModel.updateDepartureTime(),!((null!==(e=null===(t=this.viewModel.layer)||void 0===t?void 0:t.stops.filter((e=>{let{geometry:t}=e;return!!t})).length)&&void 0!==e?e:0)<2))try{await this.viewModel.getDirections()}catch(i){}}};(0,s._)([(0,u.MZ)()],R.prototype,"_currentFlowItem",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"_saveState",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"_searchTool",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"apiKey",null),(0,s._)([(0,u.MZ)(m.q)],R.prototype,"defaultUnit",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"goToOverride",null),(0,s._)([(0,u.MZ)()],R.prototype,"headingLevel",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"icon",null),(0,s._)([(0,u.MZ)()],R.prototype,"label",null),(0,s._)([(0,u.MZ)({readOnly:!0})],R.prototype,"lastRoute",null),(0,s._)([(0,u.MZ)()],R.prototype,"layer",null),(0,s._)([(0,u.MZ)()],R.prototype,"maxStops",null),(0,s._)([(0,u.MZ)(),(0,D.G)("esri/widgets/Directions/t9n/Directions")],R.prototype,"messages",void 0),(0,s._)([(0,u.MZ)(),(0,D.G)("esri/core/t9n/Units")],R.prototype,"messagesUnits",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"searchProperties",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"unit",null),(0,s._)([(0,u.MZ)()],R.prototype,"view",null),(0,s._)([(0,u.MZ)({type:S.default})],R.prototype,"viewModel",void 0),(0,s._)([(0,u.MZ)({type:k,nonNullable:!0})],R.prototype,"visibleElements",void 0),R=(0,s._)([(0,h.$)("esri.widgets.Directions")],R);const L=R}}]);
//# sourceMappingURL=60785.4c628165.chunk.js.map