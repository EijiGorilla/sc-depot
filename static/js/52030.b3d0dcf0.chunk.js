"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[21964,52030,63733,88877,89646,95327],{4955:(e,t,i)=>{function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){var i;return"number"==typeof e?e:null!==e&&void 0!==e&&null!==(i=e.stops)&&void 0!==i&&i.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const n=e[a].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function r(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(n(i,e)+n(a,e))/2}));let a=0;const r=i.length;if(0===r)return e;for(let n=0;n<r;n++)a+=i[n];const o=Math.floor(a/r);return Math.max(o,e)}function o(e){const t=null===e||void 0===e?void 0:e.renderer,i="touch"===(null===e||void 0===e?void 0:e.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?r(i,t.visualVariables):i;if("simple"===t.type)return a(n,t.symbol);if("unique-value"===t.type){var o;let e=n;return null!==(o=t.uniqueValueInfos)&&void 0!==o&&o.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return"dot-density"===t.type||t.type,n}i.d(t,{o:()=>o})},7141:(e,t,i)=>{i.r(t),i.d(t,{default:()=>K});var a=i(89379),n=i(35143),r=i(39356),o=i(50076),s=i(54901),l=(i(81806),i(76460)),d=i(30726),u=i(50346),c=i(68134),p=i(49723),h=i(46053),f=(i(47249),i(85842)),y=i(5600),v=i(87663),g=i(17983),m=i(81130);const w={"buffer-line-to-polygon":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(47413),i.e(34432)]).then(i.bind(i,12051)),"buffer-point-to-polygon":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(47413),i.e(77492)]).then(i.bind(i,77492)),"buffer-polygon-to-polygon":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(47413),i.e(38900)]).then(i.bind(i,38900)),"connection-point":()=>i.e(47615).then(i.bind(i,47615)),"equally-spaced":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(50416)]).then(i.bind(i,50416)),"offset-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(78836)]).then(i.bind(i,78836)),"offset-primary-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(32968)]).then(i.bind(i,32968)),"point-at-all-vertices-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(94687)]).then(i.bind(i,94687)),"point-at-beginning-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(55012)]).then(i.bind(i,55012)),"point-at-beginning-of-radial":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(17057)]).then(i.bind(i,17057)),"point-at-end-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(1158)]).then(i.bind(i,1158)),"point-at-interior-vertices":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(253)]).then(i.bind(i,253)),"point-at-intersection-vertices-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(16563)]).then(i.bind(i,16563)),"point-at-not-beginning-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(86017)]).then(i.bind(i,8398)),"point-at-not-end-of-line":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(70968),i.e(65587)]).then(i.bind(i,65587)),"point-at-polygon-centroid":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(23942)]).then(i.bind(i,23942)),"point-at-polygon-not-start":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(6389)]).then(i.bind(i,6389)),"point-at-polygon-start":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(98844)]).then(i.bind(i,98844)),"point-identity":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(1729)]).then(i.bind(i,1729)),"point-primary-identity":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(54767)]).then(i.bind(i,54767)),"polygon-boundary":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(30429)]).then(i.bind(i,30429)),"polygon-boundary-two-point":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(23673)]).then(i.bind(i,46054)),"polygon-identity":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(39377)]).then(i.bind(i,39377)),"polygon-primary-identity":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(50335)]).then(i.bind(i,50335)),"polygon-vertices":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(75336)]).then(i.bind(i,75336)),"radial-lines":()=>i.e(49503).then(i.bind(i,49503)),"two-point-lines":()=>Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(52847),i.e(68350)]).then(i.bind(i,68350))};var b=i(19902),_=i(28009),I=i(12899);const F=()=>l.A.getLogger("esri.editing.sharedTemplates.executor.createTemplateExecutor"),M="globalid";async function A(e){if(!(0,y.xZ)(e))throw new o.default("template-executor:template-not-loaded","The template must be loaded before it can be executed.");if((0,y.Cq)(e))return function(e){return t=>{var i,a;const n=[],r=[];(0,g.i)({geometry:t,template:e,edits:n,relationships:r});const o=(0,m.zE)(n);return{edits:(0,m.Vi)(n),relationships:r,primary:null!==(i=n[0])&&void 0!==i?i:null,featureExtent:o,rotationPoint:null!==(a=null===o||void 0===o?void 0:o.center)&&void 0!==a?a:null}}}(e);if((0,y.Dt)(e))return async function(e){const{definition:t}=e,i=await Promise.all(t.allParts.map(S));return(a,n)=>{const r=[],o=[],s=new Set,l=()=>{var e,i;if(t.createUtilityNetworkAssociations&&"completion"===n){const{utilityNetwork:e,utilityNetworkAssociationsTable:i}=t;e&&i?function(e){const{edits:t,utilityNetworkHelper:i}=e,a=new Map;for(const n of t)""!==n.tag&&i.layerIdToSourceIdLookup.has(n.id)&&(0,v.tE)(a,n.tag,(()=>[])).push(n);for(const n of a.values())if(!(n.length<2))for(let t=0;t<n.length;t++){const i=n[t];for(let a=t+1;a<n.length;a++)T(i,n[a],e)}}({associationGraphics:s,associationsTable:i,edits:r,relationships:o,utilityNetworkHelper:e}):F().warn("Unable to create utility network associations between group template features. The utility network or its associations table is unavailable.")}const a=(0,m.zE)(r);return{associationGraphics:s,edits:(0,m.Vi)(r),relationships:o,primary:null!==(e=r[0])&&void 0!==e?e:null,featureExtent:a,rotationPoint:null!==(i=null===a||void 0===a?void 0:a.center)&&void 0!==i?i:null}};if(null==a)return F().warn("No geometry provided to group template executor. Result will be empty."),l();const d=i.map((t=>t({edits:r,mode:n,parentTemplate:e,relationships:o,shape:a}))).filter(u.isPromiseLike);return 0===d.length?l():Promise.all(d).then((()=>l()))}}(e);if((0,y.JC)(e))return async function(e){const{createPresetServiceEdit:t}=await Promise.all([i.e(26871),i.e(91523),i.e(16364),i.e(82103),i.e(48045),i.e(75274)]).then(i.bind(i,75274));return function(i,a){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(0,b.isPoint)(i))throw new o.default("template-executor:invalid-input-geometry","The input goemetry for a preset template must be a point.");const s=[],l=[],d=t({geometry:i,template:e,edits:s,relationships:l,rotation:r,mode:a});return{edits:(0,m.Vi)(s),relationships:l,primary:null!==(n=s[0])&&void 0!==n?n:null,featureExtent:(0,m.zE)(s),rotationPoint:d}}}(e);throw new o.default("template-executor:unsupported-template-type","The template type is not supported.")}async function S(e){const t=await function(e){const t=w[e];if(!t)throw new Error("Builder type ".concat(e," is not supported."));return t()}(e.builderType);return i=>t.execute((0,a.A)((0,a.A)({},i),{},{templatePart:e}))}function T(e,t,i){const{associationGraphics:a,associationsTable:n,edits:o,utilityNetworkHelper:s,relationships:l}=i,d=s.findAgat(e.graphic,e.layer),u=s.findAgat(t.graphic,t.layer);if(!d||!u)return;const c=s.findRules(d).map((i=>{var a,n,r,o,s,l,c,p,h,f,y;return(null===(a=i.fromNetworkSource)||void 0===a?void 0:a.sourceId)!==d.networkSourceId||(null===(n=i.fromAssetGroup)||void 0===n?void 0:n.assetGroupCode)!==d.assetGroup||null!==(null===(r=i.fromAssetType)||void 0===r?void 0:r.assetTypeCode)&&(null===(o=i.fromAssetType)||void 0===o?void 0:o.assetTypeCode)!==d.assetType||i.toNetworkSource.sourceId!==u.networkSourceId||(null===(s=i.toAssetGroup)||void 0===s?void 0:s.assetGroupCode)!==u.assetGroup||null!==i.toAssetType&&(null===(l=i.toAssetType)||void 0===l?void 0:l.assetTypeCode)!==u.assetType?i.toNetworkSource.sourceId!==d.networkSourceId||(null===(c=i.toAssetGroup)||void 0===c?void 0:c.assetGroupCode)!==d.assetGroup||null!==i.toAssetType&&(null===(p=i.toAssetType)||void 0===p?void 0:p.assetTypeCode)!==d.assetType||i.fromNetworkSource.sourceId!==u.networkSourceId||(null===(h=i.fromAssetGroup)||void 0===h?void 0:h.assetGroupCode)!==u.assetGroup||null!==(null===(f=i.fromAssetType)||void 0===f?void 0:f.assetTypeCode)&&(null===(y=i.fromAssetType)||void 0===y?void 0:y.assetTypeCode)!==u.assetType?null:{rule:i,from:{agat:u,item:t},to:{agat:d,item:e}}:{rule:i,from:{agat:d,item:e},to:{agat:u,item:t}}})).filter((e=>(null===e||void 0===e?void 0:e.rule.ruleType)===I.D2.RTJunctionEdgeConnectivity||(null===e||void 0===e?void 0:e.rule.ruleType)===I.D2.RTEdgeJunctionEdgeConnectivity||(null===e||void 0===e?void 0:e.rule.ruleType)===I.D2.RTContainment?null:e)).filter((e=>null!==e));if(0===c.length)return;const h=(0,_.E)(n),f=new Set;for(const _ of c){var y,v,g,m,w,b;const e={};e[h.fromNetworkSourceId]=_.rule.fromNetworkSource.sourceId,e[h.fromGlobalId]=_.from.item.graphic.attributes[null!==(y=_.from.item.layer.globalIdField)&&void 0!==y?y:M],e[h.fromTerminalId]=null,_.rule.fromTerminal&&(e[h.fromTerminalId]=_.rule.fromTerminal.terminalId),e[h.toNetworkSourceId]=_.rule.toNetworkSource.sourceId,e[h.toGlobalId]=_.to.item.graphic.attributes[null!==(v=_.to.item.layer.globalIdField)&&void 0!==v?v:M],e[h.toTerminalId]=null,_.rule.toTerminal&&(e[h.toTerminalId]=_.rule.toTerminal.terminalId),e[h.associationType]=_.rule.ruleType,e[h.percentAlong]=null,e[h.isContentVisible]=_.rule.ruleType===I.D2.RTContainment?1:0,e[h.status]=0,e[h.globalId]=(0,p.yS)();const t="".concat(e[h.fromNetworkSourceId],"-").concat(e[h.fromGlobalId],"-").concat(e[h.toNetworkSourceId],"-").concat(e[h.toGlobalId],"-").concat(e[h.associationType]);if(f.has(t))continue;f.add(t);const i=new r.default({attributes:e,sourceLayer:n});a.add(i),o.push({id:n.layerId,graphic:i,tag:"",layer:n}),l.push({sourceGraphic:_.to.item.graphic,sourceLayerId:_.to.item.layer.layerId,destinationGraphic:i,destinationLayerId:n.layerId,sourceField:null!==(g=_.to.item.layer.globalIdField)&&void 0!==g?g:M,destinationField:null!==(m=h.toGlobalId)&&void 0!==m?m:M}),l.push({sourceGraphic:_.from.item.graphic,sourceLayerId:_.from.item.layer.layerId,destinationGraphic:i,destinationLayerId:n.layerId,sourceField:null!==(w=_.from.item.layer.globalIdField)&&void 0!==w?w:M,destinationField:null!==(b=h.fromGlobalId)&&void 0!==b?b:M})}}var k,P=i(63733),E=i(31933),x=i(8503),V=i(94277),C=i(20072),Z=i(97513),O=i(3589),H=i(1723),R=i(48594),L=i(21661),D=i(88877),z=i(95600),G=i(87102),U=i(81257);const N=Symbol(),q=Symbol(),W=Symbol(),j=Symbol(),B={point:["point"],multipoint:["multipoint"],polygon:["polygon","freehandPolygon","rectangle","circle"],polyline:["polyline","freehandPolyline"],mesh:[],multipatch:[]};let J=k=class extends D.default{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._webStyleCache=new Map,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new G.default,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._isActive=!0}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var e;if(this.pendingFeatures.some((e=>{var t;return!(null===(t=this.data.getEditsForPendingFeature(e))||void 0===t||!t.modified)})))return!0;const{creationInfo:t,upload:i}=this.data,a=this._sketchViewModel,{activeComponent:n}=a,r=null===(e=a.createGraphic)||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.type;return!("polyline"!==r&&"polygon"!==r&&"multipoint"!==r||"draw-2d"!==(null===n||void 0===n?void 0:n.type)&&"draw-3d"!==(null===n||void 0===n?void 0:n.type))&&n.drawOperation.committedVertices.length>0||!(!i||"pending"!==i.state&&"success"!==i.state)||!(null===t||void 0===t||!t.geometryToPlace)}get hasPreviousStep(){return this._stepIndex>0||"update-pending"===this.createFeatureState&&!!this.data.selectedPendingFeature&&!this.parent&&!(0,L.v)(this.data.creationInfo)}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const a=e.layer.geometryType,n=this._sketchViewModel.createGraphic;if("mesh"===a){var r;this._getDrawMeshHelpMessage||i.e(76030).then(i.bind(i,76030)).then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===(null===e||void 0===e?void 0:e.type)?null===(r=this._getDrawMeshHelpMessage)||void 0===r?void 0:r.call(this,n,e):void 0}const o=this._sketchViewModel.activeCreateToolDrawMode,s=this._sketchViewModel.activeTool;return(0,V.$)("rectangle"===s?"rectangle":"circle"===s?"circle":a,null===n||void 0===n?void 0:n.geometry,o)}get layer(){var e;return null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get numPendingFeaturesExcludingHidden(){return this.pendingFeatures.filter((e=>this.data.isDisplayable(e))).length}get parent(){return this.data.parent}get parentLayer(){var e;return null===(e=this.parent)||void 0===e?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){var e,t;return null!==(e=null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.reliesOnOwnerAdminPrivileges)&&void 0!==e&&e}get shouldShowAttachments(){var e,t;return null!==(e=this.data.selectedPendingFeature&&(null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.attachments.enabled))&&void 0!==e&&e}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}get availableCreateTools(){var e,t;const i=null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer.geometryType,a=this.data.viewModel.view;if(!i)return[];if(null!==(t=this.data.creationInfo)&&void 0!==t&&t.maxFeatures&&this.data.creationInfo.maxFeatures<=this.numPendingFeatures)return[];if((0,y.w2)(this.data.fullTemplate)){const{tool:e}=(0,z.Xm)(i,this.data.fullTemplate);return[e]}return"2d"!==(null===a||void 0===a?void 0:a.type)&&"multipoint"===i?[]:[...B[i]]}get _attachmentsActive(){const e=this.data.viewModel.attachmentsViewModel.mode,t=this.stepId;return this.shouldShowAttachments&&("add"===e||"edit"===e||"adding-attachment"===t||"editing-attachment"===t)}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&await this._updatingHandles.addPromise(this._setUpCreatingFeaturesStep())}exit(){this._isActive=!1,this.removeHandles([W])}async updatePendingFeature(e){if(e!==this.data.selectedPendingFeature)return this._sketchViewModel.cancel(),this._startUpdating({feature:e})}async start(){var e;return await super.start(),(0,E.bI)(null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}async save(){const{featureFormViewModel:e}=this;if(e.pendingSubtypeChoice)return;e.submit(),this._stashValidationState();const t=this.data.selectedPendingFeature,i=this._hasValidationErrors(t)?t:this.data.pendingFeatures.find((e=>this._hasValidationErrors(e)));return i?(await this._startUpdating({feature:i}),void(null===e||void 0===e||e.submit())):super.save()}back(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,L.v)(this.data.creationInfo)||this._attachmentsActive||this.parent?super.back(e):this._clearSelectedFeature()}previous(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,L.v)(this.data.creationInfo)||this._attachmentsActive?super.previous(e):this._clearSelectedFeature()}cancelFeature(e){this.data.isSharedTemplateWorkflow?l.A.getLogger(this).warn("Cannot cancel individual features created by shared templates."):(this.data.removePendingFeature(e),this.sketchViewModel.layer.graphics.remove(e))}static create(e){var t;const{addAttachmentsCallback:i,applyEditsCallback:n,applyEditsFeatureServiceCallback:r,isNested:o,creationInfo:s,parent:l,snappingManager:d,startAt:u,viewModel:c}=e,h=null!==(t=e.sketchOptions)&&void 0!==t?t:new Z.A,f=null===s||void 0===s?void 0:s.layer,v=f?c.findEditorItemForLayer(f):void 0,g=new k({data:new R.default({creationInfo:s,editorItem:v,parent:l,sketchOptions:h,snappingManager:d,viewModel:c}),isNested:o,onCommit:async e=>{var t,o;const{creationInfo:s}=e;if(!s)return;g._sketchViewModel.cancel();const l=e.pendingFeatures.toArray(),{layer:d}=s,u=(null===(t=d.capabilities)||void 0===t?void 0:t.editing.supportsGlobalId)&&"globalIdField"in d,h=g._attachmentFileInfos,{fullTemplate:f}=e,v=(0,z._3)(g.data),m=(0,y.Sf)(f)&&v;if(u){if(function(e){for(const n of e){var t,i,a;const{sourceLayer:e}=n;e&&"globalIdField"in e&&null!=e.globalIdField&&(null!==(a=(t=n.attributes)[i=e.globalIdField])&&void 0!==a||(t[i]=(0,p.yS)()))}}(l),m){var w;let t=function(e,t){return e.map((e=>{const{addFeatures:i}=e;if(!i||0===i.length)return e;const n=[];for(const a of i){const e=t.get(a);if(e)for(const{file:t}of e)n.push({feature:a,attachment:{globalId:(0,p.yS)(),data:t}})}return n.length?(0,a.A)((0,a.A)({},e),{},{addAttachments:n}):e}))}(v,h);const i=await(0,z.uh)(d,c.view);i&&(t=(0,z.sy)({edits:t,serviceInfo:i,view:c.view,findOriginalFeature:t=>{var i,a;return null!==(i=null===(a=e.getEditsForPendingFeature(t))||void 0===a?void 0:a.initialFeature)&&void 0!==i?i:t}})),await r(f.featureService,t,{globalIdUsed:!0,gdbVersion:null!==(w=f.layer.gdbVersion)&&void 0!==w?w:void 0})}else{const e=function(e,t){const i=[];if(!t||0===t.size)return{addFeatures:e};for(const[a,n]of t)for(const{file:e}of n)i.push({feature:a,attachment:{globalId:(0,p.yS)(),data:e}});return i.length?{addFeatures:e,addAttachments:i}:{addFeatures:e}}(l,h);await n(d,e,{globalIdUsed:!0})}return}const b=m?await r(f.featureService,v,{gdbVersion:null!==(o=f.layer.gdbVersion)&&void 0!==o?o:void 0}):[await n(d,{addFeatures:l})];b&&h.size>0&&await Promise.all(b.map((e=>{if(null!==e&&void 0!==e&&e.addFeatureResults)return i(d,function(e,t,i,a){const n=[];return t.forEach(((t,r)=>{if(!t.error){const o=e[r],s=a.get(o)||[];o.attributes[i.objectIdField]=t.objectId,s.forEach((e=>{let{form:t}=e;return n.push({feature:o,attachment:t})}))}})),n}(l,e.addFeatureResults,d,h))})))}});return g._set("steps",this._createWorkflowSteps(g,u)),g}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",(0,s.hA)((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,(0,s.hA)((()=>e.opacity=t))}async _initializeFullTemplateAndExecutorInfo(e){const{creationInfo:t}=e,{view:i}=e.viewModel;if(!t||!i)return null;const a=await(0,z.sE)(t,i);if(e.fullTemplate=a,a&&(0,y.Sf)(a)){const n={completionResults:[],executor:await A(a),serviceLayersById:await(0,z.EH)(t.layer,i)};e.templateExecutorInfo=n}return a}async _startCreating(){var e;this.removeHandles(q);const{data:t}=this;if(!t.creationInfo)return;const i=null===(e=this.data.creationInfo)||void 0===e?void 0:e.maxFeatures;if(i&&this.numPendingFeatures>=i)return this.sketchViewModel.cancel(),void(this.numPendingFeatures&&await this._startUpdating({feature:this.pendingFeatures.at(-1)}));this.createFeatureState="create-new",await(0,z.AP)(this._sketchViewModel,t,this._webStyleCache)}async _clearSelectedFeature(){var e;const t=this._featureFormViewModel.pendingSubtypeChoice;t&&(t.resolve("undo"),await t.promise),this._stashValidationState(),this.sketchViewModel.cancel(),this.data.selectedPendingFeature=null,this._featureFormHandle=(0,d.xt)(this._featureFormHandle),this._featureFormViewModel.feature=null;const i=this.data.viewModel.attachmentsViewModel;"add"!==i.mode&&"edit"!==i.mode||null===(e=this.data.viewModel.activeWorkflow)||void 0===e||e.previous()}_stashValidationState(){const e=this._featureFormViewModel.feature,t=e&&this.data.getEditsForPendingFeature(e);t&&(t.submittable=this._featureFormViewModel.submittable)}async _selectFeatureForUpdate(e){var t;let{feature:i,initialFeature:a=i}=e;this._stashValidationState();const{data:n,pendingFeatures:r,_webStyleCache:o}=this;r.includes(i)||n.addPendingFeature(i,a),n.selectedPendingFeature=i;const{_featureFormViewModel:l,_sketchViewModel:u}=this,{creationInfo:p,viewModel:h}=n,{attachmentsViewModel:f,layerInfos:y,view:v}=h;if(!v||!p)return;(0,d.xt)(this._featureFormHandle);const g=i.sourceLayer,m=(0,z.Z5)(y,g),w=null===m||void 0===m?void 0:m.formTemplate,b=v.spatialReference;l.set({arcadeEditType:"INSERT",feature:i,formTemplate:w,spatialReference:b,map:v.map}),"add"!==f.mode&&"edit"!==f.mode||null!==(t=h.activeWorkflow)&&void 0!==t&&t.previous(),f.graphic=i,f.fileInfos.removeAll(),f.mode="view",(this._attachmentFileInfos.get(i)||[]).forEach((e=>{let{file:t,form:i}=e;return f.addFile(t,i)})),await(0,z.FC)(i,o,"2d"===v.type?v.scale:null);const _=n.getEditsForPendingFeature(i);this._featureFormHandle=(0,s.vE)([l.on("value-change",(async()=>{null!==_&&void 0!==_&&_.updateAttributes(l.getValues()),await(0,z.FC)(i,o,"2d"===v.type?v.scale:null)})),u.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&(0,z.Ks)(e.toolEventInfo.type))&&l.notifyFeatureGeometryChanged()})),(0,c.watch)((()=>{var e;return null===(e=l.feature)||void 0===e?void 0:e.sourceLayer}),(e=>i.sourceLayer=e)),(0,c.watch)((()=>[l.feature,l.submittable]),(()=>this._stashValidationState()))]),this.createFeatureState="update-pending"}async _startUpdating(e){var t;let{feature:i,initialFeature:a=i}=e;await this._selectFeatureForUpdate({feature:i,initialFeature:a});const{_sketchViewModel:n,data:r}=this,{creationInfo:o,viewModel:s}=r,{view:l}=s;if(!l||!o)return;const d=null!==(t=i.sourceLayer)&&void 0!==t?t:o.layer;return(0,E.bI)(d)?void 0:(this._visualVariableAttributes=(0,z.EO)(i),(0,z.J_)({graphic:i,sketchViewModel:n,sourceLayer:d,visualVariables:this._visualVariableAttributes,webStyleCache:this._webStyleCache}))}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";const{data:i}=e,n=(0,z.z4)(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:n}=i,{view:r}=n;r&&((0,L.v)(t)?e.addHandles(await(0,L.P)({view:r,data:i,next:()=>e.next(),cancel:()=>n.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(i.parent&&t&&e.addHandles(n.restrictFeatureTemplatesViewModelToLayer(t.layer),this.id),e.addHandles(n.featureTemplatesViewModel.on("select",(t=>{let{item:n}=t;n&&(i.creationInfo=(0,a.A)((0,a.A)({},i.creationInfo),{},{layer:n.layer,template:n.template}),e.next())})),this.id)))},async tearDown(){e.removeHandles(this.id)}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:a}=i;t.canceled&&(e.removeHandles([W,N,q,j]),a.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=i.viewModel,{graphic:a,fileInfos:n}=t;e._attachmentFileInfos.set(a,n.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=i.viewModel,{graphic:a,fileInfos:n}=t;e._attachmentFileInfos.set(a,n.toArray()),t.mode="view"}})});return(0,z.bn)(i,n)}static _configureSketchViewModel(e){const{data:t}=e,i=e._webStyleCache,{creationInfo:a,viewModel:n}=t,{view:r}=n,o=e._sketchViewModel,l=[];if(!r)return(0,s.hA)();if("2d"===r.type){a&&l.push(e._fadeExistingFeatures(a.layer));const t=(0,u.debounce)(((e,t)=>Promise.all(e.map((e=>(0,z.FC)(e,i,t))))));l.push((0,c.watch)((()=>r.scale),(e=>t(o.layer.graphics,e))))}const p=(0,z.nc)(t.fullTemplate,null===a||void 0===a?void 0:a.attributeOverrides),h=(0,c.watch)((()=>o.createGraphic),(a=>{a&&!e.hasHandles(q)&&e._updatingHandles.addPromise((0,z.Pi)({creationAttributes:p,data:t,sketchViewModel:o,view:r,webStyleCache:i}).then((t=>e.addHandles(t,q))))})),f=async i=>{const{attachmentsViewModel:s}=n,{_featureFormViewModel:l}=e;if(i.graphics.length>1)return void await e._clearSelectedFeature();const d=i.graphics[0];if("complete"===i.state){var u,c;const{submittable:t}=l;if(e.numPendingFeatures!==(null===a||void 0===a?void 0:a.maxFeatures)&&t||l.submit(),await e._clearSelectedFeature(),"add"!==s.mode&&"edit"!==s.mode||null!==(u=n.activeWorkflow)&&void 0!==u&&u.previous(),!i.aborted&&r.activeTool===e.sketchViewModel.activeComponent&&(await e.sketchViewModel.wait(),"ready"===e.sketchViewModel.state&&"mesh"!==(null===(c=e.data.creationInfo)||void 0===c?void 0:c.layer.geometryType)))return e._startCreating()}else{var p,h;if("start"===i.state)return null!==(p=d.sourceLayer)&&void 0!==p||(d.sourceLayer=null===(h=t.creationInfo)||void 0===h?void 0:h.layer),await(0,z.cY)({sketchViewModel:o,graphic:d,visualVariables:e._visualVariableAttributes,webStyleCache:e._webStyleCache,sourceLayer:d.sourceLayer}),e._selectFeatureForUpdate({feature:d});if("active"===i.state){await e.updatePendingFeature(d);const t=e._visualVariableAttributes;await(0,z.EA)(r,d,i,t,e._webStyleCache);const a=d.attributes,{rotation:n,size:o}=t;if(null!=n){const{field:e}=n;l.setValue(e,a[e])}if(null!=o){const{field:e}=o;l.setValue(e,a[e])}}}},y=async i=>{if(i.graphics.forEach((e=>{t.removePendingFeature(e)})),!(0,L.v)(t.creationInfo))return e._startCreating()};l.push(h,o.on("create",(t=>e._updatingHandles.addPromise((async t=>{if("cancel"!==t.state&&"complete"!==t.state||e.removeHandles(q),"cancel"===t.state&&null!==r.activeTool&&r.activeTool!==e.sketchViewModel.activeComponent&&(await e._waitForActiveToolCleared(),await e._startCreating()),"complete"===t.state&&t.graphic){const i=await e._processEdits(t.graphic,{scale:"2d"===r.type?r.scale:null,useSourceLayer:!0,webStyleCache:e._webStyleCache});i&&(await e._waitForActiveToolCleared(),await e._startUpdating({feature:i}))}})(t)))),o.on("update",(t=>e._updatingHandles.addPromise(f(t)))),o.on("delete",(t=>e._updatingHandles.addPromise(y(t)))),(0,c.when)((()=>!e.numPendingFeatures),(()=>e._updatingHandles.addPromise((async()=>{if((0,L.v)(t.creationInfo))try{await e.data.viewModel.back()}catch(i){}return e._startCreating()})()))),(0,s.hA)((()=>{o.cancel()})),function(e,t){let i=null;const a=()=>e.snappingOptions.featureSources,n=()=>(i=new O.default({layer:e.layer}),a().add(i),i),r=()=>{null!=i&&(a().remove(i),i=(0,d.pR)(i))};return(0,s.vE)([(0,c.watch)((()=>{var e,i;const n=null===(e=t.creationInfo)||void 0===e?void 0:e.layer,r=a().find((e=>e.layer===n));return{hasFeatureLayerSource:!!r,enabled:null!==(i=null===r||void 0===r?void 0:r.enabled)&&void 0!==i&&i}}),(e=>{let{hasFeatureLayerSource:t,enabled:a}=e;if(!t)return r();null!==i&&void 0!==i||(i=n()),i.enabled=a}),c.syncAndInitial),(0,s.hA)(r)])}(o,t),...function(e){const t=e.viewModel.view;if(!t)return[];const i=[];if("3d"===t.type){const a=new C.A({view:t});i.push((0,c.watch)((()=>e.selectedPendingFeature),((e,t)=>{a.remove(e),a.add(t)})),(0,s.hA)((()=>a.destroy())))}const a=new C.A({view:t,highlightName:H.n4});return i.push((0,c.watch)((()=>e.temporaryHighlightFeature),(e=>{a.removeAll(),a.add(e)})),(0,s.hA)((()=>a.destroy()))),i}(t));const v=(0,s.vE)(l);return o.addHandles(v),v}_initializeSketchViewModel(){var e;const{data:t}=this,{view:i}=t.viewModel,a=new P.default({elevationInfo:null===(e=t.creationInfo)||void 0===e?void 0:e.layer.elevationInfo,internal:!0,listMode:"hide",title:"createFeaturesWorkflow-internal"}),n=new U.default({layer:a,creationMode:"single",sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},view:i});this._sketchViewModel=n,null!==i&&void 0!==i&&i.map.add(a),this.addHandles([(0,s.hA)((()=>{null!==i&&void 0!==i&&i.destroyed||null!==i&&void 0!==i&&i.map.remove(a),a.destroy()})),(0,c.watch)((()=>this.numPendingFeatures>0),(e=>this._sketchViewModel.updateOnGraphicClick=e),c.initial)])}_hasValidationErrors(e){var t;return!!e&&(!this.data.isSubmittable(e)||!(null===(t=this._featureFormViewModel.validateContingencyConstraints(e.attributes,{includeIncompleteViolations:!0}))||void 0===t||!t.length))}async _processEdits(e,t){var i,n;const{data:r}=this,{layerInfos:o,view:s}=r.viewModel,l=this._featureFormViewModel,{templateExecutorInfo:d}=r;if(!d){const t=e.clone();return t.geometry=null,r.addPendingFeature(e,t),e}const p=this.sketchViewModel.layer;p.remove(e);const{executor:h}=d,f=h(e.geometry,"completion"),y=(0,u.isPromiseLike)(f)?await f:f;d.completionResults.push(y),(0,z.O)(y.relationships),l.arcadeEditType="INSERT",l.map=null===s||void 0===s?void 0:s.map,l.spatialReference=null===s||void 0===s?void 0:s.spatialReference,y.primary&&(null===(i=r.creationInfo)||void 0===i?void 0:i.attributeOverrides)&&(y.primary.graphic.attributes=(0,a.A)((0,a.A)({},y.primary.graphic.attributes),r.creationInfo.attributeOverrides));for(const a of y.edits){let e=null;if(a.addFeatures)for(const i of a.addFeatures){var v,g,m;const a=i.clone();a.geometry=null,null!=i.geometry&&(i.symbol=await(0,x.getDisplayedSymbol)(i,t),p.add(i));const n=r.addPendingFeature(i,a,{isAssociation:!(null===(v=y.associationGraphics)||void 0===v||!v.has(i))});i.sourceLayer!==(null===(g=e)||void 0===g?void 0:g.layer)&&(e=(0,z.Z5)(o,i.sourceLayer)),l.feature=i,l.formTemplate=null===(m=e)||void 0===m?void 0:m.formTemplate,await(0,c.whenOnce)((()=>!l.updating)),n.submittable=l.submittable}}return l.feature=null,await(0,c.whenOnce)((()=>!l.updating)),y.edits.reduce(((e,t)=>{var i,a;return e+(null!==(i=null===(a=t.addFeatures)||void 0===a?void 0:a.length)&&void 0!==i?i:0)}),0)>1?null:null===(n=y.primary)||void 0===n?void 0:n.graphic}async _setUpCreatingFeaturesStep(){if(this.hasHandles(W))return;const{data:e,sketchViewModel:t}=this,{creationInfo:i,viewModel:a}=e,{attachmentsViewModel:n,view:l}=a;if(!l||null===i||void 0===i||!i.layer)throw new o.default("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:u,layer:p}=i,h=[],f=[];this._featureFormHandle=(0,d.xt)(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},e.editorItem=a.findEditorItemForLayer(i.layer),i.template&&(null==e.fullTemplate&&await this._initializeFullTemplateAndExecutorInfo(e),f.push((0,s.hA)((()=>{e.templateExecutorInfo&&(e.templateExecutorInfo.completionResults=[])})))),t.allowDeleteKey=!e.isSharedTemplateWorkflow,(0,z.r8)(n),h.push((0,c.watch)((()=>n.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const v=(0,z.Pz)(l);h.push(v);const g=(0,E.bI)(i.layer),{template:m}=i,w=!m||(0,y.gZ)(m)||(0,y.w2)(m)&&"feature"===m.type,b=g&&w;try{if(b){const t=null!==u&&void 0!==u?u:new r.default({attributes:(0,z.nc)(e.fullTemplate,i.attributeOverrides),sourceLayer:p}),a=await this._processEdits(t);a&&await this._startUpdating({feature:a})}else h.push(k._configureSketchViewModel(this)),u?(t.layer.add(u),await this._startUpdating({feature:u})):await this._startCreating()}finally{v.remove()}const _=(0,s.hA)((()=>{for(const i of e.pendingFeatures)t.layer.remove(i),e.removePendingFeature(i)})),I=(0,c.watch)((()=>null===l||void 0===l?void 0:l.timeZone),(e=>{this._featureFormViewModel.timeZone=e,this.data.timeZone=e}),c.initial),F=(0,s.hA)((()=>{(0,L.v)(i)&&a.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&h.push(this._featureFormHandle),this.addHandles(h,this._handleKeys.beforeCommit),this.addHandles(f,this._handleKeys.afterCommit),this.addHandles([(0,s.hA)((()=>n.fileInfos.removeAll())),(0,s.vE)(h),(0,s.vE)(f),F,_,I],W)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if(null==(null===e||void 0===e?void 0:e.activeTool))return;const t=new AbortController;this.addHandles((0,s.rE)(t),j),await(0,c.whenOnce)((()=>null==(null===e||void 0===e?void 0:e.activeTool)),t.signal),t.abort()}};(0,n._)([(0,h.MZ)()],J.prototype,"createFeatureState",void 0),(0,n._)([(0,h.MZ)()],J.prototype,"data",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],J.prototype,"isNested",void 0),(0,n._)([(0,h.MZ)()],J.prototype,"featureFormViewModel",null),(0,n._)([(0,h.MZ)()],J.prototype,"hasPendingEdits",null),(0,n._)([(0,h.MZ)()],J.prototype,"hasPreviousStep",null),(0,n._)([(0,h.MZ)()],J.prototype,"_getDrawMeshHelpMessage",void 0),(0,n._)([(0,h.MZ)()],J.prototype,"helpMessage",null),(0,n._)([(0,h.MZ)()],J.prototype,"layer",null),(0,n._)([(0,h.MZ)()],J.prototype,"parent",null),(0,n._)([(0,h.MZ)()],J.prototype,"parentLayer",null),(0,n._)([(0,h.MZ)()],J.prototype,"keyboardCancellationEnabled",null),(0,n._)([(0,h.MZ)()],J.prototype,"reliesOnOwnerAdminPrivileges",null),(0,n._)([(0,h.MZ)()],J.prototype,"shouldShowAttachments",null),(0,n._)([(0,h.MZ)()],J.prototype,"shouldAllowAttachmentEditing",null),(0,n._)([(0,h.MZ)()],J.prototype,"sketchViewModel",null),(0,n._)([(0,h.MZ)()],J.prototype,"availableCreateTools",null),(0,n._)([(0,h.MZ)()],J.prototype,"_attachmentsActive",null),J=k=(0,n._)([(0,f.$)("esri.widgets.Editor.CreateFeaturesWorkflow")],J);const K=J},17983:(e,t,i)=>{i.d(t,{i:()=>f});var a=i(89379),n=i(39356),r=i(50076),o=i(49723),s=i(5600),l=i(81130),d=i(66388),u=i(19247),c=i(65215),p=i(23701),h=i(31933);function f(e){let{edits:t,geometry:i,relationships:d,tag:u="",template:c}=e;if((0,l.AO)(i)){const e=i.geometry.clone();for(const i of e.paths)f({geometry:new p.default({spatialReference:e.spatialReference,paths:[i],hasZ:e.hasZ,hasM:e.hasM}),template:c,edits:t,relationships:d,tag:u});return}const{definition:h,layer:v}=c;i=y(i,v);const g=new n.default({attributes:h.defaultValues?(0,a.A)({},h.defaultValues):{},geometry:i,sourceLayer:v});if(b(g,v),v.globalIdField&&(g.attributes[v.globalIdField]=(0,o.yS)()),t.push({id:v.layerId,graphic:g,tag:u,layer:v}),0!==h.relationships.length)for(const l of h.relationships||[]){const e=l.template;if(null==l.relationshipMetadata||!(0,s.xZ)(e))throw new r.default("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");const{layer:i}=e,u=new n.default({attributes:(0,a.A)({},h.defaultValues),sourceLayer:i});b(u,i),i.globalIdField&&(u.attributes[i.globalIdField]=(0,o.yS)()),t.push({graphic:u,id:i.layerId,tag:"",layer:i}),d.push((0,a.A)((0,a.A)({},l.relationshipMetadata),{},{sourceGraphic:g,destinationGraphic:u}))}}function y(e,t){var i;if(!e)return null;if(e.hasZ===t.hasZ&&e.hasM===t.hasM)return e;switch(e.type){case"point":return new u.default((0,a.A)((0,a.A)({spatialReference:e.spatialReference,x:e.x,y:e.y},t.hasZ?e.hasZ?{z:e.z}:{z:m(t)}:{}),t.hasM?e.hasM?{m:e.m}:{m:null!==(i=w(t))&&void 0!==i?i:void 0}:{}));case"polygon":return new c.default({spatialReference:e.spatialReference,rings:v(e.rings,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"polyline":return new p.default({spatialReference:e.spatialReference,paths:v(e.paths,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"multipoint":return new d.default({spatialReference:e.spatialReference,hasZ:t.hasZ,hasM:t.hasM,points:g(e.points,t.hasZ,t.hasM,m(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1)});default:return e}}function v(e,t,i,a,n,r,o){const s=[];for(const l of e)s.push(g(l,t,i,a,n,r,o));return s}function g(e,t,i,a,n,r,o){const s=[];for(const l of e){const e=[l[0],l[1]];t&&(e[2]=o>-1?l[2]:a),i&&(e[t?3:2]=r>-1?l[r]:n),s.push(e)}return s}function m(e){var t,i;return null!==(t=null===(i=e.capabilities.editing)||void 0===i?void 0:i.zDefault)&&void 0!==t?t:0}function w(e){return e.capabilities.editing.supportsUpdateWithoutM?void 0:0}function b(e,t){(0,h.F2)(t)&&(e.sourceLayer=t.findSublayerForFeature(e))}},20072:(e,t,i)=>{i.d(t,{A:()=>p});var a=i(35143),n=i(91967),r=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),s=i(69120),l=i(1723),d=i(90992),u=i(9912);let c=class extends n.default{constructor(e){super(e),this.view=null,this.highlightName=l.Tv}add(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,s.i)(this.view,e.layer);(0,d.Of)(t)&&this.addHandles(t.highlight(e,{name:this.highlightName}),(0,u.getHighlightKeyForFeature)(e))}_removeHighlight(e){e&&this.removeHandles((0,u.getHighlightKeyForFeature)(e))}};(0,a._)([(0,r.MZ)()],c.prototype,"view",void 0),(0,a._)([(0,r.MZ)({constructOnly:!0})],c.prototype,"highlightName",void 0),c=(0,a._)([(0,o.$)("esri.views.draw.support.HighlightHelper")],c);const p=c},21661:(e,t,i)=>{i.d(t,{P:()=>l,v:()=>d});var a=i(39356),n=i(54901),r=i(50346),o=i(68134),s=i(95600);async function l(e){let{view:t,data:l,signal:u,next:c,cancel:p}=e;const{creationInfo:h}=l;if(!h)return(0,n.hA)();if(!d(h))return(0,n.hA)();const{layer:f}=h,y=null!=h.geometryToPlace;if(h.geometryToPlace=null,y)return p(),(0,n.hA)();const{Upload:v}=await i.e(34881).then(i.bind(i,34881));(0,r.throwIfAborted)(u);const g=new v;l.upload=g;let m=null;const w=()=>{var e;return null===(e=m)||void 0===e?void 0:e.remove()},b=(0,n.vE)([(0,o.watch)((()=>g.state),(e=>{switch(e){case"default":case"error":w();break;case"pending":w(),m=(0,s.Pz)(t);break;case"success":{h.maxFeatures=1;const{result:e}=g;"georeferenced"===(null===e||void 0===e?void 0:e.type)||"georeferenced-reprojected"===(null===e||void 0===e?void 0:e.type)?(h.geometryToPlace=e.mesh,h.initialFeature=new a.default({attributes:(0,s.nc)(l.fullTemplate,h.attributeOverrides),geometry:e.mesh,sourceLayer:f}),t.goTo(h.initialFeature,{animate:!1}).catch(r.ignoreAbortErrors)):h.geometryToPlace=null===e||void 0===e?void 0:e.mesh,w(),c();break}}})),(0,n.hA)((()=>{g.cancel(),w()}))]);return g.uploadTo(f),b}function d(e){const t=null===e||void 0===e?void 0:e.layer;return"scene"===(null===t||void 0===t?void 0:t.type)}},48594:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var a=i(35143),n=i(91967),r=i(19276),o=i(76460),s=i(67993),l=i(46053),d=(i(81806),i(47249),i(85842)),u=i(5600),c=i(79256);let p=class extends n.default{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new s.A}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&(0,u.w2)(this.fullTemplate)}get pendingFeatures(){return new r.default([...this._pendingEdits.keys()])}set selectedPendingFeature(e){this._set("selectedPendingFeature",e),this.temporaryHighlightFeature=null}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach((t=>{t.timeZone=e}))}isSubmittable(e){const t=this._pendingEdits.get(e);return!(null===t||void 0===t||!t.submittable)||!(null===t||void 0===t||!t.isAssociation)}isDisplayable(e){var t;return!(null!==(t=this._pendingEdits.get(e))&&void 0!==t&&t.isAssociation)}addPendingFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAssociation:!1};this.temporaryHighlightFeature=null;const{_pendingEdits:a}=this;if(a.has(e))return a.get(e);e.sourceLayer||o.A.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData").warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const n=new c.default({feature:e,isAssociation:i.isAssociation});return n.trackChanges(t),a.set(e,n),n}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){this.temporaryHighlightFeature=null;const{_pendingEdits:t}=this,i=t.get(e);i&&(i.destroy(),t.delete(e)),this.selectedPendingFeature===e&&(this.selectedPendingFeature=null)}getFeatureTitle(e){var t;return null===(t=this._pendingEdits.get(e))||void 0===t?void 0:t.displayTitle}};(0,a._)([(0,l.MZ)()],p.prototype,"creationInfo",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"editorItem",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"fullTemplate",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"isSharedTemplateWorkflow",null),(0,a._)([(0,l.MZ)()],p.prototype,"parent",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"pendingFeatures",null),(0,a._)([(0,l.MZ)()],p.prototype,"selectedPendingFeature",null),(0,a._)([(0,l.MZ)()],p.prototype,"temporaryHighlightFeature",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],p.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"snappingManager",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"templateExecutorInfo",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"viewModel",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"upload",void 0),(0,a._)([(0,l.MZ)()],p.prototype,"timeZone",null),p=(0,a._)([(0,d.$)("esri.widgets.Editor.CreateFeaturesWorkflowData")],p);const h=p},52447:(e,t,i)=>{i.d(t,{y:()=>s});var a=i(35143),n=i(54099),r=i(46053),o=(i(81806),i(76460),i(47249),i(85842));let s=class extends n.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};(0,a._)([(0,r.MZ)({constructOnly:!0})],s.prototype,"graphic",void 0),(0,a._)([(0,r.MZ)()],s.prototype,"tracking",void 0),(0,a._)([(0,r.MZ)()],s.prototype,"displaying",void 0),(0,a._)([(0,r.MZ)()],s.prototype,"error",void 0),(0,a._)([(0,r.MZ)()],s.prototype,"isDraped",void 0),s=(0,a._)([(0,o.$)("esri.views.3d.layers.graphics.GraphicState")],s)},55754:(e,t,i)=>{i.d(t,{V:()=>o,t:()=>s});var a=i(31633),n=i(76797),r=i(4955);function o(e,t,i){var r;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.default,s=0;if("2d"===i.type)s=t*(null!==(r=i.resolution)&&void 0!==r?r:0);else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),r=i.basemapSpatialReference;s=null==r||r.equals(i.spatialReference)?t*n:(0,a.GA)(r)/(0,a.GA)(i.spatialReference)}const l=e.x-s,d=e.y-s,u=e.x+s,c=e.y+s,{spatialReference:p}=i;return o.xmin=Math.min(l,u),o.ymin=Math.min(d,c),o.xmax=Math.max(l,u),o.ymax=Math.max(d,c),o.spatialReference=p,o}function s(e,t,i){const a=i.toMap(e);return null!=a&&o(a,(0,r.o)(),i,l).intersects(t)}const l=new n.default},56061:(e,t,i)=>{i.d(t,{t:()=>n,x:()=>a});const a=["freehand","hybrid","click"],n="click"},63733:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var a=i(35143),n=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),o=i(5364),s=i(25515),l=i(65624),d=i(5682),u=i(64519),c=i(731);let p=class extends((0,l.dM)((0,d.j)(s.default))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,a._)([(0,n.MZ)({type:c.A})],p.prototype,"elevationInfo",void 0),(0,a._)([(0,n.MZ)((0,o.C)(u.Y,"graphics"))],p.prototype,"graphics",void 0),(0,a._)([(0,n.MZ)({type:["show","hide"]})],p.prototype,"listMode",void 0),(0,a._)([(0,n.MZ)()],p.prototype,"screenSizePerspectiveEnabled",void 0),(0,a._)([(0,n.MZ)({readOnly:!0})],p.prototype,"type",void 0),(0,a._)([(0,n.MZ)({constructOnly:!0})],p.prototype,"internal",void 0),p=(0,a._)([(0,r.$)("esri.layers.GraphicsLayer")],p);const h=p},79256:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var a=i(35143),n=i(91967),r=i(50346),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),l=i(41289),d=i(23301);let u=class extends n.default{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=(0,r.debounce)(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){var e,t;return!function(e,t){const i=null!==e&&void 0!==e?e:{},a=null!==t&&void 0!==t?t:{},n=new Set(Object.keys(i));(0,l.FB)(n,Object.keys(a));for(const r of n){const e=i[r],t=a[r];if(!(0,d.D_)(e,t))return!1}return!0}(null===(e=this.initialFeature)||void 0===e?void 0:e.attributes,null===(t=this.feature)||void 0===t?void 0:t.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(e){this._set("timeZone",e),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.feature;this.initialFeature=null===e||void 0===e?void 0:e.clone(),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified")),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const t=null===e||void 0===e?void 0:e.geometry;return function(e){return null==e?null:JSON.stringify(e)}("mesh"===(null===t||void 0===t?void 0:t.type)?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}async _refreshDisplayTitle(e){const t=this.feature,i=null===t||void 0===t?void 0:t.sourceLayer;if(!i||!("getFeatureTitle"in i))return;const a=await i.getFeatureTitle(t,{fetchMissingFields:!1,timeZone:this.timeZone});e.aborted||(this.displayTitle=""===a?null:a)}};(0,a._)([(0,o.MZ)()],u.prototype,"_stagedForDelete",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"attributesModified",null),(0,a._)([(0,o.MZ)()],u.prototype,"feature",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"geometryModified",null),(0,a._)([(0,o.MZ)()],u.prototype,"initialFeature",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"modified",null),(0,a._)([(0,o.MZ)()],u.prototype,"submittable",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"displayTitle",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"isAssociation",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"timeZone",null),u=(0,a._)([(0,s.$)("esri.widgets.Editor.Edits")],u);const c=u},81130:(e,t,i)=>{i.d(t,{AO:()=>d,Bi:()=>s,Cg:()=>r,Rg:()=>l,Vi:()=>c,fT:()=>o,zE:()=>u});var a=i(87663),n=i(76797);const r=100;function o(e){return"point"===e.type}function s(e){return"polygon"===e.type}function l(e){return"polyline"===e.type}function d(e){return!!e&&"radial"===e.type}function u(e){let t=null;for(const i of e)if(i.graphic.geometry){const e=i.graphic.geometry,a=o(e)?new n.default({spatialReference:e.spatialReference,xmin:e.x,xmax:e.x,ymax:e.y,ymin:e.y}):e.extent;t=null==t?null===a||void 0===a?void 0:a.clone():t.union(a.extent)}return t}function c(e){const t=new Map;for(const n of e){var i;null===(i=(0,a.tE)(t,n.id,(()=>({addFeatures:[],id:n.id,identifierFields:{globalIdField:n.layer.globalIdField,objectIdField:n.layer.objectIdField}}))).addFeatures)||void 0===i||i.push(n.graphic)}return[...t.values()]}},88877:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var a=i(89379),n=i(35143),r=i(50076),o=i(54099),s=i(50346),l=i(46053),d=(i(81806),i(76460),i(47249),i(85842)),u=i(19451);let c=class extends o.A.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new u.U,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter((e=>!e.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!0};return!1!==e.force?this._cancel(e):new Promise(((t,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel((0,a.A)((0,a.A)({},e),{},{force:!0})).then(t)},deny:()=>i(new r.default("workflow:cancel-denied","Request to cancel workflow was denied."))}})}))}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,i=t.findIndex((t=>t.id===e));this._indexHistory.push(this._stepIndex),await this._go(i)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelCurrentStep:!1};await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel(){let{emitCancelEvent:e=!0,error:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&(this._set("started",!1),await this._transaction((()=>{var e;return null===(e=this.steps[this._stepIndex])||void 0===e?void 0:e.tearDown({canceled:!0})}))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._transaction((async()=>{const{steps:i}=this;if(!(e<=-1||e>=i.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await i[this._lastStepIndex].tearDown({canceled:t});try{await i[e].setUp()}catch(a){(0,s.throwIfNotAbortError)(a)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}}))}async _transaction(e){const t=this._pendingOperation,i=(0,s.createResolver)(),a=(null!==t&&void 0!==t?t:Promise.resolve()).then((()=>i.promise));this._pendingOperation=a,this._updatingHandles.addPromise(a);try{t&&await t,await e()}finally{i.resolve(),a===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};(0,n._)([(0,l.MZ)()],c.prototype,"data",void 0),(0,n._)([(0,l.MZ)()],c.prototype,"hasNextStep",null),(0,n._)([(0,l.MZ)()],c.prototype,"hasPreviousStep",null),(0,n._)([(0,l.MZ)()],c.prototype,"onCommit",void 0),(0,n._)([(0,l.MZ)()],c.prototype,"reliesOnOwnerAdminPrivileges",null),(0,n._)([(0,l.MZ)()],c.prototype,"hasInvalidFormTemplate",null),(0,n._)([(0,l.MZ)()],c.prototype,"shouldShowAttachments",null),(0,n._)([(0,l.MZ)()],c.prototype,"shouldAllowAttachmentEditing",null),(0,n._)([(0,l.MZ)()],c.prototype,"started",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],c.prototype,"stepId",null),(0,n._)([(0,l.MZ)()],c.prototype,"steps",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],c.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],c.prototype,"helpMessage",null),(0,n._)([(0,l.MZ)()],c.prototype,"hasPendingEdits",null),(0,n._)([(0,l.MZ)()],c.prototype,"keyboardCancellationEnabled",null),(0,n._)([(0,l.MZ)()],c.prototype,"updating",null),c=(0,n._)([(0,d.$)("esri.widgets.Editor.Workflow")],c);const p=c},89646:(e,t,i)=>{i.d(t,{$h:()=>y,Ef:()=>M,IP:()=>g,P1:()=>_,hF:()=>F,jQ:()=>b,rT:()=>I,rZ:()=>a,uR:()=>m});var a,n,r=i(73582),o=i(24648),s=i(31633),l=i(19555),d=i(72745),u=i(20664),c=i(9392),p=i(14487),h=i(7137),f=i(80963);function y(e,t){if(null==e||null==t)return;const i=v(e,t);return null!=i?(0,o.Wq)(i,"radians","geographic"):void 0}(n=a||(a={})).Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral";const v=(()=>{const e=(0,c.vt)(),t=(0,c.vt)();return(i,a)=>{var n,r;return(0,u.i)(e,i.x,i.y,null!==(n=i.z)&&void 0!==n?n:0),(0,u.i)(t,a.x,a.y,null!==(r=a.z)&&void 0!==r?r:0),g(e,t,i.spatialReference,a.spatialReference)}})(),g=(()=>{const e=(0,d.vt)(),t=(0,c.vt)(),i=(0,c.vt)();return(a,n,r,o)=>{if((0,u.p)(a,n))return;const c=(0,h.geodesicCompatibleSpatialReference)(r),y=(0,h.geodesicCompatibleSpatialReference)(o);if(c&&y&&(0,f.aI)(c,y)&&(0,p.F)(a,r,t,c)&&(0,p.F)(n,o,i,y)){const{azimuth:e}=(0,h.inverseGeodeticSolver)(S,t,i,c);return null!=e?(0,s.oU)(e,"degrees","radians"):void 0}e[0]=n[0]-a[0],e[1]=n[1]-a[1];let v=(0,l.g7)(d.JP,e);return e[0]<0&&(v=T-v),v}})();function m(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Absolute;if(t&&i)switch(n){case a.Absolute:return y(t,i);case a.Relative:return b(w(e,t,i),a.Relative);case a.RelativeBilateral:return b(w(e,t,i),a.RelativeBilateral)}}function w(e,t,i){if(!e||!t||!i)return;const a=v(e,t),n=v(t,i);return null!=a&&null!=n?(0,o.Wq)(n-a,"radians","geographic"):void 0}function b(e,t){if(null!=e)switch(t){case a.Absolute:return _(e);case a.Relative:{const t=F(e);let i=P.normalize(t,0,!0);return-180===i&&(i=180),(0,o.Wq)(i,"degrees","geographic")}case a.RelativeBilateral:{const t=F(e),i=Math.abs(P.normalize(t,0,!0));return(0,o.Wq)(i,"degrees","geographic")}}}function _(e){const t=F(e),i=k.normalize(t,0,!0);return(0,o.Wq)(i,"degrees","geographic")}const I=(()=>{const e=(0,c.vt)();return function(t,i,a,n,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,u.c)(e,i);const d=F(r);if("geodesic"===l){const r=(0,h.geodesicCompatibleSpatialReference)(a);if(r&&(0,p.F)(e,a,e,r))return(0,h.directGeodeticSolver)(t,e,d,n,r),t[2]=i[2],!!(0,p.F)(t,r,t,a)}const c=(0,o.g2)(d,"geographic","arithmetic"),f=(0,s.oU)(c,"degrees","radians"),y=i[0]+n*Math.cos(f),v=i[1]+n*Math.sin(f),g=i[2];return(0,u.i)(t,y,v,g),!0}})();function F(e){if(null!=e)return(0,o.g2)(A(e),e.rotationType,"geographic")}function M(e){if(null!=e)return(0,o.g2)(A(e),e.rotationType,"arithmetic")}function A(e){return(0,s.oU)(e.value,e.unit,"degrees")}const S=new h.InverseGeodeticSolverResult,T=2*Math.PI,k=r.ie,P=new r.hr(-180,180)},94277:(e,t,i)=>{function a(e,t,i){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const i=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}(t,i);case"polygon":return function(e,t){const i=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(i<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,i);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,i);default:return}}i.d(t,{$:()=>a})},95327:(e,t,i)=>{i.r(t),i.d(t,{default:()=>l});var a=i(35143),n=i(91967),r=i(46053),o=(i(81806),i(76460),i(47249),i(85842));let s=class extends n.default{constructor(e){super(e),this.enabled=!1}};(0,a._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],s.prototype,"enabled",void 0),s=(0,a._)([(0,o.$)("esri.views.interactive.sketch.SketchLabelOptions")],s);const l=s},95600:(e,t,i)=>{i.d(t,{bn:()=>be,nv:()=>Ae,ON:()=>Se,Xm:()=>j,z4:()=>we,Zs:()=>de,mU:()=>ce,Z5:()=>le,nc:()=>re,sE:()=>ke,_3:()=>Ee,uh:()=>Y,EH:()=>X,EO:()=>N,Ks:()=>Fe,bl:()=>U,sy:()=>te,r8:()=>Ie,O:()=>Pe,vM:()=>ye,Pi:()=>J,cY:()=>he,Pz:()=>Te,AP:()=>B,J_:()=>pe,z7:()=>ve,FC:()=>W,EA:()=>fe,QZ:()=>Me});var a=i(89379),n=i(69539),r=i(39356),o=i(18690),s=i(98773),l=(i(81806),i(50076)),d=i(54901),u=i(53084),c=i(76460),p=i(87663),h=i(50346),f=i(68134),y=i(76931),v=i(15011),g=i(5600),m=i(49750),w=i(66830),b=i(63733),_=i(53430),I=i(31933),F=i(4955),M=i(3454),A=i(4815),S=i(15492),T=i(86875),k=i(38996),P=i(76940),E=i(87708),x=i(8503),V=i(5874),C=i(52447),Z=i(56061),O=i(55754),H=i(53787);function R(e,t){const i={};t=t||{continueOnCircularDependency:!1};const a=[],n={};e.forEach((e=>{const t=e[0];let a;(a=i[t])||(a=i[t]=new L(t)),e.forEach((e=>{e!==t&&(i[e]||(i[e]=new L(e)),a.afters.push(e))}))}));const r=Object.keys(i);return r.sort(D),r.forEach((function e(r,o){const s=i[r],l=s.id;if(n[r])return;const d=Array.isArray(o)?o:[];d.push(l),n[r]=!0,s.afters.sort(D),s.afters.forEach((i=>{if(d.includes(i)){var a;if(null!==(a=t)&&void 0!==a&&a.continueOnCircularDependency)return;throw new Error("Circular chain found: "+l+" must be before "+i+" due to a direct order specification, but "+i+" must be before "+l+" based on other specifications.")}e(i,d.slice())})),a.push(l)})),a.reverse()}class L{constructor(e){this.id=e,this.afters=[]}}function D(e,t){return e<t?1:e>t?-1:0}var z=i(21270);const G=()=>c.A.getLogger("esri.widgets.Editor.workflowUtils");function U(e){return"update"===e.type}function N(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(null===e||void 0===e?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let a=null,n=null;const r=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=(0,S.getRotationAngle)(t,e)));1===r.length&&(a=function(e,t){var i;const a="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,n=e.field,r=t.fields&&t.fields.filter((e=>e.name===n)),o=r&&1===r.length?r[0].type:"double",s={initial:0,current:0};return{field:n,fieldType:o,getDefault:()=>Promise.resolve(0),getValue:e=>(s.current=s.initial-a*e,q((s.current+360)%360,o)),setInitialValue:e=>{s.initial=e,s.current=0},isUpdatingInteractively:!1,rotationType:null!==(i=e.rotationType)&&void 0!==i?i:"geographic"}}(r[0],t));const o=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&(0,A.KZ)(t)===A._w.RealWorldSize&&null!=(0,S.getSize)(t,e)));return 1===o.length&&(n=function(e,t){var a;const n=e.field,r=e.axis,o=t.fields&&t.fields.filter((e=>e.name===n)),s=o&&1===o.length?o[0].type:"double",l={initial:0,current:0},d=null!==(a=M.j[e.valueUnit])&&void 0!==a?a:1;let u;return u="area"===e.valueRepresentation?e=>(e*d/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*d/2:e=>e*d,{field:n,fieldType:s,getDefault:async(e,t)=>q(u(await async function(e,t,a){if(null==t)return 0;const{symbol:n}=(0,E.t)(t);if(null==n||"web-style"===n.type||"cim"===n.type)return 0;const r=n.symbolLayers.at(0);if(!r)return 0;switch(r.type){case"icon":{const{computeIconLayerResourceSize:e}=await i.e(44374).then(i.bind(i,44374));return r.size||Math.min(me.icon,(await e(r,me.icon))[0])||me.icon}case"text":return r.size||me.text;case"line":return r.size||me.line;case"object":{const{computeObjectLayerResourceSize:t}=await i.e(44374).then(i.bind(i,44374));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(r,e.scale/me.viewScaleSizeFactor),a)}case"path":return(null!=r.width?r.width:r.height)||e.scale/me.viewScaleSizeFactor;case"extrude":return r.size||e.scale/me.viewScaleSizeFactor;default:return 0}}(t,e,r)),s),getValue:(e,t)=>(l.initial||(l.initial=t.pixelSizeAt(t.center)),l.current=l.initial*e,q(l.current,s)),setInitialValue:e=>{l.initial=e,l.current=0},isUpdatingInteractively:!1,displayUnit:_e(e.valueUnit),axis:e.axis}}(o[0],t)),{rotation:a,size:n}}function q(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function W(e,t,i){const a=await(0,x.getDisplayedSymbol)(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:i});null!=(0,v.Ui)(e.symbol,a)&&(e.symbol=a)}function j(e,t){if(!e||!t)throw new Error("no geometry type");if("multipatch"===e)return{tool:"mesh",createOptions:{mode:"hybrid"}};const i=new Map;i.set("circle",{mode:"freehand"}),i.set("rectangle",{mode:"freehand"});const a={mode:Z.t,optionsPerTool:i};if((0,g.w2)(t)){var n,r;const o=t.defaultTool,s=(0,g.Dt)(t)&&null!==(n=null===(r=t.definition)||void 0===r?void 0:r.inputGeometryType)&&void 0!==n?n:e;switch(o){case"freehand":case"stream-line":return{tool:"polyline"===s?"freehandPolyline":"freehandPolygon",createOptions:a};case"autocomplete-freehand-polygons":case"stream-polygon":return{tool:"freehandPolygon",createOptions:a};case"autocomplete-polygons":case"difference-polygon":case"create-structures":case"polygon":case"trace":return{tool:"polygon"===s?"polygon":"polyline",createOptions:a};case"circle":return i.get("circle").preserveAspectRatio=!0,{tool:"circle",createOptions:a};case"ellipse":return i.get("circle").preserveAspectRatio=!1,{tool:"circle",createOptions:a};case"create-points-along-line":case"multipoint":return{tool:"multipoint",createOptions:a};case"line":case"radial-line":case"right-angle-line":case"split":case"two-point-line":return{tool:"polyline",createOptions:a};case"rectangle":case"regular-polygon":case"right-angle-polygon":return{tool:"rectangle",createOptions:a};case"elevation-point-from-contour":case"elevation-point-from-dem":case"parcel-seed":case"point":case"point-and-rotation":case"point-at-end-of-line":return{tool:"point",createOptions:a}}}else{const n=t.drawingTool;if("circle"===n||"ellipse"===n)return i.get("circle").preserveAspectRatio="circle"===n,{tool:"circle",createOptions:a};if("rectangle"===n)return{tool:"rectangle",createOptions:a};if("freehand"===n)return{tool:"polygon"===e?"freehandPolygon":"freehandPolyline",createOptions:a}}return{tool:e,createOptions:a}}async function B(e,t,i){var a;const{creationInfo:n,fullTemplate:r}=t;if(!n)throw new l.default("No creation info provided.");const o=n.layer,s=re(r,n.attributeOverrides),{view:d}=e,u="2d"===(null===d||void 0===d?void 0:d.type);(0,g.Dt)(r)||(0,g.JC)(r)||await oe(e,o,s,i,u?d.scale:null);const{capabilities:c}=o;e.layer.elevationInfo=o.elevationInfo;const p=j(o.geometryType,r);e.defaultCreateOptions={graphicProperties:{attributes:s,sourceLayer:o},mode:p.createOptions.mode,optionsPerTool:p.createOptions.optionsPerTool,preserveAspectRatio:p.createOptions.preserveAspectRatio,hasZ:c.data.supportsZ,defaultZ:null!==(a=u?c.editing.zDefault:null)&&void 0!==a?a:e.defaultCreateOptions.defaultZ},null==n.geometryToPlace?await e.create(p.tool):await e.place(n.geometryToPlace,{graphicProperties:{attributes:s,sourceLayer:o}})}async function J(e){return(0,d.vE)([await K(e),await $(e)])}async function K(e){let{creationAttributes:t,data:i,sketchViewModel:a,view:n,webStyleCache:r}=e;const{creationInfo:o}=i,{fullTemplate:s}=i;if(!o||"2d"!==(null===n||void 0===n?void 0:n.type)||(0,g.Dt)(s)||(0,g.JC)(s))return null;const l=(0,h.debounce)((e=>oe(a,o.layer,t,r,e)));return(0,f.watch)((()=>n.scale),(e=>l(e)))}async function $(e){var t,i,a;let{data:r,sketchViewModel:s,view:u}=e;const{templateExecutorInfo:c}=r;if(!c)return null;const p=s.activeComponent;if(!u||!(0,z.xJ)(p))return G().error(new l.default("Failed to set up template feedback.")),null;const y=new b.default({effect:"saturate(0.6) opacity(0.8)",listMode:"hide",title:"Shared Template Feedback Graphics"});null===(t=u.map)||void 0===t||t.add(y);const{executor:v,serviceLayersById:g}=c,m=null!==(i=null===(a=u.theme)||void 0===a?void 0:a.accentColor)&&void 0!==i?i:new n.default([255,165,0,1]);return(0,d.vE)([(0,f.on)((()=>p),["cursor-update","vertex-add"],(()=>{var e;y.removeAll();const t=null===(e=p.graphic)||void 0===e?void 0:e.geometry;if(!t||!function(e){switch(e.type){case"point":case"multipoint":return!0;case"polyline":return e.paths[0].length>1;case"polygon":{const t=e.rings[0];return(0,o.aI)(t.at(0),t.at(-1))?t.length>2:t.length>1}default:return!1}}(t))return;const i=v(t,"digitizing");if(!(0,h.isPromiseLike)(i))for(const a of i.edits){const e=g.get(a.id);if(e&&a.addFeatures&&0!==a.addFeatures.length)for(const t of e)if(!t.isTable)for(const e of a.addFeatures){const t=Q(e,m);t&&y.add(t)}}})),(0,d.hA)((()=>{u.map.remove(y),y.destroy()}))])}function Q(e,t){var i;let n=null;switch(null===(i=e.geometry)||void 0===i?void 0:i.type){case"point":case"multipoint":n=new P.default({angle:0,color:t,outline:new k.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:1}),path:"undefined",size:8,style:"circle",xoffset:0,yoffset:0});break;case"polygon":n=new T.default({color:t,outline:new k.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:3}),style:"none"});break;case"polyline":n=new k.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:2});break;default:return null}return new r.default({geometry:e.geometry,symbol:n,attributes:(0,a.A)({},e.attributes)})}async function Y(e,t){const i=await(0,V.Z)(t).load(),a=(0,I.Sv)(e)?e.parent:e;return i.tablesAndLayersLookup.get(a)}async function X(e,t){const i=await Y(e,t);if(!i)return new Map;const a=new Map;for(const n of i.layersAndTables)(0,p.tE)(a,n.layerId,(()=>[])).push(n);return a}function ee(e){var t;const i=e.objectIdField,a=null!==(t=e.globalIdField)&&void 0!==t?t:"";return{id:e.layerId,identifierFields:{objectIdField:i,globalIdField:a},addFeatures:[],deleteAttachments:[],addAttachments:[],deleteFeatures:[],updateFeatures:[]}}function te(e){const{edits:t,serviceInfo:i,view:a,findOriginalFeature:n}=e,r=function(e){const t=new Map;for(const i of e)t.set(i.layerId,i);return t}(i.layersAndTables),s=i.layersAndTables.toArray(),{allEditData:d,editDataByLayerIdMap:u,editDataByIdMap:c}=function(e,t,i){const a=new Map,n=[],r=new Map;let o=1;for(const h of e){const e=[],f=t.get(h.id);if(!f)throw new l.default("Failed to prepare applyEdits payload. Layer with id ".concat(h.id," not found."));for(const t of null!==(s=h.addFeatures)&&void 0!==s?s:[]){var s;e.push({uniqueId:"T"+o++,operationType:"add",layer:f,after:t})}for(const t of null!==(d=h.deleteFeatures)&&void 0!==d?d:[]){var d;e.push({uniqueId:"T"+o++,operationType:"delete",before:t,layer:f})}for(const t of null!==(u=h.deleteAttachments)&&void 0!==u?u:[]){var u;e.push({uniqueId:"T"+o++,operationType:"deleteAttachment",attachmentId:t,layer:f})}for(const t of null!==(c=h.addAttachments)&&void 0!==c?c:[]){var c;e.push({uniqueId:"T"+o++,operationType:"addAttachment",attachment:t,layer:f})}for(const t of null!==(p=h.updateFeatures)&&void 0!==p?p:[]){var p;e.push({uniqueId:"T"+o++,operationType:"modify",before:i(t),after:t,layer:f})}a.set(f.layerId,e);for(const t of e)n.push(t),r.set(t.uniqueId,t)}return{allEditData:n,editDataByIdMap:r,editDataByLayerIdMap:a}}(t,r,n),p=function(e,t,i){const a=[];for(const r of e){var n;const e=null!==(n=r.layer.relationships)&&void 0!==n?n:[],{uniqueId:o}=r;for(const n of e){const e=n.keyField;if("origin"===n.role){const s=i.get(n.relatedTableId);if(!s||0===s.length)continue;const l=ie(r.layer,n),d=t.get(l);if(void 0===d||""===d)continue;switch(r.operationType){case"add":for(const t of s)t!==r&&("add"!==t.operationType&&"modify"!==t.operationType||t.after.attributes[d]===r.after.attributes[e]&&a.push([o,t.uniqueId]));break;case"modify":if(r.before.attributes[e]!==r.after.attributes[e])for(const t of s){const i=t.uniqueId;t!==r&&("delete"===t.operationType?t.before.attributes[d]===r.before.attributes[e]?a.push([i,o]):t.before.attributes[d]===r.after.attributes[e]&&a.push([o,i]):"add"===t.operationType?t.after.attributes[d]===r.after.attributes[e]?a.push([o,i]):t.after.attributes[d]===r.before.attributes[e]&&a.push([i,o]):"modify"===t.operationType&&(t.before.attributes[d]!==t.after.attributes[d]?t.after.attributes[d]===r.after.attributes[e]?a.push([o,i]):a.push([i,o]):a.push([o,i])))}break;case"delete":for(const t of s)t!==r&&("delete"!==t.operationType&&"modify"!==t.operationType||t.before.attributes[d]===r.before.attributes[e]&&a.push([t.uniqueId,o]))}}}}return a}(d,function(e,t){const i=new Map;for(const r of e)for(const e of null!==(a=r.relationships)&&void 0!==a?a:[]){var a;if(i.set(ie(r,e),""),t.has(e.relatedTableId)){const a=t.get(e.relatedTableId);if(a.length>0)for(const t of null!==(n=a[0].layer.relationships)&&void 0!==n?n:[]){var n;if(t.id===e.id){i.set(ie(r,e),t.keyField);break}}}}return i}(s,u),u);if(function(e,t,i){const a=[];for(const r of e)ae(r.layer,i)&&a.push(r);if(0===a.length)return;let n=[];for(const r of a){const i=r.layer;switch(r.operationType){case"delete":n=[...ne(r.before.attributes[i.fieldsIndex.get("fromglobalid").name],e),...ne(r.before.attributes[i.fieldsIndex.get("toglobalid").name],e)];for(const e of n)t.push([r.uniqueId,e.uniqueId]);break;case"add":n=[...ne(r.after.attributes[i.fieldsIndex.get("fromglobalid").name],e),...ne(r.after.attributes[i.fieldsIndex.get("toglobalid").name],e)];for(const e of n)t.push([e.uniqueId,r.uniqueId])}}}(d,p,a),0===p.length)return t;const h=R(p,{continueOnCircularDependency:!0}).map((e=>c.get(e))).filter(o.Ru),f=new Map;for(const o of h)f.set(o.uniqueId,o);const y=[];for(const o of d)f.has(o.uniqueId)||y.push(o);const v=[];let g=null;for(const o of h){const{layer:e}=o;switch(null==g?g=ee(e):g.id!==e.layerId&&(v.push(g),g=ee(e)),o.operationType){case"add":case"modify":g.addFeatures.push(o.after);break;case"delete":g.deleteFeatures.push(o.before)}}null!==g&&v.push(g);for(const o of y){var m;const e=o.layer.layerId,t=null!==(m=v.find((t=>t.id===e)))&&void 0!==m?m:ee(o.layer);switch(v.includes(t)||v.push(t),o.operationType){case"add":t.addFeatures.push(o.after);break;case"modify":t.updateFeatures.push(o.after);break;case"delete":t.deleteFeatures.push(o.before);break;case"deleteAttachment":t.deleteAttachments.push(o.attachmentId);break;case"addAttachment":t.addAttachments.push(o.attachment)}}for(const o of v)void 0!==o.deleteAttachments&&0===o.deleteAttachments.length&&delete o.deleteAttachments,void 0!==o.addAttachments&&0===o.addAttachments.length&&delete o.addAttachments;return v}function ie(e,t){return"".concat(e.layerId,":").concat(t.id)}function ae(e,t){var i;return!!(null!==t&&void 0!==t&&t.map&&"utilityNetworks"in t.map&&null!==(i=t.map.utilityNetworks)&&void 0!==i&&i.length&&t.map.utilityNetworks.some((t=>{var i;return!(!t.loaded||null===(i=e.url)||void 0===i||!i.startsWith(t.featureServiceUrl)||e.layerId!==t.networkSystemLayers.associationsTableId)})))}function ne(e,t){const i=[],a=t.filter((e=>{let{layer:t}=e;return""!==t.globalIdField&&null!=t.globalIdField}));for(const o of a){var n,r;const t=o.layer.globalIdField;("before"in o&&(null===(n=o.before)||void 0===n?void 0:n.attributes[t])===e||"after"in o&&(null===(r=o.after)||void 0===r?void 0:r.attributes[t])===e)&&i.push(o)}return i}function re(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.Dt)(e)||(0,g.JC)(e)?{}:(0,g.gZ)(e)?(0,a.A)((0,a.A)({},e.prototype.attributes),i):(0,g.Cq)(e)?(0,a.A)((0,a.A)({},null===(t=e.definition)||void 0===t?void 0:t.defaultValues),i):(0,a.A)({},i)}async function oe(e,t,i,a,n){var o;const s=new r.default({sourceLayer:t,attributes:i}),{rotation:l,size:d}=N(s);let u=await(0,x.getDisplayedSymbol)(s,{useSourceLayer:!0,webStyleCache:a,scale:n}),c=!1;for(const r of[d,l])null!=r&&null==i[r.field]&&(i[r.field]=await r.getDefault(u,e.view),c=!0);switch(c&&(u=await(0,x.getDisplayedSymbol)(s,{useSourceLayer:!0,webStyleCache:a,scale:n})),null===(o=u)||void 0===o?void 0:o.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=u;break;case"simple-line":case"line-3d":e.polylineSymbol=u;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=u;break;case"mesh-3d":e.meshSymbol=u}se(e.tooltipOptions,d,l)}function se(e,t,i){var a;e.visualVariables=null!=t||null!=i?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=i?{valueType:i.fieldType,rotationType:null!==(a=i.rotationType)&&void 0!==a?a:"geographic"}:null}:null}function le(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}async function de(e,t,i,a){switch(t.type){case"3d":return async function(e,t,i,a){if(0===e.length)return[];const{updatable:n,graphicsByLayer:r}=await i.async((async()=>{const{results:n}=await(0,h.whenOrAbort)((0,H.oZ)(t,i),a),r=new Map,o=e=>{const t=e.layer,i=r.get(t);if(!i){const e=new Array;return r.set(t,e),e}return i};(0,H.h$)(n).forEach((e=>{let{graphic:t}=e;return o(t).push(t)}));const s=e.filter((e=>{let{capabilities:t,layer:i}=e;return t.update.enabled&&r.has(i)}));return 0!==s.length&&i.stopPropagation(),{updatable:s,graphicsByLayer:r}}));return(0,h.whenOrAbort)(Promise.allSettled(n.map((async e=>{let{layer:t}=e;const i=r.get(t),n=ue(t);if(i.every((e=>(0,_.featureHasFields)(n,e))))return i;const s=[];for(const a of i){s.push(a.getObjectId());const e=Object.keys(a.attributes);(0,o.FB)(n,e)}const l=t.createQuery();return l.returnGeometry=!1,l.objectIds=s,l.outFields=(0,_.fixFields)(t.fieldsIndex,n),t.queryFeatures(l,{signal:a}).then((e=>{let{features:t}=e;return t}))}))),a)}(e,t,i,a);case"2d":return async function(e,t,i,a){if(0===e.length)return[];const{mapPoint:n}=i;if(null==n)return[];let r=null;const o=await i.async((async()=>{const{results:n}=await(0,h.whenOrAbort)(t.hitTest(i),a);if(0===n.length)return[];const o=new Set;r=(0,H.h$)(n),r.forEach((e=>{let{graphic:t}=e;return t&&o.add(t.layer)}));const s=e.filter((e=>o.has(e.layer)&&e.supportsUpdateWorkflow));return s.length>0&&i.stopPropagation(),s}));return(0,h.whenOrAbort)(Promise.allSettled(o.map((async e=>{var o;let{layer:s}=e;const l=s.createQuery();l.returnGeometry=!0,l.outFields=ue(s);const d="renderer"in s?(0,F.o)({renderer:s.renderer,pointerType:i.pointerType}):0;l.geometry=(0,O.V)(n,d,t),l.outSpatialReference=t.spatialReference;const{features:u}=await s.queryFeatures(l,{signal:a});return null!==(o=r)&&void 0!==o&&o.forEach((e=>{let{graphic:t}=e;t.layer!==s||u.some((e=>e.getObjectId()===t.getObjectId()))||u.push(t)})),u}))),a)}(e,t,i,a)}}function ue(e){return(0,_.fixFields)(e.fieldsIndex,[e.objectIdField,(0,_.getDisplayFieldName)({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function ce(e,t,i){const{sourceLayer:a}=e,n=a.createQuery();n.objectIds=[e.getAttribute(a.objectIdField)],n.outFields=["*"],n.returnM=a.capabilities.data.supportsM,n.returnZ=a.capabilities.data.supportsZ,"scene"===a.type&&null!=a.infoFor3D||(n.outSpatialReference=t);const r=await a.queryFeatures(n,{signal:i});return(0,h.throwIfAborted)(i),r.features[0]}async function pe(e){const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:n}=e;await he(e);const r={multipleSelectionEnabled:!1};return"point"===a.geometryType&&(r.enableRotation=null!=n.rotation,r.enableScaling=null!=n.size),i.update(t,r)}async function he(e){const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:n,webStyleCache:r}=e;let o=!1;const{rotation:s,size:l}=n;if([s,l].forEach((async e=>{if(null==e)return;const a=t.getAttribute(e.field);if(null!=a)e.setInitialValue(a);else{const a=await e.getDefault(t.symbol,i.view);e.setInitialValue(a),t.setAttribute(e.field,a),o=!0}})),o){var d;const e="2d"===(null===(d=i.view)||void 0===d?void 0:d.type)?i.view.scale:null;await W(t,r,e)}se(i.tooltipOptions,l,s),i.layer.elevationInfo=a.elevationInfo}async function fe(e,t,i,a,n){var r;if(null==t.geometry||"point"!==(null===(r=t.geometry)||void 0===r?void 0:r.type))return;const o=a.rotation,s=function(e){return null==e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=o&&null!=s){const{field:i,getValue:a}=o;"rotate-stop"===s.type?(o.isUpdatingInteractively=!1,o.setInitialValue(t.getAttribute(i))):(o.isUpdatingInteractively=!0,t.setAttribute(i,a(s.angle,e)))}const l=a.size,d=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=l&&null!=d){const{field:i,getValue:a}=l;"scale-stop"===d.type?(l.isUpdatingInteractively=!1,l.setInitialValue(t.getAttribute(i))):(l.isUpdatingInteractively=!0,t.setAttribute(i,a(d.xScale,e)))}await W(t,n,"2d"===e.type?e.scale:null)}async function ye(e){var t;let{feature:i,featureClone:a,visualVariableAttributes:n,sketchViewModel:r,view:o,onUpdate:s,webStyleCache:l,addUpdatingPromise:u,addHandle:c}=e;await W(a,l,"2d"===o.type?o.scale:null);let p=null;if("2d"===(null===r||void 0===r||null===(t=r.view)||void 0===t?void 0:t.type)){const e=(0,h.debounce)((e=>W(a,l,e)));p=(0,f.watch)((()=>{var e;return null===r||void 0===r||null===(e=r.view)||void 0===e?void 0:e.scale}),(t=>e(t)))}const y=a.sourceLayer,v=Me(o,y);await pe({graphic:a,sketchViewModel:r,sourceLayer:y,visualVariables:n,webStyleCache:l});let g=null;v.then((e=>g=e)).catch((()=>{}));const m=n.size,w=n.rotation,b=(0,f.watch)((()=>i.attributes),(async e=>{let t=!1;for(const i in e){const n=e[i];n!==a.getAttribute(i)&&(a.setAttribute(i,n),null==m||m.isUpdatingInteractively||m.field!==i||m.setInitialValue(n),null==w||w.isUpdatingInteractively||w.field!==i||w.setInitialValue(n),(null==g||g.requiredFields.includes(i))&&(t=!0))}t&&await W(a,l,"2d"===o.type?o.scale:null)})),_=r.on("update",(async e=>{const t=e.graphics[0],i={graphic:t,sketchViewModel:r,sourceLayer:y,visualVariables:n,webStyleCache:l};if("complete"===e.state){if(null===o.activeTool)return pe(i);const e=new AbortController,t=(0,d.rE)(e);return c(t),u((0,f.whenOnce)((()=>null===o.activeTool),e.signal).then((()=>(e.abort(),pe(i)))))}await fe(o,t,e,n,l),s(Se(t),e)})),I=r.on(["undo","redo"],(async e=>{s(Se(e.graphics[0]),e)}));return(0,d.vE)([I,_,(0,d.hA)((()=>r.cancel())),b,p])}async function ve(e,t,i){const a=e.view;e.layer.add(i);const n=t.sourceLayer,r=t.layer,o=t.getAttribute(r.objectIdField);let l=null;function u(e){var t;null!==(t=l)&&void 0!==t&&t.abort(),l=(0,s.UT)((async t=>{var i;const r=await Me(a,n);(0,h.throwIfAborted)(t),null===(i=r.setVisibility)||void 0===i||i.call(r,o,e)}))}return await async function(e,t){if("3d"===e.type){const i=new C.y({graphic:t}),a=e.trackGraphicState(i);await(0,f.whenOnce)((()=>i.displaying||i.error)),a.remove()}else await(0,f.whenOnce)((()=>t.visible))}(a,i),u(!1),(0,d.vE)([ge(a,i,(e=>u(!e))),(0,d.hA)((async()=>{u(!0);try{const e=await Me(a,n);await(0,f.whenOnce)((()=>!e.updating))}finally{e.layer.remove(i)}}))])}function ge(e,t,i){if("3d"===e.type){const a=new C.y({graphic:t});return(0,d.vE)([e.trackGraphicState(a),(0,f.watch)((()=>a.displaying),i)])}return(0,f.watch)((()=>t.visible),i)}const me={icon:(0,y.PN)(24),text:(0,y.PN)(12),line:(0,y.PN)(1),viewScaleSizeFactor:100};function we(e,t,i){let a=!1;return e.filter((e=>!!a||(a=e===t,a))).map((e=>i[e]()))}function be(e,t){e.viewModel.syncFeatureTemplates();const i=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&i){const a=i.layer,n=e.viewModel.getTemplatesForLayer(a);1===n.length&&"scene"!==a.type&&(i.template=n[0],t.shift())}return t}function _e(e){return"unknown"===e?null:e}function Ie(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Fe=e=>/-stop/.test(e)||/vertex-/.test(e),Me=(e,t)=>{const i="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(i)};function Ae(e){return"createInteractiveEditSession"in e}function Se(e){const t=e.geometry;if("mesh"===(null===t||void 0===t?void 0:t.type)){var i,a;const n=e.cloneShallow();return n.attributes=(0,u.clone)(e.attributes),n.geometry=t.cloneShallow(),n.geometry.transform=null!==(i=null===(a=t.transform)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,n}return e.clone()}function Te(e){const t=e.cursor;return e.cursor="progress",(0,d.hA)((()=>e.cursor=t))}async function ke(e,t){const{template:i}=e;if(null==i)return null;if((0,g.Sf)(i))return i.load();if((0,g.w2)(i)){const e=(0,w.B)(t,{makeSharedTemplateFromJSON:xe}),a=await e.getTemplates({templateIds:[i.templateId],featureService:i.featureService});if(0===a.length)throw new l.default("editor:failed-to-load-template","Unable to load the provided template");return a[0].load()}return i}function Pe(e){for(const t of e){const{destinationGraphic:e,destinationField:i,sourceGraphic:a,sourceField:n}=t;e.setAttribute(i,a.getAttribute(n))}}function Ee(e){var t;const i=null===(t=e.templateExecutorInfo)||void 0===t?void 0:t.completionResults;return null!==i&&void 0!==i&&i.length?(i.forEach((e=>Pe(e.relationships))),i.flatMap((e=>e.edits))):null}const xe=e=>m.default.fromJSON(e)}}]);
//# sourceMappingURL=52030.b3d0dcf0.chunk.js.map