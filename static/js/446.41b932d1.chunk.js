"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[446],{542:(t,e,s)=>{s.d(e,{c:()=>v});s(81806);var i=s(63919),r=s(85827),n=s(8254),a=s(30726),o=s(97255),h=(s(40181),s(93453)),l=(s(15389),s(96345),s(6645)),c=s(76718),u=s(93345),d=s(36911);class g{constructor(t,e){this.layerUIDs=[],this.isDestroyed=!1,this._data=t;let s=1;const i=new Uint32Array(t);this.layerUIDs=[];const r=i[s++];for(let n=0;n<r;n++)this.layerUIDs[n]=i[s++];this.bufferDataOffset=s,e&&(this.layer=e.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(t){null!=this._data&&(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class _ extends g{constructor(t,e){super(t,e),this.type=n.NP.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.lineIndexStart=s[i++],this.lineIndexCount=s[i++];const r=s[i++];if(r>0){this.patternMap=new Map;for(let t=0;t<r;t++){const t=s[i++],e=s[i++],r=s[i++];this.patternMap.set(t,[e,r])}}this.bufferDataOffset=i}get usedMemory(){var t,e,s,i;return(null!==(t=null===(e=this.data)||void 0===e?void 0:e.byteLength)&&void 0!==t?t:0)+(null!==(s=null===(i=this.vao)||void 0===i?void 0:i.cachedMemory)&&void 0!==s?s:0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,a.WD)(this.vao)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),r=new Int32Array(i.buffer),n=i[s++],a=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,n));s+=n;const o=i[s++],h=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,o));s+=o;const l=this.layer.lineMaterial;this.vao=new d.Z(t,l.getAttributeLocations(),l.getLayoutInfo(),new Map([["geometry",a]]),h)}}class f extends g{constructor(t,e){super(t,e),this.type=n.NP.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.fillIndexStart=s[i++],this.fillIndexCount=s[i++],this.outlineIndexStart=s[i++],this.outlineIndexCount=s[i++];const r=s[i++];if(r>0){this.patternMap=new Map;for(let t=0;t<r;t++){const t=s[i++],e=s[i++],r=s[i++];this.patternMap.set(t,[e,r])}}this.bufferDataOffset=i}get usedMemory(){var t,e,s,i,r,n;return(null!==(t=null===(e=this.data)||void 0===e?void 0:e.byteLength)&&void 0!==t?t:0)+(null!==(s=null===(i=this.fillVAO)||void 0===i?void 0:i.cachedMemory)&&void 0!==s?s:0)+(null!==(r=null===(n=this.outlineVAO)||void 0===n?void 0:n.cachedMemory)&&void 0!==r?r:0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,a.WD)(this.fillVAO),this.outlineVAO=(0,a.WD)(this.outlineVAO)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),r=new Int32Array(i.buffer),n=i[s++],a=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,n));s+=n;const o=i[s++],h=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,o));s+=o;const l=i[s++],g=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,l));s+=l;const _=i[s++],f=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,_));s+=_;const p=this.layer,y=p.fillMaterial,m=p.outlineMaterial;this.fillVAO=new d.Z(t,y.getAttributeLocations(),y.getLayoutInfo(),new Map([["geometry",a]]),h),this.outlineVAO=new d.Z(t,m.getAttributeLocations(),m.getLayoutInfo(),new Map([["geometry",g]]),f)}}class p extends g{constructor(t,e,s){super(t,e),this.type=n.NP.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(t),r=new Int32Array(t),a=new Float32Array(t);let o=this.bufferDataOffset;this.isIconSDF=!!i[o++];const c=i[o++],u=i[o++],d=i[o++],g=new h.A(c,u,d,0),_=i[o++];for(let n=0;n<_;n++){const t=i[o++],e=i[o++],s=i[o++];this.iconPerPageElementsMap.set(t,[e,s])}const f=i[o++];for(let n=0;n<f;n++){const t=i[o++],e=i[o++],s=i[o++];this.glyphPerPageElementsMap.set(t,[e,s])}const p=i[o++],y=i[o++];this.iconOpacity=new Int32Array(p),this.textOpacity=new Int32Array(y),o=(0,l.X1)(i,r,a,o,this.symbols,s,g),this.bufferDataOffset=o}get usedMemory(){var t,e,s,i,r,n;return(null!==(t=null===(e=this.data)||void 0===e?void 0:e.byteLength)&&void 0!==t?t:0)+(null!==(s=null===(i=this.iconVAO)||void 0===i?void 0:i.cachedMemory)&&void 0!==s?s:0)+(null!==(r=null===(n=this.textVAO)||void 0===n?void 0:n.cachedMemory)&&void 0!==r?r:0)+(0,o.Qf)(this.iconOpacity)+(0,o.Qf)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const e of this.iconPerPageElementsMap.values())t+=e[1];for(const e of this.glyphPerPageElementsMap.values())t+=e[1];return t/3}doDestroy(){this.iconVAO=(0,a.WD)(this.iconVAO),this.textVAO=(0,a.WD)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,e=this.iconVAO.vertexBuffers.get("opacity");t.length>0&&t.byteLength===e.usedMemory&&e.setSubData(t,0,0,t.length);const s=this.textOpacity,i=this.textVAO.vertexBuffers.get("opacity");s.length>0&&s.byteLength===i.usedMemory&&i.setSubData(s,0,0,s.length)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),r=new Int32Array(i.buffer),n=i[s++],a=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,n));s+=n;const o=i[s++],h=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,o));s+=o;const l=i[s++],g=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,l));s+=l;const _=i[s++],f=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,_));s+=_;const p=c.g.createVertex(t,u._U.STATIC_DRAW,this.iconOpacity.buffer),y=c.g.createVertex(t,u._U.STATIC_DRAW,this.textOpacity.buffer),m=this.layer,w=m.iconMaterial,v=m.textMaterial;this.iconVAO=new d.Z(t,w.getAttributeLocations(),w.getLayoutInfo(),new Map([["geometry",a],["opacity",p]]),h),this.textVAO=new d.Z(t,v.getAttributeLocations(),v.getLayoutInfo(),new Map([["geometry",g],["opacity",y]]),f)}}class y extends g{constructor(t,e){super(t,e),this.type=n.NP.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.circleIndexStart=s[i++],this.circleIndexCount=s[i++],this.bufferDataOffset=i}get usedMemory(){var t,e,s,i;return(null!==(t=null===(e=this.data)||void 0===e?void 0:e.byteLength)&&void 0!==t?t:0)+(null!==(s=null===(i=this.vao)||void 0===i?void 0:i.cachedMemory)&&void 0!==s?s:0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,a.WD)(this.vao)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),r=new Int32Array(i.buffer),n=i[s++],a=c.g.createVertex(t,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,n));s+=n;const o=i[s++],h=c.g.createIndex(t,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,o));s+=o;const l=this.layer.circleMaterial;this.vao=new d.Z(t,l.getAttributeLocations(),l.getLayoutInfo(),new Map([["geometry",a]]),h)}}var m=s(62887),w=s(78440);class v extends w.Y{constructor(t,e,s,i,r,n,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;super(t,e,s,i,r,n,4096,4096),this.styleRepository=a,this._memCache=o,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<m.zk}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<m.zk)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(t){var e,s;let i=!1;for(const r of t){const t=this.layerData.get(r);t&&(this._usedMemory-=t.usedMemory,t.type===n.NP.SYMBOL&&this.symbols.delete(r)&&(i=!0),t.destroy(),this.layerData.delete(r))}null!==(e=this._memCache)&&void 0!==e&&e.updateSize(this.key.id,this),i&&(null!==(s=this.featureIndex)&&void 0!==s&&s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const t=this.layerData.values();for(const e of t)if(e.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(v._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){0==--this._referenced&&(this.dispose(),this.stage=null)}retain(){++this._referenced}get cachedMemory(){return this._usedMemory}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(t){var e;null===(e=this.featureIndex)||void 0===e||e.clear();let s=!1;if(t){var i;const{bucketsWithData:e,emptyBuckets:r}=t,a=this._createRenderBuckets(e);if(r&&r.byteLength>0){const t=new Uint32Array(r);for(const e of t)this._deleteLayerData(e)}for(const[t,i]of a)this._deleteLayerData(t),i.type===n.NP.SYMBOL&&(this.symbols.set(t,i.symbols),s=!0),this._usedMemory+=i.usedMemory,this.layerData.set(t,i);null===(i=this._memCache)||void 0===i||i.updateSize(this.key.id,this)}this._hasSymbolBuckets=!1;for(const r of this.layerData.values())r.type===n.NP.SYMBOL&&(this._hasSymbolBuckets=!0);s&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(t){t.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const e=this.resolution/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*e,r=this.height/this.rangeY*e,n=[0,0];t.toScreen(n,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;(0,i.D_)(a),(0,i.Tl)(a,a,n),(0,i.e$)(a,a,Math.PI*t.rotation/180),(0,i.hs)(a,a,[s,r,1])}_createTransforms(){return{displayViewScreenMat3:(0,r.vt)(),tileMat3:(0,r.vt)(),tileUnitsToPixels:(0,r.vt)()}}static _destroyRenderBuckets(t){if(!t)return;const e=new Set;for(const s of t.values())e.has(s)||(s.destroy(),e.add(s));t.clear()}_createRenderBuckets(t){const e=new Map,s=new Map;for(const i of t){const t=this._deserializeBucket(i,s);for(const s of t.layerUIDs)e.set(s,t)}return e}_deserializeBucket(t,e){let s=e.get(t);if(s)return s;switch(new Uint32Array(t)[0]){case n.NP.FILL:s=new f(t,this.styleRepository);break;case n.NP.LINE:s=new _(t,this.styleRepository);break;case n.NP.SYMBOL:s=new p(t,this.styleRepository,this);break;case n.NP.CIRCLE:s=new y(t,this.styleRepository)}return e.set(t,s),s}_deleteLayerData(t){if(!this.layerData.has(t))return;const e=this.layerData.get(t);this._usedMemory-=e.usedMemory,e.destroy(),this.layerData.delete(t)}}},15671:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=t,this.y=e,this.width=s,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},18374:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(88235),r=s(40181),n=s(93453);class a extends r.A{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(t){const e=n.A.pool.acquire(t),s=0===e.level?null:n.A.getId(e.level-1,e.row>>1,e.col>>1,e.world);return n.A.pool.release(e),s}getTileCoverage(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;const r=super.getTileCoverage(t,e,s,i);if(!r)return r;const n=1<<r.lodInfo.level;return r.spans=r.spans.filter((t=>t.row>=0&&t.row<n)),r}scaleToLevel(t){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[t])return this._levelByScale[t];{const e=this._fullCacheLodInfos;if(t>e[0].scale)return e[0].level;let s,i;for(let r=0;r<e.length-1;r++)if(i=e[r+1],t>i.scale)return s=e[r],s.level+(s.scale-t)/(s.scale-i.scale);return e[e.length-1].level}}_initializeFullCacheLODs(t){let e;if(0===t[0].level)e=t.map((t=>({level:t.level,resolution:t.resolution,scale:t.scale})));else{const t=this.tileInfo.size[0],s=this.tileInfo.spatialReference;e=i.default.create({size:t,spatialReference:s}).lods.map((t=>({level:t.level,resolution:t.resolution,scale:t.scale})))}for(let s=0;s<e.length;s++)this._levelByScale[e[s].scale]=e[s].level;this._fullCacheLodInfos=e}}},29234:(t,e,s)=>{s.d(e,{A:()=>u});var i,r,n=s(81806),a=s(97255),o=s(3789);(r=i||(i={}))[r.varint=0]="varint",r[r.fixed64=1]="fixed64",r[r.delimited=2]="delimited",r[r.fixed32=5]="fixed32",r[r.unknown=99]="unknown";const h=4294967296,l=new TextDecoder("utf-8"),c=(0,n.A)("safari")||(0,n.A)("ios")?6:(0,n.A)("ff")?12:32;class u{constructor(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t?t.byteLength:0;this._tag=0,this._dataType=i.unknown,this._init(t,e,s,r)}_init(t,e,s,i){this._data=t,this._dataView=e,this._pos=s,this._end=i}get usedMemory(){return 64+(0,a.Qf)(this._data)}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,s=t.getUint32(e,!0)+t.getUint32(e+4,!0)*h;return this._skip(8),s}getSFixed64(){const t=this._dataView,e=this._pos,s=t.getUint32(e,!0)+t.getInt32(e+4,!0)*h;return this._skip(8),s}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,s=this._toString(this._data,e,e+t);return this._skip(t),s}getBytes(){const t=this._getLength(),e=this._pos,s=this._toBytes(this._data,e,e+t);return this._skip(t),s}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,s,i){const r=this.getMessage(),n=t(r,e,s,i);return r.release(),n}processMessage(t){const e=this.getMessage(),s=t(e);return e.release(),s}getMessage(){const t=this._getLength(),e=u.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case i.varint:this._decodeVarint();break;case i.fixed64:this._skip(8);break;case i.delimited:this._skip(this._getLength());break;case i.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,s=0,i=0;if(this._end-e>=10)do{if(i=t[e++],s|=127&i,!(128&i))break;if(i=t[e++],s|=(127&i)<<7,!(128&i))break;if(i=t[e++],s|=(127&i)<<14,!(128&i))break;if(i=t[e++],s|=(127&i)<<21,!(128&i))break;if(i=t[e++],s+=268435456*(127&i),!(128&i))break;if(i=t[e++],s+=34359738368*(127&i),!(128&i))break;if(i=t[e++],s+=4398046511104*(127&i),!(128&i))break;if(i=t[e++],s+=562949953421312*(127&i),!(128&i))break;if(i=t[e++],s+=72057594037927940*(127&i),!(128&i))break;if(i=t[e++],s+=0x8000000000000000*(127&i),!(128&i))break;throw new Error("Varint too long!")}while(0);else{let r=1;for(;e!==this._end&&(i=t[e],128&i);)++e,s+=(127&i)*r,r*=128;if(e===this._end)throw new Error("Varint overrun!");++e,s+=i*r}return this._pos=e,s}_decodeSVarint(){const t=this._data;let e,s=0,i=0;const r=1&t[this._pos];if(i=t[this._pos++],s|=127&i,!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s|=(127&i)<<7,!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s|=(127&i)<<14,!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s|=(127&i)<<21,!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s+=268435456*(127&i),!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s+=34359738368*(127&i),!(128&i))return r?-(s+1)/2:s/2;if(i=t[this._pos++],s+=4398046511104*(127&i),!(128&i))return r?-(s+1)/2:s/2;if(e=BigInt(s),i=t[this._pos++],e+=0x2000000000000n*BigInt(127&i),!(128&i))return Number(r?-(e+1n)/2n:e/2n);if(i=t[this._pos++],e+=0x100000000000000n*BigInt(127&i),!(128&i))return Number(r?-(e+1n)/2n:e/2n);if(i=t[this._pos++],e+=0x8000000000000000n*BigInt(127&i),!(128&i))return Number(r?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==i.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,s){if((s=Math.min(this._end,s))-e>c){const i=t.subarray(e,s);return l.decode(i)}let i="",r="";for(let n=e;n<s;++n){const e=t[n];128&e?r+="%"+e.toString(16):(i+=decodeURIComponent(r)+String.fromCharCode(e),r="")}return r.length&&(i+=decodeURIComponent(r)),i}_toBytes(t,e,s){return s=Math.min(this._end,s),new Uint8Array(t.buffer,e,s-e)}}u.pool=new o.A(u,void 0,(t=>{t._data=null,t._dataView=null}))},77555:(t,e,s)=>{s.d(e,{$o:()=>i,$u:()=>a,gR:()=>n,zA:()=>r});const i=15.5,r=4,n=64,a=1024},83367:(t,e,s)=>{s.d(e,{AH:()=>y,Kj:()=>f,Tl:()=>S,c5:()=>d,f0:()=>g,hs:()=>I,k2:()=>_});var i=s(14522),r=s(76460),n=s(15941),a=s(77555),o=s(13442),h=s(5095);const l=()=>r.A.getLogger("esri.symbols.cim.rasterizingUtils"),c=32,u=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function d(t,e,s){const i=e.style,r=(0,n.yR)(Math.ceil(s)),a=u(i)?8*r:16*r,o=2*r;t.width=a,t.height=a;const h=t.getContext("2d");h.strokeStyle="#ffffff",h.lineWidth=r,h.beginPath(),"vertical"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSVertical"!==i||(h.moveTo(a/2,-o),h.lineTo(a/2,a+o)),"horizontal"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSHorizontal"!==i||(h.moveTo(-o,a/2),h.lineTo(a+o,a/2)),"backward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i&&"esriSFSBackwardDiagonal"!==i||(h.moveTo(-o,-o),h.lineTo(a+o,a+o),h.moveTo(a-o,-o),h.lineTo(a+o,o),h.moveTo(-o,a-o),h.lineTo(o,a+o)),"forward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSForwardDiagonal"!==i&&"esriSFSDiagonalCross"!==i||(h.moveTo(a+o,-o),h.lineTo(-o,a+o),h.moveTo(o,-o),h.lineTo(-o,o),h.moveTo(a+o,a-o),h.lineTo(a-o,a+o)),h.stroke();const l=h.getImageData(0,0,t.width,t.height),c=new Uint8Array(l.data);let d;for(let n=0;n<c.length;n+=4)d=c[n+3]/255,c[n]=c[n]*d,c[n+1]=c[n+1]*d,c[n+2]=c[n+2]*d;return[c,t.width,t.height,r]}function g(t){t.length%2==1&&(t=[...t,...t]);const e=t.reduce(((t,e)=>t+e),0),s=Math.round(e*a.zA),r=new Float32Array(1*s);let n=0,o=0,h=.5,l=!0;for(const i of t){for(n=o,o+=i*a.zA;h<=o;){const t=h-.5,e=Math.min(Math.abs(h-n),Math.abs(h-o));r[t]=l?-e:e,h++}l=!l}const c=r.length,u=new Uint8Array(4*c);for(let d=0;d<c;++d){const t=r[d]/a.zA;(0,i.U)(t/a.gR*.5+.5,u,4*d)}return[u,s,1]}function _(t,e){null==t&&(t=[]);const s="Butt"===e,r="Square"===e,n=!s&&!r;t.length%2==1&&(t=[...t,...t]);const o=a.$o,h=2*o;let l=0;for(const i of t)l+=i;const c=Math.round(l*o),u=new Float32Array(c*h),d=.5*o;let g=0,_=0,f=.5,p=!0;for(const i of t){for(g=_,_+=i*o;f<=_;){let t=.5;for(;t<h;){const e=(t-.5)*c+f-.5,i=n?(t-o)*(t-o):Math.abs(t-o);u[e]=p?s?Math.max(Math.max(g+d-f,i),Math.max(f-_+d,i)):i:n?Math.min((f-g)*(f-g)+i,(f-_)*(f-_)+i):r?Math.min(Math.max(f-g,i),Math.max(_-f,i)):Math.min(Math.max(f-g+d,i),Math.max(_+d-f,i)),t++}f++}p=!p}const y=u.length,m=new Uint8Array(4*y);for(let a=0;a<y;++a){const t=(n?Math.sqrt(u[a]):u[a])/o;(0,i.U)(t,m,4*a)}return[m,c,h]}function f(t,e){const{colorRamp:s,gradientType:i}=e,r="CIMFixedColorRamp"===s.type,n=e.interval||o.D.CIMGradientFill.interval;let a=m(s);return r&&(a=w(a,n)),"Discrete"===i||r?function(t,e,s){return x(t,e,s,1,h.MZ),b(t)}(t,a,n):function(t,e){return x(t,e,c,1,h.MZ),b(t)}(t,a)}let p;function y(t,e){var s;const{colorRamp:i,gradientType:r}=e,n=m(i),a="CIMFixedColorRamp"===i.type;if("Continuous"===r&&!a)return v(t,n);const h=null!==(s=e.interval)&&void 0!==s?s:o.D.CIMGradientFill.interval;if(a)return v(t,w(n,h));const l=[];null!==p&&void 0!==p||(p=document.createElement("canvas")),x(p,n,h,1,0);const c=p.getContext("2d").getImageData(0,0,h,1).data;for(let o=0,u=0;o<h;o++,u=4*o){const t=[c[u+0],c[u+1],c[u+2],c[u+3]];l.push({offset:o/h,color:t}),l.push({offset:(o+1)/h,color:t})}return v(t,l)}function m(t){const e=[];switch(t.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===t.type&&l().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const s=t;e.push({offset:0,color:[s.fromColor[0],s.fromColor[1],s.fromColor[2],s.fromColor[3]/255]}),e.push({offset:1,color:[s.toColor[0],s.toColor[1],s.toColor[2],s.toColor[3]/255]});break}case"CIMFixedColorRamp":{const s=t,i=1/(s.colors.length-1);let r=0;for(const t of s.colors)e.push({offset:r,color:[t[0],t[1],t[2],t[3]/255]}),r+=i;break}case"CIMMultipartColorRamp":{const s=t,i=s.weights.reduce(((t,e)=>t+e),0);let r=0;for(let t=0;t<s.colorRamps.length;t++){const n=s.colorRamps[t],a=s.weights[t],o=m(n);for(const t of o)e.push({offset:(r+t.offset*a)/i,color:t.color});r+=a}break}default:l().error('Color ramp "'.concat(t.type,'" currently unsupported.'))}return e}function w(t,e){const s=[],i=(t.length-1)/(e-1);for(let r=0;r<e;r++){const n=t[Math.round(r*i)].color;s.push({offset:r/e,color:n}),s.push({offset:(r+1)/e,color:n})}return s}function v(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(const{offset:i,color:r}of e)t.addColorStop(Math.min(Math.max(i,s),1-s),"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", ").concat(r[3],")"))}function x(t,e,s,i,r){const n=s+2*r;t.width=n,t.height=i;const a=(r+1)/n,o=t.getContext("2d",{willReadFrequently:!0});if(e.length>0){const t=o.createLinearGradient(0,0,n,i);v(t,e,a),o.fillStyle=t}else o.fillStyle="rgba(128, 128, 128, 1)";o.fillRect(0,0,n,i)}function b(t){const{width:e,height:s}=t,i=t.getContext("2d").getImageData(0,0,e,s),r=new Uint8Array(i.data);for(let n=0;n<r.length;n+=4){const t=r[n+3]/255;r[n]*=t,r[n+1]*=t,r[n+2]*=t}return[r,e,s]}function I(t,e){const s=function(t){var e,s,i,r;const n=null!==(e=null===(s=t[0])||void 0===s||null===(s=s[0])||void 0===s?void 0:s[0])&&void 0!==e?e:0,a=null!==(i=null===(r=t[0])||void 0===r||null===(r=r[0])||void 0===r?void 0:r[1])&&void 0!==i?i:0,o={ymin:a,xmin:n,ymax:a,xmax:n,width:0,height:0};for(let h=0;h<t.length;h++){const e=t[h];for(let t=0;t<e.length;t++){const s=e[t][0],i=e[t][1];s<o.xmin&&(o.xmin=s),s>o.xmax&&(o.xmax=s),i<o.ymin&&(o.ymin=i),i>o.ymax&&(o.ymax=i)}}return o.width=Math.abs(o.xmax-o.xmin),o.height=Math.abs(o.ymax-o.ymin),o}(t),i=0===s.width?1:s.width,r=0===s.height?1:s.height,n=[];for(let a=0;a<t.length;a++){const o=t[a],h=[];for(let t=0;t<o.length;t++){let n=Math.round(o[t][0]-s.xmin),a=Math.round(o[t][1]-s.ymin);if(n=e.xmin+n*e.width/i,a=e.ymin+a*e.height/r,isNaN(n)||isNaN(a))throw new Error("Scaled shape has NaN values");h.push([n,a])}n.push(h)}return n}function S(t,e,s){const i=[];for(let r=0;r<t.length;r++){const n=t[r],a=[];for(let t=0;t<n.length;t++){const i=n[t][0]+e,r=n[t][1]+s;if(isNaN(i)||isNaN(r))throw new Error("Scaled shape has NaN values");a.push([i,r])}i.push(a)}return i}},92678:(t,e,s)=>{s.d(e,{d:()=>S});var i=s(89379),r=s(30726),n=s(50346),a=s(90534),o=s(16783),h=s(8254),l=s(15671);class c{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new l.A(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new l.A;let s=null,i=-1;for(let r=0;r<this._free.length;++r){const n=this._free[r];t<=n.width&&e<=n.height&&(null===s||n.y<=s.y&&n.x<=s.x)&&(s=n,i=r)}return null===s?new l.A:(this._free.splice(i,1),s.width<s.height?(s.width>t&&this._free.push(new l.A(s.x+t,s.y,s.width-t,e)),s.height>e&&this._free.push(new l.A(s.x,s.y+e,s.width,s.height-e))):(s.width>t&&this._free.push(new l.A(s.x+t,s.y,s.width-t,s.height)),s.height>e&&this._free.push(new l.A(s.x,s.y+e,t,s.height-e))),new l.A(s.x,s.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const s=this._free[e];if(s.y===t.y&&s.height===t.height&&s.x+s.width===t.x)s.width+=t.width;else if(s.x===t.x&&s.width===t.width&&s.y+s.height===t.y)s.height+=t.height;else if(t.y===s.y&&t.height===s.height&&t.x+t.width===s.x)s.x=t.x,s.width+=t.width;else{if(t.x!==s.x||t.width!==s.width||t.y+t.height!==s.y)continue;s.y=t.y,s.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var u=s(93345),d=s(29492),g=s(96673);class _{constructor(t,e,s){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=s,this._binPack=new c(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(t,e){const s=[],i=this._glyphSource,r=new Set,n=1/256;for(const o of e){const t=Math.floor(o*n);r.add(t)}const a=[];return r.forEach((e=>{const s=t+e;if(this._rangePromises.has(s))a.push(this._rangePromises.get(s));else{const r=i.getRange(t,e).then((()=>{this._rangePromises.delete(s)}),(()=>{this._rangePromises.delete(s)}));this._rangePromises.set(s,r),a.push(r)}})),Promise.all(a).then((()=>{let r=this._glyphIndex[t];r||(r={},this._glyphIndex[t]=r);for(const n of e){const e=r[n];if(e){s[n]={sdf:!0,rect:e.rect,metrics:e.metrics,page:e.page,code:n};continue}const a=i.getGlyph(t,n);if(null===a||void 0===a||!a.metrics)continue;const o=a.metrics;let h;if(0===o.width)h=new l.A(0,0,0,0);else{const t=3,e=o.width+2*t,s=o.height+2*t;let i=e%4?4-e%4:4,r=s%4?4-s%4:4;1===i&&(i=5),1===r&&(r=5),h=this._binPack.allocate(e+i,s+r),h.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new c(this.width-4,this.height-4),h=this._binPack.allocate(e+i,s+r));const n=this._glyphData[this._currentPage],l=a.bitmap;let u,d;if(l)for(let a=0;a<s;a++){u=e*a,d=this.width*(h.y+a+1)+h.x;for(let t=0;t<e;t++)n[d+t+1]=l.at(u+t)}}r[n]={rect:h,metrics:o,tileIDs:null,page:this._currentPage},s[n]={sdf:!0,rect:h,metrics:o,page:this._currentPage,code:n},this._dirties[this._currentPage]=!0}return s}))}removeGlyphs(t){for(const e in this._glyphIndex){const s=this._glyphIndex[e];if(!s)continue;let i;for(const e in s)if(i=s[e],i.tileIDs.delete(t),0===i.tileIDs.size){const t=this._glyphData[i.page],r=i.rect;let n,a;for(let e=0;e<r.height;e++)for(n=this.width*(r.y+e)+r.x,a=0;a<r.width;a++)t[n+a]=0;delete s[e],this._dirties[i.page]=!0}}}bind(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._textures[s]){const e=new g.R;e.pixelFormat=u.Ab.ALPHA,e.wrapMode=u.pF.CLAMP_TO_EDGE,e.width=this.width,e.height=this.height,this._textures[s]=new d.g(t,e,new Uint8Array(this.width*this.height))}const r=this._textures[s];r.setSamplingMode(e),this._dirties[s]&&r.setData(this._glyphData[s]),t.bindTexture(r,i),this._dirties[s]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0}}var f=s(3825),p=s(29234);class y{constructor(t){if(this._metrics=[],!t)return void(this._allBitmaps=null);const e=new Map;let s=0;for(;t.next();)switch(t.tag()){case 1:{const n=t.getMessage();for(;n.next();)switch(n.tag()){case 3:{const t=n.getMessage();let a,o,h,l,c,u,d;for(;t.next();)switch(t.tag()){case 1:a=t.getUInt32();break;case 2:o=t.getBytes();break;case 3:h=t.getUInt32();break;case 4:l=t.getUInt32();break;case 5:c=t.getSInt32();break;case 6:u=t.getSInt32();break;case 7:d=t.getUInt32();break;default:t.skip()}if(t.release(),a){var i,r;const t=null!==(i=null===(r=o)||void 0===r?void 0:r.length)&&void 0!==i?i:0;this._metrics[a]={width:h,height:l,left:c,top:u,advance:d,startOffset:s,length:t},e.set(a,o),s+=t}break}default:n.skip()}n.release();break}default:t.skip()}const n=new Uint8Array(s),a=this._metrics;for(const[o,h]of e){const{startOffset:t,length:e}=a[o];if(h)for(let s=0;s<e;++s)n[t+s]=h[s]}this._allBitmaps=n}getMetrics(t){return this._metrics[t]}getBitmap(t){if(!this._allBitmaps)return;const e=this._metrics[t];if(void 0===e)return;const{startOffset:s,length:i}=e;return 0!==i?new v(this._allBitmaps,s,i):void 0}}class m{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class w{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e){const s=this._getFontStack(t);if(s.getRange(e))return Promise.resolve();const i=256*e,r=i+255;if(this._baseURL){const n=this._baseURL.replace("{fontstack}",t).replace("{range}",i+"-"+r);return(0,f.default)(n,{responseType:"array-buffer"}).then((t=>{s.addRange(e,new y(new p.A(new Uint8Array(t.data),new DataView(t.data))))})).catch((()=>{s.addRange(e,new y)}))}return s.addRange(e,new y),Promise.resolve()}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const i=Math.floor(e/256),r=s.getRange(i);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new m),e}}class v{constructor(t,e,s){this._array=t,this._start=e,this.length=s}at(t){return 0<=t&&t<this.length?this._array[this._start+t]:void 0}}s(81806);var x=s(83367);class b{constructor(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,e<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=e,s>0&&(this._maxItemSize=s),this._binPack=new c(t-4,e-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new c(this._pageWidth-4,this._pageHeight-4);const t=Math.floor(this._pageWidth),e=Math.floor(this._pageHeight),s=new Uint32Array(t*e);this._mosaicsData[0]=s,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t){var e,s;let i,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this._mosaicRects[t];if(a)return a;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(t&&t.startsWith("dasharray-")?([i,r]=this._rasterizeDash(t),n=!0):i=this._sprites.getSpriteInfo(t),null===(e=i)||void 0===e||!e.width||!i.height||i.width<0||i.height<0)return null;const o=i.width,h=i.height,[l,c,u]=this._allocateImage(o,h);return l.width<=0?null:(this._copy(l,i,c,u,n,r),a={type:"sprite",rect:l,width:o,height:h,sdf:i.sdf,simplePattern:!1,rasterizationScale:null!==(s=i.pixelRatio)&&void 0!==s?s:1,samplingMode:"Linear",page:c},this._mosaicRects[t]=a,a)}getSpriteItems(t){const e={};for(const s of t)e[s.name]=this.getSpriteItem(s.name,s.repeat);return e}getMosaicItemPosition(t,e){const s=this.getSpriteItem(t,e),i=null===s||void 0===s?void 0:s.rect;if(!i)return null;i.width=s.width,i.height=s.height;const r=s.width,n=s.height;return{tl:[i.x+2,i.y+2],br:[i.x+2+r,i.y+2+n],page:s.page}}bind(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(s>=this._size.length||s>=this._mosaicsData.length)return;if(!this._textures[s]){const e=new g.R;e.wrapMode=u.pF.CLAMP_TO_EDGE,e.width=this._size[s][0],e.height=this._size[s][1],this._textures[s]=new d.g(t,e,new Uint8Array(this._mosaicsData[s].buffer))}const r=this._textures[s];r.setSamplingMode(e),this._dirties[s]&&r.setData(new Uint8Array(this._mosaicsData[s].buffer)),t.bindTexture(r,i),this._dirties[s]=!1}static _copyBits(t,e,s,i,r,n,a,o,h,l,c){let u=i*e+s,d=o*n+a;if(c){d-=n;for(let a=-1;a<=l;a++,u=((a+l)%l+i)*e+s,d+=n)for(let e=-1;e<=h;e++)r[d+e]=t[u+(e+h)%h]}else for(let g=0;g<l;g++){for(let e=0;e<h;e++)r[d+e]=t[u+e];u+=e,d+=n}}_copy(t,e,s,i,r,n){if(!this._sprites||"loaded"!==this._sprites.loadStatus||s>=this._mosaicsData.length)return;const a=new Uint32Array(n?n.buffer:this._sprites.image.buffer),o=this._mosaicsData[s],h=n?e.width:this._sprites.width;b._copyBits(a,h,e.x,e.y,o,i[0],t.x+2,t.y+2,e.width,e.height,r),this._dirties[s]=!0}_allocateImage(t,e){t+=2,e+=2;const s=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<s){const s=new l.A(0,0,t,e);return this._mosaicsData.push(new Uint32Array(t*e)),this._dirties.push(!0),this._size.push([t,e]),this._textures.push(void 0),[s,this._mosaicsData.length-1,[t,e]]}let i=t%4?4-t%4:4,r=e%4?4-e%4:4;1===i&&(i=5),1===r&&(r=5);const n=this._binPack.allocate(t+i,e+r);return n.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,e)):[n,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(t){const e=t.match(/\[(.*?)\]/);if(!e)return null;const s=e[1].split(",").map(Number),i=t.slice(t.lastIndexOf("-")+1),[r,n,a]=(0,x.k2)(s,i);return[{x:0,y:0,width:n,height:a,sdf:!0,pixelRatio:1},new Uint8Array(r.buffer)]}}var I=s(93453);class S{constructor(t,e,s,i){this._layer=t,this._styleRepository=e,this.devicePixelRatio=s,this._sourceDataMaxLOD=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){var t,e,s;null!==(t=this._connection)&&void 0!==t&&t.close(),this._connection=null,this._styleRepository=null,this._layer=null,null!==(e=this._spriteMosaic)&&void 0!==e&&e.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,r.DC)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&null!==(s=this._startOptionsInputSignal)&&void 0!==s&&s.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}async start(t){this._requestSprite(t);const e=this._layer.currentStyleInfo.glyphsUrl,s=new w(e?(0,a.addQueryParameters)(e,(0,i.A)((0,i.A)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null);this._glyphMosaic=new _(1024,1024,s),this._broadcastPromise=(0,o.ho)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((e=>{var s;if(this._layer&&(null!==(s=this._connection)&&void 0!==s&&s.close(),this._connection=e,this._layer&&!this._connection.closed)){const s=e.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},t);Promise.all(s).catch((t=>(0,n.throwIfNotAbortError)(t)))}}))}_requestSprite(t){var e,s;null===(e=this._spriteSourceAbortController)||void 0===e||e.abort();const r=new AbortController;this._spriteSourceAbortController=r;const a=null===t||void 0===t?void 0:t.signal;this._inputSignalEventListener&&null!==(s=this._startOptionsInputSignal)&&void 0!==s&&s.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,a&&(this._inputSignalEventListener=function(t){return()=>t.abort()}(r),a.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:o}=r,h=(0,i.A)((0,i.A)({},t),{},{signal:o});this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,h),this._spriteSourcePromise.then((t=>{(0,n.throwIfAbortError)(o),this._spriteMosaic=new b(1024,1024,250),this._spriteMosaic.setSpriteSource(t)}))}async updateStyle(t){const e=[];for(const s of t)s.type===h.$q.SPRITES_CHANGED?e.push({type:h.$q.SPRITES_CHANGED,data:{spriteSource:null}}):e.push(s);return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",e)),this._broadcastPromise}setSpriteSource(t){const e=new b(1024,1024,250);return e.setSpriteSource(t),this._spriteMosaic=e,this._spriteSourcePromise=Promise.resolve(t),this._spriteSourceAbortController=null,e}async setStyle(t,e,s){await this._broadcastPromise,this._styleRepository=t,this._sourceDataMaxLOD=s,this._requestSprite();const r=new w(this._layer.currentStyleInfo.glyphsUrl?(0,a.addQueryParameters)(this._layer.currentStyleInfo.glyphsUrl,(0,i.A)((0,i.A)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null);return this._glyphMosaic=new _(1024,1024,r),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:e,sourceDataMaxLOD:this._sourceDataMaxLOD})),this._broadcastPromise}async fetchTileData(t,e){const s=await this._getRefKeys(t,e);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),s,e)}async fetchTilePBFs(t){const e=Object.keys(this._layer.sourceNameToSource),s={},r=await this._getRefKeys(t,s),n=[],a=[];for(let o=0;o<r.length;o++)if(null==r[o].value||null==e[o])a.push(null);else{const t=r[o].value,h=this._getTilePayload(t,e[o],s);h.then((e=>{n.push((0,i.A)((0,i.A)({},e),{},{key:t}))})),a.push(h)}return Promise.all(a).then((()=>n))}async parseTileData(t,e){const s=t&&t.data;if(!s)return null;const{sourceName2DataAndRefKey:r,transferList:n}=s;return 0===Object.keys(r).length?null:this._broadcastPromise.then((()=>this._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:t.styleLayerUIDs},(0,i.A)((0,i.A)({},e),{},{transferList:n}))))}async getSprites(t){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(t)}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,t.codePoints)}async _getTilePayload(t,e,s){const i=I.A.pool.acquire(t.id),r=this._layer.sourceNameToSource[e],{level:a,row:o,col:h}=i;I.A.pool.release(i);try{return{protobuff:await r.requestTile(a,o,h,s),sourceName:e}}catch(l){if((0,n.isAbortError)(l))throw l;return{protobuff:null,sourceName:e}}}async _getRefKeys(t,e){const s=this._layer.sourceNameToSource,i=new Array;for(const r in s){const n=s[r].getRefKey(t,e);i.push(n)}return(0,n.eachAlways)(i)}_getSourcesData(t,e,s){const i=[];for(let r=0;r<e.length;r++)if(null==e[r].value||null==t[r])i.push(null);else{const n=e[r].value,a=this._getTilePayload(n,t[r],s);i.push(a)}return(0,n.eachAlways)(i).then((t=>{const s={},i=[];for(let r=0;r<t.length;r++){const n=t[r].value;if(n&&n.protobuff&&n.protobuff.byteLength>0){const t=e[r].value.id;s[n.sourceName]={refKey:t,protobuff:n.protobuff},i.push(n.protobuff)}}return{sourceName2DataAndRefKey:s,transferList:i}}))}}}}]);
//# sourceMappingURL=446.41b932d1.chunk.js.map