"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[270],{270:(e,n,t)=>{t.r(n),t.d(n,{getLabelSchemes:()=>u});t(11265);var i=t(50076),a=t(37119),l=t(90494),o=t(63860);async function r(e){var n;const{layer:t,renderer:a}=e;if(await t.load(),"binning"!==(null===(n=t.featureReduction)||void 0===n?void 0:n.type))throw new i.default("bins-label-schemes:invalid-parameters","featureReduction type of the layer is not valid");const l=a||t.featureReduction.renderer;if(!l)throw new i.default("bins-label-schemes:invalid-parameters","'renderer' is not valid");return{layer:t,renderer:l}}async function s(e,n,t,i){const l=(0,a.yb)(e,n);if(!l)return null;const o=(0,a.Hg)(n,t,l,i);return{name:"binning-".concat(e),labelingInfo:[(0,a.Rl)(o,!0)],fieldName:e}}async function u(e){const[{renderer:n,layer:t},a]=await Promise.all([r(e),(0,o.ud)("esri/smartMapping/t9n/smartMapping")]),u=a.clusters.predominantNoneValue;if(e.field){const a=await s(e.field,t,n,u);if(!a)throw new i.default("bins-label-schemes:invalid-parameters","'field' is not a valid aggregate field");return{primaryScheme:a,secondarySchemes:[]}}const c=await s(l.z,t),f=[],d=function(e){let n=[];const t=e.featureReduction;return"fields"in t&&(n=t.fields.map((e=>e.name))),n}(t).filter((e=>e.toLowerCase()!==l.z.toLowerCase()));for(const i of d){const e=await s(i,t,n,u);e&&f.push(e)}return{primaryScheme:c,secondarySchemes:f}}},37119:(e,n,t)=>{t.d(n,{Hg:()=>c,Rl:()=>f,ik:()=>u,yb:()=>s});var i=t(95114),a=t(57491),l=t(28731),o=t(99433),r=t(86659);function s(e,n){const t=n.featureReduction;if("fields"in t)for(const i of t.fields)if(i.name.toLowerCase()===e.toLowerCase())return i;return null}function u(e){return'\n  $feature["'.concat(e,'"];\n  var value = $feature["').concat(e,'"];\n  var num = Count(Text(Round(value)));\n  var label = When(\n    num < 4, Text(value, "#.#"),\n    num == 4, Text(value / Pow(10, 3), "#.0k"),\n    num <= 6, Text(value / Pow(10, 3), "#k"),\n    num == 7, Text(value / Pow(10, 6), "#.0m"),\n    num > 7, Text(value / Pow(10, 6), "#m"),\n    Text(value, "#,###")\n  );\n  return label;\n  ')}function c(e,n,t,i){const a=t.name;if("mode"===t.statisticType){var r;const s="getFieldDomain"in e?e.getFieldDomain(t.onStatisticField):null;let u=null;return"coded-value"===(null===s||void 0===s?void 0:s.type)?u=s.codedValues.map((e=>new l.default({value:e.code,label:e.name}))):"unique-value"===(null===n||void 0===n?void 0:n.type)&&null!=n.field&&n.field.toLowerCase()===a.toLowerCase()&&(u=(null!==(r=n.uniqueValueInfos)&&void 0!==r?r:[]).map((e=>e.clone()))),u?(0,o.Wx)(u,a,i):'Text($feature["'.concat(a,'"])')}return u(a)}function f(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=new r.default({haloColor:"#373837",haloSize:"1px",color:"#f0f0f0",font:{family:"Noto Sans",size:"12px",weight:"bold"}});return new i.default({symbol:t,deconflictionStrategy:"none",labelPlacement:n?"always-horizontal":"center-center",labelExpressionInfo:new a.A({expression:e})})}},90494:(e,n,t)=>{t.d(n,{p:()=>l,z:()=>a});var i=t(50076);const a="aggregateCount";function l(e,n){if(!e.view)throw new i.default("".concat(n,":missing-parameters"),"'view' parameter is required for binning");if(e.sqlExpression)throw new i.default("".concat(n,":invalid-parameters"),"'sqlExpression' parameter is not supported for binning");if("3d"===e.view.type)throw new i.default("".concat(n,":invalid-parameters"),"3d view is not supported for binning")}},97336:(e,n,t)=>{t.d(n,{G2:()=>w,Lb:()=>z,Xj:()=>h,bF:()=>y,gS:()=>F,lm:()=>g});var i=t(18690),a=(t(81806),t(63860)),l=t(39348),o=t(53430),r=(t(75900),t(56362),t(87015),t(81940),t(6929)),s=(t(7198),t(93616),t(53539)),u=(t(91904),t(81779)),c=t(40585),f=t(17542),d=t(23994),p=t(15492),m=t(90704);let v=0;const y="expression/";function w(e){return"hasVisualVariables"in e&&e.hasVisualVariables()?e.visualVariables.filter((e=>!p.viewScaleRE.test(e.valueExpression)&&(!("target"in e)||"outline"!==e.target))):[]}function b(e,n){if(!n)return null;const t=(0,m.Rm)(e);return null===t||void 0===t?void 0:t.find((e=>e.name.toLowerCase()===n.toLowerCase()))}function g(e,n,t){let i=null;if(t&&"featureReduction"in e){const n=e.featureReduction;n&&"popupTemplate"in n&&n.popupTemplate&&(i=n.popupTemplate.fieldInfos)}else"popupTemplate"in e&&e.popupTemplate&&(i=e.popupTemplate.fieldInfos);const a=t?b(e,n):e.getField(n);let l=null;if(i&&i.some((e=>{var n;return!(!e||(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())!==(null===a||void 0===a?void 0:a.name.toLowerCase()))&&(l=e.clone(),!0)})),!l){const e=o.numericTypes.includes(a.type),n="integer"===a.type||"small-integer"===a.type;l=new c.default({fieldName:a.name,isEditable:a.editable,visible:!0,format:e?new f.default({places:n?0:2,digitSeparator:!0}):void 0})}return l.label||(l.label=a.alias),l}function T(e){const{expression:n,title:t,returnType:i}=e;return new u.default({name:"expr"+v++,expression:n,title:t,returnType:i})}function x(e){const n="number"===e.returnType?new f.default({places:2,digitSeparator:!0}):void 0;return new c.default({fieldName:"".concat(y).concat(e.name),visible:!0,format:n})}async function h(e){const n=await(0,a.ud)("esri/smartMapping/t9n/smartMapping"),{renderer:t,layer:o,normFieldExpressionTemplate:r,isFeatureReduction:s}=e,u=[],c=[],f=(0,d.getAttributes)(t,w);for(const i of f)if("field"===i.type)u.push(g(o,i.field,s));else if("normalized-field"===i.type){const e=s?b(o,i.field):o.getField(i.field),t=s?b(o,i.normalizationField):o.getField(i.normalizationField),a=T({type:"expression",expression:'\n      $feature["'.concat(e.name,'"];\n      $feature["').concat(t.name,'"];\n      ').concat("percentage"===r?'($feature["'.concat(e.name,'"] / $feature["').concat(t.name,'"]) * 100;'):'$feature["'.concat(e.name,'"] / $feature["').concat(t.name,'"];'),"\n      "),title:(0,l.V)("percentage"===r?n.normFieldLabelAsPercent:n.normFieldLabel,{expression1:e.alias,expression2:t.alias}),returnType:"number"});u.push(x(a),g(o,i.field,s),g(o,i.normalizationField,s)),c.push(a)}else if("expression"===i.type){const e=T(i);u.push(x(e)),c.push(e)}return{fieldInfos:(0,i.Am)(u,((e,n)=>e.fieldName===n.fieldName)),expressionInfos:(0,i.Am)(c,((e,n)=>e.expression===n.expression))}}async function z(e,n,t){const{fieldInfos:i,expressionInfos:o}=n,u=await(0,a.ud)("esri/smartMapping/t9n/smartMapping");if(i.length>2)return[new r.default({fieldInfos:i})];const c=[];for(const a of i){const n=a.fieldName||"";let i=a.label;if(!i){const a=t?b(e,n):e.getField(n);if(a)i=a.alias||n;else if(o){const e=n.split(y)[1],t=o[o.findIndex((n=>n.name===e))];t&&(i=t.title||t.name)}}c.push(new s.default({text:(0,l.V)(u.fieldInfo,{fieldLabel:i,fieldValue:"{".concat(n,"}")})}))}return c}function F(e){return!(!("normalizationField"in e)||!e.normalizationField)||"hasVisualVariables"in e&&e.hasVisualVariables()&&e.visualVariables.some((e=>!(!("normalizationField"in e)||!e.normalizationField)))}},99433:(e,n,t)=>{t.d(n,{Dv:()=>f,Qb:()=>s,Wx:()=>v,eU:()=>b,pq:()=>u});var i=t(18690),a=t(53514),l=t(4815),o=t(97336),r=t(42633);const s="cluster_count";function u(e,n){return e.split("cluster_".concat(n,"_")).pop()}function c(e,n){const t=function(e){if(!e)return null;const{field:n,valueExpression:t,normalizationField:i,normalizationType:a,normalizationTotal:o}=e;let s=null;if(t)s=t;else if(n){const e=(0,r.Wy)({normalizationType:a,normalizationField:i,normalizationTotal:o});if(e){const t=e.toLowerCase();if(s=n.toLowerCase()+",norm:"+t,i)s+=","+i.toLowerCase();else if("percent-of-total"===t){let e=o;(0,l.gf)(e)&&0!==e||(e=null),s+=","+e}}}return s}(e);return"".concat(n,"_").concat(null!=t?function(e){return(0,a.d)(e)}(t):e.field)}function f(e,n){return"cluster_".concat(c(e,n))}function d(e,n){const t=n.getField(e);return null===t||void 0===t?void 0:t.type}function p(e,n){var t;const i="rotation"===n.type?n.rotationType:null,a=null===(t=n.legendOptions)||void 0===t?void 0:t.title,l=n.field,o=l?d(l,e):null;return{field:l,fieldType:null!=o?o:null,rotationType:i,valueExpression:n.valueExpression,valueExpressionTitle:n.valueExpressionTitle||n.valueExpression&&a,normalizationField:"normalizationField"in n?n.normalizationField:null,vvType:n.type}}function m(e){return e?e.replaceAll('"','\\"'):""}function v(e,n,t){return"\n  var uvInfos = [".concat(function(e){return e.map((e=>'{\n        "value": "'.concat(String(e.value),'",\n        "label": "').concat(m(String(e.label)),'"\n      }')))}(e).join(", "),'];\n  var predominantType = Text($feature["').concat(n,'"]);\n  var label = "').concat(m(t),'";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  ')}function y(e,n){const t=[c(e,n)];return"date"===e.fieldType&&t.push(e.fieldType.toLowerCase()),e.rotationType&&t.push(e.rotationType.toLowerCase()),t.join("_")}function w(e,n){return{statisticHash:y(e,n),attributeInfo:e,statisticType:n}}function b(e,n){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=[],l=function(e,n){const t="field"in n?n.field:null,i=t?d(t,e):null;return{field:t,fieldType:null!=i?i:null,valueExpression:"valueExpression"in n?n.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in n?n.valueExpressionTitle:null,normalizationField:"normalizationField"in n?n.normalizationField:null,normalizationType:"normalizationType"in n?n.normalizationType:null,normalizationTotal:"normalizationTotal"in n?n.normalizationTotal:null}}(e,n);"class-breaks"===n.type?a.push(w(l,"avg")):"unique-value"===n.type&&a.push(w(l,"type"));const r=(0,o.G2)(n);for(const i of r){const n=p(e,i);a.push(w(n,"avg"))}return t?(0,i.Am)(a,((e,n)=>e.statisticHash===n.statisticHash)):a}}}]);
//# sourceMappingURL=270.6d257030.chunk.js.map