"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[34881],{34881:(e,t,s)=>{s.d(t,{Upload:()=>_});var r=s(35143),o=s(91967),i=s(98773),n=s(50076),a=s(79053),l=s(81806),p=s(50346),c=s(46053),d=(s(76460),s(47249),s(85842)),u=s(19247),h=s(9624),f=s(80963),g=s(53195),v=s(19463),m=s(91364);let _=class extends o.default{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){const e=this._uploadTask;return e&&0!==this.files.length?e.finished?e.error?"error":"success":"pending":"default"}get result(){var e,t;return null!==(e=null===(t=this._uploadTask)||void 0===t?void 0:t.value)&&void 0!==e?e:null}get error(){var e,t;return null!==(e=null===(t=this._uploadTask)||void 0===t?void 0:t.error)&&void 0!==e?e:null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=(0,i.UT)((async t=>{const s=await async function(e){const{resolve:t,promise:s}=(0,p.createResolver)(),r=document.createElement("input");r.type="file",r.multiple=!1,r.accept=[...(0,v.hK)(e.infoFor3D),".zip"].join(","),r.style.display="none",document.body.appendChild(r);const o=(0,a.on)(r,"change",(()=>t(r.files?Array.from(r.files):[])));return y?y(r):r.click(),s.finally((()=>{o.remove(),r.remove()}))}(e);(0,p.throwIfAborted)(t),this.progress=0,this.files=s;const r=(0,m.XA)(g.y.upload,(e=>{this.progress=e}),"Upload.uploadTo");if(0===s.length)return null;(0,p.throwIfAborted)(t);const o=await e.extractAndFilterFiles(s);(0,p.throwIfAborted)(t),o.length>0&&(this.files=o);const i=await e.convertMesh(o,{signal:t,onProgress:r.makeOnProgress("createFromFiles")});if((0,p.throwIfAborted)(t),!i)throw new n.default("editor:upload","could not upload or convert model");const c=o.reduce(((e,t)=>e+t.size),0),d=r.simulate("loadMesh",(0,m.V7)(c));try{await i.load()}finally{d.remove()}if((0,l.A)("enable-feature:georeferenced-uploads")&&i.metadata.georeferenced){var _;if(await(0,f.Vv)(e.spatialReference,null===(_=i.origin)||void 0===_?void 0:_.spatialReference))return{type:"georeferenced",mesh:i};if((e.spatialReference.isWebMercator||e.spatialReference.isWGS84)&&await async function(e,t){var s;if(await(0,h.initializeProjection)(e.spatialReference,t),!e.vertexSpace.origin)return!1;const[r,o,i]=e.vertexSpace.origin,n=new u.default({x:r,y:o,z:i,spatialReference:e.spatialReference}),a=(0,h.project)(n,t);return!!a&&(e.vertexSpace.origin=[a.x,a.y,null!==(s=a.z)&&void 0!==s?s:0],e.spatialReference=t,!0)}(i,e.spatialReference))return{type:"georeferenced-reprojected",mesh:i}}return i.spatialReference=e.spatialReference,i.vertexSpace.origin=[0,0,0],{type:"non-georeferenced",mesh:i}}))}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){var e;null===(e=this._uploadTask)||void 0===e||e.abort()}};(0,r._)([(0,c.MZ)()],_.prototype,"files",void 0),(0,r._)([(0,c.MZ)()],_.prototype,"progress",void 0),(0,r._)([(0,c.MZ)()],_.prototype,"state",null),(0,r._)([(0,c.MZ)()],_.prototype,"result",null),(0,r._)([(0,c.MZ)()],_.prototype,"error",null),(0,r._)([(0,c.MZ)()],_.prototype,"_uploadTask",void 0),(0,r._)([(0,c.MZ)()],_.prototype,"_layer",void 0),_=(0,r._)([(0,d.$)("esri.widgets.Editor.Upload")],_);let y=null},53195:(e,t,s)=>{s.d(t,{y:()=>r});const r={upload:{createFromFiles:.8,loadMesh:.2},uploadAssetBlobs:{prepareAssetItems:.9,uploadAssetItems:.1},uploadConvertibleSource:{uploadEditSource:.5,serviceAssetsToGlb:.5},uploadLocalMesh:{meshToAssetBlob:.5,uploadAssetBlobs:.5}}},91364:(e,t,s)=>{s.d(t,{V7:()=>c,XA:()=>a,aG:()=>p,sL:()=>d});var r=s(54901),o=s(81806),i=s(87663),n=s(91417);function a(e){return new l(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{},arguments.length>2?arguments[2]:void 0)}class l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{},s=arguments.length>2?arguments[2]:void 0;if(this.onProgress=t,this.taskName=s,this._progressMap=new Map,this._startTime=void 0,this._timingsMap=new Map,"number"==typeof e){this._weights={};for(let t=0;t<e;t++){const s=t,r=1/e;this._weights[s]=r,this._progressMap.set(s,0)}}else this._weights=e;this.emitProgress()}emitProgress(){let e=0;for(const[r,o]of this._progressMap.entries())e+=o*this._weights[r];if(1===e&&(0,o.A)("enable-feature:esri-3dofl-upload-timings")){var t;const e=Math.round(performance.now()-(null!==(t=this._startTime)&&void 0!==t?t:0))/1e3;console.log("".concat(this.taskName," done in ").concat(e," sec"));for(const[t,r]of this._timingsMap){var s;const o=Math.round(r.end-r.start)/1e3,i=Math.round(o/e*100);console.log(null!==(s=this.taskName)&&void 0!==s?s:"Task",{stepKey:t,stepTime:o,relativeTime:i})}}this.onProgress(e)}setProgress(e,t){if(this._progressMap.set(e,t),(0,o.A)("enable-feature:esri-3dofl-upload-timings")){var s;const r=performance.now();null!==(s=this._startTime)&&void 0!==s||(this._startTime=r);const o=(0,i.tE)(this._timingsMap,e,(()=>({start:r,end:0})));1===t&&(o.end=r)}this.emitProgress()}simulate(e,t){return p((t=>this.setProgress(e,t)),t)}makeOnProgress(e){return t=>this.setProgress(e,t)}}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;const s=performance.now();e(0);const o=setInterval((()=>{const r=performance.now()-s,o=1-Math.exp(-r/t);e(o)}),g);return(0,r.hA)((()=>{clearInterval(o),e(1)}))}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return(0,n.gr)((0,n.Kp)(e*f/t))}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h;return(0,n.gr)((0,n.Kp)(e*f/t))}const u=10,h=10,f=8e-6,g=(0,n.l5)(50),v=(0,n.l5)(1e3)}}]);
//# sourceMappingURL=34881.874c96e2.chunk.js.map