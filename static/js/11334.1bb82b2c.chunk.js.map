{"version":3,"file":"static/js/11334.1bb82b2c.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/widgets/OrientedImageryViewer/adapters/view/SceneViewAdapter.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Graphic.js\";import{isSome as t}from\"../../../../core/arrayUtils.js\";import{throwIfAborted as i,waitTick as r}from\"../../../../core/promiseUtils.js\";import o from\"../../../../geometry/Mesh.js\";import a from\"../../../../geometry/Point.js\";import{projectWithZConversion as s}from\"../../../../geometry/projection.js\";import{MeshVertexAttributes as n}from\"../../../../geometry/support/MeshVertexAttributes.js\";import{projectVertices as l,updateFrustum as c,createCoveragePolygon as m}from\"../../../../layers/orientedImagery/core/coverageUtils.js\";import{activeFrustumSymbol as u,additionalFrustumSymbol as p}from\"../../symbols.js\";class d{constructor(a){this.viewModel=a,this._updateBestFeatureFootprintElevation=!1,this.createFootprints=async r=>{const{coverageFrustums:a,currentBestFeature:c,isAdditionalCoverageVisible:m,view:d}=this.viewModel,f=a.filter(t);for(const t of f){let a=t.clone();if(!d.spatialReference.equals(a.spatialReference)){const{components:e,spatialReference:t,origin:c,vertexAttributes:m,vertexSpace:u}=a;if(\"local\"===u.type){const e=await s(c,d.spatialReference,r);i(r),a.centerAt(e)}else{const s=m.position,c=Float64Array.from(await l([...s],t.clone(),d.spatialReference.clone(),r));i(r),a=new o({vertexAttributes:new n({position:c}),components:e,spatialReference:d.spatialReference.clone()})}}t.imageID===c.attributes.objectId?(this.viewModel.bestFeatureFootprint=new e({attributes:{imageID:t.imageID},geometry:a,symbol:u.clone(),visible:!1}),this._updateBestFeatureFootprintElevation=!0):this.viewModel.additionalFootprints.push(new e({attributes:{imageID:t.imageID},geometry:a,symbol:p.clone(),visible:m}))}},this.updateFootprint=async(r,o)=>{const{bestFeatureFootprint:a,currentBestFeature:n,activeViewer:l,footprintExtent:m,view:p}=this.viewModel,d=l?.imageSize;if(!(n&&a?.geometry&&d&&m))return void this.viewModel.updateCurrentCoveragePolygon(null);const{attributes:{cameraHeight:w,location:v,cameraPitch:g,horizontalFieldOfView:h,verticalFieldOfView:y,cameraRoll:b},elevationSample:F}=n;F&&this._updateBestFeatureFootprintElevation&&(this.updateGroundElevation([a],F),this._updateBestFeatureFootprintElevation=!1);const M=v.toArray(),{vertexAttributes:{position:R},spatialReference:V}=a.geometry,j=await f(R,V,v.spatialReference),A=await this.viewModel.getMapPoint(r,{feature:n,mode:\"default\",imageSize:d});i(o);let I=A.filter(t);if(!I.length)return;I[0].spatialReference.equals(v.spatialReference)||(I=await Promise.all(I.map((async e=>{const t=await s(e,v.spatialReference,o);return i(o),t}))));const P=await c(r.map((({x:e,y:t})=>[e,t])),I.map((e=>e.toArray())),{cameraHeight:w,cameraLocation:M,cameraPitch:g,frustumVertices:j,horizontalFieldOfView:h,imageHeight:d[1],imageWidth:d[0],inSRS:{wkid:v.spatialReference.wkid},outSRS:{wkid:p.spatialReference.wkid},verticalFieldOfView:y,cameraRoll:b??0,options:o});this.viewModel.updateCurrentCoveragePolygon(new e({attributes:{imageID:n.attributes.objectId},geometry:P,symbol:u.clone(),visible:this.viewModel.currentCoverageVisible}))},this.updateFootprintPanorama=async(t,i)=>{await r(i);const{horizontalFieldOfView:o,pitch:a,verticalFieldOfView:s,yaw:n}=t,l=this.viewModel.currentBestFeature?.clone();if(!l)return;const{attributes:c}=l;c.orientedImageryType=null,c.cameraHeading=(n+c.cameraHeading)%360,c.cameraPitch=a,c.horizontalFieldOfView=o,c.verticalFieldOfView=s,c.cameraRoll=0;const{frustum:p}=m(c);p?this.viewModel.updateCurrentCoveragePolygon(new e({attributes:{imageID:c.objectId},geometry:p,symbol:u.clone(),visible:this.viewModel.currentCoverageVisible})):this.viewModel.updateCurrentCoveragePolygon(null)}}updateGroundElevation(e,t){const{geometry:i}=this.viewModel.currentBestFeature,r=t.queryElevation(i);e.forEach((e=>{const{geometry:t}=e;switch(t?.type){case\"mesh\":{const{vertexAttributes:{position:e}}=t,i=Math.floor(e.length/3);for(let t=0;t<i;t+=1)e[3*t+2]+=r?.z??0;break}case\"point\":t.z=(t.z??0)+(r?.z??0)}}))}}async function f(e,t,i,r){return Float64Array.from((await Promise.all(e.reduce(((e,t,i)=>{const r=Math.floor(i/3);return e[r]=e[r]??[],e[r].push(t),e}),new Array).map((async e=>(await s(new a(e,t),i,r)).toArray())))).flat())}export{d as default};\n"],"names":["d","constructor","a","this","viewModel","_updateBestFeatureFootprintElevation","createFootprints","async","coverageFrustums","currentBestFeature","c","isAdditionalCoverageVisible","m","view","f","filter","t","clone","spatialReference","equals","components","e","origin","vertexAttributes","vertexSpace","u","type","s","r","i","centerAt","position","Float64Array","from","l","o","n","imageID","attributes","objectId","bestFeatureFootprint","geometry","symbol","visible","additionalFootprints","push","p","updateFootprint","activeViewer","footprintExtent","imageSize","updateCurrentCoveragePolygon","cameraHeight","w","location","v","cameraPitch","g","horizontalFieldOfView","h","verticalFieldOfView","y","cameraRoll","b","elevationSample","F","updateGroundElevation","M","toArray","R","V","j","Promise","all","reduce","_e$r","Math","floor","Array","map","flat","A","getMapPoint","feature","mode","I","length","P","_ref","x","cameraLocation","frustumVertices","imageHeight","imageWidth","inSRS","wkid","outSRS","options","currentCoverageVisible","updateFootprintPanorama","_this$viewModel$curre","pitch","yaw","orientedImageryType","cameraHeading","frustum","queryElevation","forEach","_t$z","_r$z2","_r$z","z"],"sourceRoot":""}