"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[27824],{27824:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var i=n(35143),o=n(69539),r=n(54901),l=n(56002),s=n(68134),u=n(41289),a=n(31633),c=n(46053),d=(n(81806),n(76460),n(47249),n(85842)),v=n(20664),p=n(9392),y=n(34111),h=n(95925),_=n(18722),f=n(88220),w=n(29808),m=n(3112),D=n(30310),g=n(84174);let I=class extends g.default{constructor(e){super(e),this.type="view",this.color=new o.default("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=(0,l.B)(((e,t,n,i,o,r,l)=>({inputGraphicUid:null!=e?x(e):null,visibleLayers:t,maxIntersectionDistance:n,intersectOptions:i,view:o,stationary:r,spatialReference:l}))),this._vecA=(0,p.vt)(),this._vecB=(0,p.vt)(),this._ray=(0,h.vt)()}get minDemResolution(){var e,t;const n=null===(e=this._viewModel)||void 0===e?void 0:e.view;if(null==n||"3d"!==n.type)return null;const i=null===(t=n.pointsOfInterest)||void 0===t||null===(t=t.focus)||void 0===t?void 0:t.worldUnitsPerContentPixel;return null==i?null:i*(0,a.G9)(n.spatialReference)}get queryElevationDependencies(){var e;const t=this._view;return t?this._getQueryElevationDependencies(null===(e=this._viewModel)||void 0===e?void 0:e.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,t,t.stationary,t.spatialReference):null}get _visibleLayers(){var e,t;return null!==(e=null===(t=this._view)||void 0===t||null===(t=t.map)||void 0===t||null===(t=t.allLayers)||void 0===t?void 0:t.filter((e=>e.visible)).toArray())&&void 0!==e?e:[]}get _intersectOptions(){const e=this._view;if(null==e||e.destroyed)return{};const t=(0,f.ZD)(e,{include:this.include,exclude:this.exclude}),n=(0,f.ZD)(e,{exclude:this._pointCloudLayers});return t.exclude=(0,u.KC)(t.exclude,n.exclude),t}get _pointCloudLayers(){const e=this._view;return null==e?[]:e.allLayerViews.toArray().filter((e=>{var t;return"point-cloud"===(null===(t=e.layer)||void 0===t?void 0:t.type)})).map((e=>e.layer))}get _view(){var e;const t=null===(e=this._viewModel)||void 0===e?void 0:e.view;return null!=t&&"3d"===t.type?t:null}get _maxIntersectionDistance(){const e=this._view;return null!==e&&void 0!==e&&e.renderCoordsHelper?(0,y.tO)(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(null==e)return null;const t=(0,w.hz)(e.state.viewingMode),n=t.options;return n.hud=!1,n.invisibleTerrain=!1,n.backfacesTerrain=!1,n.selectionMode=!1,n.store=m.oH.ALL,t}async queryElevation(e,t){let{noDataValue:n,signal:i}=t;const o=this.queryElevationDependencies;if(null==o)throw new Error("ElevationProfileLineInput: no dependencies");const r=this._intersector;if(null==r)throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:l,view:s,spatialReference:u}=o,a=s.renderCoordsHelper,c=s.sceneIntersectionHelper,d=this._vecA,p=this._vecA,y=this._vecB,f=this._ray;if(!u)return{geometry:e,noDataValue:n};const w=await _.GeometryDescriptor.fromGeometry(e).project(u,i);if(!w)return{geometry:e,noDataValue:n};const m=w.coordinates,D=m.length;for(let _=0;_<D;++_){var g;const e=m[_];(0,v.i)(y,e.x,e.y,null!==(g=e.z)&&void 0!==g?g:0),a.toRenderCoords(y,u,y),a.setAltitude(d,2e5,y);const t=(0,h.Cr)(d,y,f);c.computeIntersection(t,r,l,!0);const i=M(o,r.results.all);i?(i.getIntersectionPoint(p),a.fromRenderCoords(p,p,u),e.z=p[2]):e.z=n}return{geometry:w.export(),noDataValue:n}}attach(e){const t=()=>this._onChange();return(0,r.vE)([super.attach(e),(0,s.watch)((()=>this.queryElevationDependencies),t),(0,s.on)((()=>e.elevationProvider),"elevation-change",t,{onListenerAdd:t,onListenerRemove:t})])}};function M(e,t){let{view:n,inputGraphicUid:i,maxIntersectionDistance:o}=e;for(const r of t){if(!r.withinDistance(o))continue;const e=(0,D.Gy)(r,n);if(null==e||x(e)!==i)return r}return null}function x(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return"o-".concat(e.layer.id,"-").concat(t)}return"u-".concat(e.uid)}(0,i._)([(0,c.MZ)({type:o.default,nonNullable:!0})],I.prototype,"color",void 0),(0,i._)([(0,c.MZ)()],I.prototype,"viewVisualizationEnabled",void 0),(0,i._)([(0,c.MZ)()],I.prototype,"include",void 0),(0,i._)([(0,c.MZ)()],I.prototype,"exclude",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],I.prototype,"minDemResolution",null),(0,i._)([(0,c.MZ)()],I.prototype,"queryElevationDependencies",null),(0,i._)([(0,c.MZ)()],I.prototype,"_visibleLayers",null),(0,i._)([(0,c.MZ)()],I.prototype,"_intersectOptions",null),(0,i._)([(0,c.MZ)()],I.prototype,"_pointCloudLayers",null),(0,i._)([(0,c.MZ)()],I.prototype,"_view",null),(0,i._)([(0,c.MZ)()],I.prototype,"_maxIntersectionDistance",null),(0,i._)([(0,c.MZ)()],I.prototype,"_intersector",null),I=(0,i._)([(0,d.$)("esri.widgets.ElevationProfile.ElevationProfileLineView")],I);const E=I}}]);
//# sourceMappingURL=27824.4e1768dc.chunk.js.map