"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[8163,76420],{8163:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var a=s(89379),r=s(35143),i=s(86560),l=s(55171),n=s(3825),o=s(18690),d=s(50076),u=s(5632),p=s(42553),c=s(53084),y=s(49304),f=s(50346),h=s(46053),v=(s(81806),s(76460),s(28379)),m=s(85842),b=s(54039),g=s(13312),I=s(38911),A=s(54610),w=s(61979),S=s(91447),_=s(31933),E=s(43505),T=s(98662),M=s(72945),F=s(47437),R=s(54994),V=s(10290),C=s(90534);function D(e){return Array.isArray(e)?e.join(","):""}var O=s(98136),Z=s(35298);function k(e,t){const s=t.id;return{id:s,name:t.name,url:"".concat(e,"/").concat(s),type:t.type||"Table"}}function P(e){return{isDataVersioned:(0,O.Vf)(e,"hasVersionedData",!1),isDataBranchVersioned:(0,O.Vf)(e,"hasBranchVersionedData",!1)}}function U(e,t){const s=e?e.toLowerCase().split(",").map((e=>e.trim())):[],a=s.includes("query"),r=s.includes("editing")&&!t.datesInUnknownTimezone;let i=r&&s.includes("create"),l=r&&s.includes("delete"),n=r&&s.includes("update");return r&&!(i||l||n)&&(i=l=n=!0),{supportsAdd:i,supportsDelete:l,supportsEditing:r,supportsChangeTracking:s.includes("changetracking"),supportsQuery:a,supportsQueryDataElements:(0,O.Vf)(t,"supportsQueryDataElements",!1),supportsQueryDomains:(0,O.Vf)(t,"supportsQueryDomains",!1),supportsQueryContingentValues:(0,O.Vf)(t,"supportsQueryContingentValues",!1),supportsSync:s.includes("sync"),supportsUpdate:n}}function j(e){return{maxRecordCountFactor:(0,O.kz)(e,"maxRecordCountFactor",void 0),maxRecordCount:(0,O.kz)(e,"maxRecordCount",void 0)}}function q(e){const t=null===e||void 0===e?void 0:e.advancedEditingCapabilities;return{supportsAsyncApplyEdits:(0,O.Vf)(t,"supportsAsyncApplyEdits",!1),supportsGlobalId:(0,O.Vf)(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:(0,O.Vf)(t,"supportsReturnServiceEditsInSourceSR",!1),supportsSharedTemplates:(0,O.Vf)(e,"hasSharedTemplates",!1),supportsSplit:(0,O.Vf)(t,"supportsSplit",!1)}}function N(e){const t=null===e||void 0===e?void 0:e.syncCapabilities,s=null===t||void 0===t?void 0:t.supportedSyncDataOptions;return{supportsAsync:(0,O.Vf)(t,"supportsAsync",!1),supportedSyncDataOptions:{annotations:!(1&~s),dimensions:!(2&~s),contingentValues:!(4&~s),attributeRules:!(8&~s),utilityNetworkSystem:!(16&~s),annotationFullModel:!(32&~s),include3DObjects:!(64&~s),utilityNetworkMissingLayers:!(128&~s),preserveTrueCurves:!(256&~s)}}}let J=class extends(p.A.JSONSupportMixin(u.A.IdentifiableMixin(y.A))){constructor(e){super(e),this.url=null,this.sourceJSON=null,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1,this.userTypeExtensions=[],this.layerInfos=null,this.tableInfos=null,this.capabilities=null}read(e,t){this.sourceJSON=e,super.read(e,t)}get utilityNetworkUrl(){if(this.sourceJSON)for(const e of this.sourceJSON.layers)if("Utility Network Layer"===e.type)return"".concat(this.url,"/").concat(e.id);return null}get versionManagementServiceUrl(){var e;return null!==(e=this.sourceJSON)&&void 0!==e&&e.hasBranchVersionedData&&!(0,F.$E)(this.url)?this.url.replace(/\/FeatureServer/i,"/VersionManagementServer"):null}readLayerInfos(e,t){return(t.layers||[]).map((e=>{const{type:t,geometryType:s}=e;return(0,a.A)((0,a.A)({},k(this.url,e)),{},{type:t||"Feature Layer",geometryType:s})}))}readTableInfos(e,t){return(t.tables||[]).map((e=>k(this.url,e)))}readCapabilities(e,t){return function(e){return{data:P(e),sync:N(e),operations:U(e.capabilities,e),query:j(e),editing:q(e)}}(t)}get effectiveCapabilities(){const e=this.capabilities;if(!e)return null;const t=(0,c.clone)(e),{operations:s}=t;return this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=!0,t):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=!0),t)}load(e){return this.addResolvingPromise(this._fetchService(this.url,e).then((()=>this._setUserPrivileges(e)))),Promise.resolve(this)}async fetchAllLayersAndTables(e){return await this.load(e),this._fetchLayersAndTablesPromise||(this._fetchLayersAndTablesPromise=this._fetchLayersAndTables(this.url)),(0,f.throwIfAborted)(e),this._fetchLayersAndTablesPromise}async applyEdits(e,t){let s=null;try{const{results:a,edits:r,editedFeatures:i}=await this._internalApplyEdits(e,t),l=e=>e.filter((e=>!e.error)).map(c.clone);let n=0;return a.map((e=>{s=(0,w.Zk)(this.url,e.id,null===t||void 0===t?void 0:t.gdbVersion,!0);const a={edits:r[n],addedFeatures:l(e.addFeatureResults),updatedFeatures:l(e.updateFeatureResults),deletedFeatures:l(e.deleteFeatureResults),addedAttachments:l(e.addAttachmentResults),updatedAttachments:l(e.updateAttachmentResults),deletedAttachments:l(e.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:e.editMoment?new Date(e.editMoment):null};n+=1,i.length>0&&(a.editedFeatures=i),s.resolve(a),s=null})),a}catch(a){throw s&&s.reject(a),a}}async querySharedTemplates(e){const t=(0,a.A)({},null===e||void 0===e?void 0:e.query);return null==t.layers&&null==t.templateIds&&(t.layers=this.layerInfos.map((e=>e.id))),(await async function(e){let{serviceUrl:t,query:s,requestOptions:r={}}=e;if(null==s.layers&&null==s.templateIds)throw new d.default("query-shared-templates:invalid-parameters","Must supply a value for either the 'layers' or the 'templateIds' parameters");const i=(0,C.join)(t,"sharedTemplates","query"),l=(0,a.A)((0,a.A)({f:"json"},r.query),s);l.layers&&(l.layers=D(l.layers)),l.templateIds&&(l.templateIds=D(l.templateIds)),l.tags&&(l.tags=D(l.tags));const o=(0,a.A)((0,a.A)({},r),{},{responseType:"json",query:l});return(await(0,n.default)(i,o)).data.templates}({serviceUrl:this.url,query:t,requestOptions:null===e||void 0===e?void 0:e.requestOptions})).map((e=>{const t=b.default.fromJSON(e);return t.featureService=this,t}))}async _setUserPrivileges(e){if(i.default.userPrivilegesApplied)try{const{features:{fullEdit:t},content:{updateItem:s}}=await this._fetchUserPrivileges(this.sourceJSON.serviceItemId,e);this._set("userHasFullEditingPrivileges",t),this._set("userHasUpdateItemPrivileges",s)}catch(t){(0,f.throwIfAbortError)(t)}}async _fetchUserPrivileges(e,t){const s=!0,a=!1,r=!1;if(!e)return{features:{edit:s,fullEdit:a},content:{updateItem:r}};let i,n,o;try{i=await(0,_.wI)(this.url,t)}catch(d){(0,f.throwIfAbortError)(d)}try{const e=null!=t?t.signal:null;n=await(null===l.id||void 0===l.id?void 0:l.id.getCredential("".concat(i,"/sharing"),{prompt:!1,signal:e}))}catch(d){(0,f.throwIfAbortError)(d)}if(!n)return{features:{edit:s,fullEdit:a},content:{updateItem:r}};try{if(o=new T.default({id:e,portal:{url:i}}),await o.load(t),o.portal.user)return(0,M.It)(o)}catch(d){(0,f.throwIfAbortError)(d)}return{features:{edit:s,fullEdit:a},content:{updateItem:r}}}async _internalApplyEdits(e,t){var s;await(0,S.W1)(this.url);const r=null!==(s=null===t||void 0===t?void 0:t.globalIdUsed)&&void 0!==s&&s,i=g.default.fromJSON(this.sourceJSON.spatialReference),{edits:l,options:d}=await this._processApplyEditsParams(e,t),u=await Promise.all(l.map((async e=>{var t,s,a,l;const n=null!==(t=null===(s=e.addFeatures)||void 0===s?void 0:s.map((e=>(0,I.jR)({spatialReference:i},e,null))))&&void 0!==t?t:[],d=(await Promise.all(n)).filter(o.Ru),u=d.length>0?d:null,p=null!==(a=null===(l=e.updateFeatures)||void 0===l?void 0:l.map((e=>(0,I.jR)({spatialReference:i},e,null))))&&void 0!==a?a:[],c=(await Promise.all(p)).filter(o.Ru),y=c.length>0?c:null,f=(0,I.TG)(e.identifierFields,e.deleteFeatures,r),h=f.length>0?f:null;(0,V.u)(u,y,i);const v=await(0,I.ZI)(e.identifierFields,e);let m=null;return v&&(m={adds:v.adds.length>0?v.adds:void 0,updates:v.updates.length>0?v.updates:void 0,deletes:v.deletes.length>0?v.deletes:void 0}),{id:e.id,adds:u,updates:y,deletes:h,attachments:m}}))),p={gdbVersion:null===d||void 0===d?void 0:d.gdbVersion,rollbackOnFailure:!0,useGlobalIds:r,returnEditMoment:!0,honorSequenceOfEdits:null===d||void 0===d?void 0:d.honorSequenceOfEdits,usePreviousEditMoment:null===d||void 0===d?void 0:d.usePreviousEditMoment,returnServiceEditsInSourceSR:!1,returnServiceEditsOption:"originalAndCurrentFeatures",async:!1};await(0,Z.ZJ)(this.url,null===t||void 0===t?void 0:t.gdbVersion,!0);const c=(0,Z.w5)(this.url,(null===t||void 0===t?void 0:t.gdbVersion)||null);p.edits=JSON.stringify(u);const y=(0,R.Dl)(this.url),f=(0,R.jV)(y.query,{query:(0,R.lF)((0,a.A)((0,a.A)({},p),{},{f:"json"})),method:"post"});let h;c&&(f.authMode="immediate",f.query.sessionId=Z.TA);try{h=await(0,n.default)(this.url+"/applyEdits",f)}catch(v){if(!(0,I.F0)(v))throw v;f.authMode="immediate",h=await(0,n.default)(this.url+"/applyEdits",f)}return(0,a.A)((0,a.A)({},function(e){const t=e.data,s=[];return{results:t.map((e=>{var t,r,i;const l={addResults:null!==(t=e.addResults)&&void 0!==t?t:[],updateResults:null!==(r=e.updateResults)&&void 0!==r?r:[],deleteResults:null!==(i=e.deleteResults)&&void 0!==i?i:[],attachments:e.attachments,editMoment:e.editMoment},n=(0,I.mP)(l),o=e.editedFeatures,d=null!==o&&void 0!==o&&o.spatialReference?new g.default({wkid:null===o||void 0===o?void 0:o.spatialReference.wkid,wkt:null===o||void 0===o?void 0:o.spatialReference.wkt,latestWkid:null===o||void 0===o?void 0:o.spatialReference.latestWkid,latestVcsWkid:null===o||void 0===o?void 0:o.spatialReference.latestVcsWkid,vcsWkid:null===o||void 0===o?void 0:o.spatialReference.vcsWkid}):null,u=o?(0,I.pX)(o,d):null;return u&&s.push({layerId:e.id,editedFeatures:u}),(0,a.A)({id:e.id,editedFeatures:u},n)})),editedFeatures:s}}(h)),{},{edits:l})}async _processApplyEditsParams(e,t){const s=(0,a.A)((0,a.A)({},t),{},{usingFeatureServiceEndpoint:!0});return{edits:await Promise.all(e.map((async e=>{const t=this.effectiveCapabilities,r=e&&(e.addFeatures||e.updateFeatures||e.deleteFeatures),i=e&&(e.addAttachments||e.updateAttachments||e.deleteAttachments);if((0,A.pz)(e,t,s,!!r,!!i,"feature-service"),!t.data.isDataVersioned&&null!==s&&void 0!==s&&s.gdbVersion)throw new d.default("feature-service:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isDataVersioned'");const l=(0,A.Tj)(e,t,"feature-service");return(0,a.A)((0,a.A)({},await(0,A.Gm)(l)),{},{id:e.id,identifierFields:e.identifierFields})}))),options:s}}async _fetchService(e,t){if(this.sourceJSON)return void this.read(this.sourceJSON,{url:(0,R.Dl)(e)});const s=await(0,n.default)(e,(0,a.A)({responseType:"json",query:{f:"json"}},t));this.read(s.data,{url:(0,R.Dl)(e)})}async _fetchLayersAndTables(e){const t="".concat(e,"/layers"),s=await(0,n.default)(t,{responseType:"json",query:{f:"json"}});return{layers:s.data.layers.map((e=>{const{type:t,geometryType:s}=e,r=k(this.url,e),i=(0,E.S)(e,r.url);return(0,a.A)((0,a.A)({},r),{},{type:t||"Feature Layer",geometryType:s,capabilities:i})})),tables:s.data.tables.map((e=>{const t=k(this.url,e),s=(0,E.S)(e,t.url);return(0,a.A)((0,a.A)({},t),{},{capabilities:s})}))}}};(0,r._)([(0,h.MZ)()],J.prototype,"url",void 0),(0,r._)([(0,h.MZ)()],J.prototype,"sourceJSON",void 0),(0,r._)([(0,h.MZ)()],J.prototype,"userHasFullEditingPrivileges",void 0),(0,r._)([(0,h.MZ)()],J.prototype,"userHasUpdateItemPrivileges",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],J.prototype,"utilityNetworkUrl",null),(0,r._)([(0,h.MZ)({readOnly:!0})],J.prototype,"versionManagementServiceUrl",null),(0,r._)([(0,h.MZ)()],J.prototype,"userTypeExtensions",void 0),(0,r._)([(0,h.MZ)({json:{read:{source:["layers"]}}})],J.prototype,"layerInfos",void 0),(0,r._)([(0,v.w)("layerInfos",["layers"])],J.prototype,"readLayerInfos",null),(0,r._)([(0,h.MZ)({json:{read:{source:["tables"]}}})],J.prototype,"tableInfos",void 0),(0,r._)([(0,v.w)("tableInfos",["tables"])],J.prototype,"readTableInfos",null),(0,r._)([(0,h.MZ)({readOnly:!0,json:{read:{source:["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"]}}})],J.prototype,"capabilities",void 0),(0,r._)([(0,v.w)("capabilities",["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"])],J.prototype,"readCapabilities",null),(0,r._)([(0,h.MZ)({readOnly:!0})],J.prototype,"effectiveCapabilities",null),J=(0,r._)([(0,m.$)("esri.rest.featureService.FeatureService")],J);const L=J},12730:(e,t,s)=>{s.d(t,{T:()=>a});const a=new(s(45802).J)({"{acd53634-cbc7-44d5-bde9-692fa8d45850}":"autocomplete-freehand-polygons","{6f5fc612-d1ef-4d32-a2e1-18a1cb22331c}":"autocomplete-polygons","{09c6f589-a3ce-48ab-81bc-46965c58f264}":"circle","{bccf295a-9c64-4adc-903e-62d827c10ef7}":"create-points-along-line","{756cadf6-91e6-04b1-2938-e172a97af51c}":"create-structures","{ddbe4c0c-063f-8b60-b2da-b349a1e42e84}":"difference-polygon","{a5f4db5f-4a6b-29bd-1f32-9d81bf262c76}":"elevation-point-from-contour","{285ec4bb-60a8-7184-2088-5bee2149f2a4}":"elevation-point-from-dem","{28c04532-3daf-4d3d-b7be-a589c9c9a03e}":"ellipse","{0a7c16b9-1cfd-467f-8ece-6ba376192431}":"freehand","{af2dbf8f-280e-44db-8860-e399d0b30cf1}":"line","{bc485127-2ea2-4c8b-85ef-e8237959eb64}":"multipoint","{d304243a-5c3a-4ccc-b98b-93684b15fd83}":"parcel-seed","{2a8b3331-5238-4025-972e-452a69535b06}":"point","{d376f8e5-69e0-4273-9478-724e9e0d81ac}":"point-and-rotation","{93ce7077-f09e-455e-ade7-b7413cddc393}":"point-at-end-of-line","{8f79967b-66a0-4a1c-b884-f44bc7e26921}":"polygon","{a947ba80-1c29-4bcd-8672-1963b7b9dde0}":"radial-line","{6f0ed2cc-c099-4895-bd7e-beec2f78adbf}":"rectangle","{a281e635-0f22-47d4-a438-e4d29b920e22}":"regular-polygon","{5664cae4-c7de-432a-9933-9586bc15ed39}":"regular-polyline","{c5c42e29-44da-4a1c-8688-e02c07535bc3}":"right-angle-line","{ee16991b-6303-4a8a-9143-1914b2010c1a}":"right-angle-polygon","{7d3e17cf-30dd-4593-9bd8-0b2b8770f52a}":"split","{e00209dd-05c5-4424-be62-51581f9f811d}":"stream-line","{6c6970a7-5ca9-448c-9c7d-0d716cd2ac64}":"stream-polygon","{e22f7d98-007d-427c-8282-13704f7c84c3}":"trace","{6cf59352-8e14-402c-8f4c-ed72647f5e42}":"two-point-line"})},54039:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(35143),r=s(42553),i=s(46053),l=(s(81806),s(76460),s(47249),s(28379)),n=s(85842),o=s(12730);let d=class extends r.A{constructor(e){super(e),this.type="feature",this.templateId=null,this.defaultTool=null,this.description=null,this.globalId="",this.hash="",this.layerIds=[],this.name="",this.subtypeCode=null,this.status=null,this.userIdentity=null,this.tags=[],this.visible=!0}readThumbnail(e){return null==e||""===e?null:{contentType:"png",imageData:e,height:64,width:64}}readDefaultTool(e){return null==e?null:o.T.fromJSON(e.toLowerCase())}readLayerIds(e,t){return null!=t.layerIds?t.layerIds.split(",").map((e=>parseInt(e.trim(),10))):null!=t.layerId?[t.layerId]:[]}readTags(e,t){const s=t.tag;return null==s?[]:s.split(";").map((e=>e.trim()))}};(0,a._)([(0,i.MZ)()],d.prototype,"type",void 0),(0,a._)([(0,i.MZ)({json:{read:!1,write:!1}})],d.prototype,"featureService",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"thumbnail",void 0),(0,a._)([(0,l.w)("thumbnail")],d.prototype,"readThumbnail",null),(0,a._)([(0,i.MZ)()],d.prototype,"templateId",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"defaultTool",void 0),(0,a._)([(0,l.w)("defaultTool")],d.prototype,"readDefaultTool",null),(0,a._)([(0,i.MZ)()],d.prototype,"description",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"globalId",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"hash",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"layerIds",void 0),(0,a._)([(0,l.w)("layerIds",["layerIds","layerId"])],d.prototype,"readLayerIds",null),(0,a._)([(0,i.MZ)()],d.prototype,"name",void 0),(0,a._)([(0,i.MZ)({json:{name:"subtype"}})],d.prototype,"subtypeCode",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"status",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"userIdentity",void 0),(0,a._)([(0,i.MZ)()],d.prototype,"tags",void 0),(0,a._)([(0,l.w)("tags",["tag"])],d.prototype,"readTags",null),(0,a._)([(0,i.MZ)()],d.prototype,"visible",void 0),d=(0,a._)([(0,n.$)("esri.editing.sharedTemplates.SharedTemplateMetadata")],d);const u=d}}]);
//# sourceMappingURL=8163.0134286a.chunk.js.map