"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[10033,43277,71220,95811],{10033:(e,t,r)=>{r.r(t),r.d(t,{createVersioningStates:()=>v,getVersioningStates:()=>h});var i=r(19276),o=r(54901),n=r(76460),s=r(87663),a=r(8163),u=r(43277),d=r(54265),l=r(85056);async function v(e,t){let r;if("layers"in e){const t=(0,l.createVersionAdapters)(e.allTables.concat(e.allLayers).filter((e=>"group"!==e.type)).toArray());e.utilityNetworks&&e.utilityNetworks.forEach((e=>{const r=(0,l.createVersionAdapters)([e]);t.push(...r)})),r=t}else r=new i.default(e);const o=new Map;for(const s of r){const e=o.get(s.featureServiceUrl);e?e.push(s):o.set(s.featureServiceUrl,new i.default([s]))}const n=new i.default;for(const[i,s]of o){const e=new a.default({url:i});if(await e.load(),!e.versionManagementServiceUrl)continue;const r=new d.default({url:e.versionManagementServiceUrl});n.push(new u.default({versionManagementService:r,versionableItems:s,usePersistentReadSessions:t}))}return n}const c=new Map;async function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=await v(e.map,t);return(0,s.tE)(c,e,(()=>(e.addHandles((0,o.hA)((()=>{c.delete(e),r.forEach((e=>e.destroy()))}))),r.forEach((e=>e.load().catch((e=>{n.A.getLogger("esri.versionManagement.VersioningState").error("Failed to load Versioning State",e)})))),r)))}},43277:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var i=r(35143),o=r(19276),n=r(50076),s=r(42553),a=r(49304),u=r(76460),d=r(46053),l=(r(81806),r(47249),r(85842));let v=class extends(s.A.JSONSupportMixin(a.A)){constructor(e){super(e),this.versionManagementService=null,this.featureServiceUrl=null,this.url=null,this.currentVersion=null,this.currentVersionInfo=null,this.versionInfos=[],this.versionableItems=new o.default,this.usePersistentReadSessions=!1,this.state="lock-none"}initialize(){this.url=this.versionManagementService.url,this.featureServiceUrl=this.url.replace(/\/VersionManagementServer/i,"/FeatureServer"),this.addHandles([this.versionableItems.on("before-add",(e=>{if(e.item.featureServiceUrl.toLowerCase()!==this.featureServiceUrl.toLowerCase())return e.preventDefault(),void u.A.getLogger(this).error("#add()","Cannot add versionAdapter, feature service urls do not match.")})),this.versionableItems.on("before-remove",(e=>{if(0===this.versionableItems.items.length&&this.currentVersion&&"name"in this.currentVersion&&"none"!==this.versionManagementService.getLockType(this.currentVersion))return e.preventDefault(),void u.A.getLogger(this).error("#remove()","Cannot remove last versionAdapter.")}))])}load(e){return this.addResolvingPromise(this._setUpState(e)),Promise.resolve(this)}get defaultVersionIdentifier(){return this.versionManagementService.defaultVersionIdentifier}get isDefault(){return!this.currentVersion||!!this.currentVersion&&"name"in this.currentVersion&&this.currentVersion.name===this.defaultVersionIdentifier.name}async getVersionInfos(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.versionInfos=await this.versionManagementService.getVersionInfos()),this.versionInfos}async alterVersion(e,t){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const r=await this.versionManagementService.alterVersion(e,t);return r&&await this.getVersionInfos(!0),r}async deleteVersion(e){if(this.currentVersion&&"guid"in this.currentVersion&&e.guid===this.currentVersion.guid)return!1;const t=await this.versionManagementService.deleteVersion(e);return t&&await this.getVersionInfos(!0),t}async getVersionInfoExtended(){return this.currentVersion&&"name"in this.currentVersion?this.versionManagementService.getVersionInfoExtended(this.currentVersion):this.versionManagementService.getVersionInfoExtended(this.defaultVersionIdentifier)}async startEditing(){if(this._isDefaultOrHistoricVersion())return{success:!1};if(!this.usePersistentReadSessions){const e=await this.versionManagementService.startReadingWithResult(this.currentVersion);if(!e.success)return e;this.state="lock-read"}const e=await this.versionManagementService.startEditingWithResult(this.currentVersion);return e.success&&(this.state="lock-write"),e}async stopEditing(e){if(this._isDefaultOrHistoricVersion())return{success:!1};const t=await this.versionManagementService.stopEditingWithResult(this.currentVersion,e);if(!t.success)return t;if(this.state="lock-read",!this.usePersistentReadSessions){const e=await this.versionManagementService.stopReadingWithResult(this.currentVersion);return e.success&&(this.state="lock-none"),e}return t}async changeVersion(e){var t;let r=null;if(this.usePersistentReadSessions){var i;if(this._isDefaultOrHistoricVersion(e))e&&"name"in e?(r=await this.versionManagementService.getVersionInfoExtended(e),this.state="public"===(null===(i=r)||void 0===i?void 0:i.access)?"lock-none":"lock-read"):this.state="lock-read";else if(!await this.versionManagementService.startReading(e))throw new n.default("Failed to acquire read lock for version: "+e);this._isDefaultOrHistoricVersion(this.currentVersion)||await this.versionManagementService.stopReading(this.currentVersion)}const o=await this.versionManagementService.changeVersionWithResult(this.versionableItems,this.currentVersion,e);let s=!1;return o.forEach(((e,t)=>{s=s||e.success})),s&&(this.currentVersion=e,this.currentVersionInfo=r||await this.getVersionInfoExtended(),this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state="public"===(null===(t=this.currentVersionInfo)||void 0===t?void 0:t.access)?"lock-none":"lock-read":this.state="lock-read":this.state="read"!==this.versionManagementService.getLockType(this.currentVersion)?"lock-none":"lock-read"),o}async undo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.undo(this.currentVersion),{success:!0})}async redo(){return this._isDefaultOrHistoricVersion()?{success:!1}:(this.versionManagementService.redo(this.currentVersion),{success:!0})}async _setUpState(e){var t;await this.versionManagementService.load(e),this.state="lock-none",this.currentVersionInfo=await this.getVersionInfoExtended(),this.versionableItems.forEach((e=>{this.currentVersion?"name"in this.currentVersion?(e.gdbVersion=this.currentVersion.name,e.historicMoment=null):(e.historicMoment=this.currentVersion,e.gdbVersion=null):(e.gdbVersion=null,e.historicMoment=null)})),this.usePersistentReadSessions&&(this._isDefaultOrHistoricVersion()?this.currentVersion&&"name"in this.currentVersion?this.state="public"===(null===(t=this.currentVersionInfo)||void 0===t?void 0:t.access)?"lock-none":"lock-read":this.state="lock-read":await this.versionManagementService.startReading(this.currentVersion)&&(this.state="lock-read"))}_isDefaultOrHistoricVersion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentVersion;return!(e&&"name"in e)||e.name===this.versionManagementService.defaultVersionIdentifier.name}};(0,i._)([(0,d.MZ)()],v.prototype,"versionManagementService",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"featureServiceUrl",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"url",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"currentVersion",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"currentVersionInfo",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"versionInfos",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"versionableItems",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"usePersistentReadSessions",void 0),(0,i._)([(0,d.MZ)()],v.prototype,"state",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],v.prototype,"defaultVersionIdentifier",null),(0,i._)([(0,d.MZ)({readOnly:!0})],v.prototype,"isDefault",null),v=(0,i._)([(0,l.$)("esri.versionManagement.VersioningState")],v);const c=v},71220:(e,t,r)=>{r.r(t),r.d(t,{createFeatureServices:()=>s});var i=r(13096),o=r(8163);const n=(e,t)=>{for(const r of e)if("feature"===r.type||"subtype-group"===r.type){if(!r.url)continue;const e=(0,i.qg)(r.url).url.path,n=t.get(e);if(n)n.layers.push(r);else{const i=new o.default({url:e}),n=[r];t.set(e,{featureService:i,layers:n})}}else"group"===r.type&&n(r.layers.filter((e=>"feature"===e.type||"subtype-group"===e.type||"group"===e.type)),t)};function s(e){const t=new Map;return n(e,t),t}},95811:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var i=r(53986),o=r(35143),n=r(91967),s=r(19276),a=r(50076),u=r(76460),d=r(68134),l=r(90534),v=r(46053),c=(r(81806),r(47249),r(85842)),h=r(19451),p=r(31933),g=r(24883),m=r(96422),f=r(8163),w=r(71220),_=r(10033),S=r(43277),V=r(54265),E=r(85056);const y=["featureServerUrl","versionIdentifier"];let L=class extends n.default{constructor(e){super(e),this._portalLookup=new Map,this._updatingHandlesLoad=new h.U,this._updatingHandlesExecute=new h.U,this.advancedEditingUserTypeExtensionLookup=new Map,this.executionError=void 0,this.featureServiceLookup=new Map,this.loadError=void 0,this.serverVersionLookup=new Map,this.serviceNameLookup=new Map,this.userLookup=new Map,this.versionIdentifierLookup=new Map,this.versionInfoLookup=new Map,this.versionAdministratorLookup=new Map,this.versionManagementServiceLookup=new Map,this.versioningStateLookup=new Map,this.view=null,this.versioningStates=null}initialize(){this._viewChangeHandle(),this.addHandles([(0,d.watch)((()=>this.view),(()=>{this._resetAllLookupProperties(),this._viewChangeHandle()})),(0,d.watch)((()=>this.versioningStates),(()=>{this._resetVersioningLookupProperties(),this._setVersioningStatesLookups()}))])}destroy(){this._updatingHandlesLoad.destroy(),this._updatingHandlesExecute.destroy()}get state(){return this._updatingHandlesLoad.updating?"loading":this.loadError?"disabled":this._updatingHandlesExecute.updating?"executing":this.executionError?"failed":"ready"}async alterVersion(e){return this._updatingHandlesExecute.addPromise(this._alterVersionInternal(e))}async changeVersion(e,t,r){return this._updatingHandlesExecute.addPromise(this._changeVersionInternal(e,t,r))}async createVersion(e){return this._updatingHandlesExecute.addPromise(this._createVersionInternal(e))}async deleteVersion(e,t,r){return this._updatingHandlesExecute.addPromise(this._deleteVersionInternal(e,t,r))}async getVersionInfos(e){return this._updatingHandlesExecute.addPromise(this._getVersionInfosInternal(e))}async _alterVersionInternal(e){if("disabled"===this.state)throw this._logError("version-management-view-model:load-error",this.loadError),new a.default("version-management-view-model:load-error",this.loadError);this._setExecutionError();const t=this.versioningStateLookup.get(e.featureServerUrl);if(!t)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a.default("version-management-view-model:execution-error",this.executionError);if(!this.serverVersionLookup.has(e.featureServerUrl)||this.serverVersionLookup.get(e.featureServerUrl)<=11.1)throw this._logError("version-management-view-model:execution-error","no-valid-enterprise-version"),new a.default("version-management-view-model:execution-error",this.executionError);if(!this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl))throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a.default("version-management-view-model:execution-error",this.executionError);const{featureServerUrl:r,versionIdentifier:o}=e,n=(0,i.A)(e,y),s=await t.alterVersion(o,n).catch((e=>{throw this._logExecutionError(e),e}));return await this.getVersionInfos(r),s}async _changeVersionInternal(e,t,r){if("disabled"===this.state)throw this._logError("version-management-view-model:load-error",this.loadError),new a.default("version-management-view-model:load-error",this.loadError);this._setExecutionError();const i=this.versioningStateLookup.get(e);if(!i)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a.default("version-management-view-model:execution-error",this.executionError);const o={name:t,guid:r};return await i.changeVersion(o).catch((e=>{throw this._logExecutionError(e),e}))}_updateVersionableItems(e){this._updatingHandlesLoad.addPromise((async()=>{(0,E.createVersionAdapters)(e.added).forEach((e=>{const t=e.featureServiceUrl,r=this.versioningStateLookup.get(t);r&&(r.versionableItems.find((t=>t.versionableItem===e.versionableItem))||r.versionableItems.add(e))})),(0,E.createVersionAdapters)(e.removed).forEach((e=>{const{allLayers:t,allTables:r}=this.view.map,i=e.featureServiceUrl,o=this.versioningStateLookup.get(i);if(!o)return void this._logError("version-management-view-model:execution-error","no-version-management-service-found");const n=e=>{var t,r;return("feature"===e.type||"subtype-group"===e.type)&&null!==(t=null===(r=e.url)||void 0===r?void 0:r.includes(i))&&void 0!==t&&t};[...t.filter(n),...r.filter(n)].length||(this.featureServiceLookup.delete(i),this.serviceNameLookup.delete(i),this.versioningStateLookup.delete(i),this.versioningStates.remove(o));const s=o.versionableItems.find((t=>t.versionableItem===e.versionableItem));s&&o.versionableItems.remove(s)}))})())}async _createVersionInternal(e){var t,r,i,o,n;if("disabled"===this.state)throw this._logError("version-management-view-model:load-error",this.loadError),new a.default("version-management-view-model:load-error",this.loadError);this._setExecutionError();const s=e.featureServerUrl,u=this.versioningStateLookup.get(s);if(!u)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a.default("version-management-view-model:execution-error",this.executionError);const d=this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl),l=this.userLookup.get(s).toUpperCase(),v=this._isEmptyString(e.ownerName)?l:null===(t=e.ownerName)||void 0===t?void 0:t.trim().toUpperCase();if(v!==l){if(this.serverVersionLookup.get(s)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new a.default("version-management-view-model:execution-error",this.executionError);if(!d)throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a.default("version-management-view-model:execution-error",this.executionError)}let c=await(null===(r=this.versioningStateLookup.get(s))||void 0===r?void 0:r.getVersionInfos());if("SDE"===(null===v||void 0===v?void 0:v.toUpperCase())&&"DEFAULT"===e.versionName.toUpperCase()||null!==(i=c)&&void 0!==i&&i.find((t=>t.versionIdentifier.name.toUpperCase()===(v+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(l+"."+e.versionName).toUpperCase())))throw this._logError("version-management-view-model:execution-error","no-valid-version-name"),new a.default("version-management-view-model:execution-error",this.executionError);const h=await u.versionManagementService.createVersion({versionName:e.versionName,access:v!==l?"public":e.access,description:e.description}).catch((e=>{throw this._logExecutionError(e),e}));if(v!==l){const{guid:t,name:r}=h.versionIdentifier,i={featureServerUrl:s,versionIdentifier:{guid:t,name:r},access:e.access,ownerName:v};await this.alterVersion(i)||this.deleteVersion(s,l+"."+e.versionName,h.versionIdentifier.guid)}return await this.getVersionInfos(s),c=await(null===(o=this.versioningStateLookup.get(s))||void 0===o?void 0:o.getVersionInfos()),null===(n=c)||void 0===n?void 0:n.find((e=>e.versionIdentifier.guid===h.versionIdentifier.guid))}async _deleteVersionInternal(e,t,r){if("disabled"===this.state)throw this._logError("version-management-view-model:load-error",this.loadError),new a.default("version-management-view-model:load-error",this.loadError);this._setExecutionError();const i=this.versioningStateLookup.get(e);if(!i)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a.default("version-management-view-model:execution-error",this.executionError);if(this.serverVersionLookup.get(e)<=11.1)throw this._logError("version-management-view-model:execution-error","versioning-api-error"),new a.default("version-management-view-model:execution-error",this.executionError);if(!this.advancedEditingUserTypeExtensionLookup.get(e))throw this._logError("version-management-view-model:execution-error","no-advanced-editing-user-type-extension"),new a.default("version-management-view-model:execution-error",this.executionError);const o={name:t,guid:r};return await i.deleteVersion(o).catch((e=>{throw this._logExecutionError(e),new a.default("version-management-view-model:execution-error",this.executionError)}))}async _getVersionInfosInternal(e){var t,r,i;if("disabled"===this.state)throw this._logError("version-management-view-model:load-error",this.loadError),new a.default("version-management-view-model:load-error",this.loadError);this._setExecutionError();const o=null===(t=this.featureServiceLookup.get(e))||void 0===t?void 0:t.featureService;if(!o)throw this._logError("version-management-view-model:execution-error","no-feature-service-found"),new a.default("version-management-view-model:execution-error",this.executionError);o.loaded||await o.load().catch((e=>{throw this._logExecutionError(e),e}));const n=o.url;this.serverVersionLookup.set(n,null!==(r=null===(i=o.sourceJSON)||void 0===i?void 0:i.currentVersion)&&void 0!==r?r:0),this.serverVersionLookup.get(n)<=11.1&&this.advancedEditingUserTypeExtensionLookup.set(n,!1);const s=this.userLookup.get(e);this._portalLookup.get(e)&&s?(this.advancedEditingUserTypeExtensionLookup.set(n,await(0,m.RE)(this._portalLookup.get(e),s,"advediting")),this.versionAdministratorLookup.set(n,await(0,m.Sl)(this._portalLookup.get(e),s,"features:user:manageVersions"))):(this.advancedEditingUserTypeExtensionLookup.set(n,!1),this.versionAdministratorLookup.set(n,!1));const u=this.versioningStateLookup.get(e);if(!u)throw this._logError("version-management-view-model:execution-error","no-versioning-state-found"),new a.default("version-management-view-model:execution-error",this.executionError);return u.loaded||await u.load().catch((e=>{throw this._logExecutionError(e),e})),await u.getVersionInfos(!0).catch((e=>{throw this._logExecutionError(e),e}))}_isEmptyString(e){return!e||0===e.trim().length}_logError(e,t){switch(u.A.getLogger(this).error(new a.default(e,t)),e){case"version-management-view-model:load-error":this._setLoadError(t);break;case"version-management-view-model:execution-error":this._setExecutionError(t)}}_logExecutionError(e){this._logError("version-management-view-model:execution-error",e.message)}async _viewChangeHandle(){this._updatingHandlesLoad.addPromise((async()=>{if(this._setLoadError(),!this.view)return void this._setLoadError("no-view-property");if(this.view&&"2d"!==this.view.type)return void this._logError("version-management-view-model:load-error","sceneView-not-supported");this.removeHandles("map-change-handle"),this.addHandles([(0,d.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),(()=>{this._resetAllLookupProperties(),this._mapChangeHandle(this.versioningStates)}))],"map-change-handle");const e=await this._getVersioningStates();await this._mapChangeHandle(e)})())}async _mapChangeHandle(e){this._updatingHandlesLoad.addPromise((async()=>{this._setLoadError(),this.removeHandles("map-layers-tables-change-handle"),this.addHandles([(0,d.on)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map.allLayers}),"change",(e=>{(e.added.some((e=>{let{type:t}=e;return"feature"===t}))||e.removed.some((e=>{let{type:t}=e;return"feature"===t}))||e.added.some((e=>{let{type:t}=e;return"subtype-group"===t}))||e.removed.some((e=>{let{type:t}=e;return"subtype-group"===t})))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(e))})),(0,d.on)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map.allTables}),"change",(e=>{(e.added.some((e=>{let{type:t}=e;return"feature"===t}))||e.removed.some((e=>{let{type:t}=e;return"feature"===t}))||e.added.some((e=>{let{type:t}=e;return"subtype-group"===t}))||e.removed.some((e=>{let{type:t}=e;return"subtype-group"===t})))&&(this._resetServiceRelatedLookupProperties(),this._propertiesChangeInternal(this.versioningStates),this._updateVersionableItems(e))}))],"map-layers-tables-change-handle"),await this._propertiesChangeInternal(e)})())}async _propertiesChangeInternal(e){this._updatingHandlesLoad.addPromise((async()=>{const t=e=>"feature"===e.type||"subtype-group"===e.type,{allLayers:r,allTables:i}=this.view.map;if(this._setLoadError(),this.featureServiceLookup=(0,w.createFeatureServices)([...r.filter(t),...i.filter(t)]),this.featureServiceLookup.size){this._updateFeatureServiceLookup(e),this.serviceNameLookup=new Map;for(const e of this.featureServiceLookup.values()){const{featureService:t,featureService:{url:r}}=e;if(!this.serviceNameLookup.has(r)){var o;if(t.loaded||await t.load().catch((e=>{u.A.getLogger(this).error(e)})),!t.versionManagementServiceUrl){this.featureServiceLookup.delete(r);continue}const e=await(0,p.wI)(r),i=new g.default({authMode:"immediate",url:e});await i.load().catch((e=>{u.A.getLogger(this).error(e)}));const n=null===(o=i.user)||void 0===o?void 0:o.username;if(!t.loaded||!i.loaded||!n)continue;this.serviceNameLookup.set((0,l.removeTrailingSlash)(r),r.split("/").at(-2)),this.userLookup.set(r,n),this._portalLookup.set(r,i)}}this.removeHandles("versioning-states-change-handle"),e.forEach((e=>this._handleVersioningStateLookupUpdate(e))),await this._updateVersioningStates(e),this.versioningStates=e}else this._logError("version-management-view-model:load-error","no-feature-services")})())}_updateFeatureServiceLookup(e){for(const t of e){const e=t.featureServiceUrl;if(!this.featureServiceLookup.has(e)){const r=new f.default({url:e}),i=t.versionableItems.toArray().flatMap((e=>"network"===e.type?null:e.versionableItem)).filter((e=>!!e));this.featureServiceLookup.set(e,{featureService:r,layers:i})}}}async _updateVersioningStates(e){for(const t of this.featureServiceLookup.values()){const r=t.featureService;if(r.versionManagementServiceUrl){if(!e.find((e=>e.featureServiceUrl===r.url))&&r.versionManagementServiceUrl){const i=new s.default((0,E.createVersionAdapters)(t.layers)),o=new S.default({versionManagementService:new V.default({url:r.versionManagementServiceUrl}),versionableItems:i});e.add(o),this._handleVersioningStateLookupUpdate(o)}await this.getVersionInfos(r.url)}}}async _getVersioningStates(){return this.versioningStates&&this.versioningStates.length?this.versioningStates:this.view?await(0,_.getVersioningStates)(this.view,!1):(this._logError("version-management-view-model:load-error","no-view-property"),new s.default)}_handleVersioningStateLookupUpdate(e){var t;this.versioningStateLookup.set(e.featureServiceUrl,e),this._addHandlesToVersioningState(e),this.versionIdentifierLookup.set(e.featureServiceUrl,null===(t=e.currentVersionInfo)||void 0===t?void 0:t.versionIdentifier),this.versionManagementServiceLookup.set(e.featureServiceUrl,e.versionManagementService)}async _setVersioningStatesLookups(){this._updatingHandlesLoad.addPromise((async()=>{this.versioningStates&&(this.removeHandles("versioning-states-change-handle"),this._updateFeatureServiceLookup(this.versioningStates),this.versioningStates.forEach((e=>this._handleVersioningStateLookupUpdate(e))),await this._updateVersioningStates(this.versioningStates))})())}_addHandlesToVersioningState(e){this.addHandles([(0,d.watch)((()=>e.versionInfos),(()=>{this.versionInfoLookup.set(e.featureServiceUrl,e.versionInfos)})),(0,d.watch)((()=>{var t;return null===(t=e.currentVersionInfo)||void 0===t?void 0:t.versionIdentifier}),(()=>{var t;this.versionIdentifierLookup.set(e.featureServiceUrl,null===(t=e.currentVersionInfo)||void 0===t?void 0:t.versionIdentifier)}))],"versioning-states-change-handle")}_resetVersioningLookupProperties(){this.versionIdentifierLookup=new Map,this.versionInfoLookup=new Map,this.versionManagementServiceLookup=new Map,this.versioningStateLookup=new Map}_resetAllLookupProperties(){this._portalLookup=new Map,this.advancedEditingUserTypeExtensionLookup=new Map,this.serverVersionLookup=new Map,this.userLookup=new Map,this.versioningStates=new s.default,this._resetVersioningLookupProperties(),this._resetServiceRelatedLookupProperties()}_resetServiceRelatedLookupProperties(){this.featureServiceLookup=new Map,this.serviceNameLookup=new Map}_setExecutionError(e){this._set("executionError",e)}_setLoadError(e){this._set("loadError",e)}};(0,o._)([(0,v.MZ)()],L.prototype,"_portalLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"advancedEditingUserTypeExtensionLookup",void 0),(0,o._)([(0,v.MZ)({readOnly:!0})],L.prototype,"executionError",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"featureServiceLookup",void 0),(0,o._)([(0,v.MZ)({readOnly:!0})],L.prototype,"loadError",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"serverVersionLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"serviceNameLookup",void 0),(0,o._)([(0,v.MZ)({readOnly:!0})],L.prototype,"state",null),(0,o._)([(0,v.MZ)()],L.prototype,"userLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versionIdentifierLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versionInfoLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versionAdministratorLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versionManagementServiceLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versioningStateLookup",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"view",void 0),(0,o._)([(0,v.MZ)()],L.prototype,"versioningStates",void 0),L=(0,o._)([(0,c.$)("esri.widgets.VersionManagement.VersionManagementViewModel")],L);const k=L},96422:(e,t,r)=>{r.d(t,{Kw:()=>n,RE:()=>a,Sl:()=>s});var i=r(55171),o=r(3825);async function n(e,t,r){var n;if(!(null===i.id||void 0===i.id?void 0:i.id.findCredential(e.restUrl)))return null;if("loaded"===e.loadStatus&&""===t&&null!==(n=e.user)&&void 0!==n&&n.sourceJSON&&!1===r)return e.user.sourceJSON;const s={responseType:"json",query:{f:"json"}};if(r&&(s.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,o.default)(e.restUrl+"/community/self",s);if(t.data){const e=t.data;if(null!==e&&void 0!==e&&e.username)return e}return null}const a=await(0,o.default)(e.restUrl+"/community/users/"+t,s);if(a.data){const e=a.data;return e.error?null:e}return null}async function s(e,t,r){var i,o;const s=await n(e,t,!0);return null!==(i=null===s||void 0===s||null===(o=s.privileges)||void 0===o?void 0:o.includes(r))&&void 0!==i&&i}async function a(e,t,r){var i,o;const s=await n(e,t,!0);return null!==(i=null===s||void 0===s||null===(o=s.userLicenseTypeExtensions)||void 0===o?void 0:o.includes(r))&&void 0!==i&&i}}}]);
//# sourceMappingURL=95811.8f6bb942.chunk.js.map