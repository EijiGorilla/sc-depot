"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[97537],{89887:(e,t,l)=>{l.r(t),l.d(t,{default:()=>q});var i=l(89379),o=l(35143),r=l(53084),s=l(46053),n=l(81806),a=l(76460),u=l(85842),c=l(72934),d=(l(11265),l(50076)),h=l(30726),g=l(31633),p=l(65215),v=l(86100),f=l(77269),y=l(39348),m=l(65256);const S=/https?:\/\/services.*\.arcgis\.com/i,_=/(?:\{([^}]+)\})/g,w=()=>a.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function x(e,t){const{exactMatch:l=!1,location:i,maxResults:o,spatialReference:r,source:s,sourceIndex:n,suggestResult:a,view:u}=e,{layer:c,filter:h,zoomScale:p}=s,v=null===u||void 0===u?void 0:u.scale,f=F(s,u),y=null===t||void 0===t?void 0:t.signal;return T(c).then((()=>{const e=c.popupTemplate;return e?e.getRequiredFields(c.fieldsIndex):null})).then((e=>{var t,m;const{objectIdField:S,returnZ:_}=c,x=Z(s);if(!C(c,x))throw w().error("invalid-field: displayField is invalid."),new d.default("getResults():invalid-field","displayField is invalid.");const b=null!==e&&void 0!==e&&e.length?e:[x],F=s.outFields||b,T=M(F);if(F.includes(S)||T||F.push(S),(null===(t=c.floorInfo)||void 0===t?void 0:t.floorField)&&F.push(c.floorInfo.floorField),!T&&!P(c,F))throw w().error("invalid-field: outField is invalid."),new d.default("getResults():invalid-field","outField is invalid.");const O=c.createQuery(),{orderByFields:D}=s;if(D&&(O.orderByFields=D),r){O.outSpatialReference=r;const e=1/(0,g.GA)(r);e&&(O.maxAllowableOffset=e)}const k="mesh"===c.geometryType||"multipatch"===c.geometryType,V=(null===(m=c.capabilities)||void 0===m||null===(m=m.data)||void 0===m?void 0:m.supportsZ)&&!k;if(O.returnZ=V&&!1!==_,O.returnGeometry=!0,O.multipatchOption=k?"xyFootprint":null,F&&(O.outFields=F),i)O.geometry=i;else if(a.key)O.objectIds=[a.key];else{var q;const e=s.searchFields||[x];if(!P(c,e))throw w().error("invalid-field: search field is invalid."),new d.default("getResults():invalid-field","search field is invalid.");A(c)&&(O.num=o),f&&(O.geometry=f);if(!(null===(q=a.text)||void 0===q?void 0:q.trim()))return[];const t=a.text,{prefix:i="",suffix:r=""}=s,n=G("".concat(i).concat(t).concat(r));E(c)&&I(c,e)&&!l&&t&&(O.fullText=R({text:t,searchFields:e}));const u=N({searchTerm:n,layer:c,searchFields:e,filter:h,exactMatch:l,query:O,type:"search"});if(O.where=u,!L(O))return[]}return c.queryFeatures(O,{signal:y}).then((e=>function(e,t,l,i,o,r,s){return e.features.map((e=>j(e,t,l,i,o,r,s)))}(e,u,s,n,x,v,p)))}))}function b(e,t){const{source:l,spatialReference:i,view:o,suggestTerm:r,maxSuggestions:s,sourceIndex:n,exactMatch:a}=e,{layer:u,filter:c}=l,h=null===t||void 0===t?void 0:t.signal,g=F(l,o);return T(u).then((()=>{if(!A(u))return[];const e=Z(l),t=l.searchFields||[e],o=[];l.suggestionTemplate?l.suggestionTemplate.replaceAll(_,((e,t)=>(o.push(t),e))):o.push(e);const p=M(o);o.includes(u.objectIdField)||p||o.push(u.objectIdField);const v=C(u,e),f=p||P(u,o),y=P(u,t);if(!v)throw w().error("invalid-field: displayField is invalid."),new d.default("getSuggestions():invalid-field","displayField is invalid.");if(!f)throw w().error("invalid-field: outField is invalid."),new d.default("getSuggestions():invalid-field","outField is invalid.");if(!y)throw w().error("invalid-field: search field is invalid."),new d.default("getSuggestions():invalid-field","search field is invalid.");const m=u.createQuery(),{orderByFields:S}=l;if(S&&(m.orderByFields=S),m.outSpatialReference=i,m.returnGeometry=!1,m.num=s,m.outFields=o,g&&(m.geometry=g),!r.trim())return[];const{prefix:x="",suffix:b=""}=l,F=G("".concat(x).concat(r).concat(b));E(u)&&I(u,t)&&!a&&r&&(m.fullText=R({text:r,searchFields:t}));const T=N({searchTerm:F,layer:u,searchFields:t,filter:c,exactMatch:a,query:m,type:"suggest"});return m.where=T,L(m)?u.queryFeatures(m,{signal:h}).then((t=>function(e,t,l,i){return e.features.map((e=>function(e,t,l,i){const o=e.sourceLayer,{attributes:r}=e,{objectIdField:s}=o,n=s?r[s]:null;return{text:D(e,t.suggestionTemplate,i),key:n,sourceIndex:l}}(e,t,l,i)))}(t,l,n,e))):[]}))}function F(e,t){const{filter:l,withinViewEnabled:i}=e,o=null===t||void 0===t?void 0:t.extent,r=null===l||void 0===l?void 0:l.geometry;return null!==r&&void 0!==r?r:i&&o?o:void 0}function M(e){return e&&e.includes("*")}async function T(e){e&&await e.load()}function L(e){return!(!e.fullText&&!e.where)}function I(e,t){const l=null===e||void 0===e?void 0:e.indexes;return!(!l||null===t||void 0===t||!t.length)&&l.filter((e=>"FullText"===e.indexType)).some((e=>{var l;const i=(null===(l=e.fields)||void 0===l?void 0:l.split(",").map((e=>e.trim().toLowerCase())))||[];return t.every((e=>i.includes(e.toLowerCase())))}))}function R(e){let{text:t,searchFields:l}=e;return t.trim().split(" ").filter((e=>!!e.trim())).map((e=>new f.A({onFields:l,searchTerm:e,searchType:"prefix"})))}function E(e){var t,l;return null!==(t=null===e||void 0===e||null===(l=e.capabilities)||void 0===l||null===(l=l.query)||void 0===l?void 0:l.supportsFullTextSearch)&&void 0!==t&&t}function A(e){var t,l;return null!==(t=null===e||void 0===e||null===(l=e.capabilities)||void 0===l||null===(l=l.query)||void 0===l?void 0:l.supportsPagination)&&void 0!==t&&t}function Z(e){return e.displayField||e.layer.displayField||function(e){var t,l;return null!==(t=null===e||void 0===e||null===(l=e.fieldsIndex)||void 0===l||null===(l=l.fields)||void 0===l||null===(l=l.find((e=>"string"===e.type)))||void 0===l?void 0:l.name)&&void 0!==t?t:""}(e.layer)}function P(e,t){return!(!e||null===t||void 0===t||!t.length)&&t.every((t=>C(e,t)))}function C(e,t){return!!e.getField(t)}function G(e){return e.replaceAll("'","''")}function O(e,t){const l=null===t||void 0===t?void 0:t.where;return l?"(".concat(e,") AND (").concat(l,")"):e}function N(e){let{searchTerm:t,layer:l,searchFields:i,filter:o,exactMatch:r,query:s,type:a}=e;const{definitionExpression:u,url:c}=l;let d="";return!s.fullText&&t&&i&&i.forEach((e=>{var i;const s=l.getField(e),u=null===(i=l.getFieldDomain)||void 0===i?void 0:i.call(l,e,{excludeImpliedDomains:(0,n.A)("esri-widget-legacy-field-domain-calculation")}),g=(u&&"coded-value"===u.type?function(e,t,l){var i;let{codedValues:o}=e;return null!==(i=(0,h.Pb)(null!==o&&void 0!==o?o:[],(e=>{const i=e.name,o=l?i:i.toLowerCase();return(l?t:t.toLowerCase())===o?e.code.toString():null})))&&void 0!==i?i:null}(u,t,r):null)||t||null;if(null!==g){const e=function(e){let{currentTerm:t,field:l,filter:i,exactMatch:o,url:r,type:s}=e;const n=null===l||void 0===l?void 0:l.type,a=null===l||void 0===l?void 0:l.name;if("string"===n||"date"===n||"global-id"===n){const e=S.test(null!==r&&void 0!==r?r:""),l=e&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(t)?"N":"";return O(o&&"search"===s?"".concat(a," = ").concat(l,"'").concat(t,"'"):e?"".concat(a," LIKE ").concat(l,"'".concat(t,"%'")):"".concat("LOWER(".concat(a,")")," LIKE ",l,"'".concat(t.toLowerCase(),"%'")),i)}if("oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n){const e=Number(t);return isNaN(e)?null:O("".concat(a," = ").concat(e),i)}return O("".concat(a," = ").concat(t),i)}({currentTerm:g,field:s,filter:o,exactMatch:r,url:c,type:a});e&&(d+=function(e,t){return e?" OR (".concat(t,")"):"(".concat(t,")")}(d,e))}})),u&&d?"(".concat(u,") AND (").concat(d,")"):u||d}function D(e,t,l){var i;const o=e.sourceLayer,{attributes:r}=e,s=null===(i=o.getFieldDomain)||void 0===i?void 0:i.call(o,l,{feature:e,excludeImpliedDomains:(0,n.A)("esri-widget-legacy-field-domain-calculation")});if(t)return(0,y.V)(t,r);if(l&&r){var a;const e=o.getField(l),t=function(e,t){var l;return null!==(l=e[t])&&void 0!==l?l:e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(r,l);return null==t?"":s&&"coded-value"===s.type?null!==(a=function(e,t){let l=null;const{codedValues:i}=e;return i&&i.length&&i.some((e=>e.code===t&&(l=e.name,!0))),l}(s,t))&&void 0!==a?a:"":"date"===(null===e||void 0===e?void 0:e.type)?(0,m.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function j(e,t,l,i,o,s,n){const a=e.clone(),u=e.sourceLayer,c=null===u||void 0===u?void 0:u.objectIdField,d=c?e.attributes[c]:null,h=D(e,l.searchTemplate,o);null!=s&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(u)&&(u.minScale&&u.minScale<s?s=u.minScale:u.maxScale&&u.maxScale>s&&(s=u.maxScale));const g=a.geometry?(0,v.ZY)(a.geometry,null!==t&&void 0!==t?t:void 0,null!==s&&void 0!==s?s:void 0):void 0,f="number"==typeof n&&g?(0,v.DN)((0,r.clone)(g),null!==t&&void 0!==t?t:void 0,n):g,y=e.clone();return null!=f&&(y.geometry=p.default.fromExtent(f)),{extent:f,target:y,feature:a,key:d,name:h,sourceIndex:i}}var k;let V=k=class extends c.default{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>x((0,i.A)({source:this},e),t),this.getSuggestions=(e,t)=>b((0,i.A)({source:this},e),t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){var e;return null!==(e=this._getLayerTitle())&&void 0!==e?e:""}set name(e){this._overrideIfSome("name",e)}clone(){return new k({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,r.clone)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,r.clone)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return null!==(e=null===(t=this.layer.fieldsIndex)||void 0===t||null===(t=t.fields.find((e=>"string"===e.type)))||void 0===t?void 0:t.name)&&void 0!==e?e:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?": ".concat((t||[this._getDisplayField()]).map((t=>{const l=e.getField(t);return(null===l||void 0===l?void 0:l.alias)||t})).join(", ")):""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?"".concat(t).concat(this._getSearchFieldsString()):void 0}};(0,o._)([(0,s.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],V.prototype,"displayField",void 0),(0,o._)([(0,s.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],V.prototype,"exactMatch",void 0),(0,o._)([(0,s.MZ)({value:null})],V.prototype,"layer",null),(0,o._)([(0,s.MZ)()],V.prototype,"name",null),(0,o._)([(0,s.MZ)({type:[String],json:{write:!0}})],V.prototype,"orderByFields",void 0),(0,o._)([(0,s.MZ)()],V.prototype,"searchFields",void 0),(0,o._)([(0,s.MZ)()],V.prototype,"searchTemplate",void 0),(0,o._)([(0,s.MZ)()],V.prototype,"suggestionTemplate",void 0),V=k=(0,o._)([(0,u.$)("esri.widgets.Search.LayerSearchSource")],V);const q=V},97537:(e,t,l)=>{l.r(t),l.d(t,{default:()=>B});var i=l(89379),o=l(35143),r=l(28899),s=l(86560),n=l(39356),a=l(73204),u=l(91967),c=l(18690),d=l(19276),h=l(50076),g=l(54099),p=l(76460),v=l(30726),f=l(50346),y=l(68134),m=l(46053),S=(l(81806),l(85842)),_=l(19247),w=l(13312),x=l(86100),b=l(38042),F=l(63860),M=l(24883),T=l(27410),L=l(86875),I=l(38996),R=l(86659),E=l(90992),A=l(89887),Z=l(17160),P=l(72934),C=l(19448),G=l(99403),O=l(79535);function N(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const D="highlight",j=d.default.ofType({key:e=>e.layer?"layer":"locator",base:P.default,typeMap:{layer:A.default,locator:Z.default}}),k=w.default.WGS84,V=/<[\s\S]*?>/g,q=-1;let J=class extends((0,O.A)(g.A.EventedMixin(u.default))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new j,this.defaultSymbols={point:new T.default({url:(0,r.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new I.default({color:[130,130,130,1],width:2}),polygon:new L.default({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=M.default.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new j,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,F.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new a.default({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,y.watch)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),y.initial),(0,b.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){var e;return null!==(e=this.allSources.at(this.activeSourceIndex))&&void 0!==e?e:null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?q:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return null===(e=this.messages)||void 0===e?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:l}=this,i="function"==typeof l?l.call(null,{sources:e,defaultSources:t}):l?t.concat(e):e,o=this._get("allSources")||new j;return o.removeAll(),o.addMany(i.filter(Boolean)),o}get locationEnabled(){return this._get("locationEnabled")||(0,G.$j)()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=(0,G.$j)();if(e&&!t){const e=new h.default("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});p.A.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){var e;const{allSources:t,activeSourceIndex:l,allPlaceholder:i}=this;if(l===q)return null!==i&&void 0!==i?i:"";const o=t.at(l);return null!==(e=null===o||void 0===o?void 0:o.placeholder)&&void 0!==e?e:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const l=this._createSuggestionForSearch(e),i=(async()=>{try{var e,i;await this.when();const o=await this._getResultsFromSources(l,t);if(null!==t&&void 0!==t&&null!==(e=t.signal)&&void 0!==e&&e.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:null!==(i=l.text)&&void 0!==i?i:"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(r,o,l);const s=this._getFirstResult(r.results),n=l.location&&s?s.name:l.text,a=null===n||void 0===n?void 0:n.replace(V,"");return this._set("searchTerm",a),(l.key&&"number"==typeof l.sourceIndex||l.location)&&this._set("selectedSuggestion",l),this._set("results",r.results),this._set("resultCount",r.results.reduce(((e,t)=>{var l,i;return e+(null!==(l=null===(i=t.results)||void 0===i?void 0:i.length)&&void 0!==l?l:0)}),0)),this.emit("search-complete",r),await this._selectFirstResult(s),r}finally{this._clearSearching()}})();return this._searching=i,i}async searchNearby(e){if(!this.locationEnabled){const e=new h.default("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw p.A.getLogger(this).error(e),e}const t=(async()=>{try{const t=await(0,G.J1)(),l=await(0,G.Ly)({position:t,view:this.view},e);return await this.search(l,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new h.default("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw p.A.getLogger(this).error(t),t}const{view:t}=this,l=N(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),i=null!=l?this.allSources.at(l):null;if(!i){const e=new h.default("select:missing-source","Cannot select without a source.",{source:i});throw p.A.getLogger(this).error(e),e}const o=i instanceof A.default?this._getLayerSourcePopupTemplate(i):i.popupTemplate,r=i.resultSymbol||this._getDefaultSymbol(e),s=N(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,a=N(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,u=N(i,"popupEnabled")?i.popupEnabled:this.popupEnabled,c=u?o||this.popupTemplate||this.defaultPopupTemplate:null,{feature:d}=e;if(!d){const e=new h.default("select:missing-feature","Cannot select without a feature.",{feature:d});throw p.A.getLogger(this).error(e),e}const{attributes:g,geometry:v,layer:y,sourceLayer:m}=d,S=v?(0,x.z8)(v):null,_={layerViewQuery:this._getLayerView(d),elevationQuery:t&&null!=S?(0,x.Sv)(S,t):Promise.resolve(S)},w=await(0,f.eachAlways)(_),b=w.layerViewQuery.value,F=w.elevationQuery.value;r instanceof R.default&&(r.text=e.name);const M=t&&a?e.target||e.extent:null,T=null!=M?this._goToSearchResult(M):Promise.resolve();await T;const L=b?d:new n.default({geometry:v,symbol:r,attributes:g,layer:y,sourceLayer:m,popupTemplate:c}),I=null===t||void 0===t?void 0:t.popup,Z=I&&u&&L.getEffectivePopupTemplate(I.defaultPopupTemplateEnabled);return Z&&await t.openPopup({features:[L],location:F}),b&&(0,E.Of)(b)&&!Z&&this._highlightFeature({graphic:L,layerView:b}),!b&&s&&t&&t.graphics.push(L),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",L),this.emit("select-result",{result:e,source:i,sourceIndex:l}),e}async suggest(e,t,l){var i;const o=e||this.searchTerm;this.emit("suggest-start",{searchTerm:o}),await this._suggestTimer(t,l);const r=await this._suggestImmediate(o,l);return this._set("suggestions",null===r||void 0===r?void 0:r.results),this._set("suggestionCount",null!==(i=null===r||void 0===r?void 0:r.results.reduce(((e,t)=>{var l,i;return e+(null!==(l=null===(i=t.results)||void 0===i?void 0:i.length)&&void 0!==l?l:0)}),0))&&void 0!==i?i:null),this.emit("suggest-complete",r),r}async when(){await(0,y.whenOnce)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const l=this._updatingPromise=(0,f.eachAlways)([null===e||void 0===e?void 0:e.load(),null===t||void 0===t?void 0:t.when()]);if(this.destroyed)return;if(await l,l!==this._updatingPromise)return}await(0,y.whenOnce)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var e;const t=null===(e=this.portal)||void 0===e||null===(e=e.helperServices)||void 0===e?void 0:e.geocode;return t?t.map((e=>{if(!1===e.placefinding)return;const t=s.default.apiKey&&(0,C.m$)(e.url)?{url:C.jd}:null,l=Z.default.fromJSON((0,i.A)((0,i.A)({},e),t)),o=l.url;if((0,C.m$)(o)||(0,C.jE)(o)||(0,C.sx)(o)){var r,n,a;const e=null!==(r=l.outFields)&&void 0!==r?r:["Addr_type","Match_addr","StAddr","City"],t=null!==(n=l.placeholder||(null===(a=this.messages)||void 0===a?void 0:a.placeholder))&&void 0!==n?n:"",i="number"==typeof l.defaultZoomScale?l.defaultZoomScale:2500;l.singleLineFieldName="SingleLine",l.outFields=e,l.placeholder=t,l.defaultZoomScale=i}return l.singleLineFieldName?l:void 0})).filter(c.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>null===e||void 0===e?void 0:e.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){var l;const i=null===(l=this.view)||void 0===l?void 0:l.map;return e.map((e=>{const l=i.findLayerById(e.id);if(!l)return;const o=this._getLayerJSON(e),r=A.default.fromJSON(o);return r.placeholder=t,this._getLayer(l,o).then((e=>{r.layer=e})),r})).filter(c.Ru).toArray()}_getTableSources(e,t){var l;const i=null===(l=this.view)||void 0===l?void 0:l.map;return e.map((e=>{if(!e.id)return;const l=i.findTableById(e.id);if(!l)return;const o=this._getLayerJSON(e),r=A.default.fromJSON(o);return r.placeholder=t,this._getLayer(l,o).then((e=>{r.layer=e})),r})).filter(c.Ru).toArray()}_convertApplicationProperties(){var e,t;const l=null===(e=this.view)||void 0===e?void 0:e.map,i=null===l||void 0===l||null===(t=l.applicationProperties)||void 0===t||null===(t=t.viewing)||void 0===t?void 0:t.search;if(!i)return[];const{enabled:o,hintText:r,layers:s,tables:n}=i;return o?[...this._getLayerSources(s,r),...this._getTableSources(n,r)]:[]}async _getSubLayer(e,t){var l;if(await e.load(),!e.allSublayers)throw new Error;const i=e.allSublayers.find((e=>e.id===t.subLayer));if(!i)throw new Error;const o=await(null===(l=i.createFeatureLayer)||void 0===l?void 0:l.call(i));if(!o)throw new Error;return this._createdFeatureLayers.push(o),o}async _getBuildingSubLayer(e,t){await e.load();const l=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==(null===l||void 0===l?void 0:l.type))throw new Error;if(await l.load(),null==l.associatedLayer)throw new Error;return await l.associatedLayer.load(),l}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(l){const t=new h.default("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return p.A.getLogger(this).error(t),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var e;const t=null===(e=this.view)||void 0===e?void 0:e.popup,{resultGraphic:l}=this;if(!t||!l)return;const i="selectedFeature"in t,o=i?t.selectedFeature:null;i&&o&&o===l&&t.close()}_suggestTimer(e,t){const l=null!=e?e:this.suggestionDelay;return(0,f.after)(l,null,null===t||void 0===t?void 0:t.signal)}_createLocationForSearch(e){return e instanceof n.default&&e.geometry?(0,x.z8)(e.geometry):e instanceof _.default?e:Array.isArray(e)&&2===e.length?new _.default({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&N(e,"key")&&N(e,"text")&&N(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),l="string"==typeof e?e:this.searchTerm,{selectedSuggestion:i,selectedResult:o}=this,r=!e&&i&&o,s=r&&i.key===o.key&&i.sourceIndex===o.sourceIndex,n=r&&i.location;return s||n?i:{location:t,text:t?"":l,sourceIndex:null,key:null}}_getFirstResult(e){var t;return null!==(t=(0,v.Pb)(e,(e=>{let{results:t}=e;return null===t||void 0===t?void 0:t[0]})))&&void 0!==t?t:null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){var l;await this.when();const i=await this._getSuggestionsFromSources(e,t);if(null!==t&&void 0!==t&&null!==(l=t.signal)&&void 0!==l&&l.aborted)return null;const o={activeSourceIndex:this.activeSourceIndex,searchTerm:null!==e&&void 0!==e?e:"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(o,i),o}_formatSourceResponse(e,t,l){const i=(null===t||void 0===t?void 0:t.value)||[],o=null===t||void 0===t?void 0:t.error,r=this.allSources.at(l);if(o){const t={sourceIndex:l,source:r,error:o};e.errors.push(t),p.A.getLogger(this).error(o),e.numErrors++}else{const t={sourceIndex:l,source:r,results:i};e.results.push(t),e.numResults+=i.length}}_formatResponse(e,t,l){if(t)if(e.activeSourceIndex===q){const i=l&&N(l,"sourceIndex")&&-1!==l.sourceIndex?l.sourceIndex:void 0;t.forEach(((t,l)=>{const o=void 0!==i?i:l;this._formatSourceResponse(e,t,o)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:l}=this,i=!e.location&&N(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,o=[];if(!l.length){const e=new h.default("search:no-sources-defined","At least one source is required.",{allSources:l});throw p.A.getLogger(this).error(e),e}return i===q?l.forEach(((l,i)=>{o.push(this._getResultsFromSource(e,i,t))})):o.push(this._getResultsFromSource(e,i,t)),(0,f.eachAlways)(o)}async _getSuggestionsFromSources(e,t){const{allSources:l,activeSourceIndex:i}=this,o=[];if(!l.length){const e=new h.default("suggest:no-sources-defined","At least one source is required.",{allSources:l});throw p.A.getLogger(this).error(e),e}return i===q?l.forEach(((l,i)=>{o.push(this._getSuggestionsFromSource(e,i,t))})):o.push(this._getSuggestionsFromSource(e,i,t)),(0,f.eachAlways)(o)}async _getResultsFromSource(e,t,l){var i,o;const r=null!=t?this.allSources.at(t):null;if(!r)return null;const{location:s=null}=e,n=(null===(i=this.view)||void 0===i?void 0:i.spatialReference)||k,a=N(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof A.default&&N(r,"exactMatch"))&&r.exactMatch,{view:c}=this;return null===(o=r.getResults)||void 0===o?void 0:o.call(r,{view:c,sourceIndex:t,location:s,suggestResult:e,spatialReference:n,exactMatch:u,maxResults:a},l)}async _getSuggestionsFromSource(e,t,l){var i;const o=this.allSources.at(t);if(!o)return null;null!==e&&void 0!==e||(e="");const r=N(o,"suggestionsEnabled")?o.suggestionsEnabled:this.suggestionsEnabled,s=null===(i=e)||void 0===i?void 0:i.length,n=N(o,"minSuggestCharacters")?o.minSuggestCharacters:this.minSuggestCharacters;if(r&&e.trim()&&s>=n){var a,u;const i=(null===(a=this.view)||void 0===a?void 0:a.spatialReference)||k,r=N(o,"maxSuggestions")?o.maxSuggestions:this.maxSuggestions,{view:s}=this,n=!!(o instanceof A.default&&N(o,"exactMatch"))&&o.exactMatch;return null===(u=o.getSuggestions)||void 0===u?void 0:u.call(o,{view:s,sourceIndex:t,suggestTerm:e,spatialReference:i,maxSuggestions:r,exactMatch:n},l)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return N(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){var t,l;return null!==(t=(0,v.Pb)(null!==(l=this.results)&&void 0!==l?l:[],(t=>{let{results:l,sourceIndex:i}=t;return(null===l||void 0===l?void 0:l.includes(e))?i:null})))&&void 0!==t?t:null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const l={target:{target:e},options:{signal:t.signal}};e||(l.options.animate=!1),await this.callGoTo(l),this._gotoController=null}_getDefaultSymbol(e){var t;const{defaultSymbols:l}=this,i=null===(t=e.feature)||void 0===t?void 0:t.geometry;if(null==i)return null;switch(i.type){case"point":case"multipoint":return l.point;case"polyline":return l.polyline;case"extent":case"polygon":return l.polygon;default:return null}}_removeHighlight(){this.removeHandles(D)}async _getLayerView(e){var t,l;const{view:i}=this;if(!e||!i||"building-component"===(null===(t=e.layer)||void 0===t?void 0:t.type)||"subtype-sublayer"===(null===(l=e.layer)||void 0===l?void 0:l.type))return null;const{layer:o}=e;return o?(await i.when(),i.whenLayerView(o)):null}_highlightFeature(e){var t;const{graphic:l,layerView:i}=e,{attributes:o,layer:r}=l,{objectIdField:s}=r,n=null!==(t=s&&(null===o||void 0===o?void 0:o[s]))&&void 0!==t?t:null,a=i.highlight(null!==n&&void 0!==n?n:l);this.addHandles(a,D)}_setResultFloor(e){var t,l,i;const{view:o}=this,r=null===(t=e.feature)||void 0===t?void 0:t.attributes,s=null===(l=e.feature)||void 0===l?void 0:l.sourceLayer;if(s&&"floorInfo"in s&&null!==s&&void 0!==s&&null!==(i=s.floorInfo)&&void 0!==i&&i.floorField&&r){const e=r[s.floorInfo.floorField];null===o||void 0===o||o.emit("select-result-floor",e)}}};J.ALL_INDEX=q,(0,o._)([(0,m.MZ)()],J.prototype,"_searching",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"_updatingPromise",void 0),(0,o._)([(0,m.MZ)({readOnly:!0,value:null})],J.prototype,"activeSource",null),(0,o._)([(0,m.MZ)()],J.prototype,"activeSourceIndex",null),(0,o._)([(0,m.MZ)()],J.prototype,"allPlaceholder",null),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"allSources",null),(0,o._)([(0,m.MZ)()],J.prototype,"autoNavigate",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"autoSelect",void 0),(0,o._)([(0,m.MZ)({type:a.default})],J.prototype,"defaultPopupTemplate",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"defaultSources",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"defaultSymbols",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"includeDefaultSources",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"locationEnabled",null),(0,o._)([(0,m.MZ)()],J.prototype,"maxInputLength",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"maxResults",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"maxSuggestions",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"messages",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"minSuggestCharacters",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"placeholder",null),(0,o._)([(0,m.MZ)()],J.prototype,"popupEnabled",void 0),(0,o._)([(0,m.MZ)({type:a.default})],J.prototype,"popupTemplate",void 0),(0,o._)([(0,m.MZ)({type:M.default})],J.prototype,"portal",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"resultCount",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"resultGraphicEnabled",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"resultGraphic",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"results",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"selectedSuggestion",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"searchAllEnabled",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"selectedResult",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"searchTerm",null),(0,o._)([(0,m.MZ)({type:j})],J.prototype,"sources",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"state",null),(0,o._)([(0,m.MZ)()],J.prototype,"suggestionDelay",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"suggestionCount",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"suggestions",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"suggestionsEnabled",void 0),(0,o._)([(0,m.MZ)({readOnly:!0})],J.prototype,"updating",null),(0,o._)([(0,m.MZ)()],J.prototype,"view",void 0),(0,o._)([(0,m.MZ)()],J.prototype,"clear",null),J=(0,o._)([(0,S.$)("esri.widgets.Search.SearchViewModel")],J);const B=J},99403:(e,t,l)=>{l.d(t,{$j:()=>p,J1:()=>v,Ly:()=>y});var i=l(86560),o=l(50076),r=l(81806),s=l(76460),n=l(19247),a=l(45417),u=l(24883),c=l(71334),d=l(70414);const h=()=>s.A.getLogger("esri.widgets.support.geolocationUtils"),g={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function p(){return function(){const e=!!(0,r.A)("esri-geolocation");return e||h().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||h().warnOnce("insecure-context","Geolocation requires a secure origin."),e}()}function v(e){return null!==e&&void 0!==e||(e=g),new Promise(((t,l)=>{setTimeout((()=>l(new o.default("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,l,null!==e&&void 0!==e?e:void 0)}))}let f;function y(e,t){if(f)return f(e,t);const{position:l,view:r}=e,s=function(e){const t=e&&e.coords||{},l={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e?{coords:l,timestamp:e.timestamp,toJSON:()=>({})}:e}(l),h=null===s||void 0===s?void 0:s.coords;if(!h)throw new o.default("geometry-service:no-coords","Geolocation has no coordinates");return function(e,t,l){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve((0,a.geographicToWebMercator)(e)):function(e){if(i.default.geometryServiceUrl)return Promise.resolve(i.default.geometryServiceUrl);const t=u.default.getDefault();return t.load(e).catch((()=>{})).then((()=>{var e;return null===(e=t.helperServices)||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.url}))}(l).then((t=>{if(!t)throw new o.default("geometry-service:missing-url","Geometry service URL is missing");const i=new d.default({geometries:[e],outSpatialReference:r});return(0,c.C)(t,i,l).then((e=>e[0]))}))}(function(e){let{longitude:t,latitude:l,altitude:i}=e;return new n.default({longitude:t,latitude:l,z:i||void 0,spatialReference:{wkid:4326}})}(h),r,t)}}}]);
//# sourceMappingURL=97537.3fbc28f1.chunk.js.map