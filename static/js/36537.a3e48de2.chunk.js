"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[451,36537],{451:(t,e,i)=>{i.r(e),i.d(e,{default:()=>E});var o=i(35143),s=(i(11265),i(91967)),r=i(19276),n=i(50076),a=i(76460),l=i(68134),d=i(46053),c=(i(81806),i(47249),i(85842)),u=i(19451),v=i(31933),h=i(24883),y=i(96422),p=i(38042),g=i(63860);const w=-2147208940,_=-2147217146,k=-2147220947;let f=class extends s.default{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new u.U,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new r.default}initialize(){const t=async()=>{this.messages||(this.messages=await(0,g.ud)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then((()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([(0,l.watch)((()=>[this.view,this.utilityNetwork]),(async()=>{var t,e;const{loadErrors:i,messages:{info:{noUtilityNetwork:o,noView:s}}}=this;this._initialValidationsFinished=!1,i.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,"utility"!==(null===(t=this.utilityNetwork)||void 0===t?void 0:t.type)&&(this.loadErrors.push(o),a.A.getLogger(this).error(new n.default("utilityNetworkValidateTopology:missing-property",o)),this._validConstructProperties=!1),"2d"!==(null===(e=this.view)||void 0===e?void 0:e.type)&&(this.loadErrors.push(s),a.A.getLogger(this).error(new n.default("utilityNetworkValidateTopology:missing-property",s)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch((t=>{a.A.getLogger(this).error(t),this._validConstructProperties=!1})),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()}),l.initial),(0,l.on)((()=>{var t;return null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.layers}),"change",(async()=>{const{loadErrors:t,messages:{info:{noUtilityNetwork:e}}}=this,i=t.find((t=>t===e));this._initialValidationsFinished=!1,i||(t.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0})),(0,p.oQ)(t)])}))}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:e}},utilityNetwork:i,view:o}=this;if(!this.loadErrors.length){var s;this._activeOperationDidSucceed=!1,this._set("executionError","");const r={gdbVersion:null===i||void 0===i?void 0:i.gdbVersion,outSpatialReference:(null===(s=o.spatialReference)||void 0===s?void 0:s.clone())||null,validateArea:"current"===this.extentToValidate?o.extent.clone():i.fullExtent.clone()};this._updatingHandles.addPromise(null===i||void 0===i?void 0:i.validateTopology(r).then((()=>{this._activeOperationDidSucceed=!0}),(i=>{var o;let s="Error: "+i;if(i instanceof n.default&&null!==(o=i.details)&&void 0!==o&&o.raw)switch(i.details.raw.extendedCode){case w:s=e;break;case _:case k:s=t;break;default:s=i.details.message}this._set("executionError",s)})))}}async _setDirtyAreasLayer(){var t,e;const{messages:{info:{noDirtyAreasLayer:i}}}=this,o=null===(t=this.view)||void 0===t?void 0:t.map.allLayers.items.filter((t=>(0,v.yZ)(t))).find((t=>{var e,i;return(null===(e=t.parsedUrl)||void 0===e?void 0:e.path)===(null===(i=this.utilityNetwork)||void 0===i?void 0:i.networkSystemLayers.dirtyAreasLayerUrl)}));o?(this._dirtyAreasLayer=o,await this._dirtyAreasLayer.load(),this._serverVersion=null!==(e=this._dirtyAreasLayer.version)&&void 0!==e?e:0,this._validConstructProperties=!0):(this.loadErrors.includes(i)||(this.loadErrors.push(i),a.A.getLogger(this).error(new n.default("utilityNetworkValidateTopology:missing-layer",i))),this._validConstructProperties=!1)}async _validateNetworkExtension(){var t,e;const{messages:{info:{noAdvancedEditingUserTypeExtension:i,noUtilityNetworkServiceUserTypeExtension:o}}}=this,s=await(0,v.wI)(this.utilityNetwork.layerUrl),r=new h.default({url:s});await r.load();const l=null!==(t=null===(e=r.user)||void 0===e?void 0:e.username)&&void 0!==t?t:"",d=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await(0,y.RE)(r,l,d)){const t=Number(this._serverVersion)<=11.1?o:i;this.loadErrors.push(t),a.A.getLogger(this).error(new n.default("utilityNetworkValidateTopology:no-user-type-extension",t)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};(0,o._)([(0,d.MZ)()],f.prototype,"_initialValidationsFinished",void 0),(0,o._)([(0,d.MZ)()],f.prototype,"_dirtyAreasLayer",void 0),(0,o._)([(0,d.MZ)()],f.prototype,"_validConstructProperties",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],f.prototype,"executionError",void 0),(0,o._)([(0,d.MZ)()],f.prototype,"extentToValidate",void 0),(0,o._)([(0,d.MZ)()],f.prototype,"loadErrors",void 0),(0,o._)([(0,d.MZ)()],f.prototype,"messages",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],f.prototype,"state",null),(0,o._)([(0,d.MZ)()],f.prototype,"utilityNetwork",null),(0,o._)([(0,d.MZ)()],f.prototype,"view",null),f=(0,o._)([(0,c.$)("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],f);const E=f},36537:(t,e,i)=>{i.r(e),i.d(e,{default:()=>y});var o=i(35143),s=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),n=i(25329),a=i(94126),l=(i(76099),i(63582)),d=i(54761),c=i(451);const u="esri-un-validate-topology",v={container:"".concat(u,"__container"),content:"".concat(u,"__content"),controlsContainer:"".concat(u,"__controls-container"),statusIconError:"".concat(u,"__status-icon-error"),statusIconSuccess:"".concat(u,"__status-icon-success"),statusIconContainer:"".concat(u,"__status-icon-container")};let h=class extends n.default{constructor(t,e){super(t,e),this.messages=null,this.viewModel=new c.default}loadDependencies(){return(0,a.W)({action:()=>Promise.resolve().then(i.bind(i,85375)),block:()=>i.e(75502).then(i.bind(i,75502)),icon:()=>Promise.resolve().then(i.bind(i,16702)),notice:()=>i.e(12261).then(i.bind(i,12261)),option:()=>i.e(46422).then(i.bind(i,46422)),select:()=>i.e(2253).then(i.bind(i,2253)),tooltip:()=>i.e(31748).then(i.bind(i,31748))})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(t){this.viewModel.extentToValidate=t}get icon(){return"check-circle"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t,e;return null!==(t=null===(e=this.messages)||void 0===e?void 0:e.label)&&void 0!==t?t:""}set label(t){this._overrideIfSome("label",t)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{viewModel:t}=this;return"disabled"===t.state?(0,d.K)("div",{class:v.container},(0,d.K)("calcite-block",{class:v.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):(0,d.K)("div",{class:v.container},(0,d.K)("calcite-block",{class:v.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(t){this.extentToValidate=t.currentTarget.value}_getLoadErrorMessagesAsNotices(t,e){return(0,d.K)("calcite-notice",{closable:!1,key:"error-notice-"+e,kind:"warning",open:!0,scale:"s"},(0,d.K)("div",{slot:"message"},t))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch((()=>{}))}_renderControls(){const{viewModel:t}=this;return"failed"===t.state?(0,d.K)("div",{class:v.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:t,viewModel:e}=this;return(0,d.K)("div",{key:"selectExtentDiv"},(0,d.K)("calcite-select",{bind:this,disabled:"loading"===e.state||"executing"===e.state,label:t.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},(0,d.K)("calcite-option",{value:"current"},t.input.currentExtent),(0,d.K)("calcite-option",{value:"entire"},t.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:t}=this;return(0,d.K)("div",{class:v.controlsContainer,key:"loadErrorsDiv"},t.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return(0,d.K)("div",{class:v.statusIconContainer,key:"statusDiv",slot:"control"},(0,d.K)("calcite-icon",{class:v.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:t,viewModel:e}=this,i="".concat(this.id,"-validation-status-action"),o="".concat(this.id,"-error-status-icon"),s="".concat(this.id,"-success-status-icon");return"executing"===e.state?(0,d.K)("div",{key:"statusDivExecuting",slot:"control"},(0,d.K)("calcite-action",{id:i,loading:!0,text:t.status.executing}),(0,d.K)("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:i},(0,d.K)("span",null,t.status.executing))):"success"===e.state?(0,d.K)("div",{afterCreate:t=>{setTimeout((()=>{t.textContent=""}),3500)},class:v.statusIconContainer,key:"statusDivSuccess",slot:"control"},(0,d.K)("calcite-icon",{class:v.statusIconSuccess,icon:"check-circle",id:s,scale:"s"}),(0,d.K)("calcite-tooltip",{referenceElement:s},(0,d.K)("span",null,t.status.success))):"failed"===e.state?(0,d.K)("div",{class:v.statusIconContainer,key:"statusDivFailed",slot:"control"},(0,d.K)("calcite-icon",{class:v.statusIconError,icon:"exclamation-mark-triangle",id:o,scale:"s"}),(0,d.K)("calcite-tooltip",{referenceElement:o},(0,d.K)("span",null,e.executionError))):(0,d.K)("div",{class:v.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:t}=this;return(0,d.K)("div",{key:"executionErrorDiv"},(0,d.K)("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},(0,d.K)("div",{slot:"message"},t.executionError)))}_renderValidateTopologyAction(){const{messages:t,viewModel:e}=this,i="".concat(this.id,"-validation-action");return(0,d.K)("div",{key:"actionDiv",slot:"control"},(0,d.K)("calcite-action",{bind:this,disabled:"executing"===e.state,icon:"play-f",id:i,loading:"loading"===e.state,onclick:this._handleValidateTopologyAction,text:t.input.validateTopology}),(0,d.K)("calcite-tooltip",{referenceElement:i},(0,d.K)("span",null,"loading"===e.state?t.status.loading:t.input.validateTopology)))}};(0,o._)([(0,s.MZ)()],h.prototype,"extentToValidate",null),(0,o._)([(0,s.MZ)()],h.prototype,"icon",null),(0,o._)([(0,s.MZ)()],h.prototype,"label",null),(0,o._)([(0,s.MZ)(),(0,l.G)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],h.prototype,"messages",void 0),(0,o._)([(0,s.MZ)()],h.prototype,"utilityNetwork",null),(0,o._)([(0,s.MZ)()],h.prototype,"view",null),(0,o._)([(0,s.MZ)({type:c.default})],h.prototype,"viewModel",void 0),h=(0,o._)([(0,r.$)("esri.widgets.UtilityNetworkValidateTopology")],h);const y=h},96422:(t,e,i)=>{i.d(e,{Kw:()=>r,RE:()=>a,Sl:()=>n});var o=i(55171),s=i(3825);async function r(t,e,i){var r;if(!(null===o.id||void 0===o.id?void 0:o.id.findCredential(t.restUrl)))return null;if("loaded"===t.loadStatus&&""===e&&null!==(r=t.user)&&void 0!==r&&r.sourceJSON&&!1===i)return t.user.sourceJSON;const n={responseType:"json",query:{f:"json"}};if(i&&(n.query.returnUserLicenseTypeExtensions=!0),""===e){const e=await(0,s.default)(t.restUrl+"/community/self",n);if(e.data){const t=e.data;if(null!==t&&void 0!==t&&t.username)return t}return null}const a=await(0,s.default)(t.restUrl+"/community/users/"+e,n);if(a.data){const t=a.data;return t.error?null:t}return null}async function n(t,e,i){var o,s;const n=await r(t,e,!0);return null!==(o=null===n||void 0===n||null===(s=n.privileges)||void 0===s?void 0:s.includes(i))&&void 0!==o&&o}async function a(t,e,i){var o,s;const n=await r(t,e,!0);return null!==(o=null===n||void 0===n||null===(s=n.userLicenseTypeExtensions)||void 0===s?void 0:s.includes(i))&&void 0!==o&&o}}}]);
//# sourceMappingURL=36537.a3e48de2.chunk.js.map