"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[79318],{79318:(e,n,t)=>{t.r(n),t.d(n,{getTemplates:()=>h});var i=t(73204),l=t(50076),a=t(63860),o=t(39348),r=t(53430),s=(t(75900),t(56362),t(87015),t(81940),t(6929),t(7198),t(93616),t(53539)),u=(t(91904),t(81779)),f=t(40585),c=t(17542),p=t(97336),d=t(99433),m=t(40700);function v(e){const{fieldName:n,label:t,type:i}=e,l=null!=i&&r.numericTypes.includes(i),a=new f.default({fieldName:n,label:t,visible:!0,format:l?new c.default({places:"integer"===i||"small-integer"===i?0:2,digitSeparator:!0}):void 0});return"date"===i&&(a.format=new c.default({dateFormat:"short-date-short-time"})),a}function y(e,n){const t=e?n.getField(e):null;return null!=t?t.alias||t.name:void 0}function T(e,n,t){const{attributeInfo:i,statisticType:l}=n,{field:a,normalizationField:r}=i;let s,u="";if("avg"===l?s=r?t.clusters.avgNormFieldLabel:t.clusters.avgFieldLabel:"type"===l&&(s=t.clusters.predominantFieldLabel),s){const n=i.valueExpression?i.valueExpressionTitle:y(a,e),t=r&&y(r,e);u=(0,o.V)(s,{fieldLabel:n||"",normFieldLabel:t||""})}return u}function b(e,n,t,i){const{attributeInfo:l,statisticType:a}=n,{field:r,normalizationField:s}=l;let u,f="";if("avg"===a?u=s?i.clusters.avgNormFieldSummary:i.clusters.avgFieldSummary:"type"===a&&(u=i.clusters.predominantFieldSummary),u){const n=l.valueExpression?l.valueExpressionTitle:y(r,e),i=s&&y(s,e);f=(0,o.V)(u,{fieldLabel:n||"",normFieldLabel:i||"",fieldValue:"{"+t+"}"})}return f}function x(e){return{fieldInfo:v({fieldName:d.Qb,label:e.clusters.numFeatures,type:"integer"}),fieldSummary:new s.default({text:(0,o.V)(e.clusters.countSummary,{count:"{".concat(d.Qb,"}")})})}}async function g(e,n,t){var i;if(!(0,m.k)(n))return null;const l=(0,d.eU)(e,n),a=t.clusters.predominantNoneValue,o="unique-value"===n.type&&null!==(i=n.uniqueValueInfos)&&void 0!==i?i:[],{fieldInfo:r,fieldSummary:f}=x(t),c=[f],p=[r],y=[];for(const m of l){const{statisticType:n,attributeInfo:i}=m,l=(0,d.Dv)(i,n),r=T(e,m,t);if("avg"===n)c.push(new s.default({text:b(e,m,l,t)})),p.push(v({fieldName:l,label:r,type:"double"}));else if("type"===n){const n="expression/".concat(l);c.push(new s.default({text:b(e,m,n,t)})),y.push(new u.default({name:l,title:r,returnType:"string",expression:(0,d.Wx)(o,l,a)})),p.push(v({fieldName:n}))}}return{fieldInfos:p,expressionInfos:y,content:c}}async function F(e){const{layer:n,renderer:t}=e;await n.load();const i=null!==t&&void 0!==t?t:"renderer"in n?n.renderer:void 0;if(!(0,m.k)(i))throw new l.default("clusters-popup:invalid-parameters","'renderer' is not valid");return{layer:n,renderer:i}}async function h(e){const[{renderer:n,layer:t},l]=await Promise.all([F(e),(0,a.ud)("esri/smartMapping/t9n/smartMapping")]),o=await g(t,n,l);if(null==o)return null;const r={name:"clusters",title:l.clusters.templateTitle,value:new i.default({fieldInfos:o.fieldInfos,expressionInfos:o.expressionInfos,content:o.content,title:l.clusters.clusterPopupTitle})},s=[],u=t.featureReduction,f=u&&"renderer"in u?u.renderer:null;if("pie-chart"===(null===f||void 0===f?void 0:f.type)){const e=await async function(e,n,t){if(!(0,m.k)(n))return null;const{fieldInfo:i,fieldSummary:l}=x(t),a=[l],o=[i],r=[],{fieldInfos:s,expressionInfos:u}=await(0,p.Xj)({renderer:n,layer:e,isFeatureReduction:!0}),f=await(0,p.Lb)(e,{fieldInfos:s,expressionInfos:u},!0);return a.push(...f),o.push(...s),r.push(...u),{fieldInfos:o,expressionInfos:r,content:a}}(t,f,l);null!=e&&s.push({name:"clusters-pie-chart",title:"clusters-pie-chart",value:new i.default({fieldInfos:e.fieldInfos,expressionInfos:e.expressionInfos,content:e.content,title:l.clusters.clusterPopupTitle})})}return{primaryTemplate:r,secondaryTemplates:s}}},97336:(e,n,t)=>{t.d(n,{G2:()=>T,Lb:()=>w,Xj:()=>h,bF:()=>y,gS:()=>I,lm:()=>x});var i=t(18690),l=(t(81806),t(63860)),a=t(39348),o=t(53430),r=(t(75900),t(56362),t(87015),t(81940),t(6929)),s=(t(7198),t(93616),t(53539)),u=(t(91904),t(81779)),f=t(40585),c=t(17542),p=t(23994),d=t(15492),m=t(90704);let v=0;const y="expression/";function T(e){return"hasVisualVariables"in e&&e.hasVisualVariables()?e.visualVariables.filter((e=>!d.viewScaleRE.test(e.valueExpression)&&(!("target"in e)||"outline"!==e.target))):[]}function b(e,n){if(!n)return null;const t=(0,m.Rm)(e);return null===t||void 0===t?void 0:t.find((e=>e.name.toLowerCase()===n.toLowerCase()))}function x(e,n,t){let i=null;if(t&&"featureReduction"in e){const n=e.featureReduction;n&&"popupTemplate"in n&&n.popupTemplate&&(i=n.popupTemplate.fieldInfos)}else"popupTemplate"in e&&e.popupTemplate&&(i=e.popupTemplate.fieldInfos);const l=t?b(e,n):e.getField(n);let a=null;if(i&&i.some((e=>{var n;return!(!e||(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())!==(null===l||void 0===l?void 0:l.name.toLowerCase()))&&(a=e.clone(),!0)})),!a){const e=o.numericTypes.includes(l.type),n="integer"===l.type||"small-integer"===l.type;a=new f.default({fieldName:l.name,isEditable:l.editable,visible:!0,format:e?new c.default({places:n?0:2,digitSeparator:!0}):void 0})}return a.label||(a.label=l.alias),a}function g(e){const{expression:n,title:t,returnType:i}=e;return new u.default({name:"expr"+v++,expression:n,title:t,returnType:i})}function F(e){const n="number"===e.returnType?new c.default({places:2,digitSeparator:!0}):void 0;return new f.default({fieldName:"".concat(y).concat(e.name),visible:!0,format:n})}async function h(e){const n=await(0,l.ud)("esri/smartMapping/t9n/smartMapping"),{renderer:t,layer:o,normFieldExpressionTemplate:r,isFeatureReduction:s}=e,u=[],f=[],c=(0,p.getAttributes)(t,T);for(const i of c)if("field"===i.type)u.push(x(o,i.field,s));else if("normalized-field"===i.type){const e=s?b(o,i.field):o.getField(i.field),t=s?b(o,i.normalizationField):o.getField(i.normalizationField),l=g({type:"expression",expression:'\n      $feature["'.concat(e.name,'"];\n      $feature["').concat(t.name,'"];\n      ').concat("percentage"===r?'($feature["'.concat(e.name,'"] / $feature["').concat(t.name,'"]) * 100;'):'$feature["'.concat(e.name,'"] / $feature["').concat(t.name,'"];'),"\n      "),title:(0,a.V)("percentage"===r?n.normFieldLabelAsPercent:n.normFieldLabel,{expression1:e.alias,expression2:t.alias}),returnType:"number"});u.push(F(l),x(o,i.field,s),x(o,i.normalizationField,s)),f.push(l)}else if("expression"===i.type){const e=g(i);u.push(F(e)),f.push(e)}return{fieldInfos:(0,i.Am)(u,((e,n)=>e.fieldName===n.fieldName)),expressionInfos:(0,i.Am)(f,((e,n)=>e.expression===n.expression))}}async function w(e,n,t){const{fieldInfos:i,expressionInfos:o}=n,u=await(0,l.ud)("esri/smartMapping/t9n/smartMapping");if(i.length>2)return[new r.default({fieldInfos:i})];const f=[];for(const l of i){const n=l.fieldName||"";let i=l.label;if(!i){const l=t?b(e,n):e.getField(n);if(l)i=l.alias||n;else if(o){const e=n.split(y)[1],t=o[o.findIndex((n=>n.name===e))];t&&(i=t.title||t.name)}}f.push(new s.default({text:(0,a.V)(u.fieldInfo,{fieldLabel:i,fieldValue:"{".concat(n,"}")})}))}return f}function I(e){return!(!("normalizationField"in e)||!e.normalizationField)||"hasVisualVariables"in e&&e.hasVisualVariables()&&e.visualVariables.some((e=>!(!("normalizationField"in e)||!e.normalizationField)))}},99433:(e,n,t)=>{t.d(n,{Dv:()=>c,Qb:()=>s,Wx:()=>v,eU:()=>b,pq:()=>u});var i=t(18690),l=t(53514),a=t(4815),o=t(97336),r=t(42633);const s="cluster_count";function u(e,n){return e.split("cluster_".concat(n,"_")).pop()}function f(e,n){const t=function(e){if(!e)return null;const{field:n,valueExpression:t,normalizationField:i,normalizationType:l,normalizationTotal:o}=e;let s=null;if(t)s=t;else if(n){const e=(0,r.Wy)({normalizationType:l,normalizationField:i,normalizationTotal:o});if(e){const t=e.toLowerCase();if(s=n.toLowerCase()+",norm:"+t,i)s+=","+i.toLowerCase();else if("percent-of-total"===t){let e=o;(0,a.gf)(e)&&0!==e||(e=null),s+=","+e}}}return s}(e);return"".concat(n,"_").concat(null!=t?function(e){return(0,l.d)(e)}(t):e.field)}function c(e,n){return"cluster_".concat(f(e,n))}function p(e,n){const t=n.getField(e);return null===t||void 0===t?void 0:t.type}function d(e,n){var t;const i="rotation"===n.type?n.rotationType:null,l=null===(t=n.legendOptions)||void 0===t?void 0:t.title,a=n.field,o=a?p(a,e):null;return{field:a,fieldType:null!=o?o:null,rotationType:i,valueExpression:n.valueExpression,valueExpressionTitle:n.valueExpressionTitle||n.valueExpression&&l,normalizationField:"normalizationField"in n?n.normalizationField:null,vvType:n.type}}function m(e){return e?e.replaceAll('"','\\"'):""}function v(e,n,t){return"\n  var uvInfos = [".concat(function(e){return e.map((e=>'{\n        "value": "'.concat(String(e.value),'",\n        "label": "').concat(m(String(e.label)),'"\n      }')))}(e).join(", "),'];\n  var predominantType = Text($feature["').concat(n,'"]);\n  var label = "').concat(m(t),'";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  ')}function y(e,n){const t=[f(e,n)];return"date"===e.fieldType&&t.push(e.fieldType.toLowerCase()),e.rotationType&&t.push(e.rotationType.toLowerCase()),t.join("_")}function T(e,n){return{statisticHash:y(e,n),attributeInfo:e,statisticType:n}}function b(e,n){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=[],a=function(e,n){const t="field"in n?n.field:null,i=t?p(t,e):null;return{field:t,fieldType:null!=i?i:null,valueExpression:"valueExpression"in n?n.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in n?n.valueExpressionTitle:null,normalizationField:"normalizationField"in n?n.normalizationField:null,normalizationType:"normalizationType"in n?n.normalizationType:null,normalizationTotal:"normalizationTotal"in n?n.normalizationTotal:null}}(e,n);"class-breaks"===n.type?l.push(T(a,"avg")):"unique-value"===n.type&&l.push(T(a,"type"));const r=(0,o.G2)(n);for(const i of r){const n=d(e,i);l.push(T(n,"avg"))}return t?(0,i.Am)(l,((e,n)=>e.statisticHash===n.statisticHash)):l}}}]);
//# sourceMappingURL=79318.abd4b0df.chunk.js.map