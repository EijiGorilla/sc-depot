"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[5828,11920],{15498:(e,t,a)=>{a.d(t,{_:()=>i,t:()=>l});var r=a(76460);const n=()=>r.A.getLogger("esri.rest.support.generateRendererUtils");function s(e,t){return Number(e.toFixed(t))}function i(e){const t=c(e),a=[],r=t.uniqueValues.length;for(let n=0;n<r;n++){const e=t.uniqueValues[n],r=t.valueFrequency[n],s=e.toString();a.push({value:e,count:r,label:s})}return{uniqueValues:a}}function l(e,t){const{normalizationTotal:a}=e;return{classBreaks:o(e,t),normalizationTotal:a}}function o(e,t){var a;const r=e.definition,{classificationMethod:n,normalizationType:i,definedInterval:l}=r,o=null!==(a=r.breakCount)&&void 0!==a?a:1,f=[];let p=e.values;if(0===p.length)return[];p=p.sort(((e,t)=>e-t));const[h,m]=null!==t&&void 0!==t?t:[p.at(0),p.at(-1)];if("equal-interval"===n)if(p.length>=o){const e=(m-h)/o;let t=h;for(let a=1;a<o;a++){const r=s(h+a*e,6);f.push({minValue:t,maxValue:r,label:u(t,r,i)}),t=r}f.push({minValue:t,maxValue:m,label:u(t,m,i)})}else p.forEach((e=>{f.push({minValue:e,maxValue:e,label:u(e,e,i)})}));else if("natural-breaks"===n){const t=c(p),a=e.valueFrequency||t.valueFrequency,r=d(t.uniqueValues,a,o);let n=h;for(let e=1;e<o;e++)if(t.uniqueValues.length>e){const a=s(t.uniqueValues[r[e]],6);f.push({minValue:n,maxValue:a,label:u(n,a,i)}),n=a}f.push({minValue:n,maxValue:m,label:u(n,m,i)})}else if("quantile"===n)if(p.length>=o&&h!==m){let e=h,t=Math.ceil(p.length/o),a=0;for(let r=1;r<o;r++){let n=t+a-1;n>p.length&&(n=p.length-1),n<0&&(n=0),f.push({minValue:e,maxValue:p[n],label:u(e,p[n],i)}),e=p[n],a+=t,t=Math.ceil((p.length-a)/(o-r))}f.push({minValue:e,maxValue:m,label:u(e,m,i)})}else{let e=-1;for(let t=0;t<p.length;t++){const a=p[t];a!==e&&(e=a,f.push({minValue:e,maxValue:a,label:u(e,a,i)}),e=a)}}else if("standard-deviation"===n){const e=function(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a];return t/=e.length,t}(p),t=function(e,t){let a=0;for(let r=0;r<e.length;r++){const n=e[r];a+=(n-t)*(n-t)}return a/=e.length,Math.sqrt(a)}(p,e);if(0===t)f.push({minValue:p[0],maxValue:p[0],label:u(p[0],p[0],i)});else{const a=function(e,t,a,r,n){let s=Math.max(r-e,t-r)/n/a;return s=s>=1?1:s>=.5?.5:.25,s}(h,m,o,e,t)*t;let r=0,n=h;for(let t=o;t>=1;t--){const l=s(e-(t-.5)*a,6);f.push({minValue:n,maxValue:l,label:u(n,l,i)}),n=l,r++}let l=s(e+.5*a,6);f.push({minValue:n,maxValue:l,label:u(n,l,i)}),n=l,r++;for(let t=1;t<=o;t++)l=r===2*o?m:s(e+(t+.5)*a,6),f.push({minValue:n,maxValue:l,label:u(n,l,i)}),n=l,r++}}else if("defined-interval"===n){if(!l)return f;const[e,a]=null!==t&&void 0!==t?t:[p.at(0),p.at(-1)],r=Math.ceil((a-e)/l);let n=e;for(let t=1;t<r;t++){const a=s(e+t*l,6);f.push({minValue:n,maxValue:a,label:u(n,a,i)}),n=a}f.push({minValue:n,maxValue:a,label:u(n,a,i)})}return f}function u(e,t,a){let r=null;return r=e===t?a&&"percent-of-total"===a?e+"%":e.toString():a&&"percent-of-total"===a?e+"% - "+t+"%":e+" - "+t,r}function c(e){const t=[],a=[];let r=Number.MIN_VALUE,n=1,s=-1;for(let i=0;i<e.length;i++){const l=e[i];l===r?(n++,a[s]=n):null!==l&&(t.push(l),r=l,n=1,a.push(n),s++)}return{uniqueValues:t,valueFrequency:a}}function d(e,t,a){const r=e.length,n=[];a>r&&(a=r);for(let i=0;i<a;i++)n.push(Math.round(i*r/a-1));n.push(r-1);let s=f(n,e,t,a);return function(e,t,a,r,n,s){let i=0,l=0,o=0,u=0,c=!0;for(let d=0;d<2&&c;d++){0===d&&(c=!1);for(let d=0;d<s-1;d++)for(;a[d+1]+1!==a[d+2];){a[d+1]=a[d+1]+1;const s=p(d,a,r,n);o=s.sbMean,i=s.sbSdcm;const f=p(d+1,a,r,n);if(u=f.sbMean,l=f.sbSdcm,!(i+l<t[d]+t[d+1])){a[d+1]=a[d+1]-1;break}t[d]=i,t[d+1]=l,e[d]=o,e[d+1]=u,c=!0}for(let d=s-1;d>0;d--)for(;a[d]!==a[d-1]+1;){a[d]=a[d]-1;const s=p(d-1,a,r,n);o=s.sbMean,i=s.sbSdcm;const f=p(d,a,r,n);if(u=f.sbMean,l=f.sbSdcm,!(i+l<t[d-1]+t[d])){a[d]=a[d]+1;break}t[d-1]=i,t[d]=l,e[d-1]=o,e[d]=u,c=!0}}return c}(s.mean,s.sdcm,n,e,t,a)&&(s=f(n,e,t,a)),n}function f(e,t,a,r){let n=[],s=[],i=[],l=0;const o=[],u=[];for(let h=0;h<r;h++){const r=p(h,e,t,a);o.push(r.sbMean),u.push(r.sbSdcm),l+=u[h]}let c,d=l,f=!0;for(;f||l<d;){f=!1,n=[];for(let t=0;t<r;t++)n.push(e[t]);for(let a=0;a<r;a++)for(let n=e[a]+1;n<=e[a+1];n++)if(c=t[n],a>0&&n!==e[a+1]&&Math.abs(c-o[a])>Math.abs(c-o[a-1]))e[a]=n;else if(a<r-1&&e[a]!==n-1&&Math.abs(c-o[a])>Math.abs(c-o[a+1])){e[a+1]=n-1;break}d=l,l=0,s=[],i=[];for(let n=0;n<r;n++){s.push(o[n]),i.push(u[n]);const r=p(n,e,t,a);o[n]=r.sbMean,u[n]=r.sbSdcm,l+=u[n]}}if(l>d){for(let t=0;t<r;t++)e[t]=n[t],o[t]=s[t],u[t]=i[t];l=d}return{mean:o,sdcm:u}}function p(e,t,a,r){let s=0,i=0;for(let n=t[e]+1;n<=t[e+1];n++){const e=r[n];s+=a[n]*e,i+=e}i<=0&&n().warn("Exception in Natural Breaks calculation");const l=s/i;let o=0;for(let n=t[e]+1;n<=t[e+1];n++)o+=r[n]*(a[n]-l)**2;return{sbMean:l,sbSdcm:o}}},29310:(e,t,a)=>{a.r(t),a.d(t,{createRasterLayerAdapter:()=>I,getDefaultBandCombination:()=>V,getSupportedRendererInfo:()=>R,processRasterRendererParameters:()=>F});var r=a(89379),n=a(50076),s=a(78937),i=a(35143),l=a(46053),o=(a(81806),a(76460),a(47249),a(85842)),u=a(19247),c=a(86866),d=a(46570),f=a(49304),p=a(53521);let h=class extends f.A{constructor(){super(...arguments),this.type="raster-layer-adapter",this._statsCache=new p.q(20)}get serviceRasterInfo(){return this.rasterInfo}async updateRasterInfo(e){this.rasterInfo=await this.generateRasterInfo(e),this.rasterFunction=null===e||void 0===e?void 0:e.rasterFunction}async updateRasterInfoWithEstimatedStats(e,t){const a=await this.estimateStatisticsHistograms(t);null!==a&&void 0!==a&&a.statistics&&(e.statistics=a.statistics),(null===a||void 0===a?void 0:a.histograms)&&(e.histograms=a.histograms)}};(0,i._)([(0,l.MZ)()],h.prototype,"layer",void 0),(0,i._)([(0,l.MZ)()],h.prototype,"serviceRasterInfo",null),(0,i._)([(0,l.MZ)()],h.prototype,"rasterInfo",void 0),(0,i._)([(0,l.MZ)()],h.prototype,"rasterFunction",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],h.prototype,"version",void 0),h=(0,i._)([(0,o.$)("esri.smartMapping.raster.support.adapters.RasterLayerAdapter")],h);const m=h;let v=class extends m{generateRasterInfo(e){const t=null===e||void 0===e?void 0:e.rasterFunction;try{return this.layer.generateRasterInfo(t,{signal:null===e||void 0===e?void 0:e.signal})}catch(a){return Promise.resolve(this.layer.serviceRasterInfo)}}async estimateStatisticsHistograms(e){var t,a,r,n,s;const{layer:i}=this,l=null!==(t=null===(a=i.mosaicRule)||void 0===a||null===(a=a.multidimensionalDefinition)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.variableName)&&void 0!==t?t:"",o="".concat(null!==(r=null===e||void 0===e||null===(n=e.rasterFunction)||void 0===n?void 0:n.functionName)&&void 0!==r?r:"default").concat(l),f=this._statsCache.get(o);if(f)return f;let{width:p,height:h,pixelSize:m}=i.rasterInfo,v=1;for(;p>2e3||h>2e3;)p/=2,h/=2,v*=2;const y=null!==(s=null===e||void 0===e?void 0:e.rasterFunction)&&void 0!==s?s:i.rasterFunction,{fullExtent:g,mosaicRule:b}=i;m=new u.default(m.x*v,m.y*v,g.spatialReference);const M=new d.default({geometry:g,pixelSize:m,renderingRule:y,mosaicRule:b});let w;if(i.capabilities.operations.supportsComputeStatisticsHistograms)w=await i.computeStatisticsHistograms(M,e);else{const{histograms:t}=await i.computeHistograms(M,e);w={statistics:(0,c.Pg)(t),histograms:t}}return w&&this._statsCache.put(o,w),w}supportsMultidirectionalHillshade(){return this.layer.version>=10.81}load(e){return this.addResolvingPromise(this.layer.load(e).then((()=>{this.generateRasterInfo({rasterFunction:this.rasterFunction,signal:null===e||void 0===e?void 0:e.signal}).then((e=>this.rasterInfo=e))}))),Promise.resolve(this)}};(0,i._)([(0,l.MZ)()],v.prototype,"layer",void 0),v=(0,i._)([(0,o.$)("esri.smartMapping.raster.support.adapters.ImageryLayerAdapter")],v);const y=v;var g=a(76797);let b=class extends m{async generateRasterInfo(e){const{layer:t}=this,a=null===e||void 0===e?void 0:e.rasterFunction;if("imagery-tile"===t.type&&a)try{return await t.generateRasterInfo(a,{signal:null===e||void 0===e?void 0:e.signal})}catch(r){return t.serviceRasterInfo}return this.rasterInfo}async estimateStatisticsHistograms(e){var t,a,r,s;const{layer:i}=this,l=null!==(t=null===(a=i.multidimensionalDefinition)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.variableName)&&void 0!==t?t:"",o="".concat(null!==(r=null===(s=i.rasterFunction)||void 0===s?void 0:s.functionName)&&void 0!==r?r:"default").concat(l),u=this._statsCache.get(o);if(u)return u;const{raster:d}=i,{extent:f,width:p,height:h}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const{pyramidScalingFactor:a,maximumPyramidLevel:r}=e.storageInfo;let{extent:n,width:s,height:i,pixelSize:l}=e,o=Math.max(0,Math.ceil(Math.log(Math.max(s,i)/t)/Math.log(a))-1),u=0,c=0;if(o<=r){const e=a**o;s=Math.floor(s/e),i=Math.floor(i/e)}else o=0,s=Math.min(s,t),i=Math.min(i,t),u=Math.max(Math.floor(s/2-500),0),c=Math.max(Math.floor(i/2-500),0),n=new g.default({xmin:n.xmin+u*l.x,xmax:Math.min(n.xmax,n.xmin+u*l.x*t),ymin:n.ymin+c*l.y,ymax:Math.min(n.ymax,n.ymin+c*l.y*t)});return{extent:n,width:s,height:i,origin:{x:u,y:c}}}(d.rasterInfo),{pixelBlock:m}=await i.fetchPixels(f,p,h,e);if(null==m)throw new n.default("raster-layer-adapter","Unable to estimate histograms");const v=(0,c.f4)(m);return v&&this._statsCache.put(o,v),v}supportsMultidirectionalHillshade(){return!0}load(e){return this.addResolvingPromise(this.layer.load(e).then((()=>this.rasterInfo=this.layer.raster.rasterInfo))),Promise.resolve(this)}};(0,i._)([(0,l.MZ)()],b.prototype,"layer",void 0),b=(0,i._)([(0,o.$)("esri.smartMapping.raster.support.adapters.ImageryTileLayerAdapter")],b);const M={imagery:{adapter:y,label:"ImageryLayer"},"imagery-tile":{adapter:b,label:"ImageryTileLayer"},wcs:{adapter:b,label:"WCSLayer"}},w={"raster-stretch":"raster-stretch","unique-value":"raster-unique-value","raster-rgb":"raster-rgb","class-breaks":"raster-class-breaks","raster-colormap":"raster-colormap","raster-shaded-relief":"raster-shaded-relief","vector-field":"raster-vector-field",flow:"raster-flow"},x=Object.keys(M).map((e=>M[e].label));function I(e){var t;if("raster-layer-adapter"===e.type)return e;const a=null===(t=M[e.type])||void 0===t?void 0:t.adapter;return null==a?null:new a({layer:e})}async function R(e){var t,a,r;const n=I((e=await F(e)).layer),i=await n.generateRasterInfo(e),l=(0,s.fp)(i,!0).map((e=>w[e])),o=n.layer,u="imagery-tile"===o.type?(0,s.Mm)(o.raster):void 0,c="wcs"!==o.type?o.presetRenderers:void 0,d=(0,s.I8)({variableName:e.variableName,rasterFunctionName:null===(t=e.rasterFunction)||void 0===t?void 0:t.functionName,presetRenderers:c}),f=null!==(a=null===d||void 0===d?void 0:d.renderer)&&void 0!==a?a:(0,s.PD)(i,{rasterFunctionColorRamp:u,variableName:e.variableName}),{bandCount:p}=i;return p>1&&l.push("raster-rgb"),!l.includes("raster-class-breaks")&&1===p&&+(null===(r=n.layer)||void 0===r?void 0:r.version)>=10.3&&l.push("raster-class-breaks"),{supportedTypes:l,defaultRenderer:f}}async function V(e){var t;const a=I((e=await F(e)).layer),r=await a.generateRasterInfo(e),{layer:n}=a;if("wcs"!==n.type&&null!==(t=n.presetRenderers)&&void 0!==t&&t.length){var i,l;const t=(0,s.I8)({variableName:e.variableName,rasterFunctionName:null===(i=e.rasterFunction)||void 0===i?void 0:i.functionName,presetRenderers:n.presetRenderers});if(null!==t&&void 0!==t&&null!==(l=t.bandIds)&&void 0!==l&&l.length)return t.bandIds}return(0,s.ci)(r)}async function F(e){var t,a;const{layer:s}=e;if(!s)throw new n.default("raster-renderer-creator:missing-parameters","'layer' parameter is required");const i=I(s);if(null==i)throw new n.default("raster-renderer-creator:invalid-parameters","'layer' must be one of these types: "+x.join(", "));await i.load();const l=null!==(t=null!==(a=e.rasterFunction)&&void 0!==a?a:e.renderingRule)&&void 0!==t?t:s.rasterFunction;return await i.updateRasterInfo({rasterFunction:l,signal:e.signal}),(0,r.A)((0,r.A)({},e),{},{layer:i,rasterFunction:l})}},30674:(e,t,a)=>{a.d(t,{A:()=>f});var r=a(35143),n=a(45802),s=a(42553),i=a(46053),l=(a(81806),a(76460),a(47249),a(6409)),o=a(85842);const u=new n.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),c=new n.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let d=class extends s.A{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,r._)([(0,l.e)({classBreaksDef:"class-breaks-definition"})],d.prototype,"type",void 0),(0,r._)([(0,i.MZ)({json:{write:!0}})],d.prototype,"breakCount",void 0),(0,r._)([(0,i.MZ)({json:{write:!0}})],d.prototype,"classificationField",void 0),(0,r._)([(0,i.MZ)({type:String,json:{read:u.read,write:u.write}})],d.prototype,"classificationMethod",void 0),(0,r._)([(0,i.MZ)({json:{write:!0}})],d.prototype,"normalizationField",void 0),(0,r._)([(0,i.MZ)({json:{read:c.read,write:c.write}})],d.prototype,"normalizationType",void 0),(0,r._)([(0,i.MZ)({value:null,json:{write:!0}})],d.prototype,"standardDeviationInterval",null),(0,r._)([(0,i.MZ)({value:null,json:{write:!0}})],d.prototype,"definedInterval",null),d=(0,r._)([(0,o.$)("esri.rest.support.ClassBreaksDefinition")],d);const f=d},65322:(e,t,a)=>{a.r(t),a.d(t,{createRenderer:()=>i});var r=a(50076),n=a(78937),s=a(29310);async function i(e){e=await async function(e){return await(0,s.processRasterRendererParameters)(e)}(e);const t=(0,n.dY)(e.layer.serviceRasterInfo);if(null==t)throw new r.default("vector-field-renderer:not-supported","Only vector data is supported");return e.flowRepresentation&&(t.flowRepresentation=e.flowRepresentation),e.rotationType&&(t.rotationType=e.rotationType),e.style&&(t.style=e.style),{renderer:t}}}}]);
//# sourceMappingURL=11920.a4e57d8e.chunk.js.map