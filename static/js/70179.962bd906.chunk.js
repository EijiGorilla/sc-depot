"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[66938,70179,87539,88084,91913],{44371:(e,t,i)=>{i.d(t,{A:()=>s});var a=i(35143),n=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),o=i(68999);let l=class extends o.A{constructor(e){super(e),this.visible=!1}};(0,a._)([(0,n.MZ)()],l.prototype,"visible",void 0),l=(0,a._)([(0,r.$)("esri.widgets.Spinner.SpinnerViewModel")],l);const s=l},51695:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var a=i(35143),n=i(91967),r=i(46053),o=(i(81806),i(76460)),l=(i(47249),i(85842)),s=i(31933),d=i(12482);let u=class extends n.default{constructor(e){super(e),this.layer=null}get attachments(){var e;return{enabled:this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.data.supportsAttachment)}}get create(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._createEnabled,n=a,r=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsAdd,o=!(null===t||void 0===t||!t.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!r&&o}}get delete(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsDelete,n=!(null===t||void 0===t||!t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!(null===t||void 0===t||!t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&n}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._updateEnabled,n=!(!a||null===t||void 0===t||!t.editing.supportsGeometryUpdate),r=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsUpdate,o=!(null===t||void 0===t||!t.operations.supportsUpdate),l=this.attachments.enabled,s=l&&this._canCreateOrUpdate;return{attachments:{enabled:l,create:s,update:s},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!r&&o}}get _createEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsAdd)}get _updateEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return(0,s.tk)(this.layer)}get _effectiveCapabilities(){return(0,s.BR)(this.layer)}};(0,a._)([(0,r.MZ)()],u.prototype,"attachments",null),(0,a._)([(0,r.MZ)()],u.prototype,"create",null),(0,a._)([(0,r.MZ)()],u.prototype,"delete",null),(0,a._)([(0,r.MZ)()],u.prototype,"layer",void 0),(0,a._)([(0,r.MZ)()],u.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,r.MZ)()],u.prototype,"update",null),(0,a._)([(0,r.MZ)()],u.prototype,"_createEnabled",null),(0,a._)([(0,r.MZ)()],u.prototype,"_updateEnabled",null),(0,a._)([(0,r.MZ)()],u.prototype,"_canCreateOrUpdate",null),(0,a._)([(0,r.MZ)()],u.prototype,"_effectiveEnabled",null),(0,a._)([(0,r.MZ)()],u.prototype,"_effectiveCapabilities",null),u=(0,a._)([(0,l.$)("esri.layers.support.EditingCapabilities")],u);const p=u;var c=i(80963),h=i(19463),f=i(64465);const y="esri.views.layers.support.editableLayerViews";var v=i(9912);let m=class extends p{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==(null===t||void 0===t?void 0:t.enabled)}}get create(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,r=t.create,o=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.addEnabled),l=r.enabled&&o;return{attributes:l&&r.attributes,enabled:l,geometry:l&&r.geometry&&w(a,n),attachments:{enabled:e.enabled&&l&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnCreateEnabled)},reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}get defaults(){return new p({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,i=e.delete,a=!1!==(null===t||void 0===t?void 0:t.enabled)&&!1!==(null===t||void 0===t?void 0:t.deleteEnabled);return{enabled:i.enabled&&a,reliesOnOwnerAdminPrivileges:i.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return null!==t&&void 0!==t&&t.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){var e,t;const{layer:i}=this,a=!(!(0,v.isRelatableFeatureSupportedLayer)(i)||null===(e=i.relationships)||void 0===e||!e.length),n=!(null===(t=this.formTemplate)||void 0===t||null===(t=t.elements)||void 0===t||!t.some((e=>"relationship"===e.type)));return{enabled:a&&n}}get update(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,r=t.update,o=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.updateEnabled),l=r.enabled&&o,s=l&&r.attributes&&!1!==(null===i||void 0===i?void 0:i.attributeUpdatesEnabled),d=l&&r.geometry&&!1!==(null===i||void 0===i?void 0:i.geometryUpdatesEnabled)&&w(a,n),u=e.enabled&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnUpdateEnabled);return{attributes:s,enabled:l,geometry:d,attachments:{enabled:u,create:u&&r.attachments.create,update:u&&r.attachments.update},reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}};function w(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){var i,a,n,r,l,s;const{associatedLayer:d}=e,u=null===d||void 0===d?void 0:d.infoFor3D;if(!u)return!1;const p=(0,h.U9)(u);if(null==p||!u.queryFormats.includes(p))return o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(i=e.title)&&void 0!==i?i:"Untitled layer",", ").concat(e.id,") does not support geometry edits because it does not support GLB queries.")),!1;const v=e.spatialReference,m=d.spatialReference;if(!(0,c.aI)(v,m))return o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(a=e.title)&&void 0!==a?a:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(v.wkid,") is different from its associated FeatureLayer's spatial reference (wkid:").concat(m.wkid,").")),!1;const w=d.sourceJSON.sourceSpatialReference;if(null!=w&&!(0,c.aI)(w,m))return o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(n=e.title)&&void 0!==n?n:"Untitled layer",", ").concat(e.id,") does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:").concat(m.wkid,") is different from its source spatial reference (wkid:").concat(w.wkid,").")),!1;const{view:g}=t;if(t.destroyed||null==g)return!1;const _=g.spatialReference,{viewingMode:b}=g.state,k=(0,c.EA)(v),M=b===f.RT.Global;return k&&!M?(o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(r=e.title)&&void 0!==r?r:"Untitled layer",", ").concat(e.id,") does not support geometry edits in local viewing mode because its spatial reference (wkid:").concat(v.wkid,") is geographic. Please consider changing the viewing mode to global.")),!1):!k&&M?(o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(l=e.title)&&void 0!==l?l:"Untitled layer",", ").concat(e.id,") does not support geometry edits in global viewing mode because its spatial reference (wkid:").concat(v.wkid,") is projected. Please consider changing the viewing mode to local.")),!1):!!((0,c.aI)(v,_)||M&&(0,c.K8)(_)&&(0,c.oT)(v))||(o.A.getLogger(y).warnOnce("SceneLayer (".concat(null!==(s=e.title)&&void 0!==s?s:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(v.wkid,") does not match the view spatial reference (wkid:").concat(_.wkid,").")),!1)}(e,t)}(0,a._)([(0,r.MZ)()],m.prototype,"attachments",null),(0,a._)([(0,r.MZ)()],m.prototype,"create",null),(0,a._)([(0,r.MZ)()],m.prototype,"defaults",null),(0,a._)([(0,r.MZ)()],m.prototype,"delete",null),(0,a._)([(0,r.MZ)()],m.prototype,"formTemplate",null),(0,a._)([(0,r.MZ)()],m.prototype,"layerInfo",void 0),(0,a._)([(0,r.MZ)()],m.prototype,"layerView",void 0),(0,a._)([(0,r.MZ)()],m.prototype,"relationship",null),(0,a._)([(0,r.MZ)()],m.prototype,"update",null),m=(0,a._)([(0,l.$)("esri.widgets.Editor.support.EditorEditingCapabilities")],m);const g=m;var _=i(3320);let b=class extends n.default{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var e;return!(null===(e=this.layerView)||void 0===e||!e.suspended)}get capabilities(){return new g({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:i,delete:{enabled:a}}=this.capabilities,n=e.attachments.enabled||i.attachments.enabled;return!this.disabled&&(e.enabled||i.enabled||n||a||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return(0,_.lB)(this.layer,this.formTemplate)}get isTable(){return(0,s.bI)(this.layer)}get supportsCreateFeaturesWorkflow(){var e;if(this.disabled)return!1;if("3d"===(null===(e=this.layerView)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.type)&&(0,d.wz)(this.layer.elevationInfo))return!1;const{enabled:t,geometry:i}=this.capabilities.create;return this.isTable?t:t&&i}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};(0,a._)([(0,r.MZ)()],b.prototype,"_suspended",null),(0,a._)([(0,r.MZ)()],b.prototype,"capabilities",null),(0,a._)([(0,r.MZ)()],b.prototype,"disabled",void 0),(0,a._)([(0,r.MZ)()],b.prototype,"editable",null),(0,a._)([(0,r.MZ)()],b.prototype,"formTemplate",null),(0,a._)([(0,r.MZ)()],b.prototype,"hasInvalidFormTemplate",null),(0,a._)([(0,r.MZ)()],b.prototype,"isTable",null),(0,a._)([(0,r.MZ)()],b.prototype,"layer",void 0),(0,a._)([(0,r.MZ)()],b.prototype,"layerInfo",void 0),(0,a._)([(0,r.MZ)()],b.prototype,"layerView",void 0),(0,a._)([(0,r.MZ)()],b.prototype,"supportsCreateFeaturesWorkflow",null),(0,a._)([(0,r.MZ)()],b.prototype,"supportsUpdateWorkflow",null),(0,a._)([(0,r.MZ)()],b.prototype,"visible",null),b=(0,a._)([(0,l.$)("esri.widgets.Editor.support.EditorItem")],b);const k=b},66938:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var a=i(35143),n=i(91967),r=i(5632),o=i(46053),l=(i(81806),i(76460),i(47249),i(85842));let s=class extends(r.A.IdentifiableMixin(n.default)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find((t=>t.template===e))}};(0,a._)([(0,o.MZ)()],s.prototype,"allItems",void 0),(0,a._)([(0,o.MZ)()],s.prototype,"filterFunction",void 0),(0,a._)([(0,o.MZ)()],s.prototype,"items",null),(0,a._)([(0,o.MZ)()],s.prototype,"label",void 0),(0,a._)([(0,o.MZ)()],s.prototype,"id",null),s=(0,a._)([(0,l.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],s);const d=s},68999:(e,t,i)=>{i.d(t,{A:()=>u});var a=i(35143),n=i(54099),r=i(68134),o=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),s=i(9624);let d=class extends n.A.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,r.when)((()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,r.watch)((()=>this.screenLocation),((e,t)=>{null!=e&&null!=t&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,a=null===t||void 0===t?void 0:t.spatialReference,n=a?(0,s.projectOrLoad)(e,a).geometry:null;return i&&n&&null!==t&&void 0!==t&&t.ready?t.toScreen(n):null}};(0,a._)([(0,o.MZ)()],d.prototype,"location",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"screenLocation",null),(0,a._)([(0,o.MZ)()],d.prototype,"screenLocationEnabled",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"view",void 0),d=(0,a._)([(0,l.$)("esri.widgets.support.AnchorElementViewModel")],d);const u=d},70179:(e,t,i)=>{i.r(t),i.d(t,{default:()=>x});var a=i(89379),n=i(35143),r=i(18690),o=i(98773),l=i(19276),s=i(50076),d=i(54099),u=i(54901),p=i(76460),c=i(30726),h=i(50346),f=i(68134),y=i(46053),v=(i(81806),i(85842)),m=i(19451),w=i(5600),g=i(63733),_=i(70445),b=i(31933),k=i(47437),M=i(97513),I=i(64344),A=i(83973),F=i(78583),Z=i(7141),T=i(96500),E=i(95600),O=i(51695),W=i(91656),L=i(87539),C=i(81257),V=i(44371);const U="esri.widgets.Editor.EditorViewModel";function S(e,t,i){p.A.getLogger(U).error(new s.default(e,t,i))}function P(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}let q=class extends d.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._templatesByLayer=new Map,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new g.default({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updateTemplatesTask=null,this._updatingHandles=new m.U,this._featureTemplatesViewModelIsRestricted=!1,this.activeWorkflow=null,this._activityQueue=new l.default,this.editorItems=new l.default,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new F.default({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new L.default({disabledItemFunction:e=>{let{layer:t}=e;return this._itemIsSuspended(t)}}),this.layerInfos=null,this.ownSketchViewModel=new C.default({layer:this._sketchGraphicsLayer}),this.sketchOptions=new M.A,this.snappingOptions=new A.default({attributeRulesEnabled:!0}),this.spinnerViewModel=new V.A,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var e;this.canGoBack&&(null!==(e=this.activeWorkflow)&&void 0!==e&&e.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var e,t;const{featureFormViewModel:i}=this;if(i&&"create-features"!==(null===(e=this.activeWorkflow)||void 0===e?void 0:e.type)){if(i.submit(),!i.submittable||i.pendingSubtypeChoice)return;const e=i.getValues();if(i.validateContingencyConstraints(e,{includeIncompleteViolations:!0}).length>0)return}await(null===(t=this.activeWorkflow)||void 0===t?void 0:t.save())},this.selectFeature=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=t.activeWorkflow;t._candidateCommitted||"update"!==(null===a||void 0===a?void 0:a.type)||(a.data.rootFeature=e,i&&(a.next(),t._candidateCommitted=!0))}}initialize(){this.addHandles([(0,f.watch)((()=>{var e;const t=this.view,i=null===t||void 0===t||null===(e=t.map)||void 0===e?void 0:e.editableLayers.toArray(),a=null===t||void 0===t?void 0:t.allLayerViews,n=null===a||void 0===a?void 0:a.filter((e=>!(null===i||void 0===i||!i.includes(e.layer))));return[i,n,this.layerInfos]}),(()=>this._updateEditorItems()),f.syncAndInitial),(0,f.watch)((()=>this.hideTemplatesForInactiveLayers),(()=>this.syncFeatureTemplates())),(0,f.on)((()=>this.activeWorkflow),"cancel",(()=>this.emit("workflow-cancel"))),(0,f.on)((()=>this.activeWorkflow),"commit",(()=>this.emit("workflow-commit"))),(0,f.on)((()=>this.activeWorkflow),"complete",(()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)})),(0,f.when)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),(e=>e.add(this._sketchGraphicsLayer)),f.initial),(0,f.on)((()=>this.editorItems),"change",(()=>this._afterEditorItemsChange())),(0,f.watch)((()=>[this.canCreate,this.canUpdateVisible]),(()=>this._afterEditorItemsChange())),(0,f.watch)((()=>this.page),((e,t)=>{const i=[...this.pageStack];if(-1===i.indexOf(e))i.push(e);else for(;i.length&&i.at(-1)!==e;)i.pop();this.pageStack=i}),f.syncAndInitial),(0,f.when)((()=>"awaiting-update-feature-candidate"===this.state),(()=>this._candidateCommitted=!1)),(0,f.on)((()=>this.featureTemplatesViewModel),"select",(async e=>{let{item:t,oldItem:i}=e;const{activeWorkflow:a}=this;if(a){var n;if("update"===a.type&&"awaiting-feature-creation-info"===(null===(n=a.activeWorkflow)||void 0===n?void 0:n.stepId))return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch(o){return void this.featureTemplatesViewModel.select(i,{emit:!1})}}if(!t)return;const r={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(i,{emit:!1}),this.startCreateFeaturesWorkflow(r);this.startCreateFeaturesWorkflowAtFeatureCreation(r)})),(0,f.watch)((()=>[this.view,this.featureTemplatesViewModel]),(e=>{let[t,i]=e;i.view=t}),f.syncAndInitial),(0,f.on)((()=>this.view),"key-down",(e=>{var t;"Escape"===e.key&&(null===(t=this.activeWorkflow)||void 0===t?void 0:t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())})),(0,f.on)((()=>this.sketchViewModel),["create","delete","update"],(e=>{var t,i;const{activeWorkflow:a}=this,n="update"===(null===a||void 0===a?void 0:a.type),r=n?null===(t=a.activeWorkflow)||void 0===t?void 0:t.layer:null===a||void 0===a?void 0:a.layer,o=n?null===a||void 0===a||null===(i=a.activeWorkflow)||void 0===i?void 0:i.parentLayer:void 0,l="sketch-".concat(e.type);this.emit(l,{type:l,detail:e,layer:r,parentLayer:o})}),f.sync),(0,f.watch)((()=>this.view),(e=>{if(this._snappingManager=(0,c.pR)(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new I.g({view:e,options:t}),this.ownSketchViewModel.snappingManager=this._snappingManager}),f.syncAndInitial),(0,f.watch)((()=>this.snappingOptions),(e=>{this._snappingManager&&(this._snappingManager.options=e)}),f.syncAndInitial)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then((()=>{var e;null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._sketchGraphicsLayer),this.view=null})),this._updateItemsTask=(0,c.DC)(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=(0,c.xt)(this._sketchEventListenerHandle)}get _featureTemplatesLayersAndTables(){const e=new l.default;for(const t of this.editorItems){const i=this.hideTemplatesForInactiveLayers&&!t.visible;t.supportsCreateFeaturesWorkflow&&!i&&e.push(t.layer)}return e}get activeLeafWorkflow(){var e;const t=this.activeWorkflow;return t&&(0,E.bl)(t)&&null!==(e=t.activeWorkflow)&&void 0!==e?e:t}get canCreate(){return this.editorItems.some((e=>e.supportsCreateFeaturesWorkflow))}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some((e=>e.supportsUpdateWorkflow))}get canUpdateVisible(){return this.editorItems.some((e=>e.supportsUpdateWorkflow&&e.visible))}get featureTemplatesLayers(){return this._featureTemplatesLayersAndTables.filter((e=>"scene"===e.type||!e.isTable))}get featureFormViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeFeatureFormViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.featureFormViewModel:null}get utilityNetworkAssociationAddAssociationViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeUtilityNetworkAssociationAddAssociationViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeSketchViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.sketchViewModel:this.ownSketchViewModel}get state(){var e,t;if(null===(e=this.view)||void 0===e||!e.ready)return"disabled";const i=this.attachmentsViewModel.mode;if("add"===i)return"adding-attachment";if("edit"===i)return"editing-attachment";const{activeWorkflow:a}=this;return null!==a&&void 0!==a&&a.stepId?"update"===a.type&&null!==(t=a.activeWorkflow)&&void 0!==t&&t.stepId?a.activeWorkflow.stepId:a.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||!0===(null===(e=this.activeWorkflow)||void 0===e?void 0:e.updating)}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get canZoomTo(){var e,t;const i=this.sketchViewModel,a=null===i||void 0===i||null===(e=i.createGraphic)||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.type;return!((null===i||void 0===i||null===(t=i.updateGraphics)||void 0===t||!t.length)&&"multipoint"!==a)}get page(){var e,t;const{activeWorkflow:i,state:a}=this;if("update"===(null===i||void 0===i?void 0:i.type)&&null!=(null===i||void 0===i||null===(e=i.activeWorkflow)||void 0===e||null===(e=e.featureFormViewModel)||void 0===e?void 0:e.associatedLayer))return"viewing-associated-features";if("update"===(null===i||void 0===i?void 0:i.type)&&null!=(null===i||void 0===i||null===(t=i.activeWorkflow)||void 0===t||null===(t=t.featureFormViewModel)||void 0===t?void 0:t.associationId))return"viewing-associated-layers";if("update"===(null===i||void 0===i?void 0:i.type)&&"awaiting-feature-to-update"===i.stepId)return"ready";if("create-features"===(null===i||void 0===i?void 0:i.type)&&0===i.numPendingFeatures){const e=i.data.upload;if(e)return"default"===e.state?"ready":"creating-features-upload-details"}return null!==a&&void 0!==a?a:"disabled"}get featureFormDisabled(){var e;const{activeWorkflow:t}=this;return"update"===(null===t||void 0===t?void 0:t.type)&&!1===(null===(e=t.activeEditorItem)||void 0===e?void 0:e.capabilities.update.attributes)}get featureFormHasAssociation(){var e;return!(null===(e=this.featureFormViewModel)||void 0===e||!e.activeAssociation)}get canGoBack(){return null!=this.activeWorkflow&&!this.syncing}get shouldShowDeleteButton(){var e;const{activeWorkflow:t}=this;return!!t&&"update"===t.type&&!(null===(e=t.activeEditorItem)||void 0===e||!e.capabilities.delete.enabled)}get hasPendingEdits(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.hasPendingEdits)&&void 0!==e&&e}get snappingManager(){return this._snappingManager}getTemplatesForLayer(e){var t;return null!==(t=this._templatesByLayer.get(e))&&void 0!==t?t:[]}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";if(await(0,f.whenOnce)((()=>!this.updating)),!this.canCreate)throw new s.default("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",i),await i.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await(0,f.whenOnce)((()=>!this.updating));const t=this._createUpdatingResolver();try{const{initialFeature:t}=e,i=t.sourceLayer=t.layer,a=i?this.findEditorItemForLayer(i):void 0;if(null===a||void 0===a||!a.supportsCreateFeaturesWorkflow)throw new s.default("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const n=this._createCreateFeaturesWorkflow({initialFeature:t,layer:a.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",n),await n.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await(0,f.whenOnce)((()=>!this.updating)),!this.canUpdate)return void S("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(t){this._logErrorAndCancelWorkflow(t)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await(0,f.whenOnce)((()=>!this.updating)),!this.canUpdate)return void S("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,this._set("activeWorkflow",t),await t.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await(0,f.whenOnce)((()=>!this.updating)),!this.canUpdate)return void S("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.rootFeature=e,this._set("activeWorkflow",t),await t.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{t.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveFeature():S("editing:unsupported-workflow","Deleting a feature requires an active update workflow.")}async deleteAssociationFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveAssociation():S("editing:unsupported-workflow","Deleting an association requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow((0,a.A)({warnIfNoWorkflow:!0},e))}findEditorItemForLayer(e){return this.editorItems.find((t=>t.layer===e))}itemHasInvalidFormTemplate(e){var t;return null!=e&&!0===(null===(t=this.findEditorItemForLayer(e.layer))||void 0===t?void 0:t.hasInvalidFormTemplate)}syncFeatureTemplates(){this._featureTemplatesViewModelIsRestricted||this._updateTemplates()}zoomTo(e){var t,i;const a=this.sketchViewModel,n=e?e.geometry:null!==a&&void 0!==a&&a.updateGraphics.length?null===a||void 0===a?void 0:a.updateGraphics.toArray().map((e=>e.geometry)).filter(r.Ru):null===a||void 0===a||null===(t=a.createGraphic)||void 0===t?void 0:t.geometry;n&&(null===(i=this.view)||void 0===i||i.goTo(n))}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&"awaiting-feature-to-update"===this.state?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}restrictFeatureTemplatesViewModelToLayer(e){return this._featureTemplatesViewModelIsRestricted=!0,this._setFeatureTemplatesViewModelLayers([e]),(0,u.hA)((()=>{this._featureTemplatesViewModelIsRestricted=!1,this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)}))}async _getEditorItemCandidates(e){const{view:t}=this;if(null===t||void 0===t||!t.map)return[];const{map:i}=t,a=i.editableLayers.toArray(),n=i.allTables.toArray().filter((e=>(0,b.yZ)(e)||(0,b.F2)(e)));return await Promise.allSettled([...a.flatMap((e=>this._getLayerLoadPromise(e))),...n.flatMap((e=>this._getLayerLoadPromise(e)))]),(0,h.throwIfAborted)(e),[...a.reverse(),...n.reverse()].filter((e=>(0,_.S)(e)&&("mesh"!==e.geometryType||"3d"===t.type))).flatMap((e=>"subtype-group"===e.type?e.sublayers.toArray():e))}_getLayerLoadPromise(e){return(0,b.F2)(e)?e.loadAll():e.load()}_drainEditorItems(){this.editorItems.drain((e=>e.destroy()))}_updateEditorItems(){(0,c.DC)(this._updateItemsTask);const{view:e}=this,t=(0,o.UT)((async t=>{if(null===e||void 0===e||!e.map||null===e||void 0===e||!e.allLayerViews)return;const i=await this._getEditorItemCandidates(t);if(!i.length)return void this._drainEditorItems();const a=[],n=[],r=[],{layerInfos:o}=this;for(const s of i){const t=P(o,s),i=await(0,E.QZ)(e,s).catch((()=>null));(t?a:i?n:r).push(new O.default({layer:s,layerInfo:t,layerView:i}))}(null===o||void 0===o?void 0:o.length)&&a.sort(((e,t)=>o.findIndex((t=>{let{layer:i}=t;return i===e.layer}))-o.findIndex((e=>{let{layer:i}=e;return i===t.layer}))));const l=[...a,...n,...r];t.aborted||(this._drainEditorItems(),this.editorItems.addMany(l))}));this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_updateTemplates(){(0,c.DC)(this._updateTemplatesTask);const e=(0,o.UT)((async e=>{const t=this._templatesByLayer,i=this._featureTemplatesLayersAndTables.filter((e=>!t.has(e)));if(i.length>0){const a=await(0,w.b)(i.toArray(),this.view,e);for(const{layer:e,templates:i}of a)t.set(e,i)}this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)}));this._updatingHandles.addPromise(e.promise),this._updateTemplatesTask=e}_setFeatureTemplatesViewModelLayers(e){const t=this._templatesByLayer,i=[];for(const a of e){const e=t.get(a);e&&e.length>0&&i.push((0,W.Ex)(a,e))}this.featureTemplatesViewModel.templateInfos=i}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;"create-features"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdateVisible||"awaiting-update-feature-candidate"===t&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(t)if(e&&!1===e.force)try{await t.cancel(e),this._set("activeWorkflow",null),t.destroy()}catch(i){}else{this.emit("workflow-cancel"),this._set("activeWorkflow",null);try{await t.cancel(e)}finally{t.destroy()}}else(null===e||void 0===e?void 0:e.warnIfNoWorkflow)&&S("editing:no-active-workflow","There is no active workflow to cancel.")}_createCreateFeaturesWorkflow(e,t){return Z.default.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),applyEditsFeatureServiceCallback:(e,t,i)=>this._applyEditsFeatureService(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_createUpdateWorkflow(e){return T.default.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),applyEditsFeatureServiceCallback:(e,t,i)=>this._applyEditsFeatureService(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_addAttachments(e,t){var i;const a=null!==(i=t.map((t=>this._addAttachment(e,t.feature,t.attachment))))&&void 0!==i?i:[];return Promise.all(a)}async _addAttachment(e,t,i){var a;let n=null;if(!("addAttachment"in e)||null==(null===(a=e.capabilities)||void 0===a?void 0:a.attachment))throw new s.default("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation((async()=>{var a,r;return n=null!==(a=await(null===(r=e.addAttachment)||void 0===r?void 0:r.call(e,t,i).catch((e=>{throw(null===e||void 0===e?void 0:e.error)||e}))))&&void 0!==a?a:null,n})),n}async _applyEdits(e,t,i){let n=null;const r=e.url?await(0,b.wI)(e.url):null,o=(0,a.A)({returnServiceEditsOption:r&&(0,k.py)(r)||RegExp("/hosted/","i").test(e.url)?void 0:"original-and-current-features"},i);return await this._queueOperation((async()=>{const{view:i}=this;if(!i)return null;const a=await(0,E.QZ)(i,e).catch((()=>null));return n=await e.applyEdits(t,o),a&&await(0,f.whenOnce)((()=>!a.updating)),n})),n}async _applyEditsFeatureService(e,t,i){let a=null;return await this._queueOperation((async()=>a=await e.applyEdits(t,i))),a}_queueOperation(e){this._activityQueue.push(e);const t=(e,t)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)};return e().then((e=>(Array.isArray(e)?e.forEach((e=>this._handleEditsResultError(e))):this._handleEditsResultError(e),e))).catch((i=>{S("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures)}};this._set("failures",[...this.failures,a])})).then((()=>{t(e,this._activityQueue)}))}_handleEditsResultError(e){if(null!=e&&"error"in e&&null!=e.error)throw e.error;if(null!=e&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:i,updateFeatureResults:a}=e,n=t.find((e=>!!e.error))||a.find((e=>!!e.error))||i.find((e=>!!e.error));if(n)throw n.error}}_createUpdatingResolver(){const e=(0,h.createResolver)();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:i,details:a}=e;S(null!==t&&void 0!==t?t:"editing:workflow-start-failed",null!==i&&void 0!==i?i:void 0,null!==a&&void 0!==a?a:e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return null!=t&&(!t.visible||t.disabled)}};(0,n._)([(0,y.MZ)()],q.prototype,"_featureTemplatesLayersAndTables",null),(0,n._)([(0,y.MZ)()],q.prototype,"_snappingManager",void 0),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"activeWorkflow",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"activeLeafWorkflow",null),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"_activityQueue",void 0),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"canCreate",null),(0,n._)([(0,y.MZ)()],q.prototype,"canCreateVisible",null),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"canUpdate",null),(0,n._)([(0,y.MZ)()],q.prototype,"canUpdateVisible",null),(0,n._)([(0,y.MZ)()],q.prototype,"featureTemplatesLayers",null),(0,n._)([(0,y.MZ)()],q.prototype,"editorItems",void 0),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"failures",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"hideTemplatesForInactiveLayers",void 0),(0,n._)([(0,y.MZ)({type:F.default})],q.prototype,"attachmentsViewModel",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"featureFormViewModel",null),(0,n._)([(0,y.MZ)()],q.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),(0,n._)([(0,y.MZ)({type:L.default})],q.prototype,"featureTemplatesViewModel",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"labelOptions",null),(0,n._)([(0,y.MZ)()],q.prototype,"layerInfos",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"ownSketchViewModel",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"sketchOptions",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"sketchViewModel",null),(0,n._)([(0,y.MZ)({type:A.default,nonNullable:!0})],q.prototype,"snappingOptions",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"spinnerViewModel",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"state",null),(0,n._)([(0,y.MZ)({readOnly:!0})],q.prototype,"syncing",null),(0,n._)([(0,y.MZ)()],q.prototype,"updating",null),(0,n._)([(0,y.MZ)()],q.prototype,"tooltipOptions",null),(0,n._)([(0,y.MZ)()],q.prototype,"valueOptions",null),(0,n._)([(0,y.MZ)()],q.prototype,"view",null),(0,n._)([(0,y.MZ)()],q.prototype,"canZoomTo",null),(0,n._)([(0,y.MZ)()],q.prototype,"pageStack",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"showDiscardEditsPrompt",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"_candidateCommitted",void 0),(0,n._)([(0,y.MZ)()],q.prototype,"page",null),(0,n._)([(0,y.MZ)()],q.prototype,"featureFormDisabled",null),(0,n._)([(0,y.MZ)()],q.prototype,"featureFormHasAssociation",null),(0,n._)([(0,y.MZ)()],q.prototype,"canGoBack",null),(0,n._)([(0,y.MZ)()],q.prototype,"shouldShowDeleteButton",null),(0,n._)([(0,y.MZ)()],q.prototype,"hasPendingEdits",null),(0,n._)([(0,y.MZ)()],q.prototype,"snappingManager",null),q=(0,n._)([(0,v.$)(U)],q);const x=q},78583:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var a=i(89379),n=i(35143),r=i(39356),o=i(91967),l=i(19276),s=i(50076),d=i(68134),u=i(46053),p=i(21403),c=(i(81806),i(47249),i(85842)),h=i(6362),f=i(88084),y=i(9708),v=i(9912);const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},w=l.default.ofType(f.default);let g=class extends o.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=(0,a.A)({},m),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new w,this.fileInfos=new l.default,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles((0,d.watch)((()=>this.graphic),(()=>this._graphicChanged()),d.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return(0,a.A)((0,a.A)({},m),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(null===t||void 0===t?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:i}=this;if(!e||"function"!=typeof e.queryAttachments)throw new s.default("invalid-layer","getAttachments(): A valid layer is required.");const a=this._getObjectId();if("number"!=typeof a)throw new s.default("invalid-object-id","getAttachments(): Numeric object id is required");const n=null===i||void 0===i?void 0:i.map((e=>"".concat(e.field," ").concat("descending"===e.order?"DESC":"ASC"))),r=new y.default({objectIds:[a],returnMetadata:!0,orderByFields:n}),o=[],l=e.queryAttachments(r).then((e=>e[a]||o)).catch((()=>o));this._getAttachmentsPromise=l,this.notifyChange("state");const d=await l;return t.destroyAll(),d.length&&t.addMany(d),this._getAttachmentsPromise=null,this.notifyChange("state"),d}async addAttachment(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:a,attachmentInfos:n,capabilities:r}=this;if(!i)throw new s.default("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new s.default("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(null===(t=r.operations)||void 0===t||!t.add)throw new s.default("invalid-capabilities","addAttachment(): add capabilities are required.");if(!a||"function"!=typeof a.addAttachment)throw new s.default("invalid-layer","addAttachment(): A valid layer is required.");const o=a.addAttachment(i,e).then((e=>this._queryAttachment(e.objectId,i))),l=await o;return n.add(l),l}async deleteAttachment(e){var t;const{_attachmentLayer:i,attachmentInfos:a,graphic:n,capabilities:r}=this;if(!e)throw new s.default("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(null===(t=r.operations)||void 0===t||!t.delete)throw new s.default("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!i||"function"!=typeof i.deleteAttachments)throw new s.default("invalid-layer","deleteAttachment(): A valid layer is required.");if(!n)throw new s.default("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(n,[e.id]).then((()=>e)),l=await o;return a.remove(l),l.destroy(),l}async updateAttachment(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:a,attachmentInfos:n,graphic:r,capabilities:o}=this;if(!e)throw new s.default("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new s.default("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(null===(t=o.operations)||void 0===t||!t.update)throw new s.default("invalid-capabilities","updateAttachment(): Update capabilities are required.");const l=n.indexOf(i);if(!a||"function"!=typeof a.updateAttachment)throw new s.default("invalid-layer","updateAttachment(): A valid layer is required.");if(!r)throw new s.default("invalid-graphic","updateAttachment(): A graphic is required.");const d=a.updateAttachment(r,i.id,e).then((e=>this._queryAttachment(e.objectId))),u=await d;return n.splice(l,1,u),u}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!i)return null;const a=this.fileInfos.indexOf(i);return a>-1&&this.fileInfos.splice(a,1,{file:e,form:t}),this.fileInfos.items[a]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:i}=this;if(!e||null===i||void 0===i||!i.queryAttachments)throw new s.default("invalid-attachment-id","Could not query attachment.");const a=this._getObjectId(t);if("number"!=typeof a)throw new s.default("invalid-object-id","getAttachments(): Numeric object id is required");const n=new y.default({objectIds:[a],attachmentsWhere:"AttachmentId=".concat(e),returnMetadata:!0});return i.queryAttachments(n).then((e=>e[a][0]))}_getObjectId(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(e=null===t||void 0===t?void 0:t.getObjectId())&&void 0!==e?e:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>this.attachmentInfos.destroyAll())))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,v.getSourceLayer)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,n._)([(0,u.MZ)()],g.prototype,"capabilities",void 0),(0,n._)([(0,p.w)("capabilities")],g.prototype,"castCapabilities",null),(0,n._)([(0,u.MZ)()],g.prototype,"activeAttachmentInfo",void 0),(0,n._)([(0,u.MZ)()],g.prototype,"activeFileInfo",void 0),(0,n._)([(0,u.MZ)({readOnly:!0,type:w})],g.prototype,"attachmentInfos",void 0),(0,n._)([(0,u.MZ)()],g.prototype,"fileInfos",void 0),(0,n._)([(0,u.MZ)({type:r.default})],g.prototype,"graphic",void 0),(0,n._)([(0,u.MZ)()],g.prototype,"mode",void 0),(0,n._)([(0,u.MZ)({type:[h.default]})],g.prototype,"orderByFields",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"state",null),(0,n._)([(0,u.MZ)()],g.prototype,"filesEnabled",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"supportsResizeAttachments",null),g=(0,n._)([(0,c.$)("esri.widgets.Attachments.AttachmentsViewModel")],g);const _=g},87539:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var a=i(35143),n=i(98773),r=i(54099),o=i(30726),l=i(50346),s=i(68134),d=i(46053),u=(i(81806),i(76460),i(47249),i(85842)),p=i(19451),c=i(5600),h=i(31933),f=i(91656),y=i(91913),v=i(66938);const m=e=>{var t;let{layer:i}=e;return{key:i,label:null!==(t=i.title)&&void 0!==t?t:""}},w=e=>{var t;let{layer:i}=e;return{key:i.geometryType,label:null!==(t=i.geometryType)&&void 0!==t?t:""}};let g=class extends r.A.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new p.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,s.watch)((()=>[this.templateInfos,this.layers]),((e,t)=>{let[i]=e;i&&i===(null===t||void 0===t?void 0:t.at(0))||(this._updateTask=(0,o.DC)(this._updateTask),i?this._updateAllItems(i):this._getTemplatesAndUpdateAllItems())}),s.syncAndInitial),(0,s.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,o.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),s.sync),(0,s.watch)((()=>this.filterFunction),(e=>{for(const t of this._allItems)(0,f.X6)(t)&&(t.filterFunction=e)}),s.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=m;break;case"geometry":this._groupByFunction=w;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const i=()=>this.notifyChange("state");this.addHandles(e.map((e=>(0,s.when)((()=>e.loadStatus),i))),t)}this._set("layers",e)}get state(){var e;return this.updating?"loading":0!==this.layers.length||null!==(e=this.templateInfos)&&void 0!==e&&e.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((e,t)=>(0,f.X6)(t)?e+t.allItems.length:e+1),0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter((t=>(0,f.X6)(t)?t.items.length>0:e(t)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)(0,f.X6)(e)&&e.reapplyFilter()}select(e){var t;let{emit:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.selectedItem,n=(null===e||void 0===e?void 0:e.clone())||null;this._set("selectedItem",n),i&&this.emit("select",{item:n,oldItem:a,template:null!==(t=null===n||void 0===n?void 0:n.template)&&void 0!==t?t:null})}_createItem(e,t){return new y.default({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if((0,f.X6)(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[i,a]=(0,f.K_)(t),n=e=>{const t=i.get(e.template);return t?(i.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:r}=this,o=e.filter(_).map((e=>(0,f.wu)(e)?new v.default({filterFunction:r,label:e.label,allItems:e.templateInfos.filter(_).map((e=>n(e)))}):n(e)));for(const l of[...i.values(),...a])l.destroy();this._allItems=o}async _getTemplatesFromLayers(e){const t=[],i={signal:e};await Promise.all(this.layers.map((async a=>{var n;await(0,f.JS)(a,i),(0,l.throwIfAborted)(e);const r=null===(n=(0,h.BR)(a))||void 0===n?void 0:n.operations;(null===r||void 0===r?void 0:r.supportsEditing)&&(null===r||void 0===r?void 0:r.supportsAdd)&&((0,h.F2)(a)?t.push(...a.sublayers):t.push(a))})));const a=await(0,c.b)(t,this.view,e);(0,l.throwIfAborted)(e);const n=(0,f.zA)(a),r=this._groupByFunction;if(null==r)return n;const o=(0,f.AY)(n,r);return 1===o.length&&o[0].label===f._t.label?o[0].templateInfos:o}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=(0,n.UT)((async e=>{const t=await this._getTemplatesFromLayers(e);(0,l.throwIfAborted)(e),this._updateAllItems(t)}));this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function _(e){return(0,f.wu)(e)?e.templateInfos.some(_):!(0,c.w2)(e.template)||!1!==e.template.visible}(0,a._)([(0,d.MZ)()],g.prototype,"_allItems",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"_groupByFunction",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"_updatingHandles",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"disabled",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"disabledItemFunction",void 0),(0,a._)([(0,d.MZ)({value:null})],g.prototype,"filterFunction",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"groupBy",null),(0,a._)([(0,d.MZ)({value:[]})],g.prototype,"layers",null),(0,a._)([(0,d.MZ)()],g.prototype,"state",null),(0,a._)([(0,d.MZ)({readOnly:!0})],g.prototype,"numberOfFeatureTemplates",null),(0,a._)([(0,d.MZ)({readOnly:!0})],g.prototype,"items",null),(0,a._)([(0,d.MZ)({readOnly:!0})],g.prototype,"selectedItem",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"templateInfos",void 0),(0,a._)([(0,d.MZ)()],g.prototype,"updating",null),(0,a._)([(0,d.MZ)()],g.prototype,"view",void 0),g=(0,a._)([(0,u.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],g);const b=g},88084:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var a,n=i(35143),r=i(42553),o=i(46053),l=i(40565),s=(i(81806),i(47249),i(85842));function d(e){const{exifInfo:t,exifName:i,tagName:a}=e;if(!t||!i||!a)return null;const n=t.find((e=>e.name===i));return n?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const a=i.find((e=>e.name===t));return(null===a||void 0===a?void 0:a.value)||null}({tagName:a,tags:n.tags}):null}const u={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let p=a=class extends r.A{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=d({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return u[t]||null}clone(){return new a({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,n._)([(0,o.MZ)({type:String})],p.prototype,"contentType",void 0),(0,n._)([(0,o.MZ)()],p.prototype,"exifInfo",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],p.prototype,"orientationInfo",null),(0,n._)([(0,o.MZ)({type:l.jz})],p.prototype,"id",void 0),(0,n._)([(0,o.MZ)({type:String})],p.prototype,"globalId",void 0),(0,n._)([(0,o.MZ)({type:String})],p.prototype,"keywords",void 0),(0,n._)([(0,o.MZ)({type:String})],p.prototype,"name",void 0),(0,n._)([(0,o.MZ)({json:{read:!1}})],p.prototype,"parentGlobalId",void 0),(0,n._)([(0,o.MZ)({json:{read:!1}})],p.prototype,"parentObjectId",void 0),(0,n._)([(0,o.MZ)({type:l.jz})],p.prototype,"size",void 0),(0,n._)([(0,o.MZ)({json:{read:!1}})],p.prototype,"url",void 0),p=a=(0,n._)([(0,s.$)("esri.rest.query.support.AttachmentInfo")],p);const c=p},91656:(e,t,i)=>{i.d(t,{AY:()=>l,Ex:()=>s,JS:()=>d,K_:()=>u,X6:()=>p,_t:()=>n,wu:()=>r,zA:()=>o});var a=i(87663);const n={key:Symbol(),label:"Other\u200b"};function r(e){return"templateInfos"in e}function o(e){const t=[];for(const{layer:i,templates:a}of e)for(const e of a)t.push({layer:i,template:e});return t}function l(e,t){const i=new Map;for(const r of e){const e=t(r),{key:o,label:l}=null!=e.key?e:n;(0,a.tE)(i,o,(()=>({label:l,templateInfos:[]}))).templateInfos.push(r)}return Array.from(i.values())}function s(e,t){var i;return{label:null!==(i=e.title)&&void 0!==i?i:"",templateInfos:t.map((t=>({layer:e,template:t})))}}async function d(e,t){var i;return"subtype-sublayer"===e.type?await(null===(i=e.parent)||void 0===i?void 0:i.load(t)):await e.load(t),e}function u(e){const t=new Map,i=[];for(const a of e)if(p(a)){i.push(a);for(const e of a.items)t.set(e.template,e)}else t.set(a.template,a);return[t,i]}const p=e=>"items"in e},91913:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var a,n=i(35143),r=i(91967),o=i(68134),l=i(46053),s=(i(81806),i(76460),i(47249),i(85842));let d=a=class extends r.default{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,o.watch)((()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),o.initial))}get description(){var e;return null===(e=this.template)||void 0===e?void 0:e.description}set description(e){this.template&&(this.template.description=e)}get disabled(){var e,t;return null!==(e=null===(t=this.disabledFunction)||void 0===t?void 0:t.call(this,this))&&void 0!==e&&e}get label(){var e;return null===(e=this.template)||void 0===e?void 0:e.name}set label(e){this.template&&(this.template.name=e)}get id(){var e,t;return"".concat(null!==(e=this.label)&&void 0!==e?e:"","\u2013").concat(null===(t=this.layer)||void 0===t?void 0:t.id)}get supportsUpload(){var e;return"scene"===(null===(e=this.layer)||void 0===e?void 0:e.type)}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new a({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};(0,n._)([(0,l.MZ)()],d.prototype,"description",null),(0,n._)([(0,l.MZ)()],d.prototype,"disabled",null),(0,n._)([(0,l.MZ)()],d.prototype,"disabledFunction",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"label",null),(0,n._)([(0,l.MZ)()],d.prototype,"layer",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"template",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"thumbnail",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"id",null),(0,n._)([(0,l.MZ)()],d.prototype,"supportsUpload",null),d=a=(0,n._)([(0,s.$)("esri.widgets.FeatureTemplates.TemplateItem")],d);const u=d}}]);
//# sourceMappingURL=70179.962bd906.chunk.js.map