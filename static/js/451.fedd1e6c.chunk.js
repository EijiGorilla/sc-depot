"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[451],{451:(t,i,e)=>{e.r(i),e.d(i,{default:()=>N});var s=e(35143),r=(e(11265),e(91967)),o=e(19276),a=e(50076),n=e(76460),l=e(68134),d=e(46053),u=(e(81806),e(47249),e(85842)),h=e(19451),y=e(31933),c=e(24883),v=e(96422),p=e(38042),w=e(63860);const _=-2147208940,g=-2147217146,f=-2147220947;let k=class extends r.default{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new h.U,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new o.default}initialize(){const t=async()=>{this.messages||(this.messages=await(0,w.ud)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then((()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([(0,l.watch)((()=>[this.view,this.utilityNetwork]),(async()=>{var t,i;const{loadErrors:e,messages:{info:{noUtilityNetwork:s,noView:r}}}=this;this._initialValidationsFinished=!1,e.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,"utility"!==(null===(t=this.utilityNetwork)||void 0===t?void 0:t.type)&&(this.loadErrors.push(s),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-property",s)),this._validConstructProperties=!1),"2d"!==(null===(i=this.view)||void 0===i?void 0:i.type)&&(this.loadErrors.push(r),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-property",r)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch((t=>{n.A.getLogger(this).error(t),this._validConstructProperties=!1})),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()}),l.initial),(0,l.on)((()=>{var t;return null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.layers}),"change",(async()=>{const{loadErrors:t,messages:{info:{noUtilityNetwork:i}}}=this,e=t.find((t=>t===i));this._initialValidationsFinished=!1,e||(t.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0})),(0,p.oQ)(t)])}))}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:i}},utilityNetwork:e,view:s}=this;if(!this.loadErrors.length){var r;this._activeOperationDidSucceed=!1,this._set("executionError","");const o={gdbVersion:null===e||void 0===e?void 0:e.gdbVersion,outSpatialReference:(null===(r=s.spatialReference)||void 0===r?void 0:r.clone())||null,validateArea:"current"===this.extentToValidate?s.extent.clone():e.fullExtent.clone()};this._updatingHandles.addPromise(null===e||void 0===e?void 0:e.validateTopology(o).then((()=>{this._activeOperationDidSucceed=!0}),(e=>{var s;let r="Error: "+e;if(e instanceof a.default&&null!==(s=e.details)&&void 0!==s&&s.raw)switch(e.details.raw.extendedCode){case _:r=i;break;case g:case f:r=t;break;default:r=e.details.message}this._set("executionError",r)})))}}async _setDirtyAreasLayer(){var t,i;const{messages:{info:{noDirtyAreasLayer:e}}}=this,s=null===(t=this.view)||void 0===t?void 0:t.map.allLayers.items.filter((t=>(0,y.yZ)(t))).find((t=>{var i,e;return(null===(i=t.parsedUrl)||void 0===i?void 0:i.path)===(null===(e=this.utilityNetwork)||void 0===e?void 0:e.networkSystemLayers.dirtyAreasLayerUrl)}));s?(this._dirtyAreasLayer=s,await this._dirtyAreasLayer.load(),this._serverVersion=null!==(i=this._dirtyAreasLayer.version)&&void 0!==i?i:0,this._validConstructProperties=!0):(this.loadErrors.includes(e)||(this.loadErrors.push(e),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-layer",e))),this._validConstructProperties=!1)}async _validateNetworkExtension(){var t,i;const{messages:{info:{noAdvancedEditingUserTypeExtension:e,noUtilityNetworkServiceUserTypeExtension:s}}}=this,r=await(0,y.wI)(this.utilityNetwork.layerUrl),o=new c.default({url:r});await o.load();const l=null!==(t=null===(i=o.user)||void 0===i?void 0:i.username)&&void 0!==t?t:"",d=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await(0,v.RE)(o,l,d)){const t=Number(this._serverVersion)<=11.1?s:e;this.loadErrors.push(t),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:no-user-type-extension",t)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};(0,s._)([(0,d.MZ)()],k.prototype,"_initialValidationsFinished",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"_dirtyAreasLayer",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"_validConstructProperties",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],k.prototype,"executionError",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"extentToValidate",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"loadErrors",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"messages",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],k.prototype,"state",null),(0,s._)([(0,d.MZ)()],k.prototype,"utilityNetwork",null),(0,s._)([(0,d.MZ)()],k.prototype,"view",null),k=(0,s._)([(0,u.$)("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],k);const N=k},96422:(t,i,e)=>{e.d(i,{Kw:()=>o,RE:()=>n,Sl:()=>a});var s=e(55171),r=e(3825);async function o(t,i,e){var o;if(!(null===s.id||void 0===s.id?void 0:s.id.findCredential(t.restUrl)))return null;if("loaded"===t.loadStatus&&""===i&&null!==(o=t.user)&&void 0!==o&&o.sourceJSON&&!1===e)return t.user.sourceJSON;const a={responseType:"json",query:{f:"json"}};if(e&&(a.query.returnUserLicenseTypeExtensions=!0),""===i){const i=await(0,r.default)(t.restUrl+"/community/self",a);if(i.data){const t=i.data;if(null!==t&&void 0!==t&&t.username)return t}return null}const n=await(0,r.default)(t.restUrl+"/community/users/"+i,a);if(n.data){const t=n.data;return t.error?null:t}return null}async function a(t,i,e){var s,r;const a=await o(t,i,!0);return null!==(s=null===a||void 0===a||null===(r=a.privileges)||void 0===r?void 0:r.includes(e))&&void 0!==s&&s}async function n(t,i,e){var s,r;const a=await o(t,i,!0);return null!==(s=null===a||void 0===a||null===(r=a.userLicenseTypeExtensions)||void 0===r?void 0:r.includes(e))&&void 0!==s&&s}}}]);
//# sourceMappingURL=451.fedd1e6c.chunk.js.map