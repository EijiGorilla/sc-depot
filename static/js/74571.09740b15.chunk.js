"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[11688,35689,46510,74571],{11688:(t,e,o)=>{o.r(e),o.d(e,{default:()=>d});var i=o(35143),l=o(91967),a=o(46053),s=(o(81806),o(76460),o(47249),o(85842)),r=o(13312);let n=class extends l.default{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};(0,i._)([(0,a.MZ)()],n.prototype,"extent",void 0),(0,i._)([(0,a.MZ)()],n.prototype,"extraParameters",void 0),(0,i._)([(0,a.MZ)({type:r.default})],n.prototype,"outSpatialReference",void 0),(0,i._)([(0,a.MZ)()],n.prototype,"template",void 0),(0,i._)([(0,a.MZ)()],n.prototype,"updateDelay",void 0),(0,i._)([(0,a.MZ)()],n.prototype,"view",void 0),n=(0,i._)([(0,s.$)("esri.rest.support.PrintParameters")],n);const d=n},35689:(t,e,o)=>{o.r(e),o.d(e,{default:()=>f});var i=o(35143),l=o(55171),a=o(50076),s=o(42553),r=o(53514),n=o(50346),d=o(46053),u=(o(81806),o(76460),o(47249),o(6409)),p=o(85842),h=o(98662),c=o(92706),v=o(39907),m=o(94639);let y=class extends s.A{constructor(t){super(t),this.description=null,this.format=null,this.state="not-loaded",this.label=null,this.layoutInfoTaskUrl=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null,this.type=null}get id(){var t,e;return null!==(t=null===(e=this.layoutItem)||void 0===e?void 0:e.id)&&void 0!==t?t:"".concat(this.layout,"-").concat((0,r.d)(JSON.stringify(this.toJSON())))}get mapSurroundInfoOptions(){var t,e;const o=null===(t=this.layoutTemplateInfo)||void 0===t||null===(t=t.layoutOptions)||void 0===t?void 0:t.mapSurroundInfos;if(!o)return null;const i={northArrow:[],scaleBar:[],legend:[]};for(const l of o)switch(l.type){case"CIMMarkerNorthArrow":i.northArrow.push(l);break;case"CIMScaleLine":i.scaleBar.push(l);break;case"CIMGroupElement":(null===(e=l.elements)||void 0===e?void 0:e.some((t=>"CIMScaleLine"===t.type)))&&i.scaleBar.push(l);break;case"CIMLegend":i.legend.push(l)}return i}_updateLayoutOptions(t){var e,o,i,l,a,s,r,n,d,u,p;const h=null!==(e=null===(o=this.layoutOptions)||void 0===o?void 0:o.legend)&&void 0!==e?e:null===(i=t.layoutOptions)||void 0===i?void 0:i.hasLegend,c=null!==(l=null===(a=this.layoutOptions)||void 0===a?void 0:a.northArrow)&&void 0!==l?l:null!==(s=this.mapSurroundInfoOptions)&&void 0!==s&&s.northArrow.length?null===(r=this.mapSurroundInfoOptions)||void 0===r?void 0:r.northArrow.some((t=>{let{visible:e}=t;return e})):void 0,v=null!==(n=null===(d=this.layoutOptions)||void 0===d?void 0:d.scaleBar)&&void 0!==n?n:null!==(u=this.mapSurroundInfoOptions)&&void 0!==u&&u.scaleBar.length?null===(p=this.mapSurroundInfoOptions)||void 0===p?void 0:p.scaleBar.some((t=>{let{visible:e}=t;return e})):void 0;this._set("layoutOptions",{legend:h,northArrow:c,scaleBar:v})}async fetchLayoutItemTemplateInfo(t){const{layoutItem:e}=this;if(null!==e&&void 0!==e&&e.id&&!this.layoutTemplateInfo&&"loaded"!==this.state)try{this._set("state","loading");const o=this.layoutInfoTaskUrl;if(!o)throw new a.default("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:o});"public"!==e.access&&l.id&&await l.id.getCredential(o);const i={Layout_Item_ID:JSON.stringify({id:e.id})},s=(await(0,m.u)(o,i,t))[0];this.setLayoutTemplateInfo(s)}catch(o){this._set("state",(0,n.isAbortError)(o)?"not-loaded":"error")}}setLayoutTemplateInfo(t){this._set("layoutTemplateInfo",t),this._updateLayoutOptions(t),this._set("state","loaded")}};(0,i._)([(0,d.MZ)({json:{write:!0}})],y.prototype,"description",void 0),(0,i._)([(0,u.e)(c.U)],y.prototype,"format",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],y.prototype,"id",null),(0,i._)([(0,d.MZ)({readOnly:!0})],y.prototype,"state",void 0),(0,i._)([(0,d.MZ)({json:{write:!0}})],y.prototype,"label",void 0),(0,i._)([(0,d.MZ)()],y.prototype,"layoutInfoTaskUrl",void 0),(0,i._)([(0,d.MZ)({json:{read:v.r,write:!0}})],y.prototype,"layout",void 0),(0,i._)([(0,d.MZ)({type:h.default,json:{write:!0}})],y.prototype,"layoutItem",void 0),(0,i._)([(0,d.MZ)({readOnly:!0,json:{write:!0}})],y.prototype,"layoutOptions",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],y.prototype,"layoutTemplateInfo",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],y.prototype,"mapSurroundInfoOptions",null),(0,i._)([(0,d.MZ)()],y.prototype,"type",void 0),y=(0,i._)([(0,p.$)("esri.widgets.Print.CustomTemplate")],y);const f=y},46510:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});var i=o(35143),l=o(91967),a=o(53084),s=o(46053),r=(o(81806),o(76460),o(85842)),n=o(98662);let d=class extends l.default{constructor(t){super(t),this._abortController=null,this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.id=null,this.state="ready",this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=void 0,this.northArrowEnabled=void 0,this.scale=null,this.scaleBarEnabled=void 0,this.scaleEnabled=!1,this.title=null,this.width=null}async applyTemplate(t,e){var o,i,l,s,r,n,d,u,p,h,c,v,m;if((null===t||void 0===t?void 0:t.id)===this.id&&"error"!==(null===t||void 0===t?void 0:t.state))return;if(this._abortController&&(this._abortController.abort(),this._abortController=null),!t)return;if(this._set("state","pending"),this._resetMapSurroundInfoOptions(),this._set("id",t.id),this.set({layout:t.layout,layoutItem:t.layoutItem}),!t.layoutOptions&&t.layoutItem){const e=new AbortController;if(this._abortController=e,await t.fetchLayoutItemTemplateInfo({signal:this._abortController.signal}),"loaded"!==t.state){if("error"===t.state&&this._set("state","error"),this._abortController!==e)return;return void(this._abortController=null)}this._abortController=null}const y=null===e||void 0===e?void 0:e.customLayoutOptions,f=null!==(o=null!==(i=null===e||void 0===e?void 0:e.customTextElements)&&void 0!==i?i:null===(l=t.layoutTemplateInfo)||void 0===l||null===(l=l.layoutOptions)||void 0===l?void 0:l.customTextElements)&&void 0!==o?o:this.customTextElements;this.set({customTextElements:f?(0,a.clone)(f):void 0,format:null!==(s=this.format)&&void 0!==s?s:t.format,legendEnabled:null!==(r=null!==(n=null===y||void 0===y?void 0:y.legend)&&void 0!==n?n:null===(d=t.layoutOptions)||void 0===d?void 0:d.legend)&&void 0!==r?r:this.legendEnabled,northArrowEnabled:null!==(u=null!==(p=null===y||void 0===y?void 0:y.northArrow)&&void 0!==p?p:null===(h=t.layoutOptions)||void 0===h?void 0:h.northArrow)&&void 0!==u?u:this.northArrowEnabled,scaleBarEnabled:null!==(c=null!==(v=null===y||void 0===y?void 0:y.scaleBar)&&void 0!==v?v:null===(m=t.layoutOptions)||void 0===m?void 0:m.scaleBar)&&void 0!==c?c:this.scaleBarEnabled}),this._set("state","ready")}reset(){this._set("id",null),this._set("state","ready"),this.set({layout:null,layoutItem:null,customTextElements:null}),this._resetMapSurroundInfoOptions()}_resetMapSurroundInfoOptions(){this.set({legendEnabled:void 0,northArrowEnabled:void 0,scaleBarEnabled:void 0})}};(0,i._)([(0,s.MZ)()],d.prototype,"attributionEnabled",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"author",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"copyright",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"customTextElements",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"dpi",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"fileName",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"forceFeatureAttributes",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"format",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"height",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"includeTables",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],d.prototype,"id",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],d.prototype,"state",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"layout",void 0),(0,i._)([(0,s.MZ)({type:n.default})],d.prototype,"layoutItem",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"legendEnabled",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"northArrowEnabled",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"scale",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"scaleBarEnabled",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"scaleEnabled",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"title",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"width",void 0),d=(0,i._)([(0,r.$)("esri.widgets.Print.TemplateOptions")],d);const u=d},74571:(t,e,o)=>{o.r(e),o.d(e,{default:()=>$});var i=o(89379),l=o(35143),a=o(3825),s=o(18690),r=o(19276),n=o(50076),d=o(45802),u=o(53084),p=o(49304),h=o(50346),c=o(67993),v=o(68134),m=o(76931),y=o(31633),f=o(46053),_=(o(81806),o(76460),o(85842)),T=o(76797),w=o(13312),g=o(65256),b=o(38042),I=o(24883),O=o(36351),M=o(47437),k=o(27983),x=o(92706),Z=o(39907),S=o(11688),E=o(39778),C=o(28632),L=o(57308),P=o(91967),U=(o(47249),o(76099),o(54761));let A=class extends P.default{constructor(t){super(t),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return"rgba(".concat(this.strokeColor.join(),")")}get _strokeBackgroundStyle(){return"rgba(".concat(this.strokeBackgroundColor.join(),")")}get _fillStyle(){return"rgba(".concat(this.fillColor.join(),")")}get _backgroundFillStyle(){return"rgba(".concat(this.backgroundFillColor.join(),")")}render(){var t,e;const{backgroundWidth:o,backgroundHeight:i,boxWidth:l,boxHeight:a,padding:s}=this,r=s.left,n=s.top,d=null!==(t=this.x)&&void 0!==t?t:r+o/2-l/2,u=null!==(e=this.y)&&void 0!==e?e:n+i/2-a/2,p=d+l,h=u+a;return(0,U.K)("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},(0,U.K)("svg",{styles:{width:"100%",height:"100%"}},(0,U.K)("path",{d:"M ".concat(r," ").concat(n," L ").concat(o+r," ").concat(n," L ").concat(o+r," ").concat(i+n," L ").concat(r," ").concat(i+n," Z M ").concat(d," ").concat(u," L ").concat(d," ").concat(h," L ").concat(p," ").concat(h," L ").concat(p," ").concat(u," Z"),fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),(0,U.K)("rect",{fill:this._fillStyle,height:a,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:l,x:d,y:u})))}renderCanvas(){}};(0,l._)([(0,f.MZ)()],A.prototype,"strokeDash",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"strokeWidth",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"strokeColor",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"strokeBackgroundColor",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"fillColor",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"backgroundFillColor",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"visible",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"isDecoration",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"boxWidth",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"boxHeight",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"backgroundWidth",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"backgroundHeight",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"x",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"y",void 0),(0,l._)([(0,f.MZ)()],A.prototype,"padding",void 0),(0,l._)([(0,f.MZ)({readOnly:!0})],A.prototype,"_strokeStyle",null),(0,l._)([(0,f.MZ)({readOnly:!0})],A.prototype,"_strokeBackgroundStyle",null),(0,l._)([(0,f.MZ)({readOnly:!0})],A.prototype,"_fillStyle",null),(0,l._)([(0,f.MZ)({readOnly:!0})],A.prototype,"_backgroundFillStyle",null),A=(0,l._)([(0,_.$)("esri.views.overlay.BoxOverlayItem")],A);const H=A;var B=o(35689),D=o(46510),F=o(94639);const W=[30,144,255,255],j=[237,211,23,255],R=[216,48,32,255],J=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),N=/(\/GPServer\/).+/i,G=new d.J({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),z=r.default.ofType(B.default);function V(t,e,o){e&&e.visible!==o&&t.layoutOptions&&(t.layoutOptions.elementOverrides?t.layoutOptions.elementOverrides[e.name]={visible:o}:t.layoutOptions.elementOverrides={[e.name]:{visible:o}})}let q=class extends p.A{constructor(t){super(t),this._serviceTemplateCustomTextElements=null,this._templateIdToCustomTemplate=new c.A,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this._customLayoutOptions=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new z,this.defaultTemplates=new z,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.outSpatialReference=null,this.portal=I.default.getDefault(),this.portalTemplateIds=[],this.printServiceTemplates=new z,this.defaultTemplate=null,this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new D.default}initialize(){this.addHandles([(0,v.watch)((()=>[this.showPrintAreaEnabled,this.view]),(()=>{var t;this.showPrintAreaEnabled?this._enablePrintPreview():(this.removeHandles("overlay-handler"),null===(t=this.view)||void 0===t||null===(t=t.overlay)||void 0===t||t.removeItem(this._getOverlayItem()))})),(0,v.watch)((()=>[this.templateOptions.layout,this.templateOptions.layoutItem]),(()=>{this.loaded&&this._processTemplateOptions()}))])}destroy(){var t;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&(null!==(t=this.view.overlay)&&void 0!==t&&t.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){var t;return null!==(t=this.printServiceUrl)&&void 0!==t?t:null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const t=(0,u.clone)(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach((e=>{const o=t[e];if(o){var i;const t=null===(i=this.templateCustomTextElements)||void 0===i?void 0:i[e];o.forEach((e=>{const[o]=Object.entries(e)[0];null===t||void 0===t||t.forEach((t=>{const[i,l]=Object.entries(t)[0];o===i&&(e[o]=l)}))}))}})),Object.freeze(t)}get state(){var t;return"loading"===this.loadStatus?"initializing":"failed"===this.loadStatus||this.error?"error":"loaded"===this.loadStatus&&null!==(t=this.view)&&void 0!==t&&t.ready?"ready":"disabled"}async load(t){return this.addResolvingPromise(this._loadResources(t).catch((t=>this.error=t))),this}async print(t){const{view:e,extraParameters:o,updateDelay:i,outSpatialReference:l}=this;if(!e)throw new n.default("print:view-required","view is not set");!function(t){var e,o,i;if(null!==(e=t.layoutOptions)&&void 0!==e||(t.layoutOptions={}),null!==(i=(o=t.layoutOptions).customTextElements)&&void 0!==i||(o.customTextElements=[]),!t.layoutOptions.customTextElements.find((t=>"date"in t))){const{customTextElements:e}=t.layoutOptions;let o=(0,g.Yq)(Date.now(),(0,g.J2)("short-date"));"ar"===(0,b.Z0)()&&(o="\u200f"+o),e.push({date:o})}}(t);const a=this._getOverlayItem(),s=t.scalePreserved||!this.showPrintAreaEnabled?void 0:(0,C.Z7)(new T.default,e.viewpoint,"map-only"===t.layout?[t.exportOptions.width,t.exportOptions.height]:[a.boxWidth,a.boxHeight]),r=new S.default({view:e,template:t,extent:s,extraParameters:o,updateDelay:i,outSpatialReference:l});try{var d;const e=!(null===(d=t.layoutItem)||void 0===d||!d.id)&&(this.portalTemplateIds.includes(t.layoutItem.id)||this.browseTemplates.some((e=>{var o,i;return(null===(o=e.layoutItem)||void 0===o?void 0:o.id)===(null===(i=t.layoutItem)||void 0===i?void 0:i.id)})));return await(0,k.execute)(e&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,r,{timeout:this.printTimeout})}catch(u){throw new n.default("print:export-error","An error occurred while exporting the web map.",{error:u})}}toPrintTemplate(t){let{attributionEnabled:e,author:o,copyright:i,customTextElements:l,dpi:a,forceFeatureAttributes:s,format:r,height:d,id:u,includeTables:p,layout:h,layoutItem:c,legendEnabled:v,northArrowEnabled:m,scale:y,scaleBarEnabled:f,scaleEnabled:_,title:T,width:w}=t;if(!h&&!c)throw new n.default("print:layout-required","layout is not set");const g=new E.default({attributionVisible:e,forceFeatureAttributes:s,format:r,includeTables:p,layout:h,layoutItem:c,layoutOptions:{authorText:o||"",copyrightText:i||"",customTextElements:l,titleText:T||""},outScale:null!==y&&void 0!==y?y:0,scalePreserved:_});if(w&&(g.exportOptions.width=w),d&&(g.exportOptions.height=d),a&&(g.exportOptions.dpi=a),g.layoutOptions){var b;v||(g.layoutOptions.legendLayers=[]);const t=null===(b=this.getLayoutTemplateById(u))||void 0===b?void 0:b.mapSurroundInfoOptions;if(t){const e=t.northArrow;for(const t of e)V(g,t,m);const o=t.scaleBar;for(const t of o)V(g,t,f);const i=t.legend;for(const t of i)V(g,t,v)}}return g}getLayoutTemplateById(t){return t?this._templateIdToCustomTemplate.get(t):null}async addPortalTemplate(t){if(!this.portal||null===t||void 0===t||!t.id)return;try{t.loaded||await t.load()}catch(o){return void this.applyTemplate(this.defaultTemplate)}const e=new B.default({type:"browse-template",layoutInfoTaskUrl:this._layoutInfoTaskUrl,label:t.title,layoutItem:t});this._templateIdToCustomTemplate.set(e.id,e),this.browseTemplates.add(e)}removePortalTemplate(t){t.layoutItem&&this.templateOptions.id===t.layoutItem.id&&(this.defaultTemplate?this.applyTemplate(this.defaultTemplate):this.templateOptions.reset()),this.browseTemplates.remove(t),this._templateIdToCustomTemplate.delete(t.id)}async applyTemplate(t){var e,o,i;if(!t)return void this.templateOptions.reset();!t.layout||!this.templatesInfo||this.templatesInfo.layout.choiceList.includes(t.layout)||(this.defaultTemplate?t=this.defaultTemplate:this.templateOptions.reset());const l=t.layout||(null===(e=t.layoutItem)||void 0===e?void 0:e.id),a=l?null===(o=this.templateCustomTextElements)||void 0===o?void 0:o[l]:void 0;if(await this.templateOptions.applyTemplate(t,{customTextElements:a,customLayoutOptions:this._customLayoutOptions}),l&&this._serviceTemplateCustomTextElements&&!this._serviceTemplateCustomTextElements[l]&&null!==(i=t.layoutTemplateInfo)&&void 0!==i&&null!==(i=i.layoutOptions)&&void 0!==i&&i.customTextElements){const e=(0,u.clone)(this._serviceTemplateCustomTextElements);e[l]=t.layoutTemplateInfo.layoutOptions.customTextElements,this._serviceTemplateCustomTextElements=Object.freeze(e)}}async _loadResources(t){if(this.destroyed)return;await this._loadUrls(t);const[e,o]=await Promise.all([this._getLayoutToLayoutTemplateInfos(t),this._getPrintServiceTemplatesInfo(t)]);await this._loadAllTemplates(e,o,t),this._processPrintServiceTemplatesInfo(o),await this._processTemplateOptions(),this._updateOverLayItem()}async _processTemplateOptions(){const{layout:t,layoutItem:e}=this.templateOptions;if("map-only"!==t&&!this.templateOptions.id)if(this._customLayoutOptions={legend:this.templateOptions.legendEnabled,northArrow:this.templateOptions.northArrowEnabled,scaleBar:this.templateOptions.scaleBarEnabled},null!==e&&void 0!==e&&e.id){try{e.loaded||await e.load()}catch(i){return void this.applyTemplate(this.defaultTemplate)}let t=this._templateIdToCustomTemplate.get(e.id);t||(t=new B.default({label:e.title,layoutItem:e,layoutInfoTaskUrl:this._layoutInfoTaskUrl}),this._templateIdToCustomTemplate.set(t.id,t)),await this.applyTemplate(t)}else if(t){var o;const t=null!==(o=this.defaultTemplates.find((t=>t.layout===this.templateOptions.layout)))&&void 0!==o?o:this.printServiceTemplates.find((t=>t.layout===this.templateOptions.layout));await this.applyTemplate(null!==t&&void 0!==t?t:this.defaultTemplate)}}async _loadPortal(t){try{await this.portal.load(t)}catch(e){throw new n.default("print:could-not-load-portal","Cannot load print resource information from portal",{error:e,url:this.effectivePrintServiceUrl})}}async _loadUrls(t){var e;if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{var o,i;await this._loadPortal(t);const{printTask:e,asyncPrintTask:l,layoutInfoTask:a}=null!==(o=null===(i=this.portal)||void 0===i?void 0:i.helperServices)&&void 0!==o?o:{};this._set("effectivePrintServiceUrl",null===e||void 0===e?void 0:e.url),this._asyncPrintTaskUrl=null===l||void 0===l?void 0:l.url,await this._updateLayoutInfoTaskUrl((null===a||void 0===a?void 0:a.url)||this.effectivePrintServiceUrl)}const l=null===(e=this.effectivePrintServiceUrl)||void 0===e?void 0:e.toLowerCase().split("/");if(null===l||void 0===l||!l.includes("gpserver"))throw new n.default("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl})}async _updateLayoutInfoTaskUrl(t,e){if(!t)return;const o=(await(0,k.getTasks)(t,e)).find((t=>t.includes("Get Layout Templates Info")));o&&(this._layoutInfoTaskUrl=t.replace(N,"$1".concat(encodeURI(o))))}_getPortalDefaultTemplates(t,e){var o,i;return null!==(o=null===(i=this.portal)||void 0===i||null===(i=i.helperServices)||void 0===i||null===(i=i.printTask)||void 0===i||null===(i=i.templates)||void 0===i||null===(i=i.filter((t=>"map_only"!==t.layout.toLowerCase()&&(!e||e.includes((0,Z.r)(t.layout))))))||void 0===i?void 0:i.map((e=>{const o=B.default.fromJSON(e);if(o.type="default-template",o.layoutInfoTaskUrl=this._layoutInfoTaskUrl,o.layout){const e=t.get(o.layout);e&&o.setLayoutTemplateInfo(e)}return o})))&&void 0!==o?o:[]}async _getPortalCustomTemplates(t){var e;if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:o,user:i}=this.portal,l=M.oQ.test(this.portal.url),a=null===i||void 0===i?void 0:i.userLicenseTypeId,s=a&&J.has(a);if(!o||l&&!s)return[];const r=new O.default({query:o,disableExtraQuery:!0}),n=await this.portal.queryGroups(r,t);if(!n.total)return[];const d=n.results[0],u=new O.default({num:100,query:"type:Layout",sortField:d.sortField,sortOrder:null!==(e=d.sortOrder)&&void 0!==e?e:void 0}),p=(await d.queryItems(u,t)).results;return p.length?p.map((t=>(this.portalTemplateIds.push(t.id),new B.default({type:"default-template",label:t.title,layoutItem:t,layoutInfoTaskUrl:this._layoutInfoTaskUrl})))):[]}async _loadAllTemplates(t,e,o){var i;let l=!1;const a=null===e||void 0===e||null===(i=e.layout)||void 0===i?void 0:i.choiceList;if(this.includeDefaultTemplates&&this.portal&&!this.printServiceUrl){const e=this._getPortalDefaultTemplates(t,a);l=!!e.length,this.defaultTemplates.addMany(e);const i=await this._getPortalCustomTemplates(o);this.defaultTemplates.addMany(i);for(const t of this.defaultTemplates)this._templateIdToCustomTemplate.set(t.id,t)}l||t.forEach(((t,e)=>{if(!a||a.includes(e)){const o=new B.default({type:"print-service-template",layout:e,layoutInfoTaskUrl:this._layoutInfoTaskUrl});o.setLayoutTemplateInfo(t),this.printServiceTemplates.add(o),this._templateIdToCustomTemplate.set(o.id,o)}}))}_processPrintServiceTemplatesInfo(t){var e;this._set("templatesInfo",t);const o=null===t||void 0===t||null===(e=t.layout)||void 0===e?void 0:e.defaultValue;if(o&&"map-only"!==o){var i,l,a;const t=null!==(i=null!==(l=null!==(a=this.defaultTemplates.find((t=>t.layout===o)))&&void 0!==a?a:this.printServiceTemplates.find((t=>t.layout===o)))&&void 0!==l?l:this.defaultTemplates.at(0))&&void 0!==i?i:this.printServiceTemplates.at(0);this._set("defaultTemplate",t)}}async _getLayoutToLayoutTemplateInfos(t){const e=await(0,F.u)(this._layoutInfoTaskUrl,void 0,t),o=new Map,i={};for(const l of e){const t=(0,Z.r)(l.layoutTemplate);o.set(t,l),i[t]=l.layoutOptions.customTextElements}return this._serviceTemplateCustomTextElements=Object.freeze(i),o}async _getPrintServiceTemplatesInfo(t){let e;try{({data:e}=await(0,a.default)(this.effectivePrintServiceUrl,(0,i.A)((0,i.A)({},t),{},{query:{f:"json"},timeout:this.printTimeout})))}catch(H){throw(0,h.isAbortError)(H)?H:new n.default("print:unavailable-service-info","Can't fetch templates info from service",{error:H})}const{parameters:o}=e,l=o.find((t=>{let{name:e}=t;return"Format"===e})),s=o.find((t=>{let{name:e}=t;return"Layout_Template"===e}));return{format:this._getFormat(l),layout:this._getLayout(s)}}_getFormat(t){const e="all"===this.allowedFormats?t.choiceList:t.choiceList.filter((t=>"string"!=typeof this.allowedFormats&&this.allowedFormats.some((e=>new RegExp("\\b".concat(e,"\\b"),"i").test(t))))),o=(e.length?e:t.choiceList).map((t=>x.U.fromJSON(t))).filter(s.Ru),i=x.U.fromJSON(t.defaultValue),l=o.some((t=>new RegExp("\\b".concat(i,"\\b"),"i").test(t)))?i:o[0];return{choiceList:o,defaultValue:l}}_getLayout(t){var e,o;const i=t.choiceList.filter((t=>"map_only"!==t.toLowerCase())),l="all"===this.allowedLayouts?i:i.filter((t=>this.allowedLayouts.includes((0,Z.r)(t)))),a=(l.length?l:i).map(Z.r).filter(s.Ru),r=(0,Z.r)(t.defaultValue),n=a.includes(r)?r:null!==(e=null!==(o=a.find((t=>/(?=.*letter)(?=.*landscape)/i.test(t))))&&void 0!==o?o:a.find((t=>/(?=.*a4)(?=.*landscape)/i.test(t))))&&void 0!==e?e:a[0];return{choiceList:a,defaultValue:n}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new H({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var t,e,o;if(null===(t=this.view)||void 0===t||!t.overlay)return;const i=this.templateOptions,l=this._getOverlayItem();this.addHandles([(0,v.watch)((()=>{var t,e,o,l;return[i.width,i.height,i.scaleEnabled,i.scale,i.layout,i.layoutItem,i.id,i.state,null===(t=this.view)||void 0===t?void 0:t.scale,null===(e=this.view)||void 0===e?void 0:e.size,null===(o=this.view)||void 0===o?void 0:o.state.paddedViewState.size,null===(l=this.view)||void 0===l?void 0:l.state.padding,this.loaded]}),(()=>this._updateOverLayItem()),v.initial),null===(e=this.view)||void 0===e?void 0:e.on("drag",["Shift"],(t=>this._handleDrag(t)),L.o.WIDGET),null===(o=this.view)||void 0===o?void 0:o.on("key-down",["Escape"],(()=>this._resetDrag()),L.o.WIDGET)],"overlay-handler"),this.view.overlay.addItem(l)}_updateOverLayItem(){var t,e;if(!this.view)return;const o=this.templateOptions,i=this._getOverlayItem(),l=null!==(t=null===(e=o.layoutItem)||void 0===e?void 0:e.id)&&void 0!==t?t:o.layout,a=this.view,s=a.spatialReference,[r,n]=a.state.paddedViewState.size,d=a.state.padding;let u=0,p=0;if("map-only"===l)null!=o.width&&null!=o.height&&(u=o.width,p=o.height);else if(l){var h;const t=o.id?this._templateIdToCustomTemplate.get(o.id):null,{webMapFrameSize:e,pageUnits:i}=null!==(h=null===t||void 0===t?void 0:t.layoutTemplateInfo)&&void 0!==h?h:{};let l=!1;if(e&&i)if(this._isFreeHand){const t=e[0]/e[1];u=this._freeHandWidth,p=this._freehandHeight,u>p?p=u/t:u=p*t}else{const t=G.fromJSON(i.toLowerCase()),o=s.unit;(0,y.t$)(t)===(0,y.t$)(o)?(u=(0,y.oU)(e[0],t,o),p=(0,y.oU)(e[1],t,o)):(l=!0,u=e[0],p=e[1])}if(!this._isFreeHand)if(o.scaleEnabled&&o.scale){const t=l?Math.min(r/u,n/p):(0,y.GA)(s)*y.dy*o.dpi;u*=t,p*=t}else if(0===u||0===p)u=r,p=n;else{const t=(r-.1*r)/u,e=(n-.1*n)/p,o=Math.min(t,e);u*=o,p*=o}}const{scaleEnabled:c,scale:v}=o,m=c&&v?v/this.view.scale:1;if(i.boxWidth=u*m||r,i.boxHeight=p*m||n,d&&(i.padding=d),i.backgroundWidth=null!==r&&void 0!==r?r:0,i.backgroundHeight=null!==n&&void 0!==n?n:0,"loading"===this.loadStatus)i.strokeColor=j;else if("loaded"===this.loadStatus)switch(this.templateOptions.state){case"pending":i.strokeColor=j;break;case"ready":i.strokeColor=W;break;case"error":i.strokeColor=R}}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(t){switch(t.action){case"start":this._start();break;case"update":this._update(t);break;case"end":this._end()}t.stopPropagation()}_start(){this._isFreeHand=!0}_update(t){const e=this._getOverlayItem(),{x:o,y:i}=t,{x:l,y:a}=t.origin;o>l?(e.x=l,e.boxWidth=o-l):(e.x=o,e.boxWidth=l-o),i>a?(e.y=a,e.boxHeight=i-a):(e.y=i,e.boxHeight=a-i)}_end(){const t=this._getOverlayItem();if(!this.view||null==t.x||null==t.y)return;const e=this.view,o=e.toMap((0,m.tc)(t.x+.5*t.boxWidth,t.y+.5*t.boxHeight));t.x=null,t.y=null,e.goTo({center:o}),this._freeHandWidth=t.boxWidth,this._freehandHeight=t.boxHeight,"map-only"===this.templateOptions.layout&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};(0,l._)([(0,f.MZ)()],q.prototype,"_serviceTemplateCustomTextElements",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"_templateIdToCustomTemplate",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"allowedFormats",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"allowedLayouts",void 0),(0,l._)([(0,f.MZ)({type:z})],q.prototype,"browseTemplates",void 0),(0,l._)([(0,f.MZ)({type:z})],q.prototype,"defaultTemplates",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"error",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"extraParameters",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"includeDefaultTemplates",void 0),(0,l._)([(0,f.MZ)({readOnly:!0})],q.prototype,"effectivePrintServiceUrl",null),(0,l._)([(0,f.MZ)()],q.prototype,"effectiveTemplateCustomTextElements",null),(0,l._)([(0,f.MZ)({type:w.default})],q.prototype,"outSpatialReference",void 0),(0,l._)([(0,f.MZ)({type:I.default})],q.prototype,"portal",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"portalTemplateIds",void 0),(0,l._)([(0,f.MZ)({type:z})],q.prototype,"printServiceTemplates",void 0),(0,l._)([(0,f.MZ)({readOnly:!0})],q.prototype,"defaultTemplate",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"showPrintAreaEnabled",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"printServiceUrl",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"printTimeout",void 0),(0,l._)([(0,f.MZ)({readOnly:!0})],q.prototype,"state",null),(0,l._)([(0,f.MZ)({readOnly:!0})],q.prototype,"templatesInfo",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"updateDelay",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"view",void 0),(0,l._)([(0,f.MZ)()],q.prototype,"templateCustomTextElements",void 0),(0,l._)([(0,f.MZ)({type:D.default})],q.prototype,"templateOptions",void 0),q=(0,l._)([(0,_.$)("esri.widgets.Print.PrintViewModel")],q);const $=q},94639:(t,e,o)=>{o.d(e,{u:()=>r});var i=o(50076),l=o(27983),a=o(11392),s=o(6196);async function r(t,e,o){if(!t)throw new i.default("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:t});if("async"===await(0,l.getMode)(t)){const i=await(0,s.O)(t,e,void 0,o||void 0);return await i.waitForJobCompletion(),(await i.fetchResultData("Output_JSON")).value}return(await(0,a.g)(t,e,null,o)).results[0].value}}}]);
//# sourceMappingURL=74571.09740b15.chunk.js.map