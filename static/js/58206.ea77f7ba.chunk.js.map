{"version":3,"file":"static/js/58206.ea77f7ba.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/analysis/Viewshed.js","../node_modules/@arcgis/core/analysis/featureReferenceUtils.js","../node_modules/@arcgis/core/analysis/ViewshedAnalysis.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import{featureReferenceEquals as r,featureReferenceProperty as i}from\"./featureReferenceUtils.js\";import o from\"../core/Clonable.js\";import{cyclicalDegrees as t}from\"../core/Cyclical.js\";import s from\"../core/JSONSupport.js\";import{equalsMaybe as a}from\"../core/maybe.js\";import{property as l}from\"../core/accessorSupport/decorators/property.js\";import{cast as n}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/has.js\";import\"../core/RandomLCG.js\";import{subclass as p}from\"../core/accessorSupport/decorators/subclass.js\";import{ensureNumber as c}from\"../core/accessorSupport/ensureType.js\";import m from\"../geometry/Point.js\";let u=class extends(s.JSONSupportMixin(o)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45,this.feature=null}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return a(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView&&r(this.feature,e.feature)}};e([l({type:m,json:{write:{isRequired:!0}}})],u.prototype,\"observer\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],u.prototype,\"farDistance\",void 0),e([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),n((e=>t.normalize(c(e),void 0,!0)))],u.prototype,\"heading\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,\"tilt\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}})],u.prototype,\"horizontalFieldOfView\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,\"verticalFieldOfView\",void 0),e([l(i)],u.prototype,\"feature\",void 0),e([l({json:{read:!1}})],u.prototype,\"isValid\",null),u=e([p(\"esri.analysis.Viewshed\")],u);const d=u;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{a as e,l as t,b as r}from\"../chunks/vec32.js\";import{create as n}from\"../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as l,fromPoints as o}from\"../geometry/support/ray.js\";import{StoreResults as i}from\"../views/3d/webgl-engine/lib/IntersectorInterfaces.js\";import{toGraphic as u,hasLod as s,getIntersectedFeatureBSRadius as a}from\"../views/3d/webgl-engine/lib/intersectorUtilsConversions.js\";function c(e,t){return d(e)===d(t)}function d(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:\"\";let r=null;return r=null!=e.objectId?e.objectId:null!=e.layer&&\"objectIdField\"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==r?null:`o-${t}-${r}`}const b={json:{write:{writer:f,target:{\"feature.layerId\":{type:[Number,String],isRequired:!0},\"feature.objectId\":{type:[Number,String],isRequired:!0}}},origins:{\"web-scene\":{read:I}}}};function f(e,t){null!=e?.layer?.objectIdField&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function I(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:\"ObjectId\"},attributes:{ObjectId:e.objectId}}}function m(l,s,a,c){const{sceneIntersectionHelper:b}=l,{observer:f,observerFeatureId:I,targetFeatureId:m,target:g}=a;if(null==I&&null==m)return;c||(c=e=>e),e(p,f,g);const v=t(p),S=1;r(p,f,p,S/v);const F=o(p,g,y);s.options.store=i.ALL,b.intersectToolIntersectorRay(F,s);let N=null,w=null,R=null,A=null;for(const e of s.results.all){const t=u(e,l);if(null==t||null==e.distanceInRenderSpace)continue;const r=d(t);null!=r&&(null!=I&&r===I&&(N??=c(j(e,l,v)),e.distanceInRenderSpace-S<N&&(R=e)),null!=m&&r===m&&(w??=c(j(e,l,v)),null==A&&e.distanceInRenderSpace-S<v&&v-e.distanceInRenderSpace+S<w&&(A=e)))}const{observerAdjusted:T,targetAdjusted:h}=a;R?.getIntersectionPoint(T)?a.observerSurfaceNormal=R.getTransformedNormal(n()):a.observerSurfaceNormal=null,A?.getIntersectionPoint(h)?a.targetSurfaceNormal=A.getTransformedNormal(n()):a.targetSurfaceNormal=null}function j(e,t,r){if(s(e)){const n=a(e,t);if(null!=n)return Math.min(n*g,r)}return 1e-5*r}const g=.05,y=l(),p=n();export{c as featureReferenceEquals,b as featureReferenceProperty,d as getFeatureId,m as updatePointsFromFeatureReference};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"./Analysis.js\";import r from\"./Viewshed.js\";import n from\"../core/Collection.js\";import{referenceSetter as s,castForReferenceSetter as i}from\"../core/collectionUtils.js\";import{cyclicalDegrees as o}from\"../core/Cyclical.js\";import{deg2rad as l,clamp as a}from\"../core/mathUtils.js\";import{watch as p,syncAndInitial as c}from\"../core/reactiveUtils.js\";import{property as u}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/Logger.js\";import\"../core/RandomLCG.js\";import{subclass as m}from\"../core/accessorSupport/decorators/subclass.js\";import d from\"../geometry/Extent.js\";import{projectOrLoadMany as h}from\"../geometry/projection.js\";const f=n.ofType(r);let x=class extends t{constructor(e){super(e),this.type=\"viewshed\",this._extent=null}initialize(){this.addHandles(p((()=>this._computeExtent()),(e=>{null==e.pending&&(this._extent=e.extent)}),c))}get viewsheds(){return this._get(\"viewsheds\")||new f}set viewsheds(e){this._set(\"viewsheds\",s(e,this.viewsheds,f))}get spatialReference(){for(const e of this.viewsheds)if(null!=e.observer)return e.observer.spatialReference;return null}get extent(){return this._extent}get requiredPropertiesForEditing(){return this.viewsheds.items.map((({observer:e})=>e))}async waitComputeExtent(){const e=this._computeExtent();null!=e.pending&&await e.pending}_computeExtent(){const{spatialReference:e}=this;if(null==e)return{pending:null,extent:null};const t=this.viewsheds.filter((e=>null!=e.observer)),r=t.map((e=>e.observer)).toArray(),n=h(r,e);if(null!=n.pending)return{pending:n.pending,extent:null};return{pending:null,extent:n.geometries.map(((e,r)=>{const n=t.at(r);return null!=e&&null!=n?this._computeViewshedExtent(this.viewsheds.at(r),e):null})).filter((e=>null!=e)).reduce(((e,t)=>y(e,t)),null)}}_computeViewshedExtent(e,t){const{farDistance:r,heading:n,tilt:s,horizontalFieldOfView:i,verticalFieldOfView:p}=e,{spatialReference:c}=t,u=i/2,m=p/2,h=r/c.metersPerUnit,f=[o.normalize(n-u),n,o.normalize(n+u)],x=d.fromPoint(t),y=e=>{const t=f.map((t=>o.normalize(t-e)));if(t[0]>t[2]||360===i)return h;const r=t.map((e=>Math.abs(e>180?360-e:e))).reduce(((e,t)=>e>t?t:e));return r>90?0:h*Math.cos(l(r))};x.xmax+=y(90),x.xmin-=y(-90),x.ymax+=y(0),x.ymin-=y(180);const w=t.z;if(null!=w){let e=w,t=w;const n=s-90,i=a(n+m,-90,90),o=a(n-m,-90,90),l=c?.isGeographic?r:h;e+=l*g(i),t+=l*g(o);const p=v(m)*l,d=g(n)*p*(1-v(u));s<90&&(e-=d),s>90&&(t-=d),x.zmax=Math.max(e,w),x.zmin=Math.min(t,w)}return x}clear(){this.viewsheds.removeAll()}};function y(e,t){return null==e?t:null==t?e:e.union(t)}function v(e){return Math.cos(l(e))}function g(e){return Math.sin(l(e))}e([u({type:[\"viewshed\"]})],x.prototype,\"type\",void 0),e([u({cast:i,type:f,nonNullable:!0})],x.prototype,\"viewsheds\",null),e([u({readOnly:!0})],x.prototype,\"spatialReference\",null),e([u()],x.prototype,\"_extent\",void 0),e([u({readOnly:!0})],x.prototype,\"extent\",null),e([u({readOnly:!0})],x.prototype,\"requiredPropertiesForEditing\",null),x=e([m(\"esri.analysis.ViewshedAnalysis\")],x);const w=x;export{w as default};\n"],"names":["u","s","JSONSupportMixin","o","constructor","e","super","this","observer","farDistance","heading","tilt","horizontalFieldOfView","verticalFieldOfView","feature","isValid","equals","a","r","l","type","m","json","write","isRequired","prototype","Number","nonNullable","range","min","n","t","normalize","c","max","i","read","p","d","layer","id","objectId","objectIdField","attributes","uid","concat","b","writer","_e$layer","layerId","target","String","origins","ObjectId","_R","_A","sceneIntersectionHelper","f","observerFeatureId","I","targetFeatureId","g","v","F","y","options","store","ALL","intersectToolIntersectorRay","N","w","R","A","results","all","distanceInRenderSpace","j","observerAdjusted","T","targetAdjusted","h","getIntersectionPoint","observerSurfaceNormal","getTransformedNormal","targetSurfaceNormal","Math","ofType","x","_extent","initialize","addHandles","_computeExtent","pending","extent","viewsheds","_get","_set","spatialReference","requiredPropertiesForEditing","items","map","_ref","waitComputeExtent","filter","toArray","geometries","at","_computeViewshedExtent","reduce","union","metersPerUnit","fromPoint","abs","cos","xmax","xmin","ymax","ymin","z","isGeographic","zmax","zmin","clear","removeAll","sin","cast","readOnly"],"sourceRoot":""}