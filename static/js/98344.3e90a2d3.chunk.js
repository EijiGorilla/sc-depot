"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[98156,98344],{43543:(t,e,i)=>{i.d(e,{F:()=>r});var n=i(98156);function r(t,e,i){if(null==(null===t||void 0===t?void 0:t.timeInfo))return null;const{datesInUnknownTimezone:r=!1,timeOffset:s,useViewTime:a}=t;let l=t.timeExtent;r&&(l=(0,n.toLocalTimeExtent)(l));let o=a?e&&l?e.intersection(l):e||l:l;return!o||o.isEmpty||o.isAllTime?o:(s&&(o=o.offset(-s.value,s.unit)),r&&(o=(0,n.toUTCTimeExtent)(o)),o.equals(i)?i:o)}},47777:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(35143),r=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),a=i(1420),l=i(43543);const o=t=>{let e=class extends t{initialize(){this.exportImageParameters=new a.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var t,e;return null!==(t=null===(e=this.view)||void 0===e?void 0:e.floors)&&void 0!==t?t:null}get exportImageVersion(){var t;return null!==(t=this.exportImageParameters)&&void 0!==t&&t.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var t;return(0,l.F)(this.layer,null===(t=this.view)||void 0===t?void 0:t.timeExtent,this._get("timeExtent"))}canResume(){var t;return!!super.canResume()&&!(null!==(t=this.timeExtent)&&void 0!==t&&t.isEmpty)}};return(0,n._)([(0,r.MZ)()],e.prototype,"exportImageParameters",void 0),(0,n._)([(0,r.MZ)({readOnly:!0})],e.prototype,"floors",null),(0,n._)([(0,r.MZ)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,n._)([(0,r.MZ)()],e.prototype,"layer",void 0),(0,n._)([(0,r.MZ)()],e.prototype,"suspended",void 0),(0,n._)([(0,r.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),e=(0,n._)([(0,s.$)("esri.views.layers.MapImageLayerView")],e),e}},70822:(t,e,i)=>{i.d(e,{A:()=>h});var n=i(35143),r=(i(76460),i(81806),i(47249),i(50076),i(85842)),s=i(61551),a=i(8995),l=i(13692);let o=class extends a.f{get hasHighlight(){return this.children.some((t=>t.hasData))}renderChildren(t){this.attributeView.update(),t.drawPhase===s.S5.HIGHLIGHT&&this.children.some((t=>t.hasData))&&(super.renderChildren(t),t.context.setColorMask(!0,!0,!0,!0),(0,l.lB)(t,!1,(t=>{this._renderChildren(t,s.RI.Highlight)})))}};o=(0,n._)([(0,r.$)("esri.views.2d.layers.graphics.HighlightGraphicContainer")],o);const h=o},98156:(t,e,i)=>{i.r(e),i.d(e,{getTimeExtentFromLayers:()=>m,getTimeSliderSettingsFromWebDocument:()=>c,toLocalTimeExtent:()=>v,toUTCTimeExtent:()=>g});var n=i(18690),r=i(53084),s=i(18288),a=i(59187),l=i(42052),o=i(72027);function h(t){return void 0!==t.timeInfo}async function u(t,e){var i,n;return null!==(i=null===(n=t.widgets)||void 0===n||null===(n=n.timeSlider)||void 0===n?void 0:n.fullTimeExtent)&&void 0!==i?i:m(t.allLayers,e)}function d(t){const{numStops:e,stopInterval:i,stops:n}=t;return n?{dates:(0,r.clone)(n)}:i?{interval:i.clone()}:{count:null!==e&&void 0!==e?e:5}}async function m(t,e){if(0===t.length)return a.default.allTime;await Promise.all(t.map((t=>t.load({signal:e}))));const i=t.filter(h),r=t.filter((t=>!h(t)&&null!=t.visibilityTimeExtent));if(0===i.length&&0===r.length)return a.default.allTime;const s=[],l=[];for(const n of i){var o;"feature"!==(null===n||void 0===n?void 0:n.type)&&"map-image"!==(null===n||void 0===n?void 0:n.type)||null===(o=n.timeInfo)||void 0===o||!o.hasLiveData?l.push(n):s.push(n)}const u=t=>null==t||t.isAllTime,d=[...l.map((t=>{var e,i;const n=null===(e=t.timeInfo)||void 0===e?void 0:e.fullTimeExtent,{visibilityTimeExtent:r}=t;return null!==(i=null===n||void 0===n?void 0:n.intersection(r))&&void 0!==i?i:r})),...r.map((t=>t.visibilityTimeExtent))];if(d.some(u))return a.default.allTime;const m=s.map((async t=>{var i,n,r,s;const a=null!==(i=null===(n=await t.fetchRecomputedExtents({signal:e}))||void 0===n?void 0:n.timeExtent)&&void 0!==i?i:null===(r=t.timeInfo)||void 0===r?void 0:r.fullTimeExtent,{visibilityTimeExtent:l}=t;return null!==(s=null===a||void 0===a?void 0:a.intersection(l))&&void 0!==s?s:l})),p=(await Promise.allSettled(m)).map((t=>"fulfilled"===t.status?t.value:null));if(p.some(u))return a.default.allTime;const c=[...p,...d].filter(n.Ru);return 0===c.length?a.default.allTime:c.reduce(((t,e)=>t.union(e)))}function p(t,e){var i;const n=t.currentTimeExtent;if(!n)return null;const{start:r,end:s}=n,l=null!==(i=null!==r&&void 0!==r?r:s)&&void 0!==i?i:null;switch(e){case"time-window":return new a.default({start:r,end:s});case"cumulative-from-start":return new a.default({start:null,end:l});case"cumulative-from-end":return new a.default({start:l,end:null});case"instant":return new a.default({start:l,end:l})}}async function c(t,e){var i,n;if(!(0,l.r)(t)&&!function(t){return null!=t&&"object"==typeof t&&o.X in t}(t))return null;await t.load({signal:e});const r=null===t||void 0===t||null===(i=t.widgets)||void 0===i?void 0:i.timeSlider;if(!r)return null;const s=await u(t,e),a=r.loop,h=function(t){var e;const i=null!==(e=t.numThumbs)&&void 0!==e?e:2,n=t.currentTimeExtent;if(n){const{start:t,end:e}=n;return null!=t&&null!=e&&t.getTime()===e.getTime()?"instant":2===i?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===i?"time-window":"cumulative-from-start"}(r);return{fullTimeExtent:s,loop:a,mode:h,playRate:null!==(n=r.stopDelay)&&void 0!==n?n:2e3,stops:d(r),timeExtent:p(r,h)}}function g(t){if(!t)return t;const{start:e,end:i}=t;return new a.default({start:null!=e?(0,s.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,s.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}function v(t){if(!t)return t;const{start:e,end:i}=t;return new a.default({start:null!=e?(0,s.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,s.S1)(i,i.getTimezoneOffset(),"minutes"):i})}},98344:(t,e,i)=>{i.r(e),i.d(e,{default:()=>I});var n=i(89379),r=i(35143),s=i(54901),a=i(76460),l=i(50346),o=i(68134),h=i(46053),u=(i(81806),i(47249),i(85842)),d=i(64519),m=i(14509),p=i(2101),c=i(69679),g=i(70822),v=i(4176),f=i(13692),y=i(91196),w=i(47777),x=i(771),_=i(58423),T=i(55754),E=i(1723);let H=class extends((0,w.A)((0,x.A)((0,p.e)(y.default)))){constructor(){super(...arguments),this._highlightGraphics=new d.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){const e="".concat(this.exportImageVersion,"/").concat(t.state.id,"/").concat(t.pixelRatio,"/").concat(t.stationary);this._updateHash!==e&&(this._updateHash=e,this.strategy.update(t).catch((t=>{(0,l.isAbortError)(t)||a.A.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,n=i>=10.3,r=i>=10;this._bitmapContainer=new m.l,this.container.addChild(this._bitmapContainer),this._highlightView=new c.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new _.Uh({createFetchPopupFeaturesQueryGeometry:(t,e)=>(0,T.V)(t,e,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,e)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:e})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new v.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:n,imageNormalizationSupported:r,hidpi:!0}),this.addAttachHandles((0,o.watch)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,(0,n.A)({timeExtent:this.timeExtent,floors:this.floors},r))}fetchImageBitmap(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,(0,n.A)({timeExtent:this.timeExtent,floors:this.floors},r))}highlight(t,e){var i;const n=(0,f.Oq)(t);if(0===n.length)return(0,s.hA)();const r=null!==(i=null===e||void 0===e?void 0:e.name)&&void 0!==i?i:E.Tv;return this._addHighlightGraphics(n,r),(0,s.hA)((()=>!this.destroyed&&this._removeHighlightGraphics(n,r)))}_processHighlight(){var t;const e=this._getHighlights();null===(t=this._highlightView)||void 0===t||t.setHighlight(e)}_addHighlightGraphics(t,e){this._highlightGraphics.addMany(t),this._addHighlights(t.map((t=>t.uid)),e)}_removeHighlightGraphics(t,e){this._highlightGraphics.removeMany(t),this._removeHighlights(t.map((t=>t.uid)),e)}};(0,r._)([(0,h.MZ)()],H.prototype,"strategy",void 0),(0,r._)([(0,h.MZ)()],H.prototype,"updating",void 0),H=(0,r._)([(0,u.$)("esri.views.2d.layers.MapImageLayerView2D")],H);const I=H}}]);
//# sourceMappingURL=98344.3e90a2d3.chunk.js.map