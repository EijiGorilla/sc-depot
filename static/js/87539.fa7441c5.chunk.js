"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[66938,87539,91913],{66938:(t,e,l)=>{l.r(e),l.d(e,{default:()=>u});var s=l(35143),i=l(91967),n=l(5632),o=l(46053),a=(l(81806),l(76460),l(47249),l(85842));let r=class extends(n.A.IdentifiableMixin(i.default)){constructor(t){super(t),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:t}=this;return null==t||t(this)?this.allItems:this.allItems.filter(t)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(t){return this.items.find((e=>e.template===t))}};(0,s._)([(0,o.MZ)()],r.prototype,"allItems",void 0),(0,s._)([(0,o.MZ)()],r.prototype,"filterFunction",void 0),(0,s._)([(0,o.MZ)()],r.prototype,"items",null),(0,s._)([(0,o.MZ)()],r.prototype,"label",void 0),(0,s._)([(0,o.MZ)()],r.prototype,"id",null),r=(0,s._)([(0,a.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],r);const u=r},87539:(t,e,l)=>{l.r(e),l.d(e,{default:()=>I});var s=l(35143),i=l(98773),n=l(54099),o=l(30726),a=l(50346),r=l(68134),u=l(46053),p=(l(81806),l(76460),l(47249),l(85842)),d=l(19451),h=l(5600),c=l(31933),m=l(91656),y=l(91913),f=l(66938);const _=t=>{var e;let{layer:l}=t;return{key:l,label:null!==(e=l.title)&&void 0!==e?e:""}},v=t=>{var e;let{layer:l}=t;return{key:l.geometryType,label:null!==(e=l.geometryType)&&void 0!==e?e:""}};let g=class extends n.A.EventedAccessor{constructor(t){super(t),this._allItems=[],this._updatingHandles=new d.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,r.watch)((()=>[this.templateInfos,this.layers]),((t,e)=>{let[l]=t;l&&l===(null===e||void 0===e?void 0:e.at(0))||(this._updateTask=(0,o.DC)(this._updateTask),l?this._updateAllItems(l):this._getTemplatesAndUpdateAllItems())}),r.syncAndInitial),(0,r.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,o.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),r.sync),(0,r.watch)((()=>this.filterFunction),(t=>{for(const e of this._allItems)(0,m.X6)(e)&&(e.filterFunction=t)}),r.sync)])}set groupBy(t){if(this._set("groupBy",t),"function"!=typeof t)switch(t){case"layer":this._groupByFunction=_;break;case"geometry":this._groupByFunction=v;break;default:this._groupByFunction=null}else this._groupByFunction=e=>this._ensureGroupByObject(t(e))}get layers(){return this._get("layers")}set layers(t){const e="layers";if(this.removeHandles(e),t){const l=()=>this.notifyChange("state");this.addHandles(t.map((t=>(0,r.when)((()=>t.loadStatus),l))),e)}this._set("layers",t)}get state(){var t;return this.updating?"loading":0!==this.layers.length||null!==(t=this.templateInfos)&&void 0!==t&&t.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((t,e)=>(0,m.X6)(e)?t+e.allItems.length:t+1),0)}get items(){const{filterFunction:t}=this;return null==t?this._allItems:this._allItems.filter((e=>(0,m.X6)(e)?e.items.length>0:t(e)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const t of this._allItems)(0,m.X6)(t)&&t.reapplyFilter()}select(t){var e;let{emit:l=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=this.selectedItem,i=(null===t||void 0===t?void 0:t.clone())||null;this._set("selectedItem",i),l&&this.emit("select",{item:i,oldItem:s,template:null!==(e=null===i||void 0===i?void 0:i.template)&&void 0!==e?e:null})}_createItem(t,e){return new y.default({disabledFunction:this.disabledItemFunction,layer:e,template:t})}_ensureGroupByObject(t){return"string"==typeof t?{key:t,label:t}:t}_updateAllItems(t){const e=this._allItems;if(0===t.length)return function(t){for(const e of t){if((0,m.X6)(e))for(const t of e.items)t.destroy();e.destroy()}}(e),void(this._allItems=[]);const[l,s]=(0,m.K_)(e),i=t=>{const e=l.get(t.template);return e?(l.delete(t.template),e):this._createItem(t.template,t.layer)},{filterFunction:n}=this,o=t.filter(b).map((t=>(0,m.wu)(t)?new f.default({filterFunction:n,label:t.label,allItems:t.templateInfos.filter(b).map((t=>i(t)))}):i(t)));for(const a of[...l.values(),...s])a.destroy();this._allItems=o}async _getTemplatesFromLayers(t){const e=[],l={signal:t};await Promise.all(this.layers.map((async s=>{var i;await(0,m.JS)(s,l),(0,a.throwIfAborted)(t);const n=null===(i=(0,c.BR)(s))||void 0===i?void 0:i.operations;(null===n||void 0===n?void 0:n.supportsEditing)&&(null===n||void 0===n?void 0:n.supportsAdd)&&((0,c.F2)(s)?e.push(...s.sublayers):e.push(s))})));const s=await(0,h.b)(e,this.view,t);(0,a.throwIfAborted)(t);const i=(0,m.zA)(s),n=this._groupByFunction;if(null==n)return i;const o=(0,m.AY)(i,n);return 1===o.length&&o[0].label===m._t.label?o[0].templateInfos:o}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const t=(0,i.UT)((async t=>{const e=await this._getTemplatesFromLayers(t);(0,a.throwIfAborted)(t),this._updateAllItems(e)}));this._updateTask=t,this._updatingHandles.addPromise(t.promise)}};function b(t){return(0,m.wu)(t)?t.templateInfos.some(b):!(0,h.w2)(t.template)||!1!==t.template.visible}(0,s._)([(0,u.MZ)()],g.prototype,"_allItems",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"_groupByFunction",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"_updatingHandles",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"disabled",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"disabledItemFunction",void 0),(0,s._)([(0,u.MZ)({value:null})],g.prototype,"filterFunction",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"groupBy",null),(0,s._)([(0,u.MZ)({value:[]})],g.prototype,"layers",null),(0,s._)([(0,u.MZ)()],g.prototype,"state",null),(0,s._)([(0,u.MZ)({readOnly:!0})],g.prototype,"numberOfFeatureTemplates",null),(0,s._)([(0,u.MZ)({readOnly:!0})],g.prototype,"items",null),(0,s._)([(0,u.MZ)({readOnly:!0})],g.prototype,"selectedItem",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"templateInfos",void 0),(0,s._)([(0,u.MZ)()],g.prototype,"updating",null),(0,s._)([(0,u.MZ)()],g.prototype,"view",void 0),g=(0,s._)([(0,p.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],g);const I=g},91656:(t,e,l)=>{l.d(e,{AY:()=>a,Ex:()=>r,JS:()=>u,K_:()=>p,X6:()=>d,_t:()=>i,wu:()=>n,zA:()=>o});var s=l(87663);const i={key:Symbol(),label:"Other\u200b"};function n(t){return"templateInfos"in t}function o(t){const e=[];for(const{layer:l,templates:s}of t)for(const t of s)e.push({layer:l,template:t});return e}function a(t,e){const l=new Map;for(const n of t){const t=e(n),{key:o,label:a}=null!=t.key?t:i;(0,s.tE)(l,o,(()=>({label:a,templateInfos:[]}))).templateInfos.push(n)}return Array.from(l.values())}function r(t,e){var l;return{label:null!==(l=t.title)&&void 0!==l?l:"",templateInfos:e.map((e=>({layer:t,template:e})))}}async function u(t,e){var l;return"subtype-sublayer"===t.type?await(null===(l=t.parent)||void 0===l?void 0:l.load(e)):await t.load(e),t}function p(t){const e=new Map,l=[];for(const s of t)if(d(s)){l.push(s);for(const t of s.items)e.set(t.template,t)}else e.set(s.template,s);return[e,l]}const d=t=>"items"in t},91913:(t,e,l)=>{l.r(e),l.d(e,{default:()=>p});var s,i=l(35143),n=l(91967),o=l(68134),a=l(46053),r=(l(81806),l(76460),l(47249),l(85842));let u=s=class extends n.default{constructor(t){super(t),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,o.watch)((()=>{const{layer:t}=this;return[t&&"renderer"in t?t.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),o.initial))}get description(){var t;return null===(t=this.template)||void 0===t?void 0:t.description}set description(t){this.template&&(this.template.description=t)}get disabled(){var t,e;return null!==(t=null===(e=this.disabledFunction)||void 0===e?void 0:e.call(this,this))&&void 0!==t&&t}get label(){var t;return null===(t=this.template)||void 0===t?void 0:t.name}set label(t){this.template&&(this.template.name=t)}get id(){var t,e;return"".concat(null!==(t=this.label)&&void 0!==t?t:"","\u2013").concat(null===(e=this.layer)||void 0===e?void 0:e.id)}get supportsUpload(){var t;return"scene"===(null===(t=this.layer)||void 0===t?void 0:t.type)}clone(){const t=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,e=new s({layer:this.layer,template:this.template});return e._set("thumbnail",t),e}};(0,i._)([(0,a.MZ)()],u.prototype,"description",null),(0,i._)([(0,a.MZ)()],u.prototype,"disabled",null),(0,i._)([(0,a.MZ)()],u.prototype,"disabledFunction",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"label",null),(0,i._)([(0,a.MZ)()],u.prototype,"layer",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"template",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"thumbnail",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"id",null),(0,i._)([(0,a.MZ)()],u.prototype,"supportsUpload",null),u=s=(0,i._)([(0,r.$)("esri.widgets.FeatureTemplates.TemplateItem")],u);const p=u}}]);
//# sourceMappingURL=87539.fa7441c5.chunk.js.map