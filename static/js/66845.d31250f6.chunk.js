"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[66845],{33695:(e,t,i)=>{i.d(t,{IS:()=>I,In:()=>w,HJ:()=>M,ND:()=>b});var n=i(89379),r=(i(11265),i(4212)),o=i(15142),s=i(53430),a=i(35143),l=i(91967),u=i(87663),d=i(99486),p=i(99702);const c=new WeakMap;class f{constructor(){this._observables=new Map}get(e,t,i){const n=(0,u.tE)(this._observables,t,(()=>new p.I));return(0,d.gc)(n),Reflect.get(e,t)}set(e,t,i,n){var r;return Reflect.set(e,t,i),null!==(r=this._observables.get(t))&&void 0!==r&&r.notify(),!0}}function h(e){return!e||"object"!=typeof e||"__accessor__"in e?e:(0,u.tE)(c,e,(()=>new Proxy(e,new f)))}var m=i(46053),v=(i(81806),i(76460),i(47249),i(85842)),y=i(23301);let _=class extends l.default{constructor(e){var t;super(e),this.userChangesHaveMadeInvalid=!1;const i=null!==(t=e.original.attributes)&&void 0!==t?t:{},r=h((0,n.A)({},i));this.attributes=r;const o=e.original.cloneShallow();o.attributes=r,this.plainGraphic=o}get geometry(){return this.original.geometry}get layer(){var e;return null!==(e=this.original.sourceLayer)&&void 0!==e?e:this.original.layer}attributeHasChanged(e){var t;return!(0,y.D_)(this.attributes[e],null===(t=this.original.attributes)||void 0===t?void 0:t[e])}getAttribute(e){var t;return null!==(t=this.attributes[e])&&void 0!==t?t:null}setAttribute(e,t){this.attributes[e]=t}};(0,a._)([(0,m.MZ)()],_.prototype,"attributes",void 0),(0,a._)([(0,m.MZ)()],_.prototype,"geometry",null),(0,a._)([(0,m.MZ)()],_.prototype,"plainGraphic",void 0),(0,a._)([(0,m.MZ)()],_.prototype,"layer",null),(0,a._)([(0,m.MZ)({constructOnly:!0})],_.prototype,"original",void 0),(0,a._)([(0,m.MZ)()],_.prototype,"userChangesHaveMadeInvalid",void 0),_=(0,a._)([(0,v.$)("esri.widgets.BatchAttributeForm.ReactiveGraphic")],_);var g=i(86950),x=i(20639),E=i(39348);const b=(e,t)=>{var i;return null!=e&&(null===(i=e.input)||void 0===i?void 0:i.type)===t};function I(e){return new _({original:e})}function M(e,t,i,r){const{dataType:a,minLength:l}=e,u=null===i||void 0===i?void 0:i.validationErrors;if(!u||!t)return null;if(t===g.uB.DIFFERENT_ERRORS)return u.invalidBatchFormType;if(t===y.gK.CANNOT_BE_EMPTY)return u.cannotBeNull;if(t===o.Mh.VALUE_OUT_OF_RANGE||t===s.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:i}=e,o={type:"date",intlOptions:(0,n.A)({timeZone:"date"===t.type&&r?r:void 0},(0,x.ZT)(t))},s=(0,y.hQ)(i,u);return(0,E.V)(s,i,{format:{max:"date"===a?o:null!=i.max&&(0,y.qn)(i.max)?y.Qv:y.PA,min:"date"===a?o:null!=i.min&&(0,y.qn)(i.min)?y.Qv:y.PA}})}return t===o.Mh.INVALID_CODED_VALUE?u.invalidCodedValue:t===s.TypeValidationError.INVALID_TYPE?u.invalidType:t===y.gK.TOO_SHORT?(0,E.V)(u.tooShort,{min:l}):(y.gK.TOO_LONG,null)}function w(e,t,i){const n=null===i||void 0===i?void 0:i.validationErrors;if(!n)return null;let o=null;for(const s of e.invalidHiddenInputs)switch(s.effectiveVisibilityCode){case g.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:case g.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:case g.qp.HIDDEN_FIELD_DEFINITION:return"single"===t?n.nonVisibleError_changeValues:n.nonVisibleError_checkIndividualFeatures;case g.qp.HIDDEN_NO_DOMAIN_IN_COMMON:case g.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:case g.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:case g.qp.HIDDEN_NOT_IN_ALL_LAYERS:o=n.nonVisibleError_checkIndividualFeatures;break;case g.qp.VISIBLE:continue;default:(0,r.Xb)(s.effectiveVisibilityCode)}return o}},66845:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Oe});var n=i(89379),r=i(35143),o=i(98773),s=i(19276),a=i(50076),l=i(54099),u=i(76460),d=i(30726),p=i(50346),c=i(67993),f=i(68134),h=i(46053),m=(i(81806),i(47249),i(85842)),v=i(19451),y=i(13312),_=i(36693),g=i(33695),x=i(30550);const E=(0,x.createArcadeProfile)("form-calculation");class b{constructor(){this._executors=new Map,this._executorPromises=new Map}async getArcadeExecutor(e){return this._executors.has(e)?this._executors.get(e):this._executorPromises.has(e)?this._executorPromises.get(e):this._createExecutor(e)}async _createExecutor(e){try{const t=(0,x.createArcadeExecutor)(e,E);this._executorPromises.set(e,t);const i=await t;return this._executors.set(e,i),i}finally{this._executorPromises.delete(e)}}}var I=i(91967),M=i(87663),w=i(16503),F=i(14902),Z=i(86950);function S(e){return"field"===e.type}function V(e){return"group"===e.type}let T=null;const L="esri.widgets.BatchAttributeForm.expressions.ExpressionsManager",N=()=>u.A.getLogger(L);let A=class extends I.default{constructor(e){super(e),this.calculating=!1,this.arcadeContext=null,this._abortController=new AbortController,this.layerExpressionsModelMap=new Map,this.evaluatedExpressions=new c.A,this.expressionEvaluationFailed=!1}abort(){this._abortController.abort()}async runAllExpressions(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.calculating=!0;try{const i=[];for(const n of e){const e=this.layerExpressionsModelMap.get(n.layer);if(!e||0===e.components.length)continue;const r=new Set;i.push(this.evaluateAffectedComponents(e.components,n,e,t,r))}await(0,p.whenOrAbort)(Promise.all(i),this._abortController)}catch(b){N().error(b),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}async valueChanged(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{this.calculating=!0;const n=t.map((t=>this.evaluateValueChangedForFeature(e,t,i)));await Promise.all(n)}catch(E){N().error(E),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}async evaluateValueChangedForFeature(e,t,i){if(this._abortController.signal.aborted)return;const n=this.layerExpressionsModelMap.get(t.layer);if(!n||0===n.components.length)return;const r=new Set,o=new Set([e]),s=new Set;for(;o.size>0;){const[e]=o;if(o.delete(e),r.has(e))continue;r.add(e);const a=n.fieldReferencesMap.get(e.toLowerCase());if(!a)continue;for(const t of a)s.has(t)&&a.delete(t);if(0===a.size)continue;const l=new Set;await this.evaluateAffectedComponents([...a],t,n,i,l);for(const t of a)s.add(t);for(const t of l)r.has(t)||o.add(t)}}async evaluateAffectedComponents(e,t,i,n,r){const o=new Map;for(const a of e)o.has(a)||o.set(a,this.createSccEvaluator(a,t,o,i));if(0===o.size)return;const s=[...o.values()].map((e=>e.evaluate(n,r)));await Promise.all(s)}createSccEvaluator(e,t,i,n){const r=new D(e,t,this.arcadeContext,n,this.evaluatedExpressions,this._abortController);for(const o of e.adjacencyList)r.dependentEvaluators.push((0,M.tE)(i,o,(()=>this.createSccEvaluator(o,t,i,n))));return r}};(0,r._)([(0,h.MZ)()],A.prototype,"calculating",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],A.prototype,"arcadeContext",void 0),(0,r._)([(0,h.MZ)()],A.prototype,"_abortController",void 0),(0,r._)([(0,h.MZ)()],A.prototype,"layerExpressionsModelMap",void 0),(0,r._)([(0,h.MZ)()],A.prototype,"evaluatedExpressions",void 0),(0,r._)([(0,h.MZ)()],A.prototype,"expressionEvaluationFailed",void 0),A=(0,r._)([(0,m.$)(L)],A);class D{constructor(e,t,i,n,r,o){this.scc=e,this.feature=t,this.arcadeContextInfo=i,this.expressionsModel=n,this.evaluatedExpressions=r,this._abortController=o,this.dependentEvaluators=[],this._evaluatorPromise=null}get baseContext(){const{editType:e,map:t,spatialReference:i,timeZone:n}=this.arcadeContextInfo,r=this.feature.layer,o="scene"===(null===r||void 0===r?void 0:r.type)&&null!=r.associatedLayer?r.associatedLayer:r;return{variables:{$originalfeature:this.feature.original.clone(),$editcontext:{editType:e},$layer:o,$featureset:o,$datastore:null===o||void 0===o?void 0:o.url,$feature:this.feature.plainGraphic.clone(),$map:t},executeContext:{rawOutput:!0,spatialReference:null!==i&&void 0!==i?i:void 0,timeZone:n,abortSignal:this._abortController.signal}}}evaluate(e,t){return null==this._evaluatorPromise&&(this._evaluatorPromise=this._evaluate(e,t)),this._evaluatorPromise}async _evaluate(e,t){null===T&&(T=await Promise.all([i.e(43036),i.e(71618)]).then(i.bind(i,71618)));const n=this.dependentEvaluators.map((i=>i.evaluate(e,t)));await(0,p.whenOrAbort)(Promise.all(n),this._abortController);for(const i of this.scc.executors){var r,o;const n=this.baseContext;if(this._abortController.signal.aborted)break;const d=null!==(r=this.expressionsModel.arcadeExecutorUses.get(i))&&void 0!==r?r:[],p=(0,M.tE)(this.evaluatedExpressions,this.feature,(()=>new c.A));let f=null,h=null;try{f=i.isAsync?await i.executeAsync(n.variables,n.executeContext):i.execute(n.variables,n.executeContext),h={result:f,status:"success"}}catch(de){h={error:de,status:"error"}}for(const i of d){const n=this.expressionsModel.elementTemplateMap.get(i.elementId);switch(i.executorPurpose){case"editable":case"required":p.set((0,Z.ng)(i.elementId,i.executorPurpose),h);break;case"value":{var s,l;if("error"===(null===(s=h)||void 0===s?void 0:s.status))continue;const e=n.getExpressionExecutorsForLayer(this.feature.layer);let i=!0;if(null!==e&&void 0!==e&&e.editableExpression&&(i=!1===(null===(l=p.get((0,Z.ng)(n.elementId,"editable")))||void 0===l?void 0:l.result)),i){var u;const e=null!==(u=this.feature.getAttribute(n.fieldName))&&void 0!==u?u:null,i=O(h.result,this.feature,n.fieldName,this.arcadeContextInfo.timeZone);i!==e&&(this.feature.setAttribute(n.fieldName,i),t.add(n.fieldName))}}break;case"visibility":if(p.set((0,Z.ng)(i.elementId,i.executorPurpose),h),!this.expressionsModel.preserveFieldValuesWhenHidden&&!1===h.result&&e)if(V(n))for(const e of n.elements)S(e)&&(null!==this.feature.getAttribute(e.fieldName)&&t.add(e.fieldName),this.feature.setAttribute(e.fieldName,null));else S(n)&&(null!==this.feature.getAttribute(n.fieldName)&&t.add(n.fieldName),this.feature.setAttribute(n.fieldName,null))}}if("error"===(null===(o=h)||void 0===o?void 0:o.status)){const e=new Set;for(const t of d){const i=this.expressionsModel.elementTemplateMap.get(t.elementId);if(i)switch(t.executorPurpose){case"editable":e.add(i.label+" - Editable expression");break;case"required":e.add(i.label+" - Required expression");break;case"value":e.add(i.label+" - Value expression");break;case"visibility":e.add(i.label+" - Visibility expression")}}if(e.size>0)throw new a.default("expression-evaluation-failed","Arcade evaluation failed ("+[...e].join(",")+")");throw new a.default("expression-evaluation-failed","Arcade evaluation failed ")}}}}function O(e,t,i,n){if(null===e)return null;const r=t.layer.fieldsIndex.get(i);if(!r)throw new a.default("field-not-found","Unable set field value as the field cannot be found. ("+i+")");switch(r.type){case"big-integer":case"integer":case"long":case"oid":case"small-integer":case"single":case"double":return T.toNumber(e);case"global-id":case"guid":case"string":return T.toString(e);case"date":{if(T.isDate(e))return e.getTime();const t=T.toDate(e,n);if(!t)throw new a.default("unsupported-value-type","Arcade return type is not a supported field type. ("+i+")");return t.getTime()}case"date-only":{if(T.isDateOnly(e))return e.toStorageFormat();if(T.isDate(e))return w.n.fromDateTime(e.toDateTime()).toStorageFormat();const t=w.n.fromString(T.toString(e));if(!t)throw new a.default("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageFormat()}case"time-only":{if(T.isTime(e))return e.toStorageString();if(T.isDate(e))return F.k.fromDateTime(e.toDateTime()).toStorageString();const t=F.k.fromString(T.toString(e));if(!t)throw new a.default("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageString()}case"timestamp-offset":{if(T.isDate(e))return e.toISOString(!1);const t=T.toDate(e,n);if(!t)throw new a.default("unsupported-value-type","Arcade return type is not a supported field type. ("+i+")");return t.toISOString(!1)}}throw new a.default("unsupported-value-type","Arcade return type is not a supported field type. ("+i+")")}var C=i(18690),k=i(59649),H=i(41289);let R=0;class P{constructor(e){this.arcadeExecutorUses=new Map,this.components=[],this.preserveFieldValuesWhenHidden=!1,this.executorMap=e.executorMap,this.preserveFieldValuesWhenHidden=!0===e.preserveFieldValuesWhenHidden,this.elementTemplateMap=new Map;for(const t of this.executorMap.keys())this.elementTemplateMap.set(t.elementId,t);this._buildDependencyGraph()}_buildDependencyGraph(){const e=function(e){const t=Array.from(e.values()).filter(C.Ru),i=new Set(t.flatMap((e=>Array.from(Object.values(e))))),n=Array.from(i).map((e=>({component:null,crossLinkNeighbors:new Set,executor:e,index:-1,lowlink:-1,onStack:!1})));return new Map(n.map((e=>[e.executor,e])))}(this.executorMap),t={components:[],arcadeExecutorUses:this.arcadeExecutorUses,elementTemplatesById:new Map([...this.executorMap.keys()].map((e=>[e.elementId,e]))),executorMap:this.executorMap,fieldElementTemplateMap:U(this.executorMap),fieldReferencesMap:new Map,nextIndex:0,nodeInfoMap:e,nodeStack:new k.A(H.HV),shouldConsiderVisibility:!this.preserveFieldValuesWhenHidden};for(const i of this.executorMap.keys()){const e=this.executorMap.get(i);e.editableExpression&&(0,M.tE)(this.arcadeExecutorUses,e.editableExpression,(()=>[])).push({elementId:i.elementId,executorPurpose:"editable"}),e.valueExpression&&(0,M.tE)(this.arcadeExecutorUses,e.valueExpression,(()=>[])).push({elementId:i.elementId,executorPurpose:"value"}),null!==e&&void 0!==e&&e.visibilityExpression&&(0,M.tE)(this.arcadeExecutorUses,e.visibilityExpression,(()=>[])).push({elementId:i.elementId,executorPurpose:"visibility"}),(null===e||void 0===e?void 0:e.requiredExpression)&&(0,M.tE)(this.arcadeExecutorUses,e.requiredExpression,(()=>[])).push({elementId:i.elementId,executorPurpose:"required"})}for(const i of this.arcadeExecutorUses.values())i.sort((e=>"editable"===e.executorPurpose?-1:1));for(const i of e.values())-1===i.index&&B(i,t);this.dependencyGraphComponents=function(e){return new Map([...e.values()].map((e=>{let{component:t,executor:i}=e;return[i,t]})))}(t.nodeInfoMap),this.fieldReferencesMap=function(e){let{fieldReferencesMap:t,nodeInfoMap:i}=e;const n=new Map;for(const[r,o]of t.entries()){const e=new Set;for(const t of o){const n=i.get(t);(null===n||void 0===n?void 0:n.component)&&e.add(n.component)}n.set(r,e)}return n}(t),this.components=t.components}}function B(e,t){e.index=e.lowlink=t.nextIndex++,t.nodeStack.push(e);for(const i of function(e,t){var i,n;let{executor:r}=e;const o=new Set;for(const a of r.fieldsUsed){const e=a.toLowerCase();(0,M.tE)(t.fieldReferencesMap,e,(()=>new Set)).add(r),(0,H.FB)(o,q(e,t))}const s=null!==(i=null===(n=t.arcadeExecutorUses.get(r))||void 0===n?void 0:n.filter((e=>"value"===e.executorPurpose)))&&void 0!==i?i:[];for(const a of s){const e=t.executorMap.get(t.elementTemplatesById.get(a.elementId));(null===e||void 0===e?void 0:e.editableExpression)&&e.editableExpression!==r&&o.add(e.editableExpression)}return Array.from(o).map((e=>t.nodeInfoMap.get(e))).filter(C.Ru)}(e,t))-1===i.index?(B(i,t),e.lowlink=Math.min(e.lowlink,i.lowlink)):i.index<e.index&&t.nodeStack.contains(i)&&(e.lowlink=Math.min(e.lowlink,i.index)),t.nodeStack.contains(i)||e.crossLinkNeighbors.add(i);if(e.lowlink===e.index){const i=function(){R++;const e=R.toString();return{executors:new Set,adjacencyList:new Set,componentId:e}}();for(t.components.push(i);G(t.nodeStack)>=e.index;){const e=t.nodeStack.pop();if(null!=e){e.component=i,i.executors.add(e.executor);for(const t of e.crossLinkNeighbors)null!=t.component&&i.adjacencyList.add(t.component)}}}}function q(e,t){let{executorMap:i,fieldElementTemplateMap:n,shouldConsiderVisibility:r}=t;const o=[],s=n.get(e);if(null==s)return o;const a=i.get(s);if(null==a)return o;if((0,C.OZ)(o,a.editableExpression),(0,C.OZ)(o,a.valueExpression),r){(0,C.OZ)(o,null===a||void 0===a?void 0:a.visibilityExpression);const{group:e}=s;if(null!=e){var l;const t=null===(l=i.get(e))||void 0===l?void 0:l.visibilityExpression;(0,C.OZ)(o,t)}}return o}function U(e){const t=new Map;for(const i of e.keys())S(i)&&t.set(i.fieldName.toLowerCase(),i);return t}function G(e){var t,i;return null!==(t=null===(i=e.peek())||void 0===i?void 0:i.index)&&void 0!==t?t:-1}let W=class extends I.default{constructor(e){super(e),this.inputs=[],this.template=null}get allFieldInputs(){const e=[];for(const t of this.inputs)(0,Z.rf)(t)?e.push(t):(0,Z.Et)(t)&&e.push(...t.inputs.filter(Z.rf));return e}get description(){var e,t;return null!==(e=null===(t=this.template)||void 0===t?void 0:t.description)&&void 0!==e?e:null}get hasInvalidHiddenInputs(){return this.invalidHiddenInputs.length>0}get invalidFeatures(){return Array.from(new Set(this.allFieldInputs.flatMap((e=>e.invalidFeatures))))}get invalidHiddenInputs(){return this.allFieldInputs.filter((e=>!e.valid&&!e.effectiveVisible))}get title(){var e,t;return null!==(e=null===(t=this.template)||void 0===t?void 0:t.title)&&void 0!==e?e:null}get valid(){return this.allFieldInputs.every((e=>e.valid))}};(0,r._)([(0,h.MZ)()],W.prototype,"allFieldInputs",null),(0,r._)([(0,h.MZ)()],W.prototype,"description",null),(0,r._)([(0,h.MZ)()],W.prototype,"inputs",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"hasInvalidHiddenInputs",null),(0,r._)([(0,h.MZ)()],W.prototype,"invalidFeatures",null),(0,r._)([(0,h.MZ)()],W.prototype,"invalidHiddenInputs",null),(0,r._)([(0,h.MZ)()],W.prototype,"template",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"title",null),(0,r._)([(0,h.MZ)()],W.prototype,"valid",null),W=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.inputs.BatchFormInputs")],W);var $=i(92115),Y=i(72599),X=(i(44631),i(32173),i(50654)),z=i(15142),j=i(53430),K=i(42633),J=i(85632);let Q=class extends I.default{constructor(e){super(e),this.existsInAllLayers=!0,this.features=new s.default}get description(){return this.template.description}get featuresHaveSameCalculatedVisibility(){const e=new Set;for(const i of this.features){var t;if(null==(null===(t=this.template.getExpressionExecutorsForLayer(i.layer))||void 0===t?void 0:t.visibilityExpression)){e.add(!0);continue}const n=this._lookupEvaluatedExpression(i,"visibility");if("success"===(null===n||void 0===n?void 0:n.status)){if(e.add(!0===n.result),e.size>1)return!1}else e.add(!1)}return e.size<=1}get label(){return this.template.label}get layers(){return Array.from(new Set(this.features.map((e=>e.layer))))}get visibilityCode(){return this._baseVisibilityCode}get visible(){return(0,Z.n8)(this.visibilityCode)}get _baseVisibilityCode(){return this.existsInAllLayers?this.featuresHaveSameCalculatedVisibility?!1===this._evaluatedVisibilityExpression?Z.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:Z.qp.VISIBLE:Z.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:Z.qp.HIDDEN_NOT_IN_ALL_LAYERS}get _evaluatedVisibilityExpression(){let e=!0,t=!0;for(const n of this.features){var i;if(null==(null===(i=this.template.getExpressionExecutorsForLayer(n.layer))||void 0===i?void 0:i.visibilityExpression)){e=e&&!0;continue}t=!1;const r=this._lookupEvaluatedExpression(n,"visibility");e="success"===(null===r||void 0===r?void 0:r.status)&&(e&&!0===r.result)}return t?null:e}_lookupEvaluatedExpression(e,t){var i;return null===(i=this.expressionsManager.evaluatedExpressions.get(e))||void 0===i?void 0:i.get((0,Z.ng)(this.template.elementId,t))}};(0,r._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"expressionsManager",void 0),(0,r._)([(0,h.MZ)()],Q.prototype,"description",null),(0,r._)([(0,h.MZ)()],Q.prototype,"existsInAllLayers",void 0),(0,r._)([(0,h.MZ)()],Q.prototype,"features",void 0),(0,r._)([(0,h.MZ)()],Q.prototype,"featuresHaveSameCalculatedVisibility",null),(0,r._)([(0,h.MZ)()],Q.prototype,"label",null),(0,r._)([(0,h.MZ)()],Q.prototype,"layers",null),(0,r._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"template",void 0),(0,r._)([(0,h.MZ)()],Q.prototype,"visibilityCode",null),(0,r._)([(0,h.MZ)()],Q.prototype,"visible",null),(0,r._)([(0,h.MZ)()],Q.prototype,"_baseVisibilityCode",null),(0,r._)([(0,h.MZ)()],Q.prototype,"_evaluatedVisibilityExpression",null),Q=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.inputs.InputBase")],Q);let ee=class extends Q{constructor(){super(...arguments),this.editType="NA"}get editable(){var e;return null===(e=this._evaluatedEditableExpression)||void 0===e||e}get _evaluatedEditableExpression(){let e=!0,t=!0;for(const n of this.features){var i;if(null==(null===(i=this.template.getExpressionExecutorsForLayer(n.layer))||void 0===i?void 0:i.editableExpression)){e=e&&!0;continue}t=!1;const r=this._lookupEvaluatedExpression(n,"editable");e="success"===(null===r||void 0===r?void 0:r.status)&&(e&&!0===r.result)}return t?null:e}};(0,r._)([(0,h.MZ)()],ee.prototype,"editable",null),(0,r._)([(0,h.MZ)()],ee.prototype,"editType",void 0),(0,r._)([(0,h.MZ)()],ee.prototype,"_evaluatedEditableExpression",null),ee=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.inputs.EditableInput")],ee);var te=i(23301);let ie=class extends ee{constructor(e){super(e),this.group=null,this.type="field",this.userHasChangedValue=!1,this._hasIntersectionWithElementFieldDomain=!1}get compositeError(){if(this.valid)return null;const{errors:e}=this;if(e.length<this.features.length)return Z.uB.DIFFERENT_ERRORS;const t=e[0];for(const i of e)if(i.error!==t.error)return Z.uB.DIFFERENT_ERRORS;return t.error}get dataType(){const{field:e}=this;return(0,j.isNumericField)(e)?te.Kx.Number:(0,j.isStringField)(e)?te.Kx.Text:(0,K.fs)(e)||(0,j.isTimeOnlyField)(e)?te.Kx.Date:te.Kx.Unsupported}get domain(){const e=this._allDomains.toArray();return this.calculateDomain(e)}get distinctValues(){if(this.featuresHaveSameValue)return[this.value];const e=new Set;for(const t of this.features)e.add(t.getAttribute(this.fieldName));return Array.from(e)}get editable(){var e;return!!this.field.editable&&(null===(e=this._evaluatedEditableExpression)||void 0===e||e)}get effectiveVisible(){return(0,Z.n8)(this.effectiveVisibilityCode)}get effectiveVisibilityCode(){const{visibilityCode:e}=this;if(e!==Z.qp.VISIBLE)return e;const{group:t}=this;if(null==t)return e;const i=t.visibilityCode;return i===Z.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL?Z.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:i===Z.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME?Z.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:e}get errors(){return this._validate()}get featuresHaveSameValue(){var e;const{fieldName:t}=this,i=null===(e=this.features.at(0))||void 0===e?void 0:e.getAttribute(t);return this.features.every((e=>e.getAttribute(t)===i))}get field(){return this.template.field}get fieldName(){return this.field.name}get invalidFeatures(){return this.errors.map((e=>e.feature))}get isSubtypeField(){return this.layers.some((e=>{if(e&&"subtypeField"in e){var t,i;const{subtypeField:n,fieldsIndex:r}=e;return(null!==(t=null===(i=r.get(n))||void 0===i?void 0:i.name)&&void 0!==t?t:n)===this.fieldName}return!1}))}get showNoValueOptionEnabled(){const{input:e}=this.template;return!this.required&&(!(0,Z.hJ)(e)||!0===(null===e||void 0===e?void 0:e.showNoValueOption))}get showNoValueLabel(){const{input:e}=this.template;return(0,Z.hJ)(e)?null===e||void 0===e?void 0:e.noValueOptionLabel:null}get includeTime(){var e;const{template:t,field:i}=this;return this.dataType===te.Kx.Date&&("time-only"===i.type||"date-only"!==i.type&&("datetime-picker"!==(null===(e=t.input)||void 0===e?void 0:e.type)||t.input.includeTime))}get includeTimeOffset(){if("timestamp-offset"!==this.field.type)return!1;const e=this.template.input;return!e||"datetimeoffset-picker"===e.type&&e.includeTimeOffset}get maxLength(){return(0,te.zU)({dataType:this.dataType,field:this.field,input:this.template.input})}get minLength(){return(0,te.jl)({dataType:this.dataType,field:this.field,input:this.template.input})}get range(){var e,t;if("date"===this.dataType)return this._dateRange;const{domain:i,field:n}=this;if(i){const e=(0,z.A5)(n,i);return{max:null===e||void 0===e?void 0:e.max,min:null===e||void 0===e?void 0:e.min}}const r=this._allDomains.toArray().every((e=>!e))?(0,j.getFieldRange)(n):null;return{max:(null===r||void 0===r?void 0:r.max)===Number.MAX_VALUE?null:null!==(e=null===r||void 0===r?void 0:r.max)&&void 0!==e?e:null,min:(null===r||void 0===r?void 0:r.min)===-Number.MAX_VALUE?null:null!==(t=null===r||void 0===r?void 0:r.min)&&void 0!==t?t:null}}get required(){var e;if(!this.editable)return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const t=this.visible&&!1!==(null===(e=this.group)||void 0===e?void 0:e.visible),i=this._evaluatedRequiredExpression;return!(!t||null==i)&&i}get submittable(){return(!this.required||!this.distinctValues.some((e=>(0,te.Po)(e))))&&!!this.valid}get valid(){return 0===this.errors.length}get value(){var e,t;return this.featuresHaveSameValue?null!==(e=null===(t=this.features.at(0))||void 0===t?void 0:t.getAttribute(this.fieldName))&&void 0!==e?e:null:Z.pg}get visibilityCode(){return this.field.visible?this._fieldShouldHaveDomain&&null==this.domain?Z.qp.HIDDEN_NO_DOMAIN_IN_COMMON:this._baseVisibilityCode:Z.qp.HIDDEN_FIELD_DEFINITION}get effectiveTimeZone(){var e;const t=this.template;let i=null!==(e=t.formTimeZone)&&void 0!==e?e:"system";return t.layerTimeZone?t.layerTimeZone===_.L5?i=_.n$:t.formTimeZone===_.L5&&(i=t.layerTimeZone):t.formTimeZone===_.L5&&(i=_.n$),i}get codedValueDomainOptions(){var e;return"coded-value"===(null===(e=this.domain)||void 0===e?void 0:e.type)?this.domain.codedValues.map((e=>{let{name:t,code:i}=e;return{name:t,value:i}})):[]}get codedValueOptions(){const e=this.codedValueDomainOptions,{value:t}=this,i=null==t||t===Z.pg||e.some((e=>e.value===t))?[]:[{name:"".concat(t),value:t}];return[e,i]}get _evaluatedRequiredExpression(){let e=!1,t=!0;const i=this.template;for(const r of this.features){var n;if(null==(null===(n=i.getExpressionExecutorsForLayer(r.layer))||void 0===n?void 0:n.requiredExpression))continue;t=!1;const o=this._lookupEvaluatedExpression(r,"required");e="success"!==(null===o||void 0===o?void 0:o.status)||(e||!0===o.result)}return t?null:e}get _allDomains(){const e=this.template.domain;return this.features.map((t=>{const i=t.layer.getFieldDomain(this.fieldName,{feature:t.plainGraphic});return"range"===(null===i||void 0===i?void 0:i.type)||"range"===(null===e||void 0===e?void 0:e.type)?null!==i&&void 0!==i?i:this.template.domain:i}))}get _fieldShouldHaveDomain(){return!!this._hasIntersectionWithElementFieldDomain||this._allDomains.some(C.Ru)}get _dateFormRange(){var e,t,i,n;if("date"!==this.dataType)return{};const r=this.template.input;if(!r)return{};const{type:o}=r;let s={};if("date-picker"!==o&&"time-picker"!==o&&"datetimeoffset-picker"!==o||(s=(0,z.nm)(this.field,r.max,r.min)),"datetime-picker"===o){const{max:e,min:t}=r;s={max:null!=e&&(0,te.$$)(e)?e.getTime():null,min:null!=t&&(0,te.$$)(t)?t.getTime():null}}return{min:s.min,max:s.max,rawMax:null!==(e=null===(t=s)||void 0===t?void 0:t.rawMax)&&void 0!==e?e:null,rawMin:null!==(i=null===(n=s)||void 0===n?void 0:n.rawMin)&&void 0!==i?i:null}}get _dateRange(){const{_dateFormRange:e,template:t,field:i,domain:n}=this;if("date"!==this.dataType)return{};if(!n)return this._fieldShouldHaveDomain?{}:e;const r=(0,z.A5)(i,n);if(!r)return e;const{max:o,min:s,rawMax:a,rawMin:l}=e,{type:u}=t.field;if("date"===u){const{max:e,min:t}=r;return{max:(0,J.Et)(o)&&(null===e||null!=e&&o<=e)?o:null!==e&&void 0!==e?e:null,min:(0,J.Et)(s)&&(null===t||null!=t&&s>=t)?s:null!==t&&void 0!==t?t:null}}if("date-only"===u||"time-only"===u||"timestamp-offset"===u){const{max:e,min:t,rawMax:i,rawMin:n}=r,u=(0,J.Et)(o)&&a&&(null==e||o<e),d=(0,J.Et)(s)&&l&&(null==t||s>t);return{max:u?o:e,min:d?s:t,rawMax:u?a:i,rawMin:d?l:n}}return{}}async setValueFromUser(e){this.userHasChangedValue=!0;const t=new s.default,i=this.fieldName;for(const n of this.features)n.getAttribute(i)!==e&&t.push(n);this._setValue(e),await this.expressionsManager.valueChanged(i,t)}_setValue(e){const{fieldName:t}=this;for(const i of this.features)i.setAttribute(t,e)}_validate(){const{dataType:e,fieldName:t,maxLength:i,minLength:n,range:r}=this,o=[];for(const a of this.features){var s;const{layer:l}=a,u=null!==(s=l.getField(t))&&void 0!==s?s:this.field,d=l.getFieldDomain(t,{feature:a.plainGraphic}),p=this.calculateDomain([d]),c=this._requiredForFeature(a),f=a.getAttribute(t),h=(0,te.Gd)(f,{dataType:e,domain:p,field:u,maxLength:i,minLength:n,range:r,required:c});h&&o.push({error:h,feature:a.original})}return o}_editableForFeature(e){var t;if(!this.field.editable)return!1;if(null==(null===(t=this.template.getExpressionExecutorsForLayer(e.layer))||void 0===t?void 0:t.editableExpression))return!0;const i=this._lookupEvaluatedExpression(e,"editable");return"success"===(null===i||void 0===i?void 0:i.status)&&!0===i.result}_effectiveVisibleFeature(e){var t;if(this.group&&!this.group.visibleForFeature(e))return!1;if(null==(null===(t=this.template.getExpressionExecutorsForLayer(e.layer))||void 0===t?void 0:t.visibilityExpression))return!0;const i=this._lookupEvaluatedExpression(e,"visibility");return"success"===(null===i||void 0===i?void 0:i.status)&&!0===i.result}_requiredForFeature(e){var t;if(!this._editableForFeature(e))return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const i=this._effectiveVisibleFeature(e);if(null==(null===(t=this.template.getExpressionExecutorsForLayer(e.layer))||void 0===t?void 0:t.requiredExpression))return!1;const n=this._lookupEvaluatedExpression(e,"required");return"success"!==(null===n||void 0===n?void 0:n.status)?i:i&&!0===n.result}calculateDomain(e){const t=e.find((e=>null!=e)),i=this.template.domain;if(!t)return i&&(0,z.QZ)(this.field,i)?i:null;switch(t.type){case"coded-value":if(e.some((e=>!e))){if(!i)return null;e=e.filter((e=>null!==e))}break;case"range":e=e.filter((e=>null!==e))}if(!e.every((e=>(null===e||void 0===e?void 0:e.type)===(null===t||void 0===t?void 0:t.type))))return null;let n=null;switch(null===t||void 0===t?void 0:t.type){case"range":n=this._intersectRangeDomains(e);break;case"coded-value":n=this._intersectCodedValueDomains(e)}return n}_intersectCodedValueDomains(e){if(!e.length)return null;const t=new Map(e[0].codedValues.map((e=>{let{code:t,name:i}=e;return[t,i]}))),i=this.template.domain?new Map(this.template.domain.codedValues.map((e=>{let{code:t,name:i}=e;return[t,i]}))):null;for(const o of e)for(const[e,i]of t)o.codedValues.some((t=>t.code===e&&t.name===i))||t.delete(e);let n=t;if(i){n=new Map;for(const[e,r]of i)t.has(e)&&n.set(e,r)}const r=Array.from(n.entries()).map((e=>{let[t,i]=e;return new $.H({code:t,name:i})}));return r.length?new Y.default({codedValues:r}):null}_intersectRangeDomains(e){if(!e.length)return null;let t=e[0];if(e.length>1&&(t=e.reduce(((e,t)=>this._findMinMaxValuesBetweenTwoDomains(e,t)||null),t)),t&&!(0,z.QZ)(this.field,t))return null;const{domain:i}=this.template;if(t&&i&&i instanceof X.default){const e=this._findMinMaxValuesBetweenTwoDomains(t,i);return this._hasIntersectionWithElementFieldDomain=!!e,e}return t}_getMinMaxFromRangeDomain(e){const t=e.minValue,i=e.maxValue,{field:n}=this;return(0,j.isDateOnlyField)(n)||(0,j.isTimeOnlyField)(n)||(0,j.isTimestampOffsetField)(n)?(0,z.nm)(n,i,t):{min:null!=t&&"number"==typeof t?t:null,max:null!=i&&"number"==typeof i?i:null}}_findMinMaxValuesBetweenTwoDomains(e,t){const i=new X.default,n=this._getMinMaxFromRangeDomain(e),r=this._getMinMaxFromRangeDomain(t),{field:o}=this,s=this._getValidRangeValue(n.min,-1/0),a=this._getValidRangeValue(n.max,1/0),l=this._getValidRangeValue(r.min,-1/0),u=this._getValidRangeValue(r.max,1/0);return i.minValue=Math.max(s,l),i.maxValue=Math.min(a,u),i.minValue===-1/0||i.maxValue===1/0||i.minValue>i.maxValue?null:(((0,j.isDateOnlyField)(o)||(0,j.isTimeOnlyField)(o)||(0,j.isTimestampOffsetField)(o))&&(i.minValue=Number(n.min)>Number(r.min)?n.rawMin:r.rawMin,i.maxValue=Number(n.max)<Number(r.max)?n.rawMax:r.rawMax),i.name="intersection",i)}_getValidRangeValue(e,t){return(0,J.Et)(e)?e:t}};(0,r._)([(0,h.MZ)()],ie.prototype,"dataType",null),(0,r._)([(0,h.MZ)()],ie.prototype,"domain",null),(0,r._)([(0,h.MZ)()],ie.prototype,"distinctValues",null),(0,r._)([(0,h.MZ)()],ie.prototype,"editable",null),(0,r._)([(0,h.MZ)()],ie.prototype,"effectiveVisible",null),(0,r._)([(0,h.MZ)()],ie.prototype,"effectiveVisibilityCode",null),(0,r._)([(0,h.MZ)()],ie.prototype,"errors",null),(0,r._)([(0,h.MZ)()],ie.prototype,"featuresHaveSameValue",null),(0,r._)([(0,h.MZ)()],ie.prototype,"field",null),(0,r._)([(0,h.MZ)()],ie.prototype,"fieldName",null),(0,r._)([(0,h.MZ)()],ie.prototype,"group",void 0),(0,r._)([(0,h.MZ)()],ie.prototype,"invalidFeatures",null),(0,r._)([(0,h.MZ)()],ie.prototype,"isSubtypeField",null),(0,r._)([(0,h.MZ)()],ie.prototype,"showNoValueOptionEnabled",null),(0,r._)([(0,h.MZ)()],ie.prototype,"includeTime",null),(0,r._)([(0,h.MZ)()],ie.prototype,"includeTimeOffset",null),(0,r._)([(0,h.MZ)()],ie.prototype,"maxLength",null),(0,r._)([(0,h.MZ)()],ie.prototype,"minLength",null),(0,r._)([(0,h.MZ)()],ie.prototype,"range",null),(0,r._)([(0,h.MZ)()],ie.prototype,"required",null),(0,r._)([(0,h.MZ)()],ie.prototype,"submittable",null),(0,r._)([(0,h.MZ)({readOnly:!0})],ie.prototype,"type",void 0),(0,r._)([(0,h.MZ)()],ie.prototype,"userHasChangedValue",void 0),(0,r._)([(0,h.MZ)()],ie.prototype,"valid",null),(0,r._)([(0,h.MZ)()],ie.prototype,"value",null),(0,r._)([(0,h.MZ)()],ie.prototype,"visibilityCode",null),(0,r._)([(0,h.MZ)()],ie.prototype,"effectiveTimeZone",null),(0,r._)([(0,h.MZ)()],ie.prototype,"_evaluatedRequiredExpression",null),(0,r._)([(0,h.MZ)()],ie.prototype,"_hasIntersectionWithElementFieldDomain",void 0),(0,r._)([(0,h.MZ)()],ie.prototype,"_allDomains",null),(0,r._)([(0,h.MZ)()],ie.prototype,"_fieldShouldHaveDomain",null),(0,r._)([(0,h.MZ)()],ie.prototype,"_dateFormRange",null),(0,r._)([(0,h.MZ)()],ie.prototype,"_dateRange",null),ie=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.inputs.FieldInput")],ie);let ne=class extends Q{constructor(e){super(e),this.inputs=[],this.type="group"}initialize(){for(const e of this.inputs)e.group=this}get open(){return"expanded"===this.template.initialState}set open(e){this._override("open",e)}get visible(){return(0,Z.n8)(this.visibilityCode)&&this.inputs.some((e=>e.visible))}visibleForFeature(e){var t;if(null==(null===(t=this.template.getExpressionExecutorsForLayer(e.layer))||void 0===t?void 0:t.visibilityExpression))return!0;const i=this._lookupEvaluatedExpression(e,"visibility");return"success"===(null===i||void 0===i?void 0:i.status)&&!0===i.result}};function re(e,t,i){const n=e.elements.map((e=>oe(e,t,i)));return new W({inputs:n,template:e})}function oe(e,t,i){const n=new Set(e.layers),r=t.filter((e=>n.has(e.layer))),o=r.length===t.length;if(S(e))return new ie({existsInAllLayers:o,features:r,template:e,expressionsManager:i});if(V(e)){const n=e.elements.map((e=>oe(e,t,i)));return new ne({existsInAllLayers:o,features:r,inputs:n,template:e,expressionsManager:i})}throw new a.default("batch-attribute-form:unsupported-element-template","The type of form element template provided is not supported")}(0,r._)([(0,h.MZ)()],ne.prototype,"inputs",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],ne.prototype,"type",void 0),(0,r._)([(0,h.MZ)()],ne.prototype,"open",null),(0,r._)([(0,h.MZ)()],ne.prototype,"visible",null),ne=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.inputs.GroupInput")],ne);let se=class extends I.default{constructor(e){super(e),this.description=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}get elementsFlat(){const e=[];for(const t of this.elements)if(e.push(t),V(t))for(const i of t.elements)e.push(i);return e}get elementsInCommon(){const e=this.layers.length;return this.elements.filter((t=>t.layers.length===e))}get layers(){const e=new Set(this.elements.flatMap((e=>e.layers)));return Array.from(e)}getExpressionExecutorsForLayer(e){const t=new Map;for(const i of this.elementsFlat)i.layers.includes(e)&&t.set(i,i.getExpressionExecutorsForLayer(e));return t}};(0,r._)([(0,h.MZ)()],se.prototype,"description",void 0),(0,r._)([(0,h.MZ)()],se.prototype,"elements",void 0),(0,r._)([(0,h.MZ)()],se.prototype,"elementsFlat",null),(0,r._)([(0,h.MZ)()],se.prototype,"elementsInCommon",null),(0,r._)([(0,h.MZ)()],se.prototype,"layers",null),(0,r._)([(0,h.MZ)()],se.prototype,"preserveFieldValuesWhenHidden",void 0),(0,r._)([(0,h.MZ)()],se.prototype,"title",void 0),se=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.templates.BatchFormTemplate")],se);const ae=se;var le=i(16251),ue=i(31933);const de=new Map;async function pe(e){var t,i;if(!(e=(0,ue.Sv)(e)?e.parent:"feature"===(null===(t=e)||void 0===t?void 0:t.type)?e:null))return null;const n=(0,M.tE)(de,e,(()=>{const t=le.A.createLoadedLayerContingentValuesCache(e);return e.addHandles({remove(){de.delete(e)}}),t}));return null!==(i=await n)&&void 0!==i?i:null}var ce=i(64449),fe=i(71764);async function he(e){let{element:t,expressionInfos:i,provider:n}=e;const r={};if(t.visibilityExpression){const e=i.get(t.visibilityExpression);r.visibilityExpression=e?await n.getArcadeExecutor(e.expression):void 0}if("editableExpression"in t&&t.editableExpression){const e=i.get(t.editableExpression);r.editableExpression=e?await n.getArcadeExecutor(e.expression):void 0}if("requiredExpression"in t&&t.requiredExpression){const e=i.get(t.requiredExpression);r.requiredExpression=e?await n.getArcadeExecutor(e.expression):void 0}if("valueExpression"in t&&t.valueExpression){const e=i.get(t.valueExpression);r.valueExpression=e?await n.getArcadeExecutor(e.expression):void 0}return r}var me=i(69098),ve=i(88685);const ye="";function _e(e){return S(e)?(0,ve.Wm)(function(e){var t,i;return"".concat(ge(e),".").concat(function(e){var t,i,n,r;const o=e.name,s=null!==(t=e.alias)&&void 0!==t?t:ye;return"".concat(o,".").concat(s===o?ye:s,".").concat(e.nullable,".").concat(e.type,".").concat(null!==(i=e.length)&&void 0!==i?i:ye,".").concat(null!==(n=e.defaultValue)&&void 0!==n?n:ye,".").concat(null!==(r=e.description)&&void 0!==r?r:ye,".").concat(e.editable,".").concat(e.visible)}(e.field),".").concat(function(e){return e?"coded-value"===e.type?function(e){const{type:t}=e;return"".concat(t,".").concat(e.codedValues.map((e=>{let{code:t,name:i}=e;return"".concat(Ee(t),".").concat(i)})).sort().join("."))}(e):"range"===e.type?function(e){const{maxValue:t,minValue:i,type:n}=e;return"".concat(n,".").concat(i,".").concat(t)}(e):JSON.stringify(e):ye}(e.domain),".").concat(null!==(t=e.hint)&&void 0!==t?t:ye,".").concat(function(e){if(!e)return ye;const{type:t}=e;if(function(e){return"barcode-scanner"===e.type}(e))return null!==t&&void 0!==t?t:ye;if(function(e){return"combo-box"===e.type}(e)||function(e){return"radio-buttons"===e.type}(e)){var i;const{showNoValueOption:n}=e;return"".concat(t,".").concat(n,".").concat(null!==(i=e.noValueOptionLabel)&&void 0!==i?i:ye)}if(function(e){return"date-picker"===e.type}(e))return"".concat(t,".").concat(xe(e));if(function(e){return"datetime-picker"===e.type}(e)){var n,r;const i=null===(n=e.min)||void 0===n?void 0:n.getTime(),o=null===(r=e.max)||void 0===r?void 0:r.getTime(),{includeTime:s}=e;return"".concat(t,".").concat(i,".").concat(o,".").concat(s)}if(function(e){return"datetimeoffset-picker"===e.type}(e)){const i=xe(e),{includeTimeOffset:n,timeResolution:r}=e;return"".concat(t,".").concat(i,".").concat(n,".").concat(r)}if(function(e){return"switch"===e.type}(e)){const{offValue:i,onValue:n}=e;return"".concat(t,".").concat(Ee(i),".").concat(Ee(n))}var o,s,a,l;if(function(e){return"text-area"===e.type}(e)||function(e){return"text-box"===e.type}(e))return"".concat(t,".").concat(null!==(o=null===(s=e.minLength)||void 0===s?void 0:s.toString())&&void 0!==o?o:ye,".").concat(null!==(a=null===(l=e.maxLength)||void 0===l?void 0:l.toString())&&void 0!==a?a:ye);if(function(e){return"time-picker"===e.type}(e)){const i=xe(e),{timeResolution:n}=e;return"".concat(t,".").concat(i,".").concat(n)}return JSON.stringify(e)}(e.input),".").concat(null!==(i=e.layerTimeZone)&&void 0!==i?i:"")}(e)).toString():V(e)?(0,ve.Wm)(function(e){const t=ge(e)+".".concat(e.initialState);let i=ye;for(const n of e.elements)i+="."+_e(n).toString();return"".concat(t).concat(i)}(e)).toString():(0,ve.Wm)(JSON.stringify(e)).toString()}function ge(e){var t,i;return"".concat(null!==(t=e.label)&&void 0!==t?t:ye,".").concat(null!==(i=e.description)&&void 0!==i?i:ye)}function xe(e){var t,i;return"".concat(null!==(t=e.min)&&void 0!==t?t:ye,".").concat(null!==(i=e.max)&&void 0!==i?i:ye)}function Ee(e){return"number"==typeof e?"".concat("num:").concat(e):e}let be=class extends me.A{constructor(e){super(e),this.description=null,this.label=null,this._expressionExecutorsByLayer=new c.A}get elementId(){return _e(this)}get layers(){return Array.from(this._expressionExecutorsByLayer.keys())}addLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._expressionExecutorsByLayer.set(e,t)}foldIn(e){for(const t of e.layers)this.addLayer(t,e.getExpressionExecutorsForLayer(t))}getExpressionExecutorsForLayer(e){var t;return null!==(t=this._expressionExecutorsByLayer.get(e))&&void 0!==t?t:null}};(0,r._)([(0,h.MZ)()],be.prototype,"description",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],be.prototype,"elementId",null),(0,r._)([(0,h.MZ)()],be.prototype,"label",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],be.prototype,"layers",null),(0,r._)([(0,h.MZ)({readOnly:!0})],be.prototype,"type",void 0),(0,r._)([(0,h.MZ)({clonable:e=>new c.A(Array.from(e))})],be.prototype,"_expressionExecutorsByLayer",void 0),be=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.templates.ElementTemplateBase")],be);let Ie=class extends be{constructor(e){super(e),this.domain=null,this.group=null,this.hint=null,this.input=null,this.type="field",this.layerTimeZone=null,this.formTimeZone=null}get fieldName(){return this.field.name}get hasValueCalculations(){for(const e of this.layers){const t=this.getExpressionExecutorsForLayer(e);if(null!==t&&void 0!==t&&t.valueExpression)return!0}return!1}};(0,r._)([(0,h.MZ)({clonable:"reference"})],Ie.prototype,"domain",void 0),(0,r._)([(0,h.MZ)({clonable:"reference",constructOnly:!0})],Ie.prototype,"field",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"fieldName",null),(0,r._)([(0,h.MZ)({clonable:!1})],Ie.prototype,"group",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"hint",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"input",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"type",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"layerTimeZone",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"formTimeZone",void 0),(0,r._)([(0,h.MZ)()],Ie.prototype,"hasValueCalculations",null),Ie=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.templates.FieldElementTemplate")],Ie);let Me=class extends be{constructor(e){super(e),this.initialState="expanded",this.type="group"}initialize(){for(const e of this.elements)e.group=this}foldIn(e){const{elements:t}=this,i=e.elements;if(t.length!==i.length)throw new a.default("unable-to-fold-in","Unable to fold in the given GroupElementTemplate because it has a different number of child elements");for(const n of e.layers){this.addLayer(n,e.getExpressionExecutorsForLayer(n));for(let e=0;e<t.length;e++)t.at(e).foldIn(i.at(e))}}};(0,r._)([(0,h.MZ)()],Me.prototype,"initialState",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],Me.prototype,"elements",void 0),(0,r._)([(0,h.MZ)()],Me.prototype,"type",void 0),Me=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.templates.GroupElementTemplate")],Me);const we="expression/dea57012-47ca4b55a000-8df62742ed0c",Fe=()=>u.A.getLogger("esri.widgets.BatchAttributeForm.templates.templateUtils");async function Ze(e,t){var i,n;return null!==(i=e.formTemplate)&&void 0!==i&&i.elements&&(null===(n=e.formTemplate)||void 0===n?void 0:n.elements.length)>0?async function(e,t){var i,n;const r=e.formTemplate;if(!r)return Se(e,t);let o=null;Ve(null!==(i=r.elements)&&void 0!==i?i:[],e)&&(o=new ce.default({title:"",name:we,expression:"false"}));const s=function(e){return new Map(null===e||void 0===e?void 0:e.map((e=>[e.name,e])))}(o?[...null!==(n=r.expressionInfos)&&void 0!==n?n:[],o]:r.expressionInfos),a={description:r.description,elements:new Array,title:r.title,preserveFieldValuesWhenHidden:r.preserveFieldValuesWhenHidden},{elements:l}=r;if(!l)return new ae(a);const{arcadeExecutorProvider:u,formTimeZone:d}=t;for(const p of l){const t=await Te(p,{arcadeExecutorProvider:u,expressionInfos:s,layer:e,formTimeZone:d});t&&a.elements.push(t)}return new ae(a)}(e,t):Se(e,t)}async function Se(e,t){let{arcadeExecutorProvider:i,formTimeZone:n}=t;const r=new Set((0,j.getLowerCaseEditTrackingFields)(e)),o={arcadeExecutorProvider:i,editTrackingFields:r,formTimeZone:n,layer:e},s=[];for(const l of e.fields)Ne(l,e,r)&&s.push(Le(l,o));const a=await Promise.all(s);return new ae({elements:a,preserveFieldValuesWhenHidden:!0})}function Ve(e,t){for(const r of null!==e&&void 0!==e?e:[]){var i;if("group"!==r.type){if("field"===r.type){var n;if(!1===r.editable&&!r.editableExpression)return!0;if(t.subtypeField&&((0,ue.Sv)(t)||(0,ue.F2)(t))&&(null===(n=r.fieldName)||void 0===n?void 0:n.toLowerCase())===t.subtypeField.toLowerCase())return!0}}else if(Ve(null!==(i=r.elements)&&void 0!==i?i:[],t))return!0}return!1}async function Te(e,t){return(0,fe.jt)(e)?async function(e,t){var i;let{arcadeExecutorProvider:n,expressionInfos:r,layer:o,formTimeZone:s}=t;const{fieldsIndex:l}=o,{description:u,domain:d,fieldName:p,hint:c,input:f,label:h}=e;if(null==p||!l.has(p))return Fe().warn(new a.default("batch-attribute-form:invalid-form-element-field","Field element with label '".concat(h,"' does not refer to a valid field"))),null;const m={description:u,domain:d,field:l.get(p),hint:c,input:f,formTimeZone:s,layerTimeZone:Ae(o),label:h};!1!==e.editable||e.editableExpression||((e=e.clone()).editableExpression=we),o.subtypeField&&((0,ue.Sv)(o)||(0,ue.F2)(o))&&(null===(i=e.fieldName)||void 0===i?void 0:i.toLowerCase())===o.subtypeField.toLowerCase()&&((e=e.clone()).editableExpression=we);const v=new Ie(m),y=await he({element:e,expressionInfos:r,provider:n});return v.addLayer(o,y),v}(e,t):(0,fe.CG)(e)?async function(e,t){const{arcadeExecutorProvider:i,expressionInfos:n,layer:r}=t,{description:o,label:s,initialState:a}=e,l={description:o,elements:[],label:s,initialState:null!==a&&void 0!==a?a:"expanded"};for(const p of e.elements){const e=await Te(p,t);e&&l.elements.push(e)}const u=new Me(l),d=await he({element:e,expressionInfos:n,provider:i});return u.addLayer(r,d),u}(e,t):(Fe().warn(new a.default("batch-attribute-form:unsupported-element-type","Form elements of type ".concat(e.type," are not supported"))),null)}async function Le(e,t){var i;let{arcadeExecutorProvider:n,layer:r,formTimeZone:o}=t;const s=new Ie({field:e,label:null!==(i=e.alias)&&void 0!==i?i:e.name,formTimeZone:o,layerTimeZone:Ae(r)}),a={},l=((0,ue.F2)(r)||(0,ue.Sv)(r))&&r.subtypeField&&r.subtypeField.toLowerCase()===e.name.toLowerCase();return!l&&e.editable&&r.userHasUpdateItemPrivileges&&(a.editableExpression=await n.getArcadeExecutor("true")),l&&(a.editableExpression=await n.getArcadeExecutor("false")),s.addLayer(r,a),s}function Ne(e,t,i){return!i.has(e.name.toLowerCase())&&(0,j.isFieldVisibleByDefault)(e,t)}function Ae(e){return(0,ue.Sv)(e)&&e.parent&&(e=e.parent),e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone?_.L5:e&&"preferredTimeZone"in e&&e.preferredTimeZone?e.preferredTimeZone:null}let De=class extends l.A.EventedAccessor{constructor(e){super(e),this.activeFeatureIndex=-1,this.disabled=!1,this.editType="NA",this.features=new s.default,this.map=null,this.spatialReference=null,this.submitHasBeenAttempted=!1,this.timeZone=null,this.userHasChangedValues=!1,this._arcadeExecutorProvider=new b,this._activeFormInputsByElementId=new Map,this._emptyForm=new W({inputs:[]}),this._emptyFormTemplate=new ae({elements:[]}),this._featureFormMap=new Map,this._prepareTask=null,this._reactiveGraphicLookup=new c.A,this._updatingHandles=new v.U,this._layerTemplateMap=new c.A,this._layerContingentValuesMap=new c.A,this._workingFeatures=new s.default,this._expressionsManager=new A({arcadeContext:{editType:"NA",spatialReference:null,map:null,timeZone:_.qU}}),this.sharedForm=this._emptyForm,this.sharedFormTemplate=this._emptyFormTemplate}initialize(){this.addHandles([(0,f.on)((()=>this.features),"after-changes",(()=>this._prepare()),{sync:!0}),(0,f.watch)((()=>[this.features,this.map,this.timeZone,this.editType]),(()=>{this._prepare()}),f.sync),(0,f.watch)((()=>this.activeForm),(()=>this._activeFormInputsByElementId.clear()),f.sync)]),this._prepare()}destroy(){this._prepareTask=(0,d.DC)(this._prepareTask),this._workingFeatures.destroyAll(),this._expressionsManager&&this._expressionsManager.abort(),this._reactiveGraphicLookup=new c.A,this._emptyForm.destroy(),this._emptyFormTemplate.destroy()}get _effectiveTimeZone(){var e;return null!==(e=this.timeZone)&&void 0!==e?e:"system"}get activeFeature(){const e=this.activeFeatureIndex;return e<0?null:this.features.at(e)}get activeForm(){if("batch"===this.mode)return this.sharedForm;const e=this._workingFeatures.at(this.activeFeatureIndex);if(!e)return this._emptyForm;const t=this._featureFormMap.get(e);if(t)return t;const i=this._makeBatchFormInputsForFeature(e);return i!==this._emptyForm&&this._featureFormMap.set(e,i),i}get calculating(){return this._expressionsManager.calculating}get expressionEvaluationFailed(){return this._expressionsManager.expressionEvaluationFailed}get hasNonActiveInvalidFeatures(){if("batch"===this.mode)return!1;const{activeFeature:e}=this;return this.invalidFeatures.some((t=>t!==e))}get invalidFeatures(){return this.sharedForm.invalidFeatures}get hasVisibleInputs(){return this.visibleInputs.length>0}get hasLayersWithContingentValues(){for(const e of this.layers){const t=this._layerContingentValuesMap.get(e);if(t&&t.size>0)return!0}return!1}get visibleInputs(){return this.activeForm.inputs.filter((e=>e.visible))}get noVisibleElementsReason(){if(this.hasVisibleInputs)return null;if(0===this.activeForm.inputs.length)return Z.sO.noElements;const e=new Set;for(const t of this.activeForm.inputs)switch(t.visibilityCode){case Z.qp.HIDDEN_NOT_IN_ALL_LAYERS:case Z.qp.HIDDEN_NO_DOMAIN_IN_COMMON:e.add(Z.sO.noElementsInCommon);break;case Z.qp.HIDDEN_FIELD_DEFINITION:case Z.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:case Z.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:e.add(Z.sO.allElementsHidden);break;case Z.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:case Z.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:return Z.sO.elementsHiddenInSome}return e.has(Z.sO.allElementsHidden)?Z.sO.allElementsHidden:Z.sO.noElementsInCommon}get status(){const e=this._prepareTask;return null==e?"not-loaded":e.finished?null!=e.error?"failed":"loaded":"loading"}get submittable(){return this.valid,!0}get updating(){return this._updatingHandles.updating||this.calculating}get valid(){return this.sharedForm.valid}get layers(){const e=new Set;return this.features.forEach((t=>{var i;const n=null!==(i=t.sourceLayer)&&void 0!==i?i:t.layer;e.add(n)})),Array.from(e)}get mode(){return this.activeFeatureIndex>-1?"single":"batch"}submit(){this.submitHasBeenAttempted=!0,this.emit("submit",{})}findFieldInput(e){if(null==e)return;const t=this._activeFormInputsByElementId;if(t.has(e))return t.get(e);const i=this.activeForm.allFieldInputs.find((t=>t.template.elementId===e));return void 0!==i?(t.set(e,i),i):void 0}getFirstVisibleInvalidFieldInput(){if(this.hasVisibleInputs&&!this.activeForm.valid)for(const e of this.visibleInputs){if((0,Z.Et)(e)){const t=e.inputs.find((e=>!e.valid));if(t)return{input:t,groupInput:e}}if((0,Z.rf)(e)&&!e.valid)return{input:e}}}getFieldInputValue(e){var t;return null===(t=this.findFieldInput(e))||void 0===t?void 0:t.value}getValues(e){const t=this._workingFeatures.find((t=>{let{original:i}=t;return i===e}));if(!t)throw new a.default("feature-not-found","The given feature is not present in the BatchAttributeForm");return(0,n.A)({},t.attributes)}setFieldInputValue(e,t){const i=new Set(this.invalidFeatures);e.setValueFromUser(t),this.userHasChangedValues=!0,this._trackValidityChange(i),this.emit("value-change",{features:e.features.toArray().map((e=>e.original)),fieldName:e.fieldName,name:"value-change",value:t})}setValue(e,t){const i=this.findFieldInput(e);if(null==i)throw new a.default("no-FieldInput-found","Cannot set the value of FieldInput with ID: ".concat(e," because none was found in the active form"));this.setFieldInputValue(i,t)}userChangesHaveMadeFeatureInvalid(e){var t;return!(null===(t=this._reactiveGraphicLookup.get(e))||void 0===t||!t.userChangesHaveMadeInvalid)}async _trackValidityChange(e){await(0,f.whenOnce)((()=>!1===this.calculating));const t=this.invalidFeatures;for(const i of t)!1===e.has(i)&&this._reactiveGraphicLookup.has(i)&&(this._reactiveGraphicLookup.get(i).userChangesHaveMadeInvalid=!0)}validate(){return!1}_makeBatchFormInputsForFeature(e){const t=this._layerTemplateMap.get(e.layer);return t?re(t,new s.default([e]),this._expressionsManager):this._emptyForm}async _prepare(){var e;this._prepareTask=(0,d.DC)(this._prepareTask),this._updateWorkingFeatures(),(0,d.DC)(this._expressionsManager),this.userHasChangedValues=!1,this._expressionsManager=new A({arcadeContext:{editType:this.editType,spatialReference:null!==(e=this.spatialReference)&&void 0!==e?e:y.default.WebMercator,map:this.map,timeZone:this._effectiveTimeZone}});const{layers:t}=this;if(0===t.length)return;const i=(0,o.UT)((async e=>{try{(0,p.throwIfAborted)(e);const i=new Map;for(const e of t){const t=await pe(e);if(t){const i=t.fieldGroups.flatMap((e=>e.fields));this._layerContingentValuesMap.set(e,new Set(i))}else this._layerContingentValuesMap.set(e,new Set);const n=await Ze(e,{arcadeExecutorProvider:this._arcadeExecutorProvider,formTimeZone:this._effectiveTimeZone});this._layerTemplateMap.set(e,n),this._expressionsManager.layerExpressionsModelMap.set(e,new P({preserveFieldValuesWhenHidden:n.preserveFieldValuesWhenHidden,executorMap:n.getExpressionExecutorsForLayer(e)}));for(const e of n.elements){const{elementId:t}=e;i.has(t)?i.get(t).foldIn(e):i.set(t,e.clone())}}const n=new ae({elements:Array.from(i.values())});this.sharedFormTemplate=n,this.sharedForm=re(n,this._workingFeatures,this._expressionsManager),await this._expressionsManager.runAllExpressions(this._workingFeatures)}catch(i){throw u.A.getLogger(this).error("Failed preparing form",i),i}}));this._updatingHandles.addPromise(i.promise),this._prepareTask=i}_updateWorkingFeatures(){this._workingFeatures.destroyAll();const{features:e}=this;if(this._reactiveGraphicLookup=new c.A,0!==e.length){this._workingFeatures.addMany(e.map(g.IS));for(const e of this._workingFeatures)this._reactiveGraphicLookup.set(e.original,e)}}};(0,r._)([(0,h.MZ)()],De.prototype,"_effectiveTimeZone",null),(0,r._)([(0,h.MZ)({readOnly:!0})],De.prototype,"activeFeature",null),(0,r._)([(0,h.MZ)()],De.prototype,"activeFeatureIndex",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],De.prototype,"activeForm",null),(0,r._)([(0,h.MZ)()],De.prototype,"disabled",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"calculating",null),(0,r._)([(0,h.MZ)()],De.prototype,"editType",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"features",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"expressionEvaluationFailed",null),(0,r._)([(0,h.MZ)()],De.prototype,"hasNonActiveInvalidFeatures",null),(0,r._)([(0,h.MZ)()],De.prototype,"invalidFeatures",null),(0,r._)([(0,h.MZ)()],De.prototype,"hasVisibleInputs",null),(0,r._)([(0,h.MZ)()],De.prototype,"hasLayersWithContingentValues",null),(0,r._)([(0,h.MZ)()],De.prototype,"visibleInputs",null),(0,r._)([(0,h.MZ)()],De.prototype,"map",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"noVisibleElementsReason",null),(0,r._)([(0,h.MZ)()],De.prototype,"spatialReference",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"submitHasBeenAttempted",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"timeZone",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"updating",null),(0,r._)([(0,h.MZ)()],De.prototype,"valid",null),(0,r._)([(0,h.MZ)()],De.prototype,"layers",null),(0,r._)([(0,h.MZ)()],De.prototype,"mode",null),(0,r._)([(0,h.MZ)()],De.prototype,"sharedForm",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"sharedFormTemplate",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"userHasChangedValues",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_arcadeExecutorProvider",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_prepareTask",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_reactiveGraphicLookup",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_layerTemplateMap",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_layerContingentValuesMap",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_workingFeatures",void 0),(0,r._)([(0,h.MZ)()],De.prototype,"_expressionsManager",void 0),De=(0,r._)([(0,m.$)("esri.widgets.BatchAttributeForm.BatchAttributeFormViewModel")],De);const Oe=De},86950:(e,t,i)=>{i.d(t,{Et:()=>u,hJ:()=>p,n8:()=>a,ng:()=>d,pg:()=>n,qp:()=>s,rf:()=>l,sO:()=>o,uB:()=>r});const n="esri_BatchAttributeForm_different_values";var r,o,s;function a(e){return e===s.VISIBLE}function l(e){return"field"===e.type}function u(e){return"group"===e.type}function d(e,t){return"".concat(e,":").concat(t)}!function(e){e.DIFFERENT_ERRORS="batch-attribute-form-validation::features-have-different-errors"}(r||(r={})),function(e){e.noElementsInCommon="noElementsInCommon",e.noElements="noElements",e.elementsHiddenInSome="elementsHiddenInSome",e.allElementsHidden="allElementsHidden"}(o||(o={})),function(e){e.HIDDEN_FIELD_DEFINITION="hidden:field-definition",e.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL="hidden:group-visibility-expression:all-features",e.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME="hidden:group-visibility-expression:some-features",e.HIDDEN_NO_DOMAIN_IN_COMMON="hidden:no-domain-in-common",e.HIDDEN_NOT_IN_ALL_LAYERS="hidden:not-in-all-layers",e.HIDDEN_VISIBILITY_EXPRESSION_ALL="hidden:visibility-expression:all-features",e.HIDDEN_VISIBILITY_EXPRESSION_SOME="hidden:visibility-expression:some-features",e.VISIBLE="visible"}(s||(s={}));const p=e=>null!=e&&(c(e,"combo-box")||c(e,"radio-buttons"));function c(e,t){return(null===e||void 0===e?void 0:e.type)===t}}}]);
//# sourceMappingURL=66845.d31250f6.chunk.js.map