"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[9912,87531,90230],{9912:(e,t,i)=>{i.r(t),i.d(t,{applyTextFormattingHTML:()=>X,createFieldInfoMap:()=>W,findRelatedLayer:()=>ue,findUtilityNetwork:()=>se,fixTokens:()=>O,formatAttributes:()=>K,formatEditInfo:()=>Q,formatValueToFieldInfo:()=>H,getAllFieldInfos:()=>J,getFieldInfo:()=>G,getFieldInfoLabel:()=>x,getFixedFieldName:()=>D,getFixedFieldNames:()=>L,getHighlightKeyForFeature:()=>pe,getSourceLayer:()=>w,graphicCallback:()=>T,htmlEntities:()=>$,isAssociatedFeatureSupportedLayer:()=>j,isExpressionField:()=>M,isFeatureSupportedLayer:()=>S,isGraphicForRelatableFeatureSupportedLayer:()=>z,isRelatableFeatureSupportedLayer:()=>P,isRelatableLayer:()=>U,isRelatedField:()=>ie,preLayerQueryCallback:()=>re,preRequestCallback:()=>ae,querySourceLayer:()=>ee,queryUpdatedFeature:()=>te,shouldOpenInNewTab:()=>E,substituteAttributes:()=>V,substituteFieldsInLinksAndAttributes:()=>R});var n=i(89379),l=i(81806),o=i(76460),r=i(88685),a=i(65256),u=i(50265),s=i(53430),d=i(31933),c=i(42633),p=i(98976),f=i(67478);const m=()=>o.A.getLogger("esri.widgets.Feature.support.featureUtils"),v=/href=(""|'')/gi,h=/(\{([^{\r\n]+)\})/g,y=/'/g,g=/^\s*expression\//i,F=/(\n)/gi,b=/[\u00A0-\u9999<>&]/gim,I=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,_=/^(?:mailto:|tel:)/,Z="relationships/",C=(0,a.J2)("short-date-short-time");function w(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}async function T(e){let{type:t,value:i,event:n}=e;try{return"function"==typeof i?i(n):await i}catch(l){return void m().error("error",'An error occurred when calling the "'.concat(t,'" function'),{error:l,graphic:n.graphic,value:i})}}function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!_.test(e.trim().toLowerCase())}function M(e){return!!e&&g.test(e)}function x(e,t){const i=function(e,t){if(!t||!M(t)||!e)return;const i=t.replace(g,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===i}))}(t,null===e||void 0===e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function D(e,t){const i=N(t,e);return i?i.name:e}function L(e,t){return e&&e.map((e=>D(e,t)))}function N(e,t){var i;return e&&"function"==typeof e.getField&&t&&null!==(i=e.getField(t))&&void 0!==i?i:null}function A(e){return"".concat(e).trim()}function R(e){let{attributes:t,globalAttributes:i,layer:l,text:o,expressionAttributes:r,fieldInfoMap:a}=e;return o?V({formattedAttributes:i,template:q(o,(0,n.A)((0,n.A)((0,n.A)({},i),r),t),l),fieldInfoMap:a}):""}function V(e){let{formattedAttributes:t,template:i,fieldInfoMap:n}=e;return A(function(e){return e.replaceAll(v,"")}((0,r.HC)((0,r.HC)(i,(e=>function(e,t){const i=t.get(e.toLowerCase());return"{".concat((null===i||void 0===i?void 0:i.fieldName)||e,"}")}(e,n))),t)))}function k(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=(0,n.A)({},e);return Object.keys(i).forEach((e=>function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t[e];if("string"==typeof n){const l="%27",o=(i?encodeURIComponent(n):n).replaceAll(y,l);t[e]=o}}(e,i,t))),i}function O(e,t){return e.replaceAll(h,((e,i,n)=>{const l=N(t,n);return l?"{".concat(l.name,"}"):i}))}function q(e,t,i){const n=O(e,i);return n?n.replaceAll(I,((e,i,n)=>function(e,t,i){const n=(t=A(t))&&"{"!==t[0];return(0,r.HC)(e,k(i,n||!1))}(e,i||n,t))):n}function S(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function U(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function P(e){return S(e)&&U(e)}function j(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function z(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&P(e.sourceLayer)}function H(e,t){const{fieldInfos:i,fieldName:l,preventPlacesFormatting:o,layer:r,timeZone:a}=t,d=G(i,l),p=N(r,l);if(d&&!(0,s.isRasterPixelValueField)(l)){var f;const t=null===p||void 0===p?void 0:p.type,i=null===(f=d.format)||void 0===f?void 0:f.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||i)return(0,c.i0)(e,{format:i,fieldType:t,timeZoneOptions:{layerTimeZone:r&&"preferredTimeZone"in r?r.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone}})}const m=null===d||void 0===d?void 0:d.format;return"string"==typeof e&&(0,s.isRasterPixelValueField)(l)&&m?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?B(e,",",", ",t):e.includes(";")?B(e,";","; ",t):e.includes(" ")?B(e," "," ",t):(0,u.ZV)(Number(e),(0,u.yx)(t))}(e,m):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,m))||null==e||null==m?X(e):(0,u.ZV)(e,o?(0,n.A)((0,n.A)({},(0,u.yx)(m)),{},{minimumFractionDigits:0,maximumFractionDigits:20}):(0,u.yx)(m))}function B(e,t,i,n){return e.trim().split(t).map((e=>(0,u.ZV)(Number(e),(0,u.yx)(n)))).join(i)}function G(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find((e=>{var i;return(null===(i=e.fieldName)||void 0===i?void 0:i.toLowerCase())===t.toLowerCase()}))}function Q(e,t,i,l){const{creatorField:o,creationDateField:r,editorField:u,editDateField:s}=e;if(!t)return;const d=(0,f.hv)(l&&"preferredTimeZone"in l?l.preferredTimeZone:null,!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone,i,C,"date"),c=(0,n.A)((0,n.A)({},C),d),p=t[s];if("number"==typeof p){const e=t[u];return{type:"edit",date:(0,a.Yq)(p,c),user:e}}const m=t[r];if("number"==typeof m){const e=t[o];return{type:"create",date:(0,a.Yq)(m,c),user:e}}return null}function W(e,t){const i=new Map;if(!e)return i;for(const n of e){if(!n.fieldName)continue;const e=D(n.fieldName,t);n.fieldName=e,i.set(e.toLowerCase(),n)}return i}function J(e){const t=[];if(!e)return t;const{fieldInfos:i,content:n}=e;return i&&t.push(...i),n&&Array.isArray(n)?(n.forEach((e=>{if("fields"===e.type){const i=null===e||void 0===e?void 0:e.fieldInfos;i&&t.push(...i)}})),t):t}function $(e){return e.replaceAll(b,(e=>"&#".concat(e.charCodeAt(0),";")))}function X(e){return"string"==typeof e?e.replaceAll(F,'<br class="esri-text-new-line" />'):e}function Y(e){var t;const{value:i,fieldName:n,fieldInfos:o,fieldInfoMap:r,layer:a,graphic:u,timeZone:d}=e;if(null==i)return"";const p=function(e){let{fieldName:t,value:i,graphic:n,layer:o}=e;if(ie(t))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const r=n&&o.getFieldDomain(t,{feature:n,excludeImpliedDomains:(0,l.A)("esri-widget-legacy-field-domain-calculation")});return r&&"coded-value"===r.type?r.getName(i):null}({fieldName:n,value:i,graphic:u,layer:a});if(p)return p;const f=function(e){let{fieldName:t,graphic:i,layer:n}=e;if(ie(t))return null;if(!n||"function"!=typeof n.getFeatureType)return null;const{typeIdField:l}=n;if(!l||t!==l)return null;const o=n.getFeatureType(i);return o?o.name:null}({fieldName:n,graphic:u,layer:a});if(f)return f;if(r.get(n.toLowerCase()))return H(i,{fieldInfos:o||Array.from(r.values()),fieldName:n,layer:a,timeZone:d});const m=null===a||void 0===a||null===(t=a.fieldsIndex)||void 0===t?void 0:t.get(n);return m&&((0,c.fs)(m)||(0,s.isTimeOnlyField)(m))?(0,c.i0)(i,{fieldType:m.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}}):X(i)}function K(e){let{fieldInfos:t,attributes:i,layer:n,graphic:l,fieldInfoMap:o,relatedInfos:r,timeZone:a}=e;const u={};return null!==r&&void 0!==r&&r.forEach((e=>function(e){var t,i;let{attributes:n,relatedInfo:l,fieldInfoMap:o,fieldInfos:r,layer:a,timeZone:u}=e;n&&l&&(null!==(t=l.relatedFeatures)&&void 0!==t&&t.forEach((e=>ne({attributes:n,graphic:e,relatedInfo:l,fieldInfoMap:o,fieldInfos:r,layer:a,timeZone:u}))),null===(i=l.relatedStatsFeatures)||void 0===i||i.forEach((e=>ne({attributes:n,graphic:e,relatedInfo:l,fieldInfoMap:o,fieldInfos:r,layer:a,timeZone:u}))))}({attributes:u,relatedInfo:e,fieldInfoMap:o,fieldInfos:t,layer:n,timeZone:a}))),i&&Object.keys(i).forEach((e=>{const r=i[e];u[e]=Y({fieldName:e,fieldInfos:t,fieldInfoMap:o,layer:n,value:r,graphic:l,timeZone:a})})),u}async function ee(e,t){var i;const{layer:n,graphic:l,outFields:o,objectIds:r,returnGeometry:a,spatialReference:u}=e,s=r[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:l,objectId:s,requiredFields:o};return m().warn(e,t),null}if(null===(i=(0,d.BR)(n))||void 0===i||null===(i=i.operations)||void 0===i||!i.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:l,requiredFields:o,returnGeometry:a};return m().warn(e,t),null}const c=n.createQuery();return c.objectIds=r,c.outFields=null!==o&&void 0!==o&&o.length?o:[n.objectIdField],c.returnGeometry=!!a,c.returnZ=!!a,c.returnM=!!a,c.outSpatialReference=u,(await n.queryFeatures(c,t)).features[0]}async function te(e,t){let{graphic:i,popupTemplate:l,layer:o,spatialReference:r}=e;if(!o||!l)return;if("function"==typeof o.load&&await o.load(t),!i.attributes)return;const a=o.objectIdField,u=i.attributes[a];if(null==u)return;const d=[u],c=await l.getRequiredFields(o.fieldsIndex),f=(0,s.featureHasFields)(c,i),m=f?[]:c.includes(a)?c:[...c,a],v=l.returnGeometry||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const i=await(0,p.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=i;return n(e)}(l);if(f&&!v)return;const h=await ee({layer:o,graphic:i,outFields:m,objectIds:d,returnGeometry:v,spatialReference:r},t);h&&(h.geometry&&(i.geometry=h.geometry),h.attributes&&(i.attributes=(0,n.A)((0,n.A)({},i.attributes),h.attributes)))}function ie(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(Z)}function ne(e){let{attributes:t,graphic:i,relatedInfo:n,fieldInfos:l,fieldInfoMap:o,layer:r,timeZone:a}=e;t&&i&&n&&Object.keys(i.attributes).forEach((e=>{const u=function(e){return"".concat(Z).concat(e.layerId,"/").concat(e.fieldName)}({layerId:n.relation.id.toString(),fieldName:e}),s=i.attributes[e];t[u]=Y({fieldName:u,fieldInfos:l,fieldInfoMap:o,layer:r,value:s,graphic:i,timeZone:a})}))}const le=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},oe=e=>{var t;let{layer:i,method:n,query:l,definitionExpression:o}=e;if(null===(t=i.capabilities)||void 0===t||null===(t=t.query)||void 0===t||!t.supportsCacheHint||"attachments"===n)return;const r=null!=l.where?l.where:null,a=null!=l.geometry?l.geometry:null;le(o)||le(r)||"extent"===(null===a||void 0===a?void 0:a.type)||"tile"===l.resultType||(l.cacheHint=!0)},re=e=>{var t;let{query:i,layer:n,method:l}=e;oe({layer:n,method:l,query:i,definitionExpression:"".concat(n.definitionExpression," ").concat(null!==(t=n.serviceDefinitionExpression)&&void 0!==t?t:"")})},ae=e=>{var t;let{queryPayload:i,layer:n,method:l}=e;oe({layer:n,method:l,query:i,definitionExpression:"".concat(n.definitionExpression," ").concat(null!==(t=n.serviceDefinitionExpression)&&void 0!==t?t:"")})};function ue(e,t,i){var n,l;return e&&t&&i?"sublayer"===t.type?ce({layers:null===(n=t.layer)||void 0===n?void 0:n.sublayers,map:e,relatedLayer:t,relationship:i})||ce({layers:null===(l=t.layer)||void 0===l?void 0:l.subtables,map:e,relatedLayer:t,relationship:i}):ce({layers:e.allLayers,map:e,relatedLayer:t,relationship:i})||ce({layers:e.allTables,map:e,relatedLayer:t,relationship:i}):null}function se(e,t){var i;return e&&"utilityNetworks"in e&&t?null===(i=e.utilityNetworks)||void 0===i?void 0:i.find((e=>e.isUtilityLayer(t))):null}function de(e,t){return null===e||void 0===e?void 0:e.allTables.find((e=>{var i;return"feature"===e.type&&e.layerId===t.id&&e.url===(null===(i=t.layer)||void 0===i?void 0:i.url)}))}function ce(e){let{map:t,relationship:i,relationship:{relatedTableId:n},relatedLayer:l,layers:o}=e;if(!o)return null;for(const a of o){var r;if("map-image"===a.type){const e=ce({layers:a.sublayers,map:t,relatedLayer:l,relationship:i})||ce({layers:a.subtables,map:t,relatedLayer:l,relationship:i});if(e)return e;continue}if(!P(a))continue;if("sublayer"===l.type){if(a!==l&&a.id===n)return a.isTable?de(t,a):a;continue}const e="scene"===l.type&&l.associatedLayer?l.associatedLayer.url:l.url;if(!e)return null;if("sublayer"!==a.type){if(a!==l&&a.url===e&&a.layerId===n)return a}else if(a!==l&&(null===(r=a.layer)||void 0===r?void 0:r.url)===e&&a.id===n)return a.isTable?de(t,a):a}return null}function pe(e){const t=e.getObjectId();return null!=t?"oid:".concat(t):"uid:".concat(e.uid)}},66635:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var n=i(89379),l=i(35143),o=i(76460),r=i(46053),a=(i(81806),i(47249),i(85842)),u=i(65256),s=i(50265),d=i(70445),c=i(91447),p=i(44135),f=i(53430),m=i(42633),v=i(36693),h=i(67478),y=i(65529),g=i(70590),F=i(95843);const b="Enter",I="Escape";let _=class extends g.default{constructor(e){super(e),this.editInfo=null,this.cellValueValidatorFunction=e=>{let{oldValue:t,value:i}=e;return t!==i},this.editable=!0,this.headerRenderFunction=e=>{const{root:t}=e,i=this.createHeaderContent();this.tableEditingEnabled&&!this.effectiveEditable&&i.prepend(this._lockIconNode),this.removeCellContent(t),t.appendChild(i)},this.inputRenderFunction=e=>{let{root:t,column:i,rowData:n}=e;if(this.editInfo||!this.effectiveEditable||!n)return;const l=this.getCellValue(n),o=this.createInputElement({value:l});this._set("editInfo",{column:i,inputs:[o],root:t,rowData:n,oldValue:l});const r=document.createElement("div");r.appendChild(o),this.removeCellContent(t),t.appendChild(r),o.focus(),o instanceof HTMLInputElement&&o.select()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.onShowPromptCallback=()=>{},this.parseInputValueFunction=e=>{let{inputs:t}=e;return null!==t&&void 0!==t&&t.length||1!==t.length||Array.isArray(t[0].value)?null:t[0].value},this.renderFunction=e=>{var t;const{root:i,rowData:n}=e,{editInfo:l}=this;if(l)return;const o=this.getCellValue(n),r=this.cellValueFormatFunction({root:i,rowData:n,value:o});let a=null;i.onclick=()=>i.focus(),i.ondblclick=()=>this.inputRenderFunction(e),i.ontouchend=()=>this.inputRenderFunction(e);const u=null===(t=this.grid)||void 0===t?void 0:t.getSlotElementByName(i.slot),s=null===u||void 0===u?void 0:u.parentElement;s&&!s.onkeydown&&(s.onkeydown=t=>{t.key!==b||this.editInfo||this.inputRenderFunction(e),t.key===I&&this.editInfo&&this.cancel()}),null!=o&&null!=r?i.title=r.toString():i.title&&i.removeAttribute("title"),a=r instanceof HTMLElement?r:(0,F.Q)(this.messagesURIUtils,r),this.removeCellContent(i),a instanceof HTMLElement?i.appendChild(a):null!=a&&(i.innerHTML=a.toString())},this.required=!1,this.tableEditingEnabled=!1}get _lockIconNode(){var e;return this.createCalciteIcon({icon:"lock",textLabel:null===(e=this.messages)||void 0===e?void 0:e.editingPreventedColumn})}get effectiveEditable(){return this.tableEditingEnabled&&this.editable}get effectiveRequired(){return this.required}get editing(){return!!this.editInfo}get shouldShowPrompt(){return!1}cancel(){const{editInfo:e}=this;if(!e)return;const{column:t,root:i,rowData:n}=e;this.onEditComplete(),this.renderFunction({column:t,root:i,rowData:n})}createCalciteOption(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=document.createElement("calcite-option");return n.label=e,n.value="".concat(t),n.selected=i,n}createCalciteSelect(e,t){const{effectiveRequired:i,messages:n}=this;let l=!1;const o=t.map((t=>{let{name:i,value:n}=t;const o=n===e;return o&&(l=!0),this.createCalciteOption(i,n,o)}));if(null!=e&&""!==e&&!l){const t=e.toString(),i=this.createCalciteOption(t,t);o.unshift(i)}i||o.unshift(this.createCalciteOption("<".concat(null===n||void 0===n?void 0:n.noValue,">"),""));const r=document.createElement("calcite-select");return o.forEach((e=>r.appendChild(e))),r}createInputElement(e){let{value:t}=e;const{effectiveRequired:i,maxLength:n}=this,l=document.createElement("calcite-input");return null!=n&&(l.maxLength=n),l.required=i,l.value=t,l.addEventListener("calciteInputChange",(()=>this.onInputBlur(l))),l.onkeydown=e=>{e.key===I&&this.onInputBlur(l,!0)},l.onblur=()=>this.onInputBlur(l),l}createDateComponent(){const e=document.createElement("calcite-input-date-picker");return e.focusTrapDisabled=!0,e.overlayPositioning="fixed",e}createTimeComponent(){const e=document.createElement("calcite-input-time-picker");return e.overlayPositioning="fixed",e.placement="auto-start",e.step=1,e}createTimeZoneComponent(){const e=document.createElement("calcite-input-time-zone");return e.maxItems=4,e.overlayPositioning="fixed",e}onEditComplete(){var e;this._set("editInfo",null),null===(e=this.grid)||void 0===e||e.generateCellPartNames()}onInputBlur(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.onblur=null,t?this.cancel():this.submit()}async submit(){const{editInfo:e}=this;if(!e)return void this.cancel();const{inputs:t,rowData:i,oldValue:n}=e,l=this.parseInputValueFunction({inputs:t});if(!this.cellValueValidatorFunction({value:l,oldValue:n}))return void this.cancel();const{root:o}=e,r=i.item.objectId,{fieldName:a}=this;o.textContent=this.loadingMessage,this.shouldShowPrompt?this.onShowPromptCallback({column:this,objectId:r,oldValue:n,value:l}):await this.updateItems({objectId:r,updates:[{fieldName:a,value:l}]})}async updateItems(e){const{store:t}=this;if(t)try{await t.updateItem(e),this.onEditComplete()}catch(i){this.cancel()}else this.cancel()}};(0,l._)([(0,r.MZ)()],_.prototype,"_lockIconNode",null),(0,l._)([(0,r.MZ)({readOnly:!0})],_.prototype,"editInfo",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"cellValueValidatorFunction",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"editable",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"effectiveEditable",null),(0,l._)([(0,r.MZ)()],_.prototype,"effectiveRequired",null),(0,l._)([(0,r.MZ)()],_.prototype,"editing",null),(0,l._)([(0,r.MZ)()],_.prototype,"headerRenderFunction",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"inputRenderFunction",void 0),(0,l._)([(0,r.MZ)({constructOnly:!0})],_.prototype,"loadingMessage",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"inputType",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"maxLength",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"onShowPromptCallback",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"parseInputValueFunction",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"renderFunction",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"required",void 0),(0,l._)([(0,r.MZ)()],_.prototype,"shouldShowPrompt",null),(0,l._)([(0,r.MZ)()],_.prototype,"tableEditingEnabled",void 0),_=(0,l._)([(0,a.$)("esri.widgets.FeatureTable.Grid.EditorColumn")],_);const Z=_;var C=i(78984),w=i(20639),T=i(76099);const E="Escape",M="esri-column",x={input:"".concat(M,"__cell-input"),inputContainer:"".concat(M,"__cell__input-container")},D=(0,u.J2)("short-date-short-time"),L=(0,u.J2)("short-date"),N={useGrouping:!0,maximumFractionDigits:20};let A=class extends Z{constructor(e){super(e),this._activeFieldInput=null,this.cellValueFormatFunction=e=>{var t;let{root:i,rowData:n,value:l}=e;const{formatFunction:o}=this;if(o&&n){const{index:e,item:{attachments:t,feature:r,relatedRecords:a}}=n;return o({attachments:t,column:this,feature:r,field:this.field,index:e,relatedRecords:a,value:T.W5.sanitize(l),virtualIndex:this.getVirtualRowIndex(i)})}if(null===l)return"&nbsp;";const{field:r}=this,a=this._getDomainForFeature(null===n||void 0===n||null===(t=n.item)||void 0===t?void 0:t.feature);if(a){const e=this._getComputedDomain(l,a);if("date"===r.type&&"range"===a.type)return this._formatDateValueForDisplay(r,e);if(this._isNumericField&&"range"===a.type){var u;const e=null===(u=this.template)||void 0===u?void 0:u.format,t=e?(0,s.yx)(e):N;return(0,s.ZV)(parseFloat(l),t)}return w.sH.has(r.type)?"range"===a.type?T.W5.sanitize((0,w.ZP)(r,e)):T.W5.sanitize(e):e}if("date"===r.type||w.sH.has(r.type))return this._formatDateValueForDisplay(r,l);if(this._isNumericField){var d;const e=null===(d=this.template)||void 0===d?void 0:d.format,t=e?(0,s.yx)(e):N;return(0,s.ZV)(parseFloat(l),t)}return T.W5.sanitize(l)},this.cellValueValidatorFunction=e=>{let{oldValue:t,value:i}=e;const{_effectiveRange:n,field:l}=this,{max:r,min:a}=n;if(this.effectiveRequired&&(null==i||""===i))return!1;if(this._isNumericField&&((0,f.validateFieldValue)(l,i)||!(0,w.eX)({max:r,min:a,value:i})))return o.A.getLogger(this).warn("value-exceeds-valid-range","Field value exceeds valid range. Attempted edit was rejected."),!1;if(this._isAnyDateOrTimeField){const e=l.type;if(!(0,w.yk)({type:e,range:n,value:i}))return!1}return t!==i},this.field=null,this.formatFunction=null,this.inputRenderFunction=async e=>{var t,i;let{root:n,column:l,rowData:r}=e;if(this.editInfo||!this.effectiveEditable)return;const a=this.getCellValue(r),{field:u}=this;if("big-integer"===u.type&&(0,f.validateFieldValue)(u,a))return void o.A.getLogger(this).warn("value-exceeds-valid-range","Field value is beyond supported limit. Editing is disabled for this field value.");const s=null===r||void 0===r?void 0:r.item.feature;if(!s)return;this._activeFieldInput=this._setUpFieldInput(s,a);const d=document.createElement("div");d.classList.add(x.inputContainer);const c=[],p="coded-value"===(null===(t=this._effectiveDomain)||void 0===t?void 0:t.type);if(this._isAnyDateOrTimeField&&!p){const e=document.createElement("div"),t=this._setUpDateComponents(a),i=this._setUpDateActionBar();t.forEach((t=>e.appendChild(t))),d.appendChild(e),d.appendChild(i),c.push(...t)}else{const e=this.createInputElement({value:a});d.appendChild(e),c.push(e)}this._set("editInfo",{column:l,inputs:c,root:n,rowData:r,oldValue:a}),this.removeCellContent(n),n.appendChild(d),this._syncRowEditingState(n,!0),null===(i=this.grid)||void 0===i||i.generateCellPartNames();const m=c[0];await(0,T.Z6)(m),"selectText"in m&&await m.selectText()},this.layer=null,this.parseInputValueFunction=e=>{let{inputs:t}=e;const{editInfo:i,field:n,includeTime:l}=this;if(!i||!t.length)return null;const o=t[0];if(this._isAnyDateOrTimeField){var r,a;if("coded-value"===(null===(r=this._effectiveDomain)||void 0===r?void 0:r.type)){if(null==o.value)return null;const e=String(o.value);return(0,f.isDateField)(n)?parseFloat(e):e}const{timeZone:e}=this.effectiveTimeZoneOptions,u=null!==(a=i.oldValue)&&void 0!==a?a:void 0;switch(n.type){case"date-only":{const e=o.value;return""!==e?e:null}case"time-only":{const e=(0,w.iP)(o.value);return""!==e?e:null}case"timestamp-offset":{const i=l?t[1]:void 0,n=t.at(-1);return(0,w.Ng)({oldValue:u,dateComponent:o,timeComponent:i,timeZoneComponent:n,defaultTimeZone:e})}case"date":{const{max:i,min:n}=this._effectiveRange;return(0,w.oh)({oldValue:u,dateComponent:o,timeComponent:t[1],timeZone:e,max:i,min:n})}}return null}const u=o.value,{effectiveRequired:s}=this;return s||null!=u&&""!==u?this._isNumericField?parseFloat(u):this._isStringField?u.trim():u:null},this.sortable=!0,this.store=null,this.template=null,this.view=null}get _effectiveDomain(){var e;const t=null===(e=this._activeFieldInput)||void 0===e?void 0:e.feature;return t?this._getDomainForFeature(t):null}get _effectiveRange(){var e,t;return null!==(e=null===(t=this._activeFieldInput)||void 0===t?void 0:t.range)&&void 0!==e?e:{max:null,min:null}}get _isAnyDateOrTimeField(){const{field:e}=this;return(0,m.fs)(e)||(0,f.isTimeOnlyField)(e)}get _isIntegerField(){return(0,f.isIntegerField)(this.field)}get _isNumericField(){return(0,f.isNumericField)(this.field)}get _isStringField(){return(0,f.isStringField)(this.field)}get _isSubtypeField(){const{layer:e}=this;if(null!==e&&void 0!==e&&e.subtypeField){var t,i;const{subtypeField:n,fieldsIndex:l}=e;return(null!==(t=null===(i=l.get(n))||void 0===i?void 0:i.name)&&void 0!==t?t:n)===this.fieldName}return!1}get alias(){var e;return null===(e=this.field)||void 0===e?void 0:e.alias}get defaultValue(){var e;return null===(e=this.field)||void 0===e?void 0:e.defaultValue}get effectiveDescription(){const{description:e,field:t}=this,i=t.description,n=(0,C.$m)(e)?(0,C.$m)(i)?null:i:e;return null==n?null:T.W5.sanitize(n)}get effectiveEditable(){var e,t;const{editable:i,field:n,layer:l,tableEditingEnabled:o}=this;if(!n||!l)return!1;const r=(0,d.S)(l),a=null!==(e=l.effectiveCapabilities)&&void 0!==e?e:l.capabilities,u=null===a||void 0===a||null===(t=a.operations)||void 0===t?void 0:t.supportsUpdate;return!!(n.editable&&r&&u&&"oid"!==n.type&&o)&&i}get effectiveLabel(){return T.W5.sanitize(this.label||this.alias||this.fieldName)}get effectiveRequired(){var e;return!this.nullable||this._isSubtypeField||(null===(e=this._activeFieldInput)||void 0===e?void 0:e.required)||this.required}get effectiveTimeZoneOptions(){var e,t;const{layer:i,field:n}=this;if(!i||"date"!==(null===n||void 0===n?void 0:n.type)&&"timestamp-offset"!==(null===n||void 0===n?void 0:n.type))return{timeZone:void 0,timeZoneName:void 0};const{tableTimeZone:l,timeZone:o,view:r}=this;return(0,h.hv)(i.preferredTimeZone||null,!!i.datesInUnknownTimezone,null!==(e=null!==(t=null!==o&&void 0!==o?o:l)&&void 0!==t?t:null===r||void 0===r?void 0:r.timeZone)&&void 0!==e?e:v.qU,(0,u.J2)("short-time"),n.type)}get includeTime(){const{field:e,template:t}=this;return"time-only"===e.type||"date-only"!==e.type&&(!(null!==t&&void 0!==t&&t.input)||"includeTime"in t.input&&!1!==t.input.includeTime)}get loadingMessage(){var e;return(null===(e=this.messages)||void 0===e?void 0:e.loading)||"..."}get maxLength(){var e;const{field:t,template:i}=this,n=null!==(e=null===t||void 0===t?void 0:t.length)&&void 0!==e?e:-1,l=null!==i&&void 0!==i&&i.input&&"maxLength"in i.input?i.input.maxLength:null;return null!=l&&!isNaN(l)&&l>=-1&&(-1===n||l<=n)?l:n}get minLength(){const{template:e,maxLength:t}=this,i=null!==e&&void 0!==e&&e.input&&"minLength"in e.input?e.input.minLength:null;return t&&i<=t?i:null}get name(){var e;return null===(e=this.field)||void 0===e?void 0:e.name}get nullable(){return!1!==this.field.nullable}get shouldShowPrompt(){return this._isSubtypeField}createInputElement(e){let{value:t}=e;const{_effectiveDomain:i,maxLength:n,minLength:l,effectiveRequired:o}=this;let r;if("coded-value"===(null===i||void 0===i?void 0:i.type))r=this.createCalciteSelect(t,i.codedValues.map((e=>{let{code:t,name:i}=e;return{value:t,name:i}}))),r.addEventListener("calciteSelectChange",(()=>this.onInputBlur(r)));else if(this._isNumericField){const{_effectiveRange:{max:e,min:i}}=this;r=document.createElement("calcite-input"),r.type="number",this._isIntegerField&&(r.step=1),null!=e&&(r.max=e),null!=i&&(r.min=i),r.status=(0,w.eX)({max:e,min:i,value:t})?"idle":"invalid"}else r=document.createElement("calcite-input"),r.addEventListener("calciteInputChange",(()=>this.onInputBlur(r))),n>-1&&(r.maxLength=n),l>0&&(r.minLength=l);return r.classList.add(x.input),r.required=o,r.value=null!=t?t.toString():"",r.onkeydown=e=>{e.key===E&&this.onInputBlur(r,!0)},r.onblur=()=>this.onInputBlur(r),r}onEditComplete(){var e;const t=null===(e=this.editInfo)||void 0===e?void 0:e.root;t&&this._syncRowEditingState(t,!1),this._activeFieldInput=null,super.onEditComplete()}_clearActiveEditValues(){var e;null===(e=this.editInfo)||void 0===e||null===(e=e.inputs)||void 0===e||e.forEach((e=>e.value=""))}_setUpDateActionBar(){var e,t,i;const{messagesCommon:n}=this,l=null!==(e=null===n||void 0===n?void 0:n.cancel)&&void 0!==e?e:"",o=null!==(t=null===n||void 0===n?void 0:n.clear)&&void 0!==t?t:"",r=null!==(i=null===n||void 0===n?void 0:n.save)&&void 0!==i?i:"",a=document.createElement("calcite-action-bar");return a.expandDisabled=!0,a.layout="horizontal",a.appendChild(this.createCalciteAction({text:r,icon:"save",onclick:()=>this.submit()})),this.effectiveRequired||a.appendChild(this.createCalciteAction({text:o,icon:"trash",onclick:()=>{this._clearActiveEditValues(),this.submit()}})),a.appendChild(this.createCalciteAction({text:l,icon:"x",onclick:()=>this.cancel()})),a}_formatDateValueForDisplay(e,t){const{timeZone:i,timeZoneName:l}=this.effectiveTimeZoneOptions;return null!=t?(0,w.ZP)(e,t,(0,n.A)((0,n.A)({},this._getDateFormatOptions()),{},{timeZone:i,timeZoneName:l})):null}_setUpDateComponents(e){const{_effectiveRange:{max:t,min:i,rawMax:n,rawMin:l},field:o,effectiveRequired:r}=this,a=this._getDateFieldValuesForComponents(o,e),u=[];if((0,m.fs)(o)){var s,d,c;const e=this.createDateComponent(),p=(0,f.isDateOnlyField)(o)||(0,f.isTimestampOffsetField)(o)?n:t,m=(0,f.isDateOnlyField)(o)||(0,f.isTimestampOffsetField)(o)?l:i,v=this._getDateFieldValuesForComponents(o,null!==p&&void 0!==p?p:null),h=this._getDateFieldValuesForComponents(o,null!==m&&void 0!==m?m:null);e.value=null!==(s=a.date)&&void 0!==s?s:"",e.max=null!==(d=v.date)&&void 0!==d?d:"",e.min=null!==(c=h.date)&&void 0!==c?c:"",e.required=r,e.addEventListener("calciteInputDatePickerOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}if(this.includeTime){var p;const e=this.createTimeComponent();e.value=null!==(p=a.time)&&void 0!==p?p:"",e.required=r,e.addEventListener("calciteInputTimePickerOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}if("timestamp-offset"===o.type){var v;const e=this.createTimeZoneComponent();e.value=null!==(v=a.timeZoneOffset)&&void 0!==v?v:"0",e.addEventListener("calciteInputTimeZoneOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}return u}_onDateComponentOpen(e){var t;null===(t=this.editInfo)||void 0===t||t.inputs.forEach((t=>{t!==e&&"open"in t&&(t.open=!1)}))}_syncRowEditingState(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=null===(t=this.grid)||void 0===t?void 0:t.getRowContainingNode(e);n&&(i?n.setAttribute("editing","true"):n.removeAttribute("editing"))}_getDateFieldValuesForComponents(e,t){switch(e.type){case"date":return(0,w.Q0)(t,this.effectiveTimeZoneOptions.timeZone);case"date-only":return{date:t};case"time-only":return{time:t};case"timestamp-offset":return(0,w.T8)(t);default:return{}}}_setUpFieldInput(e,t){const{field:i,layer:n,effectiveTimeZoneOptions:{timeZone:l}}=this,o=new y.default({feature:e,field:i,initialFeature:e.clone(),layer:n,timeZone:l});return o.set("value",t),o}_isDomainCompatible(e){if(!e)return!1;const{_isNumericField:t,_isStringField:i}=this,{type:n}=e;if("coded-value"===n){const n=typeof e.codedValues[0].code;if("string"===n&&i||"number"===n&&t)return!0}return!("range"!==n||!t)}_getDomainForFeature(e){var t;const{fieldName:i,layer:n,template:l}=this;if(!e||null===n||void 0===n||!n.getFieldDomain)return null;if("wfs"===n.type||"geojson"===n.type||"csv"===n.type||"knowledge-graph-sublayer"===n.type)return null;if(null!==l&&void 0!==l&&l.domain&&this._isDomainCompatible(l.domain))return l.domain;if("feature"!==n.type&&"subtype-group"!==n.type&&null==(null===(t=n.getField(i))||void 0===t?void 0:t.domain)){const e=(0,c.hx)(n,i);if(e)return e}return n.getFieldDomain(i,{feature:e})}_getComputedDomain(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const i=t.codedValues.filter((t=>t.hasOwnProperty("code")&&t.code===e));return i&&i.length?i[0].name:e}return null}_getDateFormatOptions(){var e;const{template:t}=this,i=null===t||void 0===t||null===(e=t.format)||void 0===e?void 0:e.dateFormat;return i?(0,u.J2)(i):null!==t&&void 0!==t&&t.input&&"includeTime"in t.input&&!1===t.input.includeTime?L:D}};(0,l._)([(0,r.MZ)()],A.prototype,"_effectiveDomain",null),(0,l._)([(0,r.MZ)()],A.prototype,"_activeFieldInput",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"_effectiveRange",null),(0,l._)([(0,r.MZ)()],A.prototype,"_isAnyDateOrTimeField",null),(0,l._)([(0,r.MZ)()],A.prototype,"_isIntegerField",null),(0,l._)([(0,r.MZ)()],A.prototype,"_isNumericField",null),(0,l._)([(0,r.MZ)()],A.prototype,"_isStringField",null),(0,l._)([(0,r.MZ)()],A.prototype,"_isSubtypeField",null),(0,l._)([(0,r.MZ)({readOnly:!0})],A.prototype,"alias",null),(0,l._)([(0,r.MZ)()],A.prototype,"cellValueFormatFunction",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"cellValueValidatorFunction",void 0),(0,l._)([(0,r.MZ)({readOnly:!0})],A.prototype,"defaultValue",null),(0,l._)([(0,r.MZ)()],A.prototype,"effectiveDescription",null),(0,l._)([(0,r.MZ)()],A.prototype,"effectiveEditable",null),(0,l._)([(0,r.MZ)()],A.prototype,"effectiveLabel",null),(0,l._)([(0,r.MZ)()],A.prototype,"effectiveRequired",null),(0,l._)([(0,r.MZ)()],A.prototype,"effectiveTimeZoneOptions",null),(0,l._)([(0,r.MZ)({type:p.default})],A.prototype,"field",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"formatFunction",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"includeTime",null),(0,l._)([(0,r.MZ)()],A.prototype,"inputRenderFunction",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"layer",void 0),(0,l._)([(0,r.MZ)({readOnly:!0})],A.prototype,"loadingMessage",null),(0,l._)([(0,r.MZ)()],A.prototype,"maxLength",null),(0,l._)([(0,r.MZ)()],A.prototype,"minLength",null),(0,l._)([(0,r.MZ)({readOnly:!0})],A.prototype,"name",null),(0,l._)([(0,r.MZ)({readOnly:!0})],A.prototype,"nullable",null),(0,l._)([(0,r.MZ)()],A.prototype,"parseInputValueFunction",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"shouldShowPrompt",null),(0,l._)([(0,r.MZ)()],A.prototype,"sortable",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"store",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"template",void 0),(0,l._)([(0,r.MZ)()],A.prototype,"view",void 0),A=(0,l._)([(0,a.$)("esri.widgets.FeatureTable.FieldColumn")],A);const R=A}}]);
//# sourceMappingURL=90230.821639c1.chunk.js.map