"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[17483],{17483:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var s=i(89379),n=i(35143),o=i(39356),r=i(18690),a=i(50076),l=i(76460),u=i(50346),c=i(60767),d=i(68134),h=i(46053),p=(i(81806),i(85842)),v=i(19247),g=i(9624),f=i(13312),y=i(86100),w=i(45417),m=i(3569),_=i(86875),b=i(8503),F=i(36693),C=i(90992),M=i(51007),P=i(85012),Z=i(61640),E=i(68999),A=i(79535);const x="location-scale-handle";let L=null;let V=class extends((0,A.A)(E.A)){constructor(e){super(e),this._pendingPromises=new c.A,this._fetchFeaturesController=null,this._highlightPromises={"highlight-active-feature":null,"highlight-selected-feature":null},this._selectedClusterFeature=null,this.actions=new P.E$,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureMenuTitle=null,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.initialDisplayMode="feature",this.selectedClusterBoundaryFeature=new o.default({symbol:new _.default({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,u.debounce)((async e=>{var t,s,n;const{spatialReference:o}=this,r=null===(t=this.selectedFeature)||void 0===t||null===(t=t.geometry)||void 0===t?void 0:t.type,a=null!==(s=this.location)&&void 0!==s?s:e;if(r&&"mesh"!==r&&o&&a&&this.selectedFeature)if("point"!==r)try{const e=this.selectedFeature;let t=e.geometry;const s=this._getHighlightLayer(e),n=e.getObjectId();if(!s||!this.view)return;if(n){var c,d;const e=null===(c=this.view)||void 0===c?void 0:c.allLayerViews.find((e=>e.layer.uid===s.uid));if(!e||!("queryFeatures"in e))return;const i=e.createQuery();i.outSpatialReference=o,i.objectIds=[n],i.returnGeometry=!0;const{features:r}=await e.queryFeatures(i);t=null===(d=r[0])||void 0===d?void 0:d.geometry}if(!t||"mesh"===t.type)return;if(t=(0,g.project)(t,o),L||(L=await i.e(56203).then(i.bind(i,56203))),!await L.intersects(t,a)){var h;const i=null!==(h=(await L.nearestCoordinate(t,a)).coordinate)&&void 0!==h?h:a;this.selectedFeature===e&&(this.location=i)}}catch(p){(0,u.isAbortError)(p)||l.A.getLogger(this).error(p)}else this.location=null!==(n=(0,y.z8)(this.selectedFeature.geometry))&&void 0!==n?n:a}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),(0,d.watch)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,d.watch)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,d.watch)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.animation)||void 0===e?void 0:e.state}),(e=>this._animationStateChange(e))),(0,d.watch)((()=>this.location),(e=>this._locationChange(e))),(0,d.watch)((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),(0,d.watch)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,d.watch)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,d.watch)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>(0,Z.DX)({event:e,viewModel:this,view:this.view}))),(0,d.when)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),d.sync),(0,d.watch)((()=>[this.features,this.map,this.spatialReference,this.timeZone]),(()=>this._updateFeatureVMs())),(0,d.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.scale}),(()=>this._viewScaleChange())),(0,d.when)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,d.watch)((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){var e;const t=this._get("allActions")||new P.E$;t.removeAll();const{actions:i,defaultActions:s,defaultPopupTemplateEnabled:n,includeDefaultActions:o,selectedFeature:r}=this,a=o?s.concat(i):i,l=r&&("function"==typeof r.getEffectivePopupTemplate&&r.getEffectivePopupTemplate(n)||r.popupTemplate),u=null===l||void 0===l?void 0:l.actions,c=null!==l&&void 0!==l&&l.overwriteActions?u:null!==(e=null===u||void 0===u?void 0:u.concat(a))&&void 0!==e?e:a;return null!==c&&void 0!==c&&c.filter(Boolean).forEach((e=>t.add(e))),t}get defaultActions(){const e=this._get("defaultActions")||new P.E$;return e.removeAll(),e.addMany((0,Z.B_)(this.selectedFeature)?[P.HZ.clone(),P.po.clone()]:[P.RP.clone()]),e}get featureCount(){return this.features.length}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:s,selectedFeatureIndex:n}=this,o=s&&t.length;"list"!==this.initialDisplayMode?o&&i&&-1===n?this.selectedFeatureIndex=0:o&&-1!==n||(this.selectedFeatureIndex=t.length?0:-1):(!o||o&&i===s)&&(this.selectedFeatureIndex=-1)}set location(e){var t,i;let s=e;const n=null===(t=this.spatialReference)||void 0===t?void 0:t.isWebMercator;(null===e||void 0===e||null===(i=e.spatialReference)||void 0===i?void 0:i.isWGS84)&&n&&(s=(0,w.geographicToWebMercator)(e)),this._set("location",s)}get map(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice()).forEach((e=>this._pendingPromises.add(e))),e.reduce(((e,t)=>e.finally((()=>t.then((e=>{this._pendingPromises.has(t)&&this._updateFeatures(e)})).finally((()=>this._pendingPromises.delete(t))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;(isNaN(e)||e<0||!t)&&(e=-1),this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.timeZone)&&void 0!==e?e:F.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some((e=>e.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:e}=this,t=(0,Z.V5)(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new a.default("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){var i;const{view:s}=this;if(!s||!e)throw new a.default("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:s});return s.fetchPopupFeatures(e,{pointerType:null===t||void 0===t||null===(i=t.event)||void 0===i?void 0:i.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null===t||void 0===t?void 0:t.signal})}open(e){const t=(0,s.A)((0,s.A)({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const n=["actionsMenuOpen","collapsed"];for(const s of n)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex+1,this.featureCount),this}previous(){return this.selectedFeatureIndex=this._getRoundRobinIndex(this.selectedFeatureIndex-1,this.featureCount),this}disableClusterBrowsing(){(0,Z.H2)(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;"2d"===(null===e||void 0===e?void 0:e.type)?(0,Z.B_)(t)?(await(0,Z.xA)(this),await(0,Z.d4)(this)):l.A.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):l.A.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_getRoundRobinIndex(e,t){return(e+t)%t}_animationStateChange(e){this.zoomToLocation||(P.RP.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(r.Ru);null!==(e=this.view)&&void 0!==e&&null!==(e=e.graphics)&&void 0!==e&&e.removeMany(t),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if((0,Z.B_)(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i,view:s}=this;s&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>0?Math.floor((this.selectedFeatureIndex+1)/this.featuresPerPage):null}_featureViewModelsChange(){this.featurePage=this.featureCount>0?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:s,featureViewModels:n}=this;if(null==i)return;const o=((i-1)*s+t)%t,r=o+s;n.slice(o,r).forEach(((t,i)=>{var s;t&&(null!==(s=t.graphic)&&void 0!==s||(t.graphic=e[o+i]))}))}async _selectedFeatureChange(e){var t;const{location:i,updateLocationEnabled:s,view:n}=this;if(!e||!n)return;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),(0,Z.B_)(e))return;return e.symbol=await(0,b.getDisplayedSymbol)(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}const o=null===(t=e.sourceLayer)||void 0===t?void 0:t.type;if("map-image"!==o&&"imagery"!==o&&"imagery-tile"!==o||(e.symbol=await(0,b.getDisplayedSymbol)(e)),!s&&i||!e.geometry){if(s&&!e.geometry){var r;await this.centerAtLocation();const e=null===(r=n.center)||void 0===r?void 0:r.clone();e&&(this.location=e)}}else this.location=(0,y.z8)(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(e){const{pendingFeatures:t}=await this._fetchFeaturesWithController({mapPoint:e});this.promises=t}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i,view:s,spatialReference:n,map:o,timeZone:r,location:a}=this;if((0,Z.B_)(t[0])||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),null===t||void 0===t||!t.length)return;const l=i.slice(),u=[];t.forEach(((t,i)=>{if(!t)return;let c=null;if(l.some(((e,i)=>(e&&e.graphic===t&&(c=e,l.splice(i,1)),!!c))),c)u[i]=c;else{const l=new M.default({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:n,graphic:t===e?t:null,location:a,map:o,view:s,timeZone:r});u[i]=l}})),l.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",u)}async _getScreenPoint(e,t){const{spatialReference:i,view:s}=this;if(!s)return null;await(null===s||void 0===s?void 0:s.when());const n=null===e||void 0===e?void 0:e.spatialReference;return n&&i?(await(0,g.initializeProjection)(n,i,null,t),s.toScreen(e)):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures(e){let{mapPoint:t,screenPoint:i,event:s,signal:n}=e;return this.fetchFeatures(null!==i&&void 0!==i?i:await this._getScreenPoint(null!==t&&void 0!==t?t:this.location,{signal:n}),{signal:n,event:s})}_fetchFeaturesWithController(e){let{mapPoint:t,screenPoint:i,event:s}=e;this._cancelFetchingFeatures();const n=new AbortController,{signal:o}=n;this._fetchFeaturesController=n;const r=this._projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:i,signal:o,event:s});return r.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),r}async _fetchFeaturesAndOpen(e){const{mapPoint:t,screenPoint:i}=e,{view:s}=this;this.removeHandles(x),this.addHandles([(0,d.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.scale}),(()=>this._debouncedLocationUpdate(t).catch((e=>{(0,u.isAbortError)(e)||l.A.getLogger(this).error(e)})))),(0,d.when)((()=>!this.visible),(()=>{this.removeHandles(x)}),{once:!0})],x);const{pendingFeatures:n}=await this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});(null===s||void 0===s?void 0:s.popup)&&"open"in s.popup&&s.popup.open({location:null!==t&&void 0!==t?t:void 0,promises:n})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:"map-notes"===(null===i||void 0===i?void 0:i.type)||"subtype-group"===(null===i||void 0===i?void 0:i.type)?i:t}_getHighlightLayerView(e,t){return"subtype-sublayer"===t.type&&t.parent&&this._mapIncludesLayer(t.parent)?this._getLayerView(e,t.parent):t&&this._mapIncludesLayer(t)?this._getLayerView(e,t):null}_getHighlightTarget(e,t,i){if(function(e,t){return"building-scene"===e||"2d"===t&&("map-image"===e||"tile"===e||"imagery"===e||"imagery-tile"===e)}(t.type,i))return e;const s=e.getObjectId();if(null!=s)return s;const n="imagery"===t.type?void 0:"objectIdField"in t?t.objectIdField||m.r:null,o=e.attributes;return o&&n&&o[n]||e}_mapIncludesLayer(e){var t;return!(null===(t=this.map)||void 0===t||null===(t=t.allLayers)||void 0===t||!t.includes(e))}async _highlightFeature(e,t){this.removeHandles(e);const i=this[t];if(!i)return;const{highlightEnabled:s,view:n,visible:o}=this;if(!n||!s||!o)return;const r=this._getHighlightLayer(i);if(!r)return;const a=this._getHighlightLayerView(n,r);if(!a)return;this._highlightPromises[e]=a;const l=await a;if(!(l&&(0,C.Of)(l)&&this._highlightPromises[e]===a&&this[t]&&this.highlightEnabled))return;const u=l.highlight(this._getHighlightTarget(i,r,n.type));this.addHandles(u,e)}async _highlightActiveFeature(){return this._highlightFeature("highlight-active-feature","activeFeature")}async _highlightSelectedFeature(){return this._highlightFeature("highlight-selected-feature","selectedFeature")}_updateFeatures(e){const{features:t}=this,i=e.filter((e=>!t.includes(e)));(null===i||void 0===i?void 0:i.length)&&(this.features=t.concat(i))}};(0,n._)([(0,h.MZ)()],V.prototype,"_fetchFeaturesController",void 0),(0,n._)([(0,h.MZ)({type:P.E$})],V.prototype,"actions",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"active",null),(0,n._)([(0,h.MZ)()],V.prototype,"activeFeature",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"allActions",null),(0,n._)([(0,h.MZ)()],V.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"browseClusterEnabled",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"content",void 0),(0,n._)([(0,h.MZ)({type:P.E$,readOnly:!0})],V.prototype,"defaultActions",null),(0,n._)([(0,h.MZ)({type:Boolean})],V.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"featureCount",null),(0,n._)([(0,h.MZ)()],V.prototype,"featurePage",void 0),(0,n._)([(0,h.MZ)({value:[]})],V.prototype,"features",null),(0,n._)([(0,h.MZ)()],V.prototype,"featuresPerPage",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"featureMenuOpen",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"featureMenuTitle",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"featureViewModelAbilities",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"featureViewModels",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"highlightEnabled",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"includeDefaultActions",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"initialDisplayMode",void 0),(0,n._)([(0,h.MZ)({type:v.default})],V.prototype,"location",null),(0,n._)([(0,h.MZ)()],V.prototype,"map",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"pendingPromisesCount",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"promiseCount",null),(0,n._)([(0,h.MZ)()],V.prototype,"promises",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"selectedClusterBoundaryFeature",void 0),(0,n._)([(0,h.MZ)({value:null,readOnly:!0})],V.prototype,"selectedFeature",null),(0,n._)([(0,h.MZ)({value:-1})],V.prototype,"selectedFeatureIndex",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"selectedFeatureViewModel",null),(0,n._)([(0,h.MZ)({type:f.default})],V.prototype,"spatialReference",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"state",null),(0,n._)([(0,h.MZ)()],V.prototype,"timeZone",null),(0,n._)([(0,h.MZ)()],V.prototype,"title",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"visible",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"waitingForContents",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"waitingForResult",null),(0,n._)([(0,h.MZ)()],V.prototype,"zoomFactor",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"zoomToLocation",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"centerAtLocation",null),V=(0,n._)([(0,p.$)("esri.widgets.Features.FeaturesViewModel")],V);const R=V},60767:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(99486),n=i(99702);class o{constructor(e){this._observable=new n.I,this._set=new Set(e)}get size(){return(0,s.gc)(this._observable),this._set.size}add(e){const t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const t=this._set.delete(e);return t&&this._observable.notify(),t}entries(){return(0,s.gc)(this._observable),this._set.entries()}forEach(e,t){(0,s.gc)(this._observable),this._set.forEach(((i,s)=>e.call(t,i,s,this)),t)}has(e){return(0,s.gc)(this._observable),this._set.has(e)}keys(){return(0,s.gc)(this._observable),this._set.keys()}values(){return(0,s.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,s.gc)(this._observable),this._set[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},61640:(e,t,i)=>{i.d(t,{B_:()=>c,DX:()=>l,H2:()=>f,Qb:()=>d,V5:()=>u,d4:()=>v,xA:()=>p});var s=i(50076),n=i(76460),o=i(50346),r=i(85012);const a=()=>n.A.getLogger("esri.widgets.Popup.PopupViewModel"),l=e=>{const{event:t,view:i,viewModel:n}=e,{action:a}=t;if(!a)return Promise.reject(new s.default("trigger-action:missing-arguments","Event has no action"));const{disabled:l,id:u}=a;if(!u)return Promise.reject(new s.default("trigger-action:invalid-action","action.id is missing"));if(l)return Promise.reject(new s.default("trigger-action:invalid-action","Action is disabled"));if(u===r.RP.id)return d(n).catch(o.throwIfNotAbortError);if(u===r.HZ.id)return h(n);if(u===r.po.id)return n.browseClusterEnabled=!n.browseClusterEnabled,n.featureMenuOpen=n.browseClusterEnabled,Promise.resolve();if(u===r.oq.id){n.visible=!1;const{selectedFeature:e}=n;if(!e)return Promise.reject(new s.default("trigger-action:".concat(r.oq.id),"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):null===i||void 0===i||i.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function u(e){var t;const{selectedFeature:i,location:s,view:n}=e;return n&&null!==(t=null!==i&&void 0!==i?i:s)&&void 0!==t?t:null}function c(e){var t;return!!e&&e.isAggregate&&"cluster"===(null===(t=e.sourceLayer)||void 0===t||null===(t=t.featureReduction)||void 0===t?void 0:t.type)}async function d(e,t){var i,n,l,c;const{location:d,selectedFeature:h,view:p,zoomFactor:g}=e;await(null===t||void 0===t||null===(i=t.viewModel)||void 0===i?void 0:i.updateGeometry());const f=null===t||void 0===t?void 0:t.graphic,y=null!==f&&void 0!==f&&f.geometry?f:u(e);if(!p||!y){const e=new s.default("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:y,view:p});throw a().error(e),e}const w=p.scale/g,m=null!==(n=null!==(l=null===f||void 0===f?void 0:f.geometry)&&void 0!==l?l:null===(c=e.selectedFeature)||void 0===c?void 0:c.geometry)&&void 0!==n?n:d,_=null!=m&&"point"===m.type&&await async function(e,t){if("3d"!==(null===t||void 0===t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=null;try{t=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch(s){}return!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]}return!0}(null!==f&&void 0!==f?f:h,p);r.RP.active=!0,r.RP.disabled=!0;try{await e.zoomTo({target:{target:y,scale:_?w:void 0}})}catch(v){if((0,o.isAbortError)(v))return;const t=new s.default("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:null!==f&&void 0!==f?f:h});a().error(t)}finally{r.RP.active=!1,r.RP.disabled=!1,e.zoomToLocation=null,_&&(e.location=m)}}async function h(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null===i||void 0===i?void 0:i.type)){const e=new s.default("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw a().error(e),e}if(!t||!c(t)){const e=new s.default("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw a().error(e),e}const[n,o]=await g(i,t);r.HZ.active=!0,r.HZ.disabled=!0;const{extent:l}=await n.queryExtent(o);l&&await e.zoomTo({target:l}),r.HZ.active=!1,r.HZ.disabled=!1}async function p(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[s,n]=await g(t,i),{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,t.graphics.add(e.selectedClusterBoundaryFeature)}async function v(e){const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[s,n]=await g(i,t);r.po.active=!0,r.po.disabled=!0;const{features:o}=await s.queryFeatures(n);r.po.active=!1,r.po.disabled=!1,r.po.value=!0;const a={features:[t].concat(o)};"feature"===(null===e||void 0===e?void 0:e.initialDisplayMode)&&(a.featureMenuOpen=!0),null===e||void 0===e||e.open(a)}async function g(e,t){const i=await e.whenLayerView(t.sourceLayer),s=i.createQuery(),n=t.getObjectId();return s.aggregateIds=null!=n?[n]:[],[i,s]}function f(e){r.po.value=!1;const t=e.features.filter((e=>c(e)));t.length&&(e.features=t)}},68999:(e,t,i)=>{i.d(t,{A:()=>c});var s=i(35143),n=i(54099),o=i(68134),r=i(46053),a=(i(81806),i(76460),i(47249),i(85842)),l=i(9624);let u=class extends n.A.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,o.when)((()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,o.watch)((()=>this.screenLocation),((e,t)=>{null!=e&&null!=t&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,s=null===t||void 0===t?void 0:t.spatialReference,n=s?(0,l.projectOrLoad)(e,s).geometry:null;return i&&n&&null!==t&&void 0!==t&&t.ready?t.toScreen(n):null}};(0,s._)([(0,r.MZ)()],u.prototype,"location",void 0),(0,s._)([(0,r.MZ)()],u.prototype,"screenLocation",null),(0,s._)([(0,r.MZ)()],u.prototype,"screenLocationEnabled",void 0),(0,s._)([(0,r.MZ)()],u.prototype,"view",void 0),u=(0,s._)([(0,a.$)("esri.widgets.support.AnchorElementViewModel")],u);const c=u},85012:(e,t,i)=>{i.d(t,{E$:()=>l,HZ:()=>d,RP:()=>u,oq:()=>c,po:()=>h});var s=i(19276),n=i(50037),o=i(16700),r=i(76192),a=i(15062);const l=s.default.ofType({key:"type",defaultKeyValue:"button",base:n.default,typeMap:{button:o.default,toggle:r.default}}),u=new o.default({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:a.T.zoomInMagnifyingGlass}),c=new o.default({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:a.T.trash}),d=new o.default({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:a.T.zoomInMagnifyingGlass}),h=new r.default({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:a.T.table,value:!1})},86100:(e,t,i)=>{i.d(t,{DN:()=>a,Sv:()=>r,ZY:()=>l,z8:()=>o});var s=i(76797),n=i(68002);function o(e){var t;switch(null===e||void 0===e?void 0:e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return null===(t=e.extent)||void 0===t?void 0:t.center;default:return null}}async function r(e,t){var i,s;if(e.hasZ||"2d"===t.type)return e;const n=null===(i=t.map)||void 0===i?void 0:i.ground;if(null===n||void 0===n||!n.layers.length)return e;const{geometry:o}=await n.queryElevation(e,{cache:null===(s=t.basemapTerrain)||void 0===s?void 0:s.elevationQueryCache});return o}function a(e,t,i){return u(e.center,t,i)}function l(e,t,i){switch(null===e||void 0===e?void 0:e.type){case"extent":return e;case"multipoint":case"polygon":case"polyline":return e.extent;case"point":return u(e,t,i);default:return null}}function u(e,t,i){const o=e.hasZ?e.z:void 0;if(null!==t&&void 0!==t&&t.map)return(null!=i?(0,n.eU)(t,i):t.extent).clone().centerAt(e).set({zmax:o,zmin:o});const{x:r,y:a,spatialReference:l}=e;return new s.default({xmin:r-.25,ymin:a-.25,xmax:r+.25,ymax:a+.25,spatialReference:l,zmin:o,zmax:o})}}}]);
//# sourceMappingURL=17483.5500ed89.chunk.js.map