"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[48479],{28320:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var n,i=o(89379),r=o(35143),s=o(3825),l=o(50076),a=o(16770),d=o(90534),c=o(49723),p=o(46053),u=(o(81806),o(76460),o(47249),o(28379)),h=o(85842),v=o(17707),m=o(83622),g=o(62705),y=o(73093),_=o(6446),f=o(79453);let M=class extends m.A{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[n]=!0,this.image=null}load(){const e=this.image;if("string"==typeof e){const t=(0,a.M5)(e).then((e=>{this._set("content",e)}));this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then((()=>{this._set("content",e)}));this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new l.default("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,o){return(0,f.f)(t.url,o)}writeImage(e,t,o,n){if(null==e)return;const r=null===n||void 0===n?void 0:n.portalItem,l=null===n||void 0===n?void 0:n.resources;if(!r||!l)return void("string"==typeof e&&(t[o]=(0,f.t)(e,n)));const a=function(e){return"string"==typeof e&&!(0,d.isDataProtocol)(e)&&!(0,d.isBlobProtocol)(e)}(e)?e:null;if(a){if(null==(0,f.i)(a))return void(t[o]=a);const e=(0,f.t)(a,(0,i.A)((0,i.A)({},n),{},{verifyItemRelativeUrls:null!==n&&void 0!==n&&n.verifyItemRelativeUrls?{writtenUrls:n.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),f.M.NO);if(r&&e&&!(0,d.isAbsolute)(e))return l.toKeep.push({resource:r.resourceFromPath(e),compress:!1}),void(t[o]=e)}t[o]="<pending>",l.pendingOperations.push(async function(e){if("string"==typeof e)return(0,d.isDataProtocol)(e)?(0,d.dataToBlob)(e):(await(0,s.default)(e,{responseType:"blob"})).data;return new Promise((t=>function(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,o=e instanceof HTMLImageElement?e.naturalHeight:e.height,n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t,n.height=o,e instanceof HTMLImageElement?i.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&i.putImageData(e,0,0),n}(e).toBlob(t)))}(e).then((e=>{const n=function(e,t){const o=(0,c.lk)(),n="".concat((0,d.join)("media",o),".").concat((0,y.n)({type:"blob",blob:e}));return t.resourceFromPath(n)}(e,r);t[o]=n.itemRelativeUrl,l.toAdd.push({resource:n,content:{type:"blob",blob:e},compress:!1,finish:e=>{this.image=e.url}})})))}};n=_.Of,(0,r._)([(0,p.MZ)()],M.prototype,"animationOptions",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],M.prototype,"content",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],M.prototype,"contentWidth",null),(0,r._)([(0,p.MZ)({readOnly:!0})],M.prototype,"contentHeight",null),(0,r._)([(0,p.MZ)(g.x3)],M.prototype,"image",void 0),(0,r._)([(0,u.w)("image",["url"])],M.prototype,"readImage",null),(0,r._)([(0,v.K)("image")],M.prototype,"writeImage",null),(0,r._)([(0,p.MZ)(g.m$)],M.prototype,"type",void 0),M=(0,r._)([(0,h.$)("esri.layers.support.ImageElement")],M);const w=M},48479:(e,t,o)=>{o.r(t),o.d(t,{ManipulatedObject3DMediaElement:()=>I});var n=o(89379),i=o(35143),r=o(54099),s=o(54901),l=o(68134),a=o(46053),d=(o(81806),o(76460),o(47249),o(85842)),c=o(91967),p=o(18690),u=o(19451),h=o(19247),v=o(65215),m=o(9624),g=o(29304),y=o(974);let _=class extends c.default{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new u.U}initialize(){this.addHandles([(0,s.DQ)(this._updatingHandles),this._updatingHandles.add((()=>{const e=this.element.georeference;return"control-points"===(null===e||void 0===e?void 0:e.type)?e.controlPoints:null}),(e=>this._elementControlPointsChanged(e)),l.initial)])}_elementControlPointsChanged(e){const t=null===e||void 0===e?void 0:e.map((e=>{let{mapPoint:t}=e;return t})).filter(p.Ru),o=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(t,o,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this,n=new v.default({rings:[e.map((e=>{let{x:t,y:o}=e;return[t,o]}))],spatialReference:o});if(null!==t&&void 0!==t&&t.trySetGeometry(n))return void this.onModifiedExternally();const i=this.view.state.viewingMode;this._replaceOperations(new g.S(y.ZE.fromGeometry(n,i),i,(e=>this._operationsGeometryChanged(e))))})))}_operationsGeometryChanged(e){var t;const{element:{georeference:o},_operations:n}=this;if(!n||!o||"control-points"!==o.type||!o.controlPoints)return;const i=n.data.geometry,r=o.controlPoints.map((e=>{let{mapPoint:t}=e;return t})).filter(p.Ru);if((null===(t=i.rings[0])||void 0===t?void 0:t.length)!==r.length)return;const s=i.rings[0].map((e=>{let[t,o]=e;return new h.default({x:t,y:o,spatialReference:i.spatialReference})})),l=r.map((e=>{let{spatialReference:t}=e;return t}));this._updatingHandles.addPromise(this._whenProjected(s,l,(t=>this._updateElementControlPoints(t,e))))}_updateElementControlPoints(e,t){var o;const{georeference:n}=this.element;if(!n||!e||"control-points"!==n.type||(null===(o=n.controlPoints)||void 0===o?void 0:o.length)!==(null===e||void 0===e?void 0:e.length))return;const i=n.controlPoints;if((null===i||void 0===i?void 0:i.length)===e.length)for(let r=0;r<i.length;r++)t&&(i[r].sourcePoint=n.toSource(e[r])),i[r].mapPoint=e[r]}async _whenProjected(e,t,o){if(!e)return void o(e);const{_operations:n,element:{georeference:i}}=this,r=e.map((e=>{let{spatialReference:t}=e;return t})),s=Array.isArray(t)?t:new Array(r.length).fill(t);await(0,m.initializeProjection)(Array.from(r).map(((e,t)=>({source:e,dest:s[t]}))));const l=e.map(((e,t)=>(0,m.project)(e,s[t])));n===this._operations&&i===this.element.georeference&&o(l)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e}};(0,i._)([(0,a.MZ)({constructOnly:!0})],_.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],_.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],_.prototype,"element",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],_.prototype,"onModifiedExternally",void 0),(0,i._)([(0,a.MZ)()],_.prototype,"_operations",void 0),(0,i._)([(0,a.MZ)()],_.prototype,"operations",null),(0,i._)([(0,a.MZ)()],_.prototype,"updating",null),_=(0,i._)([(0,d.$)("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],_);var f=o(59833);let M=class extends c.default{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new u.U}initialize(){this.addHandles([(0,s.DQ)(this._updatingHandles),this._updatingHandles.add((()=>{var e;return null===(e=this.element.georeference)||void 0===e?void 0:e.coords}),(e=>this._elementCoordinatesChanged(e)),l.initial)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this;null!==t&&void 0!==t&&t.trySetGeometry(e)?this.onModifiedExternally():this._replaceOperations(f.p.fromGeometry(e,this.view.state.viewingMode))})))}_operationsGeometryChanged(){const{element:{georeference:e},_operations:t}=this;if(!t||!e)return;const o=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(o);const n=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(o,n,(e=>this._updateElementCoordinates(e))))}_updateElementCoordinates(e){const{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}async _whenProjected(e,t,o){if(!e)return void o(e);const{_operations:n,element:{georeference:i}}=this,r=await(0,m.projectWithZConversion)(e,t);n===this._operations&&i===this.element.georeference&&o(r)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",(()=>this._operationsGeometryChanged())),e),this.onModifiedExternally()}};(0,i._)([(0,a.MZ)({constructOnly:!0})],M.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],M.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],M.prototype,"element",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],M.prototype,"onModifiedExternally",void 0),(0,i._)([(0,a.MZ)()],M.prototype,"_operations",void 0),(0,i._)([(0,a.MZ)()],M.prototype,"operations",null),(0,i._)([(0,a.MZ)()],M.prototype,"updating",null),M=(0,i._)([(0,d.$)("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],M);var w=o(20664),b=o(9392),P=o(64232),Z=o(28320),E=o(54154);function O(e,t,o){return H(e.allLayerViews.find((e=>e.layer===t)),o)}function H(e,t){if(!e||"media-3d"!==e.type||e.suspended)return!1;const o=e.layer.source;return!!o&&(o instanceof Z.default||o instanceof E.default?o===t:"hasElement"in o&&o.hasElement(t))}let C=class extends c.default{grabbableForEvent(){return!0}constructor(e){super(e),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new r.A.EventEmitter,this.addHandles((0,l.watch)((()=>this.selected),(e=>this.events.emit("select-changed",{action:e?"select":"deselect"})),l.sync))}destroy(){this._set("view",null)}intersectionDistance(e){const{view:t,layer:o,element:n}=this;if(!O(t,o,n))return null;const i=t.toMap(e,{include:{layer:o,element:n}});return i&&(0,P.g)(i,x,t.renderSpatialReference)?(0,w.j)(x,t.state.camera.eye):null}onElevationChange(){}onViewChange(){}};(0,i._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],C.prototype,"element",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],C.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],C.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"interactive",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"selectable",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"grabbable",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"grabbing",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"dragging",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"hovering",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"selected",void 0),(0,i._)([(0,a.MZ)()],C.prototype,"cursor",void 0),C=(0,i._)([(0,d.$)("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],C);const x=(0,b.vt)(),R=Symbol();let I=class extends r.A.EventedAccessor{get operations(){var e;return null===(e=this._controller)||void 0===e?void 0:e.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){const e=this.view.allLayerViews.find((e=>e.layer===this.layer));return"media-3d"===(null===e||void 0===e?void 0:e.type)?e:null}get visible(){return H(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){var e;return!(null===(e=this._controller)||void 0===e||!e.updating)}get _controllerClass(){var e;return"transform"===this.tool||"control-points"!==(null===(e=this.element.georeference)||void 0===e?void 0:e.type)?M:_}constructor(e){super(e),this.tool="transform"}initialize(){this.addHandles([(0,l.watch)((()=>this._controllerClass),(e=>this._updateController(e)),l.syncAndInitial),(0,l.on)((()=>this._layerView),"element-render-changed",(e=>{let{element:t}=e;this.element===t&&this.emit("committed")}))])}toMap(e){const{layer:t,element:o}=this;return this.view.toMap(e,{include:{layer:t,element:o}})}createManipulator(e){const{view:t,layer:o,element:i}=this;return new C((0,n.A)({view:t,layer:o,element:i},e))}_updateController(e){if(this._controller&&this._controller instanceof e)return;this.removeHandles(R);const{view:t,layer:o,element:n}=this,i=()=>{this.emit("modified-externally")};this._controller=new e({view:t,layer:o,element:n,onModifiedExternally:i}),i(),this.addHandles((0,s.DQ)(this._controller),R)}};(0,i._)([(0,a.MZ)({constructOnly:!0})],I.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],I.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],I.prototype,"element",void 0),(0,i._)([(0,a.MZ)()],I.prototype,"tool",void 0),(0,i._)([(0,a.MZ)()],I.prototype,"_controller",void 0),(0,i._)([(0,a.MZ)()],I.prototype,"elevationInfo",null),(0,i._)([(0,a.MZ)()],I.prototype,"_layerView",null),(0,i._)([(0,a.MZ)()],I.prototype,"visible",null),(0,i._)([(0,a.MZ)()],I.prototype,"updating",null),(0,i._)([(0,a.MZ)()],I.prototype,"_controllerClass",null),I=(0,i._)([(0,d.$)("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],I)},54154:(e,t,o)=>{o.r(t),o.d(t,{default:()=>M});var n,i=o(35143),r=o(3825),s=o(50076),l=o(79053),a=o(76460),d=o(15941),c=o(68134),p=o(90534),u=o(46053),h=(o(81806),o(47249),o(85842)),v=o(17707),m=o(83622),g=o(62705),y=o(6446),_=o(79453);let f=class extends m.A{constructor(e){super(e),this.autoplay=!0,this.content=null,this.controller=null,this.type="video",this[n]=!0}load(){const e=this.video;return"string"==typeof e?this.addResolvingPromise(Promise.all([this._preProcessVideoUrl(e),o.e(80782).then(o.bind(o,80782))]).then((async e=>{let[t,{default:o}]=e;this.controller=new o,this.controller.playerUrl=t,await(0,c.whenOnce)((()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.element})),this.controller.loop=!0,this.controller.muted=!0,this.controller.playsInline=!0,this.controller.crossOrigin="anonymous",await(0,c.whenOnce)((()=>{var e;return"can-play"===(null===(e=this.controller)||void 0===e?void 0:e.state)})),await this.controller.play(),this.autoplay||this.controller.pause(),this._set("content",this.controller.element)}))):e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then((()=>{this._set("content",e)}))):this.addResolvingPromise(Promise.reject(new s.default("video-element:invalid-video-type","Invalid video type",{video:e}))),Promise.resolve(this)}get contentWidth(){var e,t;return null!==(e=null===(t=this.content)||void 0===t?void 0:t.videoWidth)&&void 0!==e?e:0}get contentHeight(){var e,t;return null!==(e=null===(t=this.content)||void 0===t?void 0:t.videoHeight)&&void 0!==e?e:0}get currentTime(){var e;return null===(e=this.controller)||void 0===e?void 0:e.currentTime}set currentTime(e){var t;if(!this.controller)return;const o=(0,d.qE)(e,0,this.controller.duration);null===(t=this.controller)||void 0===t||t.setCurrentTime(o)}get duration(){var e;return null===(e=this.controller)||void 0===e?void 0:e.duration}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):a.A.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(e,t,o,n){if(!e)return void((null===n||void 0===n?void 0:n.messages)&&n.messages.push(new s.default("video-element:unsupported-video","video source is missing")));const i=function(e){return"string"==typeof e&&!(0,p.isDataProtocol)(e)&&!(0,p.isBlobProtocol)(e)}(e)?e:null;if(!i)return void((null===n||void 0===n?void 0:n.messages)&&n.messages.push(new s.default("video-element:unsupported-video","video source must be an absolute url")));!(0,p.isAbsolute)(i)&&(null===n||void 0===n?void 0:n.blockedRelativeUrls)&&n.blockedRelativeUrls.push(i);const r=(0,p.makeAbsolute)(i);(0,_.i)(r)?(null===n||void 0===n?void 0:n.messages)&&n.messages.push(new s.default("video-element:unsupported-video","video source cannot be an item resource")):t[o]=r}async _preProcessVideoUrl(e){if((0,p.getProxyRule)(e))return(0,p.addProxy)(e);try{return await(0,r.default)(e,{method:"head"}),e}catch(t){return(0,p.addProxy)(e,!0)}}_loadVideo(e){return new Promise(((t,o)=>{const n=(0,l.Oo)(e,"canplay",(()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(t,o):t()}));this.addHandles(n,"canplay"),"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",(0,p.isBlobProtocol)(e.src)||(e.src=e.src))}))}};n=y.UR,(0,i._)([(0,u.MZ)()],f.prototype,"autoplay",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"content",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"contentWidth",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"contentHeight",null),(0,i._)([(0,u.MZ)()],f.prototype,"controller",void 0),(0,i._)([(0,u.MZ)({type:Number})],f.prototype,"currentTime",null),(0,i._)([(0,u.MZ)({type:Number})],f.prototype,"duration",null),(0,i._)([(0,u.MZ)(g.x3)],f.prototype,"video",null),(0,i._)([(0,v.K)("video")],f.prototype,"writeVideo",null),(0,i._)([(0,u.MZ)(g.m$)],f.prototype,"type",void 0),f=(0,i._)([(0,h.$)("esri.layers.support.VideoElement")],f);const M=f},73093:(e,t,o)=>{o.d(t,{n:()=>i});var n=o(90534);function i(e){return r[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,n.getPathExtension)(e);return a[t]||s}(e.url)}(e)]||l}const r={},s="text/plain",l=r[s],a={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const d in a)r[a[d]]=d}}]);
//# sourceMappingURL=48479.79c89d9d.chunk.js.map