"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[66049],{21009:(e,i,t)=>{t.d(i,{BL:()=>a,Cz:()=>r,KQ:()=>n,M1:()=>o,T1:()=>s,dr:()=>l});const l="ESRI__ID",r="ESRI__OriginID",n="ESRI__DestID",s="ESRI__LayoutGeometry",o="ESRI__AggregationCount",a="LC.ESRI__IsSpatial"},66049:(e,i,t)=>{t.r(i),t.d(i,{default:()=>_});var l=t(35143),r=t(50076),n=(t(81806),t(76460)),s=t(50346),o=t(68134),a=t(34154),u=t(46053),d=(t(47249),t(85842)),f=t(21009),p=t(64810),c=t(10252),h=t(8203),y=t(91447),v=t(53430),F=t(46530),m=t(28009),g=t(68295),I=t(98976),b=t(2257);class w{constructor(e){this._fieldsIndex=e,this._clauses=[]}async finish(){return{requiresCurrentUser:(await Promise.all(this._clauses)).some((e=>e.currentUserRequired))}}visitClientWhereClause(e){e&&this._clauses.push((0,a.parseWhereClause)(e,this._fieldsIndex))}visitFeatureReduction(e){if(e)switch(e.type){case"binning":case"cluster":this.visitLabelingInfo(e.labelsVisible,e.labelingInfo)}}visitLabelingInfo(e,i){if(e&&null!=i)for(const t of i)this.visitClientWhereClause(t.where)}visitDisplayFilter(e,i){if(e)for(const l of null!==(t=null===i||void 0===i?void 0:i.filters)&&void 0!==t?t:[]){var t;this.visitClientWhereClause(l.where)}}visitFilter(e){this.visitClientWhereClause(null===e||void 0===e?void 0:e.where)}visitTrackInfo(e){null!=e&&(this.visitLabelingInfo(null===e||void 0===e?void 0:e.latestObservations.labelsVisible,null===e||void 0===e?void 0:e.latestObservations.labelingInfo),this.visitLabelingInfo(null===e||void 0===e?void 0:e.previousObservations.labelsVisible,null===e||void 0===e?void 0:e.previousObservations.labelingInfo),this.visitLabelingInfo(null===e||void 0===e?void 0:e.trackLines.labelsVisible,null===e||void 0===e?void 0:e.trackLines.labelingInfo))}}const _=e=>{let i=class extends e{constructor(){super(...arguments),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,o.watch)((()=>{var e,i,t,l;const r=this.layer,n=this.view;return[r&&"elevationInfo"in r?null===(e=r.elevationInfo)||void 0===e?void 0:e.featureExpressionInfo:null,r&&"displayField"in r?r.displayField:null,r&&"timeInfo"in r&&r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,(null===n||void 0===n||null===(i=n.requiredFieldsOptions)||void 0===i?void 0:i.featureTitleFields)&&r&&"featureTitleFields"in r&&r.featureTitleFields,(null===n||void 0===n||null===(t=n.requiredFieldsOptions)||void 0===t?void 0:t.utilityNetworkFields)&&(0,m._)(n,r),r.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===(null===r||void 0===r?void 0:r.type)&&"link-chart"===r.parentCompositeLayer.type&&(null===(l=r.parentCompositeLayer.linkChart)||void 0===l||null===(l=l.linkChartProperties.nonspatialDataDisplay)||void 0===l?void 0:l.mode),"parquet"===(null===r||void 0===r?void 0:r.type)&&r.popupTemplate]}),(()=>this._handleChange()),o.syncAndInitial),(0,o.on)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.floors}),"change",(()=>this._handleChange())),(0,o.on)((()=>{var e;return null===(e=this.layer.displayFilterInfo)||void 0===e?void 0:e.filters}),"change",(()=>this._handleChange())),(0,o.on)((()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null),"change",(()=>this._handleChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:i},requiredFields:t}=this;return"outFields"in e&&e.outFields?(0,v.fixFields)(i,[...(0,v.unpackFieldNames)(i,e.outFields),...t]):(0,v.fixFields)(i,t)}get displayFilterEnabled(){var e,i,t,l;return(null===(e=null===(i=this.view)||void 0===i?void 0:i.displayFilterEnabled)||void 0===e||e)&&(!("displayFilterEnabled"in this.layer)||null===(t=null===(l=this.layer)||void 0===l?void 0:l.displayFilterEnabled)||void 0===t||t)}get effectiveDisplayFilter(){const e=this.layer;return this.displayFilterEnabled&&e.displayFilterInfo?(0,p.u2)(e.displayFilterInfo,this.view):null}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){n.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){var e;return null!==(e=this.layer)&&void 0!==e&&e.url?(0,y.fE)(this.layer.url):Promise.resolve(null)}highlight(e,i){throw new Error("missing implementation")}createQuery(){var e;const i={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(i):new g.default(i);return"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=(0,a.sqlAnd)(t.where,(0,F.E)(this))),this.displayFilterEnabled&&(t.where=(0,a.sqlAnd)(t.where,null===(e=this.effectiveDisplayFilter)||void 0===e?void 0:e.where)),null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new g.default(e)}queryFeatures(e,i){throw new Error("missing implementation")}queryObjectIds(e,i){throw new Error("missing implementation")}queryFeatureCount(e,i){throw new Error("missing implementation")}queryExtent(e,i){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,i){return this._validateFetchPopupFeatures(e,i),this._fetchPopupFeatures(e,i)}_loadArcadeModules(e){var i;return null!==(i=e.expressionInfos)&&void 0!==i&&i.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,I.lw)():Promise.resolve()}_handleChange(){const e=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then((()=>{}));return this._set("_updatingRequiredPromise",e),e.then((()=>{this._updatingRequiredPromise===e&&this._set("_updatingRequiredPromise",null)})),e}async _updateClientWhereClauseRequirements(){var e;if(!this.layer||!this.view)return;const{layer:i}=this,t=new w(i.fieldsIndex);if(t.visitFilter(this.filter),"featureReduction"in i&&t.visitFeatureReduction(i.featureReduction),"labelingInfo"in i&&t.visitLabelingInfo(i.labelsVisible,i.labelingInfo),"trackInfo"in i&&t.visitTrackInfo(i.trackInfo),"2d"===this.view.type&&(t.visitFilter(null===(e=this.featureEffect)||void 0===e?void 0:e.filter),t.visitDisplayFilter(this.displayFilterEnabled,i.displayFilterInfo),"featureReduction"in i&&t.visitFeatureReduction(i.featureReduction)),"subtype-group"===i.type)for(const r of i.sublayers)t.visitLabelingInfo(r.labelsVisible,r.labelingInfo);try{const e=await t.finish();this._set("requiresCurrentUser",e.requiresCurrentUser)}catch(l){n.A.getLogger(this).error(l)}}async _updateRequiredFields(){var e,i;if(!this.layer||!this.view)return;const t="3d"===this.view.type,{layer:l,layer:{fieldsIndex:r,objectIdField:s}}=this,o="renderer"in l&&l.renderer,a="orderBy"in l&&l.orderBy,u="featureReduction"in l?l.featureReduction:null,d=new Set,p=[o?o.collectRequiredFields(d,r):null,(0,v.collectLabelingFields)(d,l),t&&"elevationInfo"in l?(0,v.collectElevationFields)(d,l):null,null!=this.filter?(0,v.collectFilterFields)(d,l,this.filter):null,t||null==this.featureEffect?null:(0,v.collectFilterFields)(d,l,this.featureEffect.filter),!t&&u?(0,v.collectFeatureReductionFields)(d,l,u):null,!t&&a?(0,v.collectOrderByInfos)(d,l,a):null];if("timeInfo"in l&&l.timeInfo&&this.timeExtent&&(0,v.collectFields)(d,l.fieldsIndex,[l.timeInfo.startField,l.timeInfo.endField]),"timeInfo"in l&&l.timeInfo&&"trackInfo"in l&&l.trackInfo){const{trackInfo:e}=l;(0,v.collectFields)(d,l.fieldsIndex,[l.timeInfo.trackIdField]),"feature"!==l.type&&"startTimeField"!==e.timeField||(0,v.collectFields)(d,l.fieldsIndex,[l.timeInfo.startField]),"endTimeField"===e.timeField&&(0,v.collectFields)(d,l.fieldsIndex,[l.timeInfo.endField]),await(0,v.collectTrackInfoFields)(d,l)}if("floorInfo"in l&&l.floorInfo&&(0,v.collectFields)(d,l.fieldsIndex,[l.floorInfo.floorField]),"featureTitleFields"in l&&null!==(e=this.view)&&void 0!==e&&null!==(e=e.requiredFieldsOptions)&&void 0!==e&&e.featureTitleFields&&l.featureTitleFields&&(0,v.collectFields)(d,l.fieldsIndex,l.featureTitleFields),"feature"===l.type&&l.globalIdField&&null!==(i=this.view)&&void 0!==i&&null!==(i=i.requiredFieldsOptions)&&void 0!==i&&i.globalIdField&&(0,v.collectFields)(d,l.fieldsIndex,[l.globalIdField]),this.displayFilterEnabled&&p.push((0,v.collectDisplayFilterFields)(d,l,l.displayFilterInfo)),"feature"===l.type&&t&&null!=l.infoFor3D&&(null==l.globalIdField&&n.A.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),(0,v.collectFields)(d,l.fieldsIndex,[l.globalIdField])),"subtype-group"===l.type){(0,v.collectField)(d,r,l.subtypeField);const e=l.sublayers.map((e=>{var i;return Promise.all([null===(i=e.renderer)||void 0===i?void 0:i.collectRequiredFields(d,r),(0,v.collectLabelingFields)(d,e)])}));p.push(Promise.all(e))}if("catalog-footprint"===l.type&&l.parent){const e=l.parent;(0,v.collectFields)(d,r,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}"knowledge-graph-sublayer"===l.type&&"link-chart"===l.parentCompositeLayer.type&&(0,v.collectField)(d,r,f.BL),"parquet"===l.type&&p.push((0,b.TO)(l,l.popupTemplate).then((e=>{for(const i of e)d.add(i)})));const c=await Promise.allSettled(p);(0,v.collectField)(d,r,s),t&&"displayField"in l&&l.displayField&&(0,v.collectField)(d,r,l.displayField);for(const f of c)"rejected"===f.status&&n.A.getLogger(this).error(f.reason);const h=Array.from(d).sort();this._set("requiredFields",h)}_validateFetchPopupFeatures(e,i){if(null!=i)for(const t of e){const e=t.origin&&"layer"in t.origin?t.origin.layer:t.layer;if("popupEnabled"in e&&!e.popupEnabled)throw new r.default("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e});if(t.isAggregate){const i="featureReduction"in e?e.featureReduction:null,t="trackInfo"in e?e.trackInfo:null;if(null==i&&null==t||null!=i&&(!("popupTemplate"in i)||!i.popupEnabled||!i.popupTemplate)||null!==t&&void 0!==t&&t.enabled&&(!("popupTemplate"in t)||!t.popupEnabled||!t.popupTemplate))throw new r.default("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e})}else if("popupTemplate"in e&&!(0,b.D8)(e,i))throw new r.default("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}}_popupFeatureHasRequiredFields(e,i){return(0,v.featureHasFields)(i,e)}async _fetchPopupFeatures(e,i){const t=new Array(e.length),l=new Map,r=await this._createPopupQuery(e.map((e=>{var i,t;return null!==(i=null===(t=e.origin)||void 0===t?void 0:t.layer)&&void 0!==i?i:e.layer})),i);for(let u=0;u<e.length;u++){var n,o;const a=e[u];if(a.isAggregate){t[u]=a;continue}const d=null!==(n=null===(o=a.origin)||void 0===o?void 0:o.layer)&&void 0!==n?n:a.layer;if(!d||!("popupEnabled"in d))continue;const f=(0,v.unpackFieldNames)(this.layer.fieldsIndex,r.outFields),p=(0,b.D8)(d,i);if(null==p)continue;const c=await this._loadArcadeModules(p);(0,s.throwIfAborted)(i),c&&c.arcadeUtils.hasGeometryOperations(p)||!this._popupFeatureHasRequiredFields(a,f)?l.set(a.getObjectId(),{graphic:a,index:u}):t[u]=a}if("stream"===this.layer.type||"parquet"===this.layer.type||0===l.size)return t.filter(Boolean);r.objectIds=Array.from(l.keys());try{const e=await this.layer.queryFeatures(r,i);for(const i of e.features){const{graphic:{geometry:e,origin:r},index:n}=l.get(i.getObjectId());i.geometry||(i.geometry=e),i.origin=r,t[n]=i}}catch(a){}return t.filter(Boolean)}async _createPopupQuery(e,i){const t=this.layer.createQuery(),l=new Set;let r=!1;const n=null!==e&&void 0!==e?e:[this.layer];for(const o of n){if(!("popupEnabled"in o))continue;const e=(0,b.D8)(o,i);if(null==e)continue;const t=await this._loadArcadeModules(e);(0,s.throwIfAborted)(i);const n=t&&t.arcadeUtils.hasGeometryOperations(e);r=!("point"!==this.layer.geometryType&&!n);const a=await(0,b.TO)(this.layer,e);(0,s.throwIfAborted)(i);for(const i of a)l.add(i)}if(t.returnGeometry=r,t.returnZ=r,t.returnM=r,t.outFields=Array.from(l),t.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,F.E)(this);null!=e&&(t.where=t.where?"(".concat(t.where,") AND (").concat(e,")"):e)}return t}canResume(){return!!super.canResume()&&(null==this.timeExtent||!this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,l._)([(0,u.MZ)()],i.prototype,"_updatingRequiredPromise",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"availableFields",null),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"displayFilterEnabled",null),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"effectiveDisplayFilter",null),(0,l._)([(0,u.MZ)({type:c.default})],i.prototype,"featureEffect",null),(0,l._)([(0,u.MZ)({type:h.default})],i.prototype,"filter",void 0),(0,l._)([(0,u.MZ)()],i.prototype,"layer",void 0),(0,l._)([(0,u.MZ)({type:Number})],i.prototype,"maximumNumberOfFeatures",null),(0,l._)([(0,u.MZ)({readOnly:!0,type:Boolean})],i.prototype,"maximumNumberOfFeaturesExceeded",null),(0,l._)([(0,u.MZ)()],i.prototype,"requiresCurrentUser",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"requiredFields",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"signedInUser",null),(0,l._)([(0,u.MZ)()],i.prototype,"suspended",void 0),(0,l._)([(0,u.MZ)()],i.prototype,"view",void 0),i=(0,l._)([(0,d.$)("esri.views.layers.FeatureLayerView")],i),i}}}]);
//# sourceMappingURL=66049.25e38868.chunk.js.map