"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[3620,51007,88084],{1052:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(35143),n=i(39356),o=i(91967),a=i(68134),s=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),d=i(9912);let u=class extends o.default{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,a.watch)((()=>this.creator),(e=>{this._destroyContent(),this._createContent(e)}),a.initial))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&t&&((0,d.graphicCallback)({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const i=(0,d.graphicCallback)({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};(0,r._)([(0,s.MZ)({readOnly:!0})],u.prototype,"created",void 0),(0,r._)([(0,s.MZ)()],u.prototype,"creator",void 0),(0,r._)([(0,s.MZ)()],u.prototype,"destroyer",void 0),(0,r._)([(0,s.MZ)({type:n.default})],u.prototype,"graphic",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],u.prototype,"state",null),u=(0,r._)([(0,l.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],u);const c=u},12744:(e,t,i)=>{i.d(t,{Wo:()=>m,lO:()=>v,lw:()=>c,vc:()=>u});var r=i(89379),n=i(64379),o=i(76460),a=i(30907),s=i(9912),l=i(98108);const d=()=>o.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function u(e){return"string"==typeof e?(0,s.applyTextFormattingHTML)((0,s.htmlEntities)(e)):Array.isArray(e)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((e=>"<li>".concat("string"==typeof e?(0,s.applyTextFormattingHTML)((0,s.htmlEntities)(e)):e,"</li>"))).join(""),"</ul>")}(e):"esri.arcade.Dictionary"===(null===e||void 0===e?void 0:e.declaredClass)?function(e){const t=e.keys().map((t=>{const i=e.field(t);return"<tr><th>".concat(t,"</th><td>").concat("string"==typeof i?(0,s.applyTextFormattingHTML)((0,s.htmlEntities)(i)):i,"</td></tr>")})).join("");return'<table class="'.concat(l.D.table,'">').concat(t,"</table>")}(e):e}async function c(){const[e,t]=await Promise.all([i.e(8169).then(i.bind(i,30550)),Promise.all([i.e(98683),i.e(43036),i.e(69175),i.e(30233)]).then(i.bind(i,30233))]);return{executor:e,syntaxUtils:t}}function p(e){var t,i;return{scale:null===e||void 0===e?void 0:e.scale,timeProperties:{currentStart:null===e||void 0===e||null===(t=e.timeExtent)||void 0===t?void 0:t.start,currentEnd:null===e||void 0===e||null===(i=e.timeExtent)||void 0===i?void 0:i.end,startIncluded:!0,endIncluded:!0}}}function h(e){return{$voxel:e}}async function y(e,t,i,n,o){let s=null;if(o.has("$aggregatedfeatures")){const o=await async function(e){let{graphic:t,view:i,options:r}=e;const{isAggregate:n,layer:o}=t;if(!n||!o||"2d"!==(null===i||void 0===i?void 0:i.type))return[];const a=await i.whenLayerView(o);if(!function(e){return"createQuery"in e&&"queryFeatures"in e}(a))return[];const s=a.createQuery(),l=t.getObjectId();s.aggregateIds=null!=l?[l]:[];const{features:d}=await a.queryFeatures(s,r);return d}({graphic:e,view:t,options:i}),l=e.sourceLayer||e.layer;s=function(e){let{layer:t,aggregatedFeatures:i,interceptor:n}=e;const{fields:o,objectIdField:s,geometryType:l,spatialReference:d,displayField:u}=t;return new a.default((0,r.A)((0,r.A)({fields:o,objectIdField:s,geometryType:l,spatialReference:d,displayField:u,interceptor:n},"feature"===t.type?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null),{},{source:i}))}({layer:l,aggregatedFeatures:o,interceptor:n})}return{vars:{$feature:e,$aggregatedFeatures:s,$view:p(t)},[Symbol.dispose]:()=>{var e;return null===(e=s)||void 0===e?void 0:e[Symbol.dispose]()}}}function f(e,t,i,r){var o,a;const s=null!==(o=e.sourceLayer||e.layer)&&void 0!==o?o:void 0;return{$feature:e,$layer:null!=s&&(0,n.eB)(s)?s:"scene"===(null===s||void 0===s?void 0:s.type)&&null!=s.associatedLayer?s.associatedLayer:void 0,$map:t,$datastore:null===s||void 0===s?void 0:s.url,$userInput:i,$graph:"knowledge-graph-sublayer"===(null===s||void 0===s?void 0:s.type)?null===s||void 0===s||null===(a=s.parentCompositeLayer)||void 0===a?void 0:a.knowledgeGraph:void 0,$view:p(r)}}async function m(e){let{expressionInfo:t,arcade:{executor:i,syntaxUtils:r},graphic:n}=e;const o=null===t||void 0===t?void 0:t.expression;if(!o)return null;const a=function(e){const t="esri.views.3d.layers.VoxelGraphic"===e.declaredClass;return e.isAggregate?"popup-feature-reduction":t?"popup-voxel":"popup"}(n),s=i.createArcadeProfile(a);let l;try{l=await i.createArcadeExecutor(o,s)}catch(c){return d().error("arcade-executor-error",{error:c,expressionInfo:t}),null}const u=new Set;return l.variablesUsed.includes("$view")&&(r.scriptUsesViewProperties(l.syntaxTree,["scale"])&&u.add("view-scale"),r.scriptUsesViewProperties(l.syntaxTree,["timeProperties"])&&u.add("view-time-extent")),{dependencies:u,async evaluate(e){var i;let{graphic:r,interceptor:n,location:o,map:s,options:u,spatialReference:p,view:m}=e;const v=await async function(e,t){let{graphic:i,map:r,location:n,view:o,options:a,interceptor:s,arcadeExecutor:l}=t;switch(e){case"popup":return{vars:f(i,r,n,o),[Symbol.dispose](){}};case"popup-feature-reduction":{const e=new Set(l.variablesUsed);return await y(i,o,a,s,e)}case"popup-voxel":return{vars:h(i),[Symbol.dispose](){}};default:throw new Error("Unexpected profile name ".concat(e))}}(a,{graphic:r,map:s,location:o,view:m,options:u,interceptor:n,arcadeExecutor:l}),g={abortSignal:null!==(i=null===u||void 0===u?void 0:u.signal)&&void 0!==i?i:void 0,interceptor:null!==n&&void 0!==n?n:void 0,rawOutput:!0,spatialReference:null!==p&&void 0!==p?p:void 0,timeZone:null===m||void 0===m?void 0:m.timeZone,console(){d().info(...arguments)}};try{return await l.executeAsync(v.vars,g)}catch(c){return void d().error("arcade-execution-error",{error:c,graphic:r,expressionInfo:t})}finally{v[Symbol.dispose]()}}}}async function v(e,t){if(null===e||void 0===e||!e.length)return{dependencies:new Set,expressions:new Map};const i=await c(),r=new Set,n=new Map;for(const o of e){const e=await m({expressionInfo:o,arcade:i,graphic:t});n.set("expression/".concat(o.name),e),null===e||void 0===e||e.dependencies.forEach((e=>r.add(e)))}return{dependencies:r,expressions:n}}},14009:(e,t,i)=>{i.d(t,{e:()=>d,s:()=>l});var r=i(89379),n=i(54994),o=i(36643),a=i(77725),s=i(68295);async function l(e,t,i){const r=await d(e,t,i);return a.default.fromJSON(r)}async function d(e,t,i){const a=(0,n.Dl)(e),l=(0,r.A)({},i),d=s.default.from(t),{data:u}=await(0,o.eW)(a,d,d.sourceSpatialReference,l);return u}},14902:(e,t,i)=>{i.d(t,{k:()=>l});var r=i(80324),n=i(38042),o=i(24241);function a(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const r of e.match(t)||[])switch(r){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=r;break;case"A":case"a":i+="a";break;default:i+="'".concat(r,"'")}return i}const s="esri.core.sql.timeonly";class l{constructor(e,t,i,r){this._hour=e,this._minute=t,this._second=i,this._millisecond=r,this.declaredRootClass=s}static isTimeOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return l.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,r.Fq)(this.hour)&&(0,r.Fq)(this.minute)&&(0,r.Fq)(this.second)&&(0,r.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return"".concat(this.hour.toString().padStart(2,"0"),":").concat(this.minute.toString().padStart(2,"0"),":").concat(this.second.toString().padStart(2,"0"))+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return"time '".concat(this.hour.toString().padStart(2,"0"),":").concat(this.minute.toString().padStart(2,"0"),":").concat(this.second.toString().padStart(2,"0")).concat(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"","'")}toStorageString(){return"".concat(this.hour.toString().padStart(2,"0"),":").concat(this.minute.toString().padStart(2,"0"),":").concat(this.second.toString().padStart(2,"0"))}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e||""===e?this.toString():(e=a(e))?o.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,i,r){const n=new l(e,t,i,r);return n.isValid()?n:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),i=Math.floor(e/6e4%60),r=Math.floor(e/36e5%24),n=Math.floor(e%1e3);return new l(r,i,t,n)}static fromDateJS(e){return new l(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new l(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const i=[];t?(t=a(t))&&i.push(t):null!==t&&""!==t||(i.push("HH:mm:ss"),i.push("HH:mm:ss.SSS"),i.push("hh:mm:ss a"),i.push("hh:mm:ss.SSS a"),i.push("HH:mm"),i.push("hh:mm a"),i.push("H:mm"),i.push("h:mm a"),i.push("H:mm:ss"),i.push("h:mm:ss a"),i.push("H:mm:ss.SSS"),i.push("h:mm:ss.SSS a"));for(const r of i){const t=o.c9.fromFormat(e,r);if(t.isValid)return new l(t.hour,t.minute,t.second,t.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return o.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},16503:(e,t,i)=>{i.d(t,{n:()=>l});var r=i(46405),n=i(38042),o=i(24241);function a(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i)||[])switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=r;break;default:r.length>=2&&"["===r.slice(0,1)&&"]"===r.slice(-1)?t+="'".concat(r.slice(1,-1),"'"):t+="'".concat(r,"'")}return t}const s="esri.core.sql.dateonly";class l{constructor(e,t,i){this._year=e,this._month=t,this._day=i,this.declaredRootClass=s}static isDateOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return l.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(e){return o.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,r.mT)(e)})}toDateTimeLuxon(e){return o.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,r.mT)(e)})}toString(){return"".concat(this.year.toString().padStart(4,"0"),"-").concat(this.month.toString().padStart(2,"0"),"-").concat(this.day.toString().padStart(2,"0"))}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e||""===e)return this.toString();if(t&&(e=a(e)),!e)return"";const i=this.toDateTime("unknown");return r.lY.dateTimeToArcadeDate(i).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return r.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return o.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=o.c9.fromMillis(e,{zone:o.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=o.c9.fromSeconds(e,{zone:o.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,i){const r=new l(e,t,i);return!1===r.isValid?null:r}static fromDateJS(e){return l.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return l.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const i=[];if(t)(t=a(t))&&i.push(t);else if(null===t||""===t){const t=o.c9.fromISO(e,{setZone:!0});return t.isValid?l.fromParts(t.year,t.month,t.day):null}for(const r of i){const i=o.c9.fromFormat(e,null!==t&&void 0!==t?t:r);if(i.isValid)return new l(i.year,i.month,i.day)}return null}static fromNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system";const t=o.c9.fromJSDate(new Date).setZone((0,r.mT)(e));return new l(t.year,t.month,t.day)}}},18258:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(35143),n=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),a=i(78583);let s=class extends a.default{constructor(e){super(e),this.description=null,this.title=null}};(0,r._)([(0,n.MZ)()],s.prototype,"description",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"title",void 0),s=(0,r._)([(0,o.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],s);const l=s},36643:(e,t,i)=>{i.d(t,{GB:()=>b,IJ:()=>f,Jf:()=>_,Pk:()=>v,eW:()=>y,gW:()=>g,kS:()=>m});var r=i(89379),n=i(3825),o=i(90534),a=i(19902),s=i(73953),l=i(80963),d=i(78238),u=i(89122),c=i(57831);const p="Layer does not support extent calculation.";function h(e,t){var i;const r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const o=n;let s,d,u;if(null!=r&&(d=r.spatialReference,u=(0,l.YX)(d),o.geometryType=(0,a.getJsonType)(r),o.geometry=function(e,t){if(t&&"extent"===e.type)return"".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax);if(t&&"point"===e.type)return"".concat(e.x,",").concat(e.y);const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}(r,e.compactGeometryEnabled),o.inSR=u),n.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(o.objectIds=n.objectIds.join(",")),n.orderByFields&&(o.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?delete o.outFields:n.outFields.includes("*")?o.outFields="*":o.outFields=n.outFields.join(","),n.outSR?(o.outSR=(0,l.YX)(n.outSR),s=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(o.outSR=o.inSR,s=d),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(o.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(o.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(o.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=d&&null!=(null===(i=e.quantizationParameters)||void 0===i?void 0:i.extent)&&d.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(o.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(o.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(o.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:i}=e;null==t&&null==i||(o.time=t===i?t:"".concat(null!==t&&void 0!==t?t:"null",",").concat(null!==i&&void 0!==i?i:"null")),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=d&&null!=s&&d.equals(s)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function y(e,t,i,r){const n=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await b(e,t,"json",r);return(0,c.q)(t,i,n.data),n}async function f(e,t,i,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const n=await m(e,t,r),o=n;return o.data=(0,u.m)(n.data,i),o}function m(e,t,i){return b(e,t,"pbf",i)}function v(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):b(e,t,"json",i,{returnIdsOnly:!0})}function g(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):b(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}async function _(e,t,i){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await b(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),n=r.data;if(n.hasOwnProperty("extent"))return r;if(n.features)throw new Error(p);if(n.hasOwnProperty("count"))throw new Error(p);return r}async function b(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const u="string"==typeof e?(0,o.urlToObject)(e):e,c=t.geometry?[t.geometry]:[],p=await(0,s.normalizeCentralMeridian)(c,null,{signal:a.signal}),y=null===p||void 0===p?void 0:p[0];null!=y&&((t=t.clone()).geometry=y);const f=(0,d.z)((0,r.A)((0,r.A)((0,r.A)({},u.query),{},{f:i},l),h(t,l)));return(0,n.default)((0,o.join)(u.path,(m=l,null==t.formatOf3DObjects||m.returnCountOnly||m.returnExtentOnly||m.returnIdsOnly?"query":"query3d")),(0,r.A)((0,r.A)({},a),{},{responseType:"pbf"===i?"array-buffer":"json",query:(0,r.A)((0,r.A)({},f),a.query)}));var m}},38932:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(35143),n=i(91967),o=i(46053),a=(i(81806),i(76460),i(47249),i(85842)),s=i(81779),l=i(40585),d=i(9912);let u=class extends n.default{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null!==t&&void 0!==t&&t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=(0,d.getFieldInfoLabel)(r,e),i.push(r)})),i}};(0,r._)([(0,o.MZ)()],u.prototype,"attributes",void 0),(0,r._)([(0,o.MZ)({type:[s.default]})],u.prototype,"expressionInfos",void 0),(0,r._)([(0,o.MZ)()],u.prototype,"description",void 0),(0,r._)([(0,o.MZ)({type:[l.default]})],u.prototype,"fieldInfos",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],u.prototype,"formattedFieldInfos",null),(0,r._)([(0,o.MZ)()],u.prototype,"title",void 0),u=(0,r._)([(0,a.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],u);const c=u},39492:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(35143),n=i(39356),o=i(91967),a=i(98773),s=i(30726),l=i(50346),d=i(68134),u=i(79468),c=i(46053),p=(i(81806),i(76460),i(47249),i(85842)),h=i(19247),y=(i(75900),i(56362),i(87015),i(81940),i(6929)),f=i(7198),m=(i(93616),i(53539)),v=(i(91904),i(66267)),g=i(1052),_=i(38932),b=i(42450),w=i(12744);let A=class extends o.default{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{var e,t;const i=null===(e=this.contentElement)||void 0===e?void 0:e.type;null===(t=this.contentElementViewModel)||void 0===t||t.destroy();const r="fields"===i?new _.A:"media"===i?new b.A:"text"===i?new g.A:null;this._set("contentElementViewModel",r)},this._compileThrottled=(0,u.n)(this._startCompile,(()=>this.notifyChange("state")),1,this),this._evaluateThrottled=(0,u.n)(this._startEvaluate,(()=>this.notifyChange("state")),1,this),this.addHandles([(0,d.watch)((()=>[this.expressionInfo,this.graphic]),(()=>this._compileThrottled()),d.initial),(0,d.watch)((()=>[this.contentElement]),(()=>this._createVM()),d.initial),(0,d.when)((()=>{var e,t,i,r;if(null===(e=this._compileTask)||void 0===e||!e.finished)return null;const n=this._compileTask.value,o=null===n||void 0===n?void 0:n.dependencies;return[n,this.spatialReference,this.map,this.view,null!==o&&void 0!==o&&o.has("view-scale")?null===(t=this.view)||void 0===t?void 0:t.scale:null,null!==o&&void 0!==o&&o.has("view-time-extent")?null===(i=this.view)||void 0===i||null===(i=i.timeExtent)||void 0===i?void 0:i.start:null,null!==o&&void 0!==o&&o.has("view-time-extent")?null===(r=this.view)||void 0===r||null===(r=r.timeExtent)||void 0===r?void 0:r.end:null]}),(e=>{let[t]=e;return this._evaluateThrottled(t)}))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){var e;this._compileTask=(0,s.DC)(this._compileTask),this._evaluateTask=(0,s.DC)(this._evaluateTask),null!==(e=this.contentElementViewModel)&&void 0!==e&&e.destroy(),this._set("contentElementViewModel",null)}get contentElement(){var e;return null===(e=this._evaluateTask)||void 0===e?void 0:e.value}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e,t;const{contentElement:i,contentElementViewModel:r}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||null===(e=this._compileTask)||void 0===e||!e.finished||null===(t=this._evaluateTask)||void 0===t||!t.finished?"loading":i||r?"ready":"disabled"}get map(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null}set map(e){this._override("map",e)}_startCompile(){this._evaluateTask=(0,s.DC)(this._evaluateTask),this._compileTask=(0,s.DC)(this._compileTask),this._compileTask=(0,a.UT)((async e=>{const{expressionInfo:t,graphic:i}=this;if(!t||!i)return null;const r=await(0,w.lw)();(0,l.throwIfAborted)(e);const n=await(0,w.Wo)({expressionInfo:t,arcade:r,graphic:i});return(0,l.throwIfAborted)(e),n}))}_startEvaluate(e){this._evaluateTask=(0,s.DC)(this._evaluateTask),this._evaluateTask=(0,a.UT)((async t=>{const{graphic:i}=this;if(!e||!i)return null;const{interceptor:r,spatialReference:n,map:o,location:a,view:s}=this,d=await e.evaluate({graphic:i,interceptor:r,location:a,map:o,options:{signal:t},spatialReference:n,view:s});(0,l.throwIfAborted)(t);const u=d;if(!u||"esri.arcade.Dictionary"!==u.declaredClass)return null;const c=await u.castAsJsonAsync(t);(0,l.throwIfAborted)(t);const p=null===c||void 0===c?void 0:c.type,h="media"===p?f.default.fromJSON(c):"text"===p?m.default.fromJSON(c):"fields"===p?y.default.fromJSON(c):null;return"media"===h.type&&!h.mediaInfos||"fields"===h.type&&!h.fieldInfos||"text"===h.type&&!h.text?null:h}))}};(0,r._)([(0,c.MZ)()],A.prototype,"_compileTask",void 0),(0,r._)([(0,c.MZ)()],A.prototype,"_evaluateTask",void 0),(0,r._)([(0,c.MZ)({type:v.default})],A.prototype,"expressionInfo",void 0),(0,r._)([(0,c.MZ)({type:n.default})],A.prototype,"graphic",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],A.prototype,"contentElement",null),(0,r._)([(0,c.MZ)({readOnly:!0})],A.prototype,"contentElementViewModel",void 0),(0,r._)([(0,c.MZ)()],A.prototype,"interceptor",void 0),(0,r._)([(0,c.MZ)({type:h.default})],A.prototype,"location",void 0),(0,r._)([(0,c.MZ)()],A.prototype,"spatialReference",null),(0,r._)([(0,c.MZ)({readOnly:!0})],A.prototype,"state",null),(0,r._)([(0,c.MZ)()],A.prototype,"map",null),(0,r._)([(0,c.MZ)()],A.prototype,"view",void 0),A=(0,r._)([(0,p.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],A);const I=A},42450:(e,t,i)=>{i.d(t,{A:()=>m});var r=i(89379),n=i(35143),o=i(91967),a=i(18690),s=i(46053),l=i(21403),d=(i(81806),i(85842)),u=i(40585),c=i(22431),p=i(9912),h=i(58287);const y={chartAnimation:!0};let f=class extends o.default{constructor(e){super(e),this.abilities=(0,r.A)({},y),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return(0,r.A)((0,r.A)({},y),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){var e,t,i,r,n;const{mediaInfos:o,layer:s}=this,l=null!==(e=this.attributes)&&void 0!==e?e:{},d=null!==(t=this.formattedAttributes)&&void 0!==t?t:{},u=null!==(i=this.expressionAttributes)&&void 0!==i?i:{},c=null!==(r=this.fieldInfoMap)&&void 0!==r?r:new Map;return null!==(n=null===o||void 0===o?void 0:o.map((e=>{const t=null===e||void 0===e?void 0:e.clone();if(!t)return null;if(t.title=(0,p.substituteFieldsInLinksAndAttributes)({attributes:l,fieldInfoMap:c,globalAttributes:d,expressionAttributes:u,layer:s,text:t.title}),t.caption=(0,p.substituteFieldsInLinksAndAttributes)({attributes:l,fieldInfoMap:c,globalAttributes:d,expressionAttributes:u,layer:s,text:t.caption}),t.altText=(0,p.substituteFieldsInLinksAndAttributes)({attributes:l,fieldInfoMap:c,globalAttributes:d,expressionAttributes:u,layer:s,text:t.altText}),"image"===t.type){if(!t.value)return;return this._setImageValue({value:t.value,formattedAttributes:d,layer:s}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){if(!t.value)return;return this._setChartValue({value:t.value,chartType:t.type,attributes:l,formattedAttributes:d,layer:s,expressionAttributes:u}),t}return null})).filter(a.Ru))&&void 0!==n?n:[]}_setImageValue(e){var t;const i=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,{value:r,formattedAttributes:n,layer:o}=e,{linkURL:a,sourceURL:s}=r;if(s){const e=(0,p.fixTokens)(s,o);r.sourceURL=(0,p.substituteAttributes)({formattedAttributes:n,template:e,fieldInfoMap:i})}if(a){const e=(0,p.fixTokens)(a,o);r.linkURL=(0,p.substituteAttributes)({formattedAttributes:n,template:e,fieldInfoMap:i})}}_setChartValue(e){var t;const{value:i,attributes:r,formattedAttributes:n,chartType:o,layer:a,expressionAttributes:s}=e,{popupTemplate:l,relatedInfos:d}=this,{fields:u,normalizeField:c}=i,h=a;if(i.fields=(0,p.getFixedFieldNames)(u,h),c&&(i.normalizeField=(0,p.getFixedFieldName)(c,h)),!u.some((e=>!!(null!=n[e]||(0,p.isRelatedField)(e)&&null!==d&&void 0!==d&&d.size))))return;const y=null!==(t=null===l||void 0===l?void 0:l.fieldInfos)&&void 0!==t?t:[];u.forEach(((e,t)=>{var a;const l=null===(a=i.colors)||void 0===a?void 0:a[t];if((0,p.isRelatedField)(e))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:y,fieldName:e,formattedAttributes:n,chartType:o,value:i,color:l})]);const d=this._getChartOption({value:i,attributes:r,chartType:o,formattedAttributes:n,expressionAttributes:s,fieldName:e,fieldInfos:y,color:l});i.series.push(d)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:n,chartType:o,value:a,color:s}=e,l=[],d=(0,h.kC)(r),u=d&&(null===(t=this.relatedInfos)||void 0===t?void 0:t.get(d.layerId.toString()));if(!u)return l;const{relatedFeatures:c,relation:p}=u;if(!p||!c)return l;const{cardinality:y}=p;return c.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===d.fieldName&&l.push(this._getChartOption({value:a,attributes:t,formattedAttributes:n,fieldName:r,chartType:o,relatedFieldName:e,hasMultipleRelatedFeatures:(null===c||void 0===c?void 0:c.length)>1,fieldInfos:i,color:s}))}))})),"one-to-many"===y||"many-to-many"===y?l:[l[0]]}_getTooltip(e){let{label:t,value:i,chartType:r}=e;return"pie-chart"===r?"".concat(t):"".concat(t,": ").concat(i)}_getChartOption(e){var t,i;const{value:r,attributes:n,formattedAttributes:o,expressionAttributes:a,fieldName:s,relatedFieldName:l,fieldInfos:d,chartType:y,hasMultipleRelatedFeatures:f,color:m}=e,v=this.layer,g=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,{normalizeField:_,tooltipField:b}=r,w=_?(0,p.isRelatedField)(_)?n[(0,h.kC)(_).fieldName]:n[_]:null,A=(0,p.isExpressionField)(s)&&a&&void 0!==a[s]?a[s]:l&&void 0!==n[l]?n[l]:void 0!==n[s]?n[s]:o[s],I=new c.default({fieldName:s,color:m,value:void 0===A?null:A&&w?A/w:A});if((0,p.isRelatedField)(s)){var F,M,T,C,x;const e=g.get(s.toLowerCase()),t=b&&g.get(b.toLowerCase()),i=null!==(F=null===e||void 0===e?void 0:e.fieldName)&&void 0!==F?F:s,r=f&&b?(0,h.kC)(b).fieldName:null!==(M=null===t||void 0===t?void 0:t.fieldName)&&void 0!==M?M:b,a=f&&r?n[r]:null!==(T=null!==(C=null!==(x=o[r])&&void 0!==x?x:null===e||void 0===e?void 0:e.label)&&void 0!==C?C:null===e||void 0===e?void 0:e.fieldName)&&void 0!==T?T:l,d=f&&l?n[l]:o[i];return I.tooltip=this._getTooltip({label:a,value:d,chartType:y}),I}const S=(0,p.getFieldInfo)(d,s),E=(0,p.getFixedFieldName)(s,v),O=b&&void 0!==o[b]?o[b]:(0,p.getFieldInfoLabel)(S||new u.default({fieldName:E}),null===(i=this.popupTemplate)||void 0===i?void 0:i.expressionInfos),Z=o[E];return I.tooltip=this._getTooltip({label:O,value:Z,chartType:y}),I}};(0,n._)([(0,s.MZ)()],f.prototype,"abilities",void 0),(0,n._)([(0,l.w)("abilities")],f.prototype,"castAbilities",null),(0,n._)([(0,s.MZ)()],f.prototype,"activeMediaInfoIndex",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],f.prototype,"activeMediaInfo",null),(0,n._)([(0,s.MZ)()],f.prototype,"attributes",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"description",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"fieldInfoMap",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"formattedAttributes",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"expressionAttributes",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],f.prototype,"formattedMediaInfos",null),(0,n._)([(0,s.MZ)()],f.prototype,"isAggregate",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"layer",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],f.prototype,"formattedMediaInfoCount",null),(0,n._)([(0,s.MZ)()],f.prototype,"mediaInfos",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"popupTemplate",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"relatedInfos",void 0),(0,n._)([(0,s.MZ)()],f.prototype,"title",void 0),f=(0,n._)([(0,d.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],f);const m=f},51007:(e,t,i)=>{i.r(t),i.d(t,{default:()=>V});var r=i(89379),n=i(35143),o=i(39356);var a,s=i(91967),l=i(18690),d=i(98773),u=i(19276),c=i(5632),p=i(76460),h=i(30726),y=i(50346),f=i(68134),m=i(79468),v=i(46053),g=i(21403),_=(i(81806),i(85842)),b=i(19247),w=i(13312),A=i(53539),I=i(30973),F=i(36693),M=i(18258),T=i(1052),C=i(39492),x=i(38932),S=i(42450),E=i(65023),O=i(12744),Z=i(9912),L=i(58287),k=i(91039);const D="content-view-models",P="relationship-view-models",R={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};let q=a=class extends(c.A.IdentifiableMixin(s.default)){constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=(0,r.A)({},R),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=(0,m.n)(this._graphicChanged,(()=>this.notifyChange("waitingForContent")),1,this),this._isAllowedContentType=e=>{const{abilities:t}=this;return"attachments"===e.type&&!!t.attachmentsContent||"custom"===e.type&&!!t.customContent||"fields"===e.type&&!!t.fieldsContent||"media"===e.type&&!!t.mediaContent||"text"===e.type&&!!t.textContent||"expression"===e.type&&!!t.expressionContent||"relationship"===e.type&&!!t.relationshipContent||"utility-network-associations"===e.type&&!!t.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=(0,m.n)(this._evaluateExpressionAttributes,(()=>this.notifyChange("waitingForContent")),1,this),this.addHandles([(0,f.watch)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),f.initial),(0,f.when)((()=>{var e,t,i,r,n;if(null===(e=this._graphicChangedTask)||void 0===e||!e.finished||null==this._graphicChangedTask.value)return null;const o=this._graphicChangedTask.value,a=null===o||void 0===o||null===(t=o.expressionInfos)||void 0===t?void 0:t.dependencies;return[o,null!==a&&void 0!==a&&a.has("view-scale")?null===(i=this.view)||void 0===i?void 0:i.scale:null,null!==a&&void 0!==a&&a.has("view-time-extent")?null===(r=this.view)||void 0===r||null===(r=r.timeExtent)||void 0===r?void 0:r.start:null,null!==a&&void 0!==a&&a.has("view-time-extent")?null===(n=this.view)||void 0===n||null===(n=n.timeExtent)||void 0===n?void 0:n.end:null]}),(e=>{let[t]=e;return this._evaluateExpressionAttributesThrottled(t)}))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=(0,h.DC)(this._graphicChangedTask),this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return(0,Z.createFieldInfoMap)((0,Z.getAllFieldInfos)(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return(0,Z.getSourceLayer)(this.graphic)}castAbilities(e){return(0,r.A)((0,r.A)({},R),e)}get isTable(){var e;return(null===(e=this._sourceLayer)||void 0===e?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){var t;this._set("graphic",null!==(t=null===e||void 0===e?void 0:e.clone())&&void 0!==t?t:null)}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.timeZone)&&void 0!==e?e:F.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){var e;return(null===(e=this.view)||void 0===e?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){const{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:i,_evaluateExpressionAttributesTask:r,_associationVMAbortController:n}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||null!=i&&!i.finished||null!=r&&!r.finished||!!n}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof S.A&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof S.A&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof S.A&&t.previous()}async updateGeometry(){var e;const{graphic:t,spatialReference:i,_sourceLayer:r}=this;await(null===r||void 0===r?void 0:r.load());const n=null===r||void 0===r?void 0:r.objectIdField;if(!n||!t||!r)return;const o=null===t||void 0===t||null===(e=t.attributes)||void 0===e?void 0:e[n];if(null==o)return;const a=[o];if(!t.geometry){const e=await(0,Z.querySourceLayer)({layer:r,graphic:t,outFields:[],objectIds:a,returnGeometry:!0,spatialReference:i}),n=null===e||void 0===e?void 0:e.geometry;n&&(t.geometry=n)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._graphicChangedTask=(0,h.DC)(this._graphicChangedTask),this._graphicChangedTask=(0,d.UT)((async e=>{this._error=null,this._clear();const{graphic:t}=this;try{if(!t)return null;const{_sourceLayer:i,_effectivePopupTemplate:r}=this,n=this.spatialReference;await(0,Z.queryUpdatedFeature)({graphic:t,popupTemplate:r,layer:i,spatialReference:n},{signal:e});const[{value:o},{value:a}]=await(0,y.eachAlways)([this._getContent(),this._getTitle()]),[,{value:s}]=await(0,y.eachAlways)([this._checkForRelatedFeatures({signal:e}),(0,O.lO)(null===r||void 0===r?void 0:r.expressionInfos,t)]);return{expressionInfos:s,content:o,title:a}}catch(i){throw(0,y.isAbortError)(i)||(this._error=i,p.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate})),i}}))}_compileContentElement(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):"utility-network-associations"===e.type?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map(((e,t)=>this._compileContentElement(e,t))).filter(l.Ru):"string"==typeof e?this._compileText(new A.default({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(P),this.removeHandles(D),this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_matchesFeature(e,t){var i;const r=null===e||void 0===e||null===(i=e.graphic)||void 0===i?void 0:i.getObjectId(),n=null===t||void 0===t?void 0:t.getObjectId();return null!=r&&null!=n&&r===n}_setRelatedFeaturesViewModels(e){let{relatedFeatureViewModels:t,relatedFeatures:i,map:r}=e;const{view:n,spatialReference:o,timeZone:s}=this;null!==i&&void 0!==i&&i.filter(Boolean).forEach((e=>{t.some((t=>this._matchesFeature(t,e)))||t.add(new a({abilities:{relationshipContent:!1},map:r,view:n,spatialReference:o,timeZone:s,graphic:e}))})),t.forEach((e=>{const r=null===i||void 0===i?void 0:i.find((t=>this._matchesFeature(e,t)));r||t.remove(e)}))}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:n}=e,o=null===r||void 0===r?void 0:r.type;n&&o&&("fields"===o&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),n.set(this._createFieldsVMParams(r,t))),"media"===o&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),n.set(this._createMediaVMParams(r,t))),"text"===o&&n.set(this._createTextVMParams(r)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:n,relationshipId:o,title:a,description:s}=e,{_sourceLayer:l,graphic:d,map:u}=this;if(!(0,Z.isRelatableFeatureSupportedLayer)(l))return;const c=new E.A((0,r.A)({displayCount:i,graphic:d,orderByFields:n,relationshipId:o,layer:l,map:u},this._compileTitleAndDesc({title:a,description:s})));return this.contentViewModels[t]=c,this.addHandles((0,f.on)((()=>c.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(c))),P),e}_matchesGlobalFeature(e,t){const i=null===e||void 0===e?void 0:e.association.globalId,r=null===t||void 0===t?void 0:t.association.globalId;return null!=i&&null!=r&&i===r}async _setUpUtilityNetworkAssociationsViewModels(e,t,i){const{view:r,spatialReference:n,timeZone:o}=this;e.forEach(((i,r)=>{const n=t.get(r);n?i.forEach((t=>{n.find((e=>this._matchesGlobalFeature(t,e)))||(i.remove(t),0===i.length&&e.delete(r))})):(i.removeAll(),e.delete(r))})),t.forEach(((t,s)=>{const l=e.get(s)||new u.default;null!==t&&void 0!==t&&t.filter(Boolean).forEach((e=>{l.some((t=>this._matchesGlobalFeature(t,e)))||l.add({association:e.association,featureViewModel:new a({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:r,spatialReference:n,timeZone:o,graphic:e.feature}),terminalName:e.terminalName})})),e.set(s,l)}));const s=new AbortController;this._associationVMAbortController=s,await this._sortListObjectsByTitle(e,{signal:s.signal}),this._associationVMAbortController===s&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(e,t){for(const i of e.values()){const e=i.map((e=>(0,f.whenOnce)((()=>"ready"===e.featureViewModel.state),null===t||void 0===t?void 0:t.signal)));await Promise.all(e),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(e,t){const i=(0,I.getFeaturePopupTitle)(e.featureViewModel),r=(0,I.getFeaturePopupTitle)(t.featureViewModel);return i.localeCompare(r,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){const{displayCount:i,title:n,description:o,associationTypes:a}=e,{_sourceLayer:s,graphic:l,map:d}=this;if(!(0,Z.isAssociatedFeatureSupportedLayer)(s))return;const u=new k.A((0,r.A)({graphic:l,displayCount:i,associationTypes:a,layer:s,map:d},this._compileTitleAndDesc({title:n,description:o})));return this.contentViewModels[t]=u,this.addHandles([(0,f.watch)((()=>u.associationFeatures.values()),(()=>this._setUpUtilityNetworkAssociationsViewModels(u.associationViewModels,u.associationFeatures,u.map)))],"association-view-models"),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:n,spatialReference:o,view:s,location:l}=this,d=new C.A({expressionInfo:i,graphic:r,interceptor:a.interceptor,map:n,spatialReference:o,view:s,location:l});return this.contentViewModels[t]=d,this.addHandles((0,f.watch)((()=>d.contentElementViewModel),(()=>this._setExpressionContentVM(d,t)),f.initial),D),e}_compileAttachments(e,t){const{graphic:i}=this,{description:n,title:o,orderByFields:a}=e;return this.contentViewModels[t]=new M.A((0,r.A)({graphic:i,orderByFields:a},this._compileTitleAndDesc({title:o,description:n}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:n}=e;return this.contentViewModels[t]=new T.A({graphic:i,creator:r,destroyer:n}),e}_compileTitleAndDesc(e){let{title:t,description:i}=e;const{_fieldInfoMap:r,_sourceLayer:n,graphic:o,formattedAttributes:a}=this,s=null===o||void 0===o?void 0:o.attributes,l=this._expressionAttributes,d=a.global;return{title:(0,Z.substituteFieldsInLinksAndAttributes)({attributes:s,fieldInfoMap:r,globalAttributes:d,expressionAttributes:l,layer:n,text:t}),description:(0,Z.substituteFieldsInLinksAndAttributes)({attributes:s,fieldInfoMap:r,globalAttributes:d,expressionAttributes:l,layer:n,text:i})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,n=this.formattedAttributes,o=(0,r.A)((0,r.A)({},null===n||void 0===n?void 0:n.global),null===n||void 0===n?void 0:n.content[t]),a=(null===e||void 0===e?void 0:e.fieldInfos)||(null===i||void 0===i?void 0:i.fieldInfos),s=null===a||void 0===a?void 0:a.filter((e=>{let{fieldName:t}=e;return!!t&&((0,Z.isExpressionField)(t)||(0,Z.isRelatedField)(t)||o.hasOwnProperty(t))})),l=null===i||void 0===i?void 0:i.expressionInfos,{description:d,title:u}=e;return(0,r.A)({attributes:o,expressionInfos:l,fieldInfos:s},this._compileTitleAndDesc({title:u,description:d}))}_compileFields(e,t){const i=e.clone(),r=new x.A(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){var i;const{abilities:n,graphic:o,_fieldInfoMap:a,_effectivePopupTemplate:s,relatedInfos:l,_sourceLayer:d,_expressionAttributes:u}=this,c=this.formattedAttributes,p=null!==(i=null===o||void 0===o?void 0:o.attributes)&&void 0!==i?i:{},{description:h,mediaInfos:y,title:f}=e;return(0,r.A)({abilities:{chartAnimation:n.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:p,isAggregate:null===o||void 0===o?void 0:o.isAggregate,layer:d,fieldInfoMap:a,formattedAttributes:(0,r.A)((0,r.A)({},null===c||void 0===c?void 0:c.global),null===c||void 0===c?void 0:c.content[t]),expressionAttributes:u,mediaInfos:y,popupTemplate:s,relatedInfos:l},this._compileTitleAndDesc({title:f,description:h}))}_compileMedia(e,t){const i=e.clone(),r=new S.A(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:n}=this;if(e&&e.text){var o,a,s;const l=null!==(o=null===t||void 0===t?void 0:t.attributes)&&void 0!==o?o:{},d=null!==(a=null===(s=this.formattedAttributes)||void 0===s?void 0:s.global)&&void 0!==a?a:{};e.text=(0,Z.substituteFieldsInLinksAndAttributes)({attributes:l,fieldInfoMap:i,globalAttributes:d,expressionAttributes:n,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new T.A(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:r}=this;if(!e)return;const{lastEditInfoEnabled:n}=e,o=null===t||void 0===t?void 0:t.editFieldsInfo;return n&&o?(0,Z.formatEditInfo)(o,null===i||void 0===i?void 0:i.attributes,r,t):void 0}_compileTitle(e){var t,i,r;const{_fieldInfoMap:n,_sourceLayer:o,graphic:a,_expressionAttributes:s}=this,l=null!==(t=null===a||void 0===a?void 0:a.attributes)&&void 0!==t?t:{},d=null!==(i=null===(r=this.formattedAttributes)||void 0===r?void 0:r.global)&&void 0!==i?i:{};return(0,Z.substituteFieldsInLinksAndAttributes)({attributes:l,fieldInfoMap:n,globalAttributes:d,expressionAttributes:s,layer:o,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,Z.graphicCallback)({type:"title",value:null===e||void 0===e?void 0:e.title,event:{graphic:t}}):null}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,Z.graphicCallback)({type:"content",value:null===e||void 0===e?void 0:e.content,event:{graphic:t}}):null}_evaluateExpressionAttributes(e){let{title:t,content:i,expressionInfos:n}=e;this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=(0,d.UT)((async e=>{const{graphic:o,map:s,view:l,spatialReference:d,location:u}=this;try{if(!o)return;let c;if(null!=n){const t=[];for(const[i,r]of n.expressions.entries())null!=r?t.push(r.evaluate({graphic:o,interceptor:a.interceptor,location:u,map:s,options:{signal:e},spatialReference:d,view:l}).then((e=>[i,(0,O.vc)(e)])).catch((()=>[i,void 0]))):t.push(Promise.resolve([i,void 0]));c=Object.fromEntries(await Promise.all(t)),(0,y.throwIfAborted)(e)}this._expressionAttributes=c,this._graphicExpressionAttributes=(0,r.A)((0,r.A)({},o.attributes),c),this._set("formattedAttributes",this._createFormattedAttributes(i)),this._set("title",this._compileTitle(t)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(i)||null)}catch(c){(0,y.isAbortError)(c)||(this._error=c,p.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:c,graphic:o,popupTemplate:this._effectivePopupTemplate}))}}))}_createMediaFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:n}=e;const{_effectivePopupTemplate:o,graphic:a,relatedInfos:s,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:u,timeZone:c}=this;n.content[i]=(0,Z.formatAttributes)({fieldInfos:null===o||void 0===o?void 0:o.fieldInfos,graphic:a,attributes:(0,r.A)((0,r.A)({},u),t.attributes),layer:l,fieldInfoMap:d,relatedInfos:s,timeZone:c})}_createFieldsFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:n}=e;if(t.fieldInfos){const{graphic:e,relatedInfos:o,_sourceLayer:a,_fieldInfoMap:s,_graphicExpressionAttributes:l,timeZone:d}=this;n.content[i]=(0,Z.formatAttributes)({fieldInfos:t.fieldInfos,graphic:e,attributes:(0,r.A)((0,r.A)({},l),t.attributes),layer:a,fieldInfoMap:s,relatedInfos:o,timeZone:d})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a,timeZone:s}=this,l=null===t||void 0===t?void 0:t.fieldInfos,d={global:(0,Z.formatAttributes)({fieldInfos:l,graphic:i,attributes:a,layer:n,fieldInfoMap:o,relatedInfos:r,timeZone:s}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d}),"media"===e.type&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d})})),d}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,(0,Z.getAllFieldInfos)(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:n}=this;r.clear();const o=null!=(null===n||void 0===n?void 0:n.associatedLayer)?await(null===n||void 0===n?void 0:n.associatedLayer.load(i)):n;if(!o||!e)return;const a=t.filter((e=>!!e.fieldName&&(0,Z.isRelatedField)(e.fieldName)));if(null===a||void 0===a||!a.length)return;t.forEach((e=>this._configureRelatedInfo(e,o)));const s=await(0,L.Xx)({relatedInfos:r,layer:o},i);Object.keys(s).forEach((e=>{var t;const i=r.get(e.toString()),n=null===(t=s[e])||void 0===t?void 0:t.value;i&&n&&(i.layerInfo=n.data)}));const l=await(0,L.hM)({graphic:e,relatedInfos:r,layer:o},i);Object.keys(l).forEach((e=>{var t;(0,L.nD)(null===(t=l[e])||void 0===t?void 0:t.value,r.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=(0,L.kC)(e.fieldName||"");if(!r)return;const{layerId:n,fieldName:o}=r;if(!n)return;const a=i.get(n.toString())||(0,L.cl)(n,t);a&&((0,L.LI)({relatedInfo:a,fieldName:o,fieldInfo:e}),this.relatedInfos.set(n,a))}};q.interceptor=new class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=e=>{}),this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}}(Z.preLayerQueryCallback,Z.preRequestCallback),(0,n._)([(0,v.MZ)()],q.prototype,"_error",void 0),(0,n._)([(0,v.MZ)()],q.prototype,"_graphicChangedTask",void 0),(0,n._)([(0,v.MZ)()],q.prototype,"_evaluateExpressionAttributesTask",void 0),(0,n._)([(0,v.MZ)()],q.prototype,"_associationVMAbortController",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"_effectivePopupTemplate",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"_fieldInfoMap",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"_sourceLayer",null),(0,n._)([(0,v.MZ)()],q.prototype,"abilities",void 0),(0,n._)([(0,g.w)("abilities")],q.prototype,"castAbilities",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"content",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"contentViewModels",void 0),(0,n._)([(0,v.MZ)()],q.prototype,"description",void 0),(0,n._)([(0,v.MZ)({type:Boolean})],q.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"isTable",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"state",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"formattedAttributes",void 0),(0,n._)([(0,v.MZ)({type:o.default,value:null})],q.prototype,"graphic",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"lastEditInfo",void 0),(0,n._)([(0,v.MZ)({type:b.default})],q.prototype,"location",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"relatedInfos",void 0),(0,n._)([(0,v.MZ)({type:w.default})],q.prototype,"spatialReference",null),(0,n._)([(0,v.MZ)()],q.prototype,"timeZone",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"title",void 0),(0,n._)([(0,v.MZ)()],q.prototype,"map",null),(0,n._)([(0,v.MZ)({readOnly:!0})],q.prototype,"waitingForContent",null),(0,n._)([(0,v.MZ)()],q.prototype,"view",void 0),q=a=(0,n._)([(0,_.$)("esri.widgets.Feature.FeatureViewModel")],q);const V=q},58287:(e,t,i)=>{i.d(t,{LI:()=>A,Xx:()=>b,cl:()=>v,hM:()=>w,kC:()=>m,nD:()=>g});var r=i(3825),n=i(18690),o=i(50076),a=i(76460),s=i(50346),l=i(53430),d=i(14009),u=i(68295),c=i(58289),p=i(21820),h=i(9912);const y=()=>a.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),f=new Map;function m(e){if(!(0,h.isRelatedField)(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function v(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(i)return{url:"".concat(t.url,"/").concat(i.relatedTableId),sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function g(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,n=null===i||void 0===i?void 0:i.value;t.relatedFeatures=n?n.features:[];const o=null===r||void 0===r?void 0:r.value;t.relatedStatsFeatures=o?o.features:[]}async function _(e,t,i,r){const o=i.layerId.toString(),{layerInfo:a,relation:p,relatedFields:h,outStatistics:y,url:f,sourceSpatialReference:m}=t,v=function(e){return e?(0,n.Am)(e):void 0}(h),g=function(e){return e?(0,n.Am)(e,((e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))):void 0}(y);if(!a||!p)return null;const _=function(e){var t;let{originRelationship:i,relationships:r,layerId:n}=e;return null!==(t=r.find((e=>{let{relatedTableId:t,id:r}=e;return"".concat(t)===n&&r===(null===i||void 0===i?void 0:i.id)})))&&void 0!==t?t:null}({originRelationship:p,relationships:a.relationships,layerId:o});if(null!==_&&void 0!==_&&_.relationshipTableId&&_.keyFieldInRelationshipTable){const t=(await function(e,t,i,r){var n,o,a,s;const l=new c.default;return l.outFields=["*"],l.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),l.objectIds=[e.attributes[i.objectIdField]],l.gdbVersion=null!==(n=i.gdbVersion)&&void 0!==n?n:null,l.historicMoment=null!==(o=i.historicMoment)&&void 0!==o?o:null,null!==(a=null===(s=i.queryRelatedFeatures)||void 0===s?void 0:s.call(i,l,r))&&void 0!==a?a:Promise.resolve({})}(e,_,i,r))[e.attributes[i.objectIdField]];if(!t)return null;const n=t.features.map((e=>e.attributes[a.objectIdField]));if(null!==g&&void 0!==g&&g.length&&a.supportsStatistics){const e=new u.default;e.where=function(e,t,i){let r=0;const n=[];for(;r<t.length;)n.push("".concat(e," IN (").concat(t.slice(r,i+r),")")),r+=i;return n.join(" OR ")}(a.objectIdField,n,1e3),e.outFields=v,e.outStatistics=g,e.sourceSpatialReference=m;const i={features:Promise.resolve(t),statsFeatures:(0,d.s)(f,e)};return(0,s.eachAlways)(i)}}const b=null===_||void 0===_?void 0:_.keyField;if(b){const t=(0,l.isNumericField)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(a.fields,b)),n=function(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}(e.attributes,p.keyField),o=t?"".concat(b,"=").concat(n):"".concat(b,"='").concat(n,"'"),c=i.historicMoment,h=i.gdbVersion,y=(0,d.s)(f,new u.default({where:o,outFields:v,sourceSpatialReference:m,historicMoment:c,gdbVersion:h}),r),_=null!==g&&void 0!==g&&g.length&&a.supportsStatistics?(0,d.s)(f,new u.default({where:o,outFields:v,outStatistics:g,sourceSpatialReference:m}),r):null,w={features:y};return _&&(w.statsFeatures=_),(0,s.eachAlways)(w)}return null}function b(e,t){let{relatedInfos:i,layer:n}=e;const a={};return i.forEach(((e,t)=>{const{relation:i}=e;if(!i){const e=new o.default("relation-required","A relation is required on a layer to retrieve related records.");throw y().error(e),e}const{relatedTableId:s}=i;if("number"!=typeof s){const e=new o.default("A related table ID is required on a layer to retrieve related records.");throw y().error(e),e}const l="".concat(n.url,"/").concat(s),d=f.get(l),u=null!==d&&void 0!==d?d:function(e,t){return(0,r.default)(e,{query:{f:"json"},signal:null===t||void 0===t?void 0:t.signal})}(l);d||f.set(l,u),a[t]=u})),(0,s.whenOrAbort)((0,s.eachAlways)(a),t)}function w(e,t){let{graphic:i,relatedInfos:r,layer:n}=e;const o={};return r.forEach(((e,r)=>{e.layerInfo&&(o[r]=_(i,e,n,t))})),(0,s.eachAlways)(o)}function A(e){var t;let{relatedInfo:i,fieldName:r,fieldInfo:n}=e;if(null!==(t=i.relatedFields)&&void 0!==t&&t.push(r),n.statisticType){var o;const e=new p.default({statisticType:n.statisticType,onStatisticField:r,outStatisticFieldName:r});null===(o=i.outStatistics)||void 0===o||o.push(e)}}},64379:(e,t,i)=>{i.d(t,{$P:()=>h,At:()=>w,J6:()=>n,JB:()=>I,Lk:()=>y,NI:()=>F,Qi:()=>A,eB:()=>M,eg:()=>v,f0:()=>m,gO:()=>g,ik:()=>_,ke:()=>c,nE:()=>p,rX:()=>f,yT:()=>b,zl:()=>r});var r,n,o,a=i(46405),s=i(16503),l=i(14902),d=i(44135),u=i(24241);function c(e){return d.default.fromJSON(e.toJSON())}function p(e){return e.toJSON?e.toJSON():e}function h(e){return e instanceof Date}function y(e){return e instanceof u.c9}function f(e){return e instanceof a.lY}function m(e){return e instanceof s.n}function v(e){return e instanceof l.k}(o=r||(r={}))[o.Standardised=0]="Standardised",o[o.StandardisedNoInterval=1]="StandardisedNoInterval",o[o.SqlServer=2]="SqlServer",o[o.Oracle=3]="Oracle",o[o.Postgres=4]="Postgres",o[o.PGDB=5]="PGDB",o[o.FILEGDB=6]="FILEGDB",o[o.NotEvaluated=7]="NotEvaluated",function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(n||(n={}));const g=1e3;const _={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},b={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},w={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function A(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function I(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(n=t.cmp,function(e){return function(t,i){const r={key:t,value:e[t]},o={key:i,value:e[i]};return n(r,o)}});var n;const o=[];return function e(t,n){if(null!==(n=t)&&void 0!==n&&n.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let a,s;if(Array.isArray(t)){for(s="[",a=0;a<t.length;a++)a&&(s+=","),s+=e(t[a])||"null";return s+"]"}if(null===t)return"null";if(o.includes(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const l=o.push(t)-1,d=Object.keys(t).sort(null===r||void 0===r?void 0:r(t));for(s="",a=0;a<d.length;a++){const i=d[a],r=e(t[i]);r&&(s&&(s+=","),s+=JSON.stringify(i)+":"+r)}return o.splice(l,1),"{"+s+"}"}(e)}function F(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function M(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return F(e)}}},65023:(e,t,i)=>{i.d(t,{A:()=>_});var r=i(35143),n=i(39356),o=i(91967),a=i(18690),s=i(69098),l=i(19276),d=i(5632),u=i(50346),c=i(68134),p=i(46053),h=(i(81806),i(76460),i(85842)),y=i(58289),f=i(9912),m=i(3320);let v=class extends(s.A.ClonableMixin(d.A.IdentifiableMixin(o.default))){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await(0,u.ignoreAbortErrors)(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await(0,u.ignoreAbortErrors)(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await(0,u.ignoreAbortErrors)(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=(0,u.debounce)(this._queryController,100),this._queryFeatureCountDebounced=(0,u.debounce)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,u.debounce)(this._queryPageController,100),this._query=async()=>{var e;const{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&("subtype-group"!==(null===(e=this.relatedLayer)||void 0===e?void 0:e.type)||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:null===t||void 0===t?void 0:t.signal}))))},this.addHandles([(0,c.watch)((()=>{var e;return[this.displayCount,this.graphic,this.layer,null===(e=this.layer)||void 0===e?void 0:e.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory]}),(()=>this._queryDebounced()),c.initial),(0,c.watch)((()=>[this.featurePage,this.showAllEnabled]),(()=>this._queryPageDebounced())),(0,c.watch)((()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory]),(()=>this._queryFeatureCountDebounced()))])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:i}=this,r=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,1),r))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&null!==t&&void 0!==t&&t.loaded?e.map((e=>{const i=e.clone();return i.field=(0,f.getFixedFieldName)(e.field,t),i})):null!==e&&void 0!==e?e:[]}get supportsCacheHint(){var e;return!(null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.queryRelated)||void 0===e||!e.supportsCacheHint)}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){var e;const t=null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e?void 0:e.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&null!==t&&void 0!==t&&t.supportsCount&&null!==t&&void 0!==t&&t.supportsPagination)}get allCategoriesCount(){var e,t;return null!==(e=null===(t=this.allCategories)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get categories(){var e;const{allCategories:t}=this;return this.showAllEnabled?t:null!==(e=null===t||void 0===t?void 0:t.slice(0,this.displayCount))&&void 0!==e?e:null}set displayCount(e){this._set("displayCount",Math.min(Math.max(null!==e&&void 0!==e?e:3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){var e;return(null===(e=this.orderByFieldsFixedCasing[0])||void 0===e?void 0:e.field)||null}get objectId(){var e,t;return null!==(e=this.objectIdField&&(null===(t=this.graphic)||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t[this.objectIdField]))&&void 0!==e?e:null}get objectIdField(){var e;return(null===(e=this.layer)||void 0===e?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new l.default}get relatedLayer(){var e;const{layer:t,map:i,relationship:r}=this;if(null===t||void 0===t||!t.loaded||!i||!r)return null;const n="subtype-sublayer"===t.type&&t.parent&&(0,f.isRelatableFeatureSupportedLayer)(t.parent)?t.parent:t;return null!==(e=(0,f.findRelatedLayer)(i,n,r))&&void 0!==e?e:null}get relatedLayerKeyField(){var e;const{relatedLayer:t,relationshipId:i}=this;return null!==t&&void 0!==t&&t.loaded&&null!=i?null===(e=t.relationships)||void 0===e||null===(e=e.find((e=>e.id===i)))||void 0===e?void 0:e.keyField:null}get relatedLayerKeyFields(){var e,t;const{relatedLayer:i}=this;return null!==i&&void 0!==i&&i.loaded&&null!==(e=null===(t=i.relationships)||void 0===t?void 0:t.map((e=>e.keyField)).filter(a.Ru))&&void 0!==e?e:[]}get relationship(){var e,t;const{relationshipId:i,layer:r}=this;return null!=i&&null!==r&&void 0!==r&&r.loaded&&null!==(e=null===(t=r.relationships)||void 0===t?void 0:t.find((e=>{let{id:t}=e;return t===i})))&&void 0!==e?e:null}get relationshipKey(){var e,t;const{relationshipKeyField:i}=this;return null!==(e=i&&(null===(t=this.graphic)||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t[i]))&&void 0!==e?e:null}get relationshipKeyField(){var e;return(null===(e=this.relationship)||void 0===e?void 0:e.keyField)||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new l.default}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:n,canLoad:o}=this;return t||o&&!n?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find((t=>t.getObjectId()===e))}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;null===(e=this.relatedFeatureViewModels)||void 0===e||e.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t}=this;await(null===e||void 0===e?void 0:e.load()),await(null===t||void 0===t?void 0:t.load());const{_queryFeatureCountAbortController:r,activeCategory:n,canQuery:o,objectId:s,relatedLayerKeyField:l,relationshipId:d,relationshipKey:u,supportsCacheHint:c}=this;if(!o||!e||!t||null==s)return this._set("featureCount",0),void this._set("allCategories",null);if("subtype-group"===(null===t||void 0===t?void 0:t.type)&&!n){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),l&&null!=u){const{default:e}=await Promise.all([i.e(89122),i.e(72003),i.e(39729),i.e(90704),i.e(11563),i.e(78941)]).then(i.bind(i,78941)),{uniqueValueInfos:n}=await e({layer:t,sqlWhere:"".concat(l," = '").concat(u,"'"),field:t.subtypeField,signal:null===r||void 0===r?void 0:r.signal}),o=n.map((e=>{var i;let{count:r,value:n}=e;const o=null===(i=t.subtypes)||void 0===i||null===(i=i.find((e=>e.code===n)))||void 0===i?void 0:i.name;return null!=n&&o?{count:r,value:n,name:o}:void 0})).filter(a.Ru);this._set("allCategories",o)}return}const{historicMoment:p,gdbVersion:h}=e,f=new y.default({cacheHint:c,gdbVersion:h,historicMoment:p,relationshipId:d,returnGeometry:!1,objectIds:[s],where:this._getRelationshipWhereClause(t)}),m=await e.queryRelatedFeaturesCount(f,{signal:null===r||void 0===r?void 0:r.signal});this._set("allCategories",null),this._set("featureCount",m[s]||0)}_getRelationshipWhereClause(e){const{activeCategory:t}=this,i=e.createQuery(),r="subtypeField"in e?e.subtypeField:void 0,n=t&&r?"".concat(r," = ").concat(t.value):void 0,o=i.where;return o&&n?"(".concat(o,") AND (").concat(n,")"):null!==o&&void 0!==o?o:n}_sliceFeatures(e){const{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}async _queryPage(){var e;const{relatedFeatures:t,featurePage:i,showAllEnabled:r,_queryPageAbortController:n,featureCount:o}=this;!r||i<2||!o||"subtype-group"===(null===(e=this.relatedLayer)||void 0===e?void 0:e.type)&&!this.activeCategory||t.addMany(await this._queryRelatedFeatures({signal:null===n||void 0===n?void 0:n.signal}))}async _queryRelatedFeatures(e){var t;const{displayCount:i,featureCount:r,featurePage:n,featuresPerPage:o,layer:a,orderByFieldsFixedCasing:s,relatedLayer:l,relatedLayerKeyFields:d,relationshipId:u,showAllEnabled:c,supportsCacheHint:p}=this,{canQuery:h,objectId:f}=this;if(!h||!a||!l||null==f)return[];const v=c?((n-1)*o+r)%r:0,_=c?o:i,b=l.objectIdField,w="subtypeField"in l?l.subtypeField:void 0,A=[...s.map((e=>e.field)),...(0,m.n4)(l),...d,b,w].filter(g),I=s.map((e=>"".concat(e.field," ").concat(e.order))),{historicMoment:F,gdbVersion:M}=a,T=new y.default({orderByFields:I,start:v,num:_,outFields:A,cacheHint:p,historicMoment:F,gdbVersion:M,relationshipId:u,returnGeometry:!1,objectIds:[f],where:this._getRelationshipWhereClause(l)}),C=(null===(t=(await a.queryRelatedFeatures(T,{signal:null===e||void 0===e?void 0:e.signal}))[f])||void 0===t?void 0:t.features)||[];return"subtype-group"===l.type&&w?C.forEach((e=>{var t;const i=e.attributes[w],r=null===(t=l.findSublayerForSubtypeCode)||void 0===t?void 0:t.call(l,i);e.sourceLayer=r,e.layer=r})):C.forEach((e=>{e.sourceLayer=l,e.layer=l})),C}};function g(e){return null!=e&&""!==e}(0,r._)([(0,p.MZ)()],v.prototype,"_loaded",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"_queryAbortController",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"_queryPageAbortController",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"_queryFeatureCountAbortController",void 0),(0,r._)([(0,p.MZ)({value:1})],v.prototype,"featurePage",null),(0,r._)([(0,p.MZ)()],v.prototype,"featuresPerPage",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"orderByFieldsFixedCasing",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"supportsCacheHint",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"canLoad",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"canQuery",null),(0,r._)([(0,p.MZ)()],v.prototype,"activeCategory",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"allCategories",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"allCategoriesCount",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"categories",null),(0,r._)([(0,p.MZ)()],v.prototype,"description",void 0),(0,r._)([(0,p.MZ)({value:3})],v.prototype,"displayCount",null),(0,r._)([(0,p.MZ)({type:n.default})],v.prototype,"graphic",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"itemDescriptionFieldName",null),(0,r._)([(0,p.MZ)()],v.prototype,"layer",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"map",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"objectId",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"objectIdField",null),(0,r._)([(0,p.MZ)()],v.prototype,"orderByFields",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relatedFeatures",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relatedLayer",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relatedLayerKeyField",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relatedLayerKeyFields",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relationship",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relationshipKey",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relationshipKeyField",null),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"featureCount",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],v.prototype,"relatedFeatureViewModels",null),(0,r._)([(0,p.MZ)()],v.prototype,"relationshipId",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"showAllEnabled",void 0),(0,r._)([(0,p.MZ)()],v.prototype,"state",null),(0,r._)([(0,p.MZ)()],v.prototype,"title",void 0),v=(0,r._)([(0,h.$)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],v);const _=v},78238:(e,t,i)=>{function r(e){const t={};for(const i in e){if("declaredClass"===i)continue;const n=e[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[i]=[];for(let e=0;e<n.length;e++)t[i][e]=r(n[e])}else"object"==typeof n?n.toJSON&&(t[i]=JSON.stringify(n)):t[i]=n}return t}i.d(t,{z:()=>r})},78583:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var r=i(89379),n=i(35143),o=i(39356),a=i(91967),s=i(19276),l=i(50076),d=i(68134),u=i(46053),c=i(21403),p=(i(81806),i(47249),i(85842)),h=i(6362),y=i(88084),f=i(9708),m=i(9912);const v={editing:!1,operations:{add:!0,update:!0,delete:!0}},g=s.default.ofType(y.default);let _=class extends a.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=(0,r.A)({},v),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new g,this.fileInfos=new s.default,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles((0,d.watch)((()=>this.graphic),(()=>this._graphicChanged()),d.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return(0,r.A)((0,r.A)({},v),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(null===t||void 0===t?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:i}=this;if(!e||"function"!=typeof e.queryAttachments)throw new l.default("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId();if("number"!=typeof r)throw new l.default("invalid-object-id","getAttachments(): Numeric object id is required");const n=null===i||void 0===i?void 0:i.map((e=>"".concat(e.field," ").concat("descending"===e.order?"DESC":"ASC"))),o=new f.default({objectIds:[r],returnMetadata:!0,orderByFields:n}),a=[],s=e.queryAttachments(o).then((e=>e[r]||a)).catch((()=>a));this._getAttachmentsPromise=s,this.notifyChange("state");const d=await s;return t.destroyAll(),d.length&&t.addMany(d),this._getAttachmentsPromise=null,this.notifyChange("state"),d}async addAttachment(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:r,attachmentInfos:n,capabilities:o}=this;if(!i)throw new l.default("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new l.default("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(null===(t=o.operations)||void 0===t||!t.add)throw new l.default("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||"function"!=typeof r.addAttachment)throw new l.default("invalid-layer","addAttachment(): A valid layer is required.");const a=r.addAttachment(i,e).then((e=>this._queryAttachment(e.objectId,i))),s=await a;return n.add(s),s}async deleteAttachment(e){var t;const{_attachmentLayer:i,attachmentInfos:r,graphic:n,capabilities:o}=this;if(!e)throw new l.default("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(null===(t=o.operations)||void 0===t||!t.delete)throw new l.default("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!i||"function"!=typeof i.deleteAttachments)throw new l.default("invalid-layer","deleteAttachment(): A valid layer is required.");if(!n)throw new l.default("invalid-graphic","deleteAttachment(): A graphic is required.");const a=i.deleteAttachments(n,[e.id]).then((()=>e)),s=await a;return r.remove(s),s.destroy(),s}async updateAttachment(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:r,attachmentInfos:n,graphic:o,capabilities:a}=this;if(!e)throw new l.default("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new l.default("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(null===(t=a.operations)||void 0===t||!t.update)throw new l.default("invalid-capabilities","updateAttachment(): Update capabilities are required.");const s=n.indexOf(i);if(!r||"function"!=typeof r.updateAttachment)throw new l.default("invalid-layer","updateAttachment(): A valid layer is required.");if(!o)throw new l.default("invalid-graphic","updateAttachment(): A graphic is required.");const d=r.updateAttachment(o,i.id,e).then((e=>this._queryAttachment(e.objectId))),u=await d;return n.splice(s,1,u),u}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!i)return null;const r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:i}=this;if(!e||null===i||void 0===i||!i.queryAttachments)throw new l.default("invalid-attachment-id","Could not query attachment.");const r=this._getObjectId(t);if("number"!=typeof r)throw new l.default("invalid-object-id","getAttachments(): Numeric object id is required");const n=new f.default({objectIds:[r],attachmentsWhere:"AttachmentId=".concat(e),returnMetadata:!0});return i.queryAttachments(n).then((e=>e[r][0]))}_getObjectId(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(e=null===t||void 0===t?void 0:t.getObjectId())&&void 0!==e?e:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>this.attachmentInfos.destroyAll())))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,m.getSourceLayer)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,n._)([(0,u.MZ)()],_.prototype,"capabilities",void 0),(0,n._)([(0,c.w)("capabilities")],_.prototype,"castCapabilities",null),(0,n._)([(0,u.MZ)()],_.prototype,"activeAttachmentInfo",void 0),(0,n._)([(0,u.MZ)()],_.prototype,"activeFileInfo",void 0),(0,n._)([(0,u.MZ)({readOnly:!0,type:g})],_.prototype,"attachmentInfos",void 0),(0,n._)([(0,u.MZ)()],_.prototype,"fileInfos",void 0),(0,n._)([(0,u.MZ)({type:o.default})],_.prototype,"graphic",void 0),(0,n._)([(0,u.MZ)()],_.prototype,"mode",void 0),(0,n._)([(0,u.MZ)({type:[h.default]})],_.prototype,"orderByFields",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],_.prototype,"state",null),(0,n._)([(0,u.MZ)()],_.prototype,"filesEnabled",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],_.prototype,"supportsResizeAttachments",null),_=(0,n._)([(0,p.$)("esri.widgets.Attachments.AttachmentsViewModel")],_);const b=_},79468:(e,t,i)=>{function r(e,t,i,r){let n=null,o=1e3;"number"==typeof t?(o=t,r=i):(n=null!==t&&void 0!==t?t:null,o=i);let a,s=0;const l=()=>{s=0,e.apply(r,a)},d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n.apply(r,t),a=t,o?s||(s=setTimeout(l,o)):l()};return d.remove=()=>{s&&(clearTimeout(s),s=0)},d.forceUpdate=()=>{s&&(clearTimeout(s),l())},d.hasPendingUpdates=()=>!!s,d}i.d(t,{n:()=>r})},80324:(e,t,i)=>{i.d(t,{Fq:()=>a,Yc:()=>n,Yq:()=>o});var r=i(76797);function n(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new r.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function o(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function a(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},88084:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var r,n=i(35143),o=i(42553),a=i(46053),s=i(40565),l=(i(81806),i(47249),i(85842));function d(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const n=t.find((e=>e.name===i));return n?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find((e=>e.name===t));return(null===r||void 0===r?void 0:r.value)||null}({tagName:r,tags:n.tags}):null}const u={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let c=r=class extends o.A{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=d({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return u[t]||null}clone(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,n._)([(0,a.MZ)({type:String})],c.prototype,"contentType",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"exifInfo",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],c.prototype,"orientationInfo",null),(0,n._)([(0,a.MZ)({type:s.jz})],c.prototype,"id",void 0),(0,n._)([(0,a.MZ)({type:String})],c.prototype,"globalId",void 0),(0,n._)([(0,a.MZ)({type:String})],c.prototype,"keywords",void 0),(0,n._)([(0,a.MZ)({type:String})],c.prototype,"name",void 0),(0,n._)([(0,a.MZ)({json:{read:!1}})],c.prototype,"parentGlobalId",void 0),(0,n._)([(0,a.MZ)({json:{read:!1}})],c.prototype,"parentObjectId",void 0),(0,n._)([(0,a.MZ)({type:s.jz})],c.prototype,"size",void 0),(0,n._)([(0,a.MZ)({json:{read:!1}})],c.prototype,"url",void 0),c=r=(0,n._)([(0,l.$)("esri.rest.query.support.AttachmentInfo")],c);const p=c}}]);
//# sourceMappingURL=51007.76e9f52e.chunk.js.map