"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[49750],{19166:(e,t,o)=>{o.d(t,{$W:()=>c,Br:()=>s,G6:()=>d,YU:()=>p,Zm:()=>u,dG:()=>n,eZ:()=>a,nK:()=>y,zw:()=>l});var r=o(50076),i=o(41289);class s extends r.default{constructor(e,t){super("shared-template-query-failed","Request to fetch templates failed. templateIds: ".concat(e.join(",")),{error:t}),this.templateIds=e}}class n extends r.default{constructor(e,t){const o=new Set(t.map((e=>e.templateId))),r=(0,i.iv)(new Set(e),o);super("shared-template-some-templates-missing","The service failed to return templates for the following 'templateId's: ".concat(Array.from(r).join(",")))}}class a extends r.default{constructor(){super("shared-template-required-properties-not-set","Values must be specified for the `definition`, `featureService`, `layer`, and `view` properties of a `SharedTemplate` in order to load it")}}class l extends r.default{constructor(){super("shared-template-definition-required-properties-not-set","The `featureService`, `makeSharedTemplateFromJSON`, and `view` properties must all be set in order to load a template definition")}}class p extends r.default{constructor(e){super("shared-template-unsupported-builder","This template uses an unsupported builder type, '".concat(e,"'")),this.builderType=e}}class u extends r.default{constructor(e,t){super("shared-template-layer-resolver-error","The 'layerResolver' function failed to provide any layers for template with 'templateId: ".concat(e,"'"),{error:t}),this.templateId=e}}class d extends r.default{constructor(e,t){super("shared-template-utility-network-resolver-error","The 'utilityNetworkResolver' function threw an error while attempting to find a utility network for template with 'templateId: ".concat(e,"'"),{error:t}),this.templateId=e}}class c extends r.default{constructor(e){super("shared-template-layer-unavailable","None of the layers with which the template is associated are present in the view. Layer IDs: [".concat(e.join(","),"]")),this.layerIds=e}}class y extends r.default{constructor(e){super("shared-template-relationship-not-found","Relationship class '".concat(e,"' could not be found.")),this.relationshipCatalogId=e}}r.default;r.default},49750:(e,t,o)=>{o.r(t),o.d(t,{default:()=>L});var r=o(35143),i=o(4212),s=o(50076),n=o(49304),a=o(91291),l=o(46053),p=(o(76460),o(47249),o(28379)),u=o(85842),d=o(54039),c=o(19166),y=(o(81806),o(42553)),f=o(66830),v=o(12730);let m=class extends(n.A.LoadableMixin(a.A.EsriPromiseMixin(y.A))){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(e){return e.map((e=>v.T.fromJSON(e)))}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=this.allParts,{featureService:o,makeSharedTemplateFromJSON:r,view:i}=this;if(null==o||null==r||null==i)throw new c.zw;for(const s of t)s.assertIsSupportedPart();const n=(0,f.B)(i,{makeSharedTemplateFromJSON:r}),a=t.filter((e=>null==e.template)),l=await n.getTemplates({templateIds:a.map((e=>e.templateId)),featureService:o,signal:null===e||void 0===e?void 0:e.signal}),p=new Map(l.map((e=>[e.templateId,e])));for(const u of a){const e=p.get(u.templateId);if(null==e)throw new s.default("Failed to retrieve template for template ID ".concat(u.templateId));u.template=e}await Promise.all(t.map((t=>{var o;return null===(o=t.template)||void 0===o?void 0:o.load(e)})))}};(0,r._)([(0,l.MZ)({readOnly:!0})],m.prototype,"type",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],m.prototype,"excludedTools",void 0),(0,r._)([(0,p.w)("excludedTools")],m.prototype,"readExcludedTools",null),(0,r._)([(0,l.MZ)()],m.prototype,"featureService",void 0),(0,r._)([(0,l.MZ)()],m.prototype,"makeSharedTemplateFromJSON",void 0),(0,r._)([(0,l.MZ)()],m.prototype,"view",void 0),m=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],m);let h=class extends y.A{constructor(e){super(e),this.template=null}};(0,r._)([(0,l.MZ)()],h.prototype,"template",void 0),(0,r._)([(0,l.MZ)()],h.prototype,"templateGlobalId",void 0),(0,r._)([(0,l.MZ)()],h.prototype,"templateId",void 0),(0,r._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!1}})],h.prototype,"type",void 0),h=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.TemplatePartBase")],h);let g=class extends h{constructor(e){super(e),this.relationshipCatalogId="",this.relationshipMetadata=null,this.template=null,this.type="relationship"}assertIsSupportedPart(){}};(0,r._)([(0,l.MZ)({json:{name:"relationshipClassID"}})],g.prototype,"relationshipCatalogId",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"relationshipMetadata",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"template",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"type",void 0),g=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.FeatureTemplateRelationshipPart")],g);let _=class extends m{constructor(e){super(e),this.type="feature",this.defaultValues=null,this.relationships=[]}get allParts(){return this.relationships}initializeRelationshipMetadata(e){for(const i of this.relationships){var t,o,r;const{relationshipCatalogId:s}=i,n=null===(t=i.template)||void 0===t?void 0:t.layer,a=null===(o=e.relationships)||void 0===o?void 0:o.find((e=>e.catalogId===s)),l=null===n||void 0===n||null===(r=n.relationships)||void 0===r?void 0:r.find((e=>e.catalogId===s));if(!a||!n||!l)throw new c.nK(s);i.relationshipMetadata={destinationField:l.keyField,destinationLayerId:n.layerId,sourceField:a.keyField,sourceLayerId:e.layerId}}}};(0,r._)([(0,l.MZ)({readOnly:!0})],_.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],_.prototype,"allParts",null),(0,r._)([(0,l.MZ)()],_.prototype,"defaultValues",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[g]})],_.prototype,"relationships",void 0),_=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.FeatureTemplateDefinition")],_);var w=o(6409);const T=new(o(45802).J)({esri_editing_transformation_bufferLineToPolygon:"buffer-line-to-polygon",esri_editing_transformation_bufferPointToPolygon:"buffer-point-to-polygon",esri_editing_transformation_bufferPolygonToPolygon:"buffer-polygon-to-polygon",esri_editing_transformation_connectionPoint:"connection-point",esri_editing_transformation_equallySpaced:"equally-spaced",esri_editing_transformation_offsetLine:"offset-line",esri_editing_transformation_offsetPrimaryLine:"offset-primary-line",esri_editing_transformation_pointAtAllVerticesOfLine:"point-at-all-vertices-of-line",esri_editing_transformation_pointAtBeginningOfLine:"point-at-beginning-of-line",esri_editing_transformation_pointAtBeginningOfRadial:"point-at-beginning-of-radial",esri_editing_transformation_pointAtEndOfLine:"point-at-end-of-line",esri_editing_transformation_pointAtInteriorVertices:"point-at-interior-vertices",esri_editing_transformation_pointAtIntersectionVerticesOfLine:"point-at-intersection-vertices-of-line",esri_editing_transformation_pointAtNotBeginningOfLine:"point-at-not-beginning-of-line",esri_editing_transformation_pointAtNotEndOfLine:"point-at-not-end-of-line",esri_editing_transformation_pointAtPolygonCentroid:"point-at-polygon-centroid",esri_editing_transformation_pointAtPolygonNotStart:"point-at-polygon-not-start",esri_editing_transformation_pointAtPolygonStart:"point-at-polygon-start",esri_editing_transformation_pointIdentity:"point-identity",esri_editing_transformation_pointPrimaryIdentity:"point-primary-identity",esri_editing_transformation_polygonBoundary:"polygon-boundary",esri_editing_transformation_polygonBoundaryTwoPoint:"polygon-boundary-two-point",esri_editing_transformation_polygonIdentity:"polygon-identity",esri_editing_transformation_polygonPrimaryIdentity:"polygon-primary-identity",esri_editing_transformation_polygonVertices:"polygon-vertices",esri_editing_transformation_radialLines:"radial-lines",esri_editing_transformation_twoPointLines:"two-point-lines"}),k={"buffer-line-to-polygon":"polyline","buffer-point-to-polygon":"point","buffer-polygon-to-polygon":"polygon","connection-point":"polyline","equally-spaced":"polyline","offset-line":"polyline","offset-primary-line":"polyline","point-at-all-vertices-of-line":"polyline","point-at-beginning-of-line":"polyline","point-at-beginning-of-radial":"polyline","point-at-end-of-line":"polyline","point-at-interior-vertices":"polyline","point-at-intersection-vertices-of-line":"polyline","point-at-not-beginning-of-line":"polyline","point-at-not-end-of-line":"polyline","point-at-polygon-centroid":"polygon","point-at-polygon-not-start":"polygon","point-at-polygon-start":"polygon","point-identity":"point","point-primary-identity":"point","polygon-boundary":"polygon","polygon-boundary-two-point":"polygon","polygon-identity":"polygon","polygon-primary-identity":"polygon","polygon-vertices":"polygon","radial-lines":"polyline","two-point-lines":"polyline"};let S=class extends h{constructor(e){super(e),this.builderConfig={},this.type="group"}assertIsSupportedPart(){const{builderType:e}=this;if(!T.apiValues.includes(e))throw new c.YU(e)}};(0,r._)([(0,w.e)(T,{ignoreUnknown:!1,name:"type"})],S.prototype,"builderType",void 0),(0,r._)([(0,l.MZ)({json:{name:"options"}})],S.prototype,"builderConfig",void 0),(0,r._)([(0,l.MZ)()],S.prototype,"type",void 0),S=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.GroupTemplatePart")],S);let I=class extends m{constructor(e){super(e),this.type="group",this.createUtilityNetworkAssociations=!1,this.parts=[],this.utilityNetwork=null,this.utilityNetworkAssociationsTable=null}get allParts(){return[this.basePart,...this.parts]}get inputGeometryType(){return k[this.basePart.builderType]}};(0,r._)([(0,l.MZ)({readOnly:!0})],I.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"allParts",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:S})],I.prototype,"basePart",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],I.prototype,"createUtilityNetworkAssociations",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"inputGeometryType",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[S]})],I.prototype,"parts",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"utilityNetwork",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"utilityNetworkAssociationsTable",void 0),I=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.GroupTemplateDefinition")],I);var A=o(19902),b=o(31608);let C=class extends h{constructor(e){super(e),this.geometry=null,this.type="preset"}assertIsSupportedPart(){}};(0,r._)([(0,l.MZ)({types:b.yR,json:{read:A.fromJSON}})],C.prototype,"geometry",void 0),(0,r._)([(0,l.MZ)()],C.prototype,"type",void 0),C=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.PresetTemplatePart")],C);var N=o(19247),M=o(13312);let G=class extends m{constructor(e){super(e),this.type="preset",this.parts=[]}get allParts(){return this.parts}};(0,r._)([(0,l.MZ)({readOnly:!0})],G.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],G.prototype,"allParts",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:N.default})],G.prototype,"origin",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[C],json:{name:"features"}})],G.prototype,"parts",void 0),(0,r._)([(0,l.MZ)({type:M.default})],G.prototype,"spatialReference",void 0),G=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.PresetTemplateDefinition")],G);var R=o(25647);const Z=e=>P.fromJSON(e);let P=class extends(n.A.LoadableMixin(a.A.EsriPromiseMixin(d.default))){constructor(e){super(e),this.definition=null,this.layer=null,this.type="feature",this.view=null}readDefinition(e,t){switch(t.type){case"feature":return _.fromJSON(e);case"group":return I.fromJSON(e);case"preset":return G.fromJSON(e);default:throw(0,i.Xb)(t.type),new s.default("shared-template:no-definition","No value for 'definition' provided to 'SharedTemplate' constructor")}}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){var t;const{definition:o,featureService:r,layer:i,view:s}=this;if(!(o&&r&&i&&s))throw new c.eZ;o.featureService=r,o.makeSharedTemplateFromJSON=Z,o.view=s,await(null===(t=this.definition)||void 0===t?void 0:t.load(e)),(0,R.sC)(o)&&o.initializeRelationshipMetadata(i)}};(0,r._)([(0,l.MZ)()],P.prototype,"definition",void 0),(0,r._)([(0,p.w)("definition")],P.prototype,"readDefinition",null),(0,r._)([(0,l.MZ)()],P.prototype,"layer",void 0),(0,r._)([(0,l.MZ)()],P.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],P.prototype,"view",void 0),P=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.SharedTemplate")],P);const L=P},66830:(e,t,o)=>{o.d(t,{B:()=>b});var r=o(35143),i=o(3825),s=o(91967),n=o(54901),a=o(87663),l=o(30726),p=o(50346),u=o(68134),d=o(46053),c=(o(81806),o(76460),o(47249),o(85842)),y=o(5600),f=o(19166),v=o(31933),m=o(89379),h=o(50076),g=o(49304),_=o(91291),w=o(67993),T=o(12899);let k=class extends(g.A.LoadableMixin(_.A)){constructor(e){super(e),this.layerIdToSourceIdLookup=new w.A,this.sourceIdToLayerIdLookup=new w.A,this.sourceIdToNetworkInfo=new w.A,this._rulesBySourceId=new Map,this._terminalConfigurationsBySourceId=new Map}async load(e){return this.addResolvingPromise(this._load(e)),this}agatFromRule(e,t){var o,r,i,s,n,a,l,p,u;let d;switch(t){case"to":d={networkSource:null!==(o=e.toNetworkSource)&&void 0!==o?o:null,assetGroup:null!==(r=e.toAssetGroup)&&void 0!==r?r:null,assetType:null!==(i=e.toAssetType)&&void 0!==i?i:null};break;case"from":d={networkSource:null!==(s=e.fromNetworkSource)&&void 0!==s?s:null,assetGroup:null!==(n=e.fromAssetGroup)&&void 0!==n?n:null,assetType:null!==(a=e.fromAssetType)&&void 0!==a?a:null};break;case"via":d={networkSource:null!==(l=e.viaNetworkSource)&&void 0!==l?l:null,assetGroup:null!==(p=e.viaAssetGroup)&&void 0!==p?p:null,assetType:null!==(u=e.viaAssetType)&&void 0!==u?u:null}}return null===d.networkSource?null:d}agatToFullDefinition(e){var t;let{assetGroup:o,assetType:r,networkSourceId:i}=e;if(null===i||null===o||null===r)return null;const s={networkSource:null,assetGroup:null,assetType:null},n=this.sourceIdToNetworkInfo.get(i);if(!n)return null;s.networkSource=n;const a=n.assetGroupLookup.get(o);return a?(s.assetGroup=a,s.assetType=null!==(t=a.assetTypeLookup.get(r))&&void 0!==t?t:null,null===s.assetType?null:s):null}findAgat(e,t){var o,r,i,s;const n=(0,v.Sv)(t)?t.parent:t;if(!n)throw new h.default("Unable to find asset group/asset type for layer. The given layer is a `SubtypeSublayer` with no parent.");if(this.utilityNetwork.featureServiceUrl!==n.url)return null;const a=this.getNetworkSourceIdForLayer(n);if(null===a)return null;const l=null!==(o=null===(r=n.fieldsIndex.get("assettype"))||void 0===r?void 0:r.name)&&void 0!==o?o:"";if(""===l)return null;const p=null!==(i=null===(s=n.fieldsIndex.get("assetgroup"))||void 0===s?void 0:s.name)&&void 0!==i?i:"";if(""===p)return null;const u=e.attributes[l],d=e.attributes[p];return null==u||null==d?null:{assetGroup:d,assetType:u,networkSourceId:a}}findAgatFullDefinition(e,t){const o=this.findAgat(e,t);return o?this.agatToFullDefinition(o):null}findRules(e){var t;let{networkSourceId:o,assetGroup:r,assetType:i}=e;const s=[];if(null===o||null===r)return s;const n=null===(t=this._rulesBySourceId.get(o))||void 0===t?void 0:t.get(r);if(!n)return s;for(const a of n.generalRules)s.push(a);if(null!=i){const e=n.typeSpecificRules.get(i);if(e)for(const t of e)s.push(t)}return s}getNetworkSourceIdForLayer(e){var t;const o=(0,v.Sv)(e)?e.parent:e;return o&&this.utilityNetwork.featureServiceUrl===o.url&&null!==(t=this.layerIdToSourceIdLookup.get(o.layerId))&&void 0!==t?t:null}ruleMatchesAgat(e,t,o){var r,i,s;switch(o){case"to":return!((null===(r=e.toNetworkSource)||void 0===r?void 0:r.sourceId)!==t.networkSourceId||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==t.assetGroup||e.toAssetType&&e.toAssetType.assetTypeCode!==t.assetType);case"from":return!((null===(i=e.fromNetworkSource)||void 0===i?void 0:i.sourceId)!==t.networkSourceId||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==t.assetGroup||e.fromAssetType&&e.fromAssetType.assetTypeCode!==t.assetType);case"via":return!((null===(s=e.viaNetworkSource)||void 0===s?void 0:s.sourceId)!==t.networkSourceId||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==t.assetGroup||e.viaAssetType&&e.viaAssetType.assetTypeCode!==t.assetType)}}ruleMatchesFullDefinitionAgat(e,t,o){var r,i,s,n,a,l,p,u,d,c,y,f;switch(o){case"to":return!((null===(r=e.toNetworkSource)||void 0===r?void 0:r.sourceId)!==(null===(i=t.networkSource)||void 0===i?void 0:i.sourceId)||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==(null===(s=t.assetGroup)||void 0===s?void 0:s.assetGroupCode)||e.toAssetType&&e.toAssetType.assetTypeCode!==(null===(n=t.assetType)||void 0===n?void 0:n.assetTypeCode));case"from":return!((null===(a=e.fromNetworkSource)||void 0===a?void 0:a.sourceId)!==(null===(l=t.networkSource)||void 0===l?void 0:l.sourceId)||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==(null===(p=t.assetGroup)||void 0===p?void 0:p.assetGroupCode)||e.fromAssetType&&e.fromAssetType.assetTypeCode!==(null===(u=t.assetType)||void 0===u?void 0:u.assetTypeCode));case"via":return!((null===(d=e.viaNetworkSource)||void 0===d?void 0:d.sourceId)!==(null===(c=t.networkSource)||void 0===c?void 0:c.sourceId)||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==(null===(y=t.assetGroup)||void 0===y?void 0:y.assetGroupCode)||e.viaAssetType&&e.viaAssetType.assetTypeCode!==(null===(f=t.assetType)||void 0===f?void 0:f.assetTypeCode))}}terminalConfiguration(e,t,o){const r=this._terminalConfigurationsBySourceId.get(e);if(!r)return null;const i=r.get(t);if(!i)return null;return i.get(o)||null}async _load(e){await this.utilityNetwork.load(),(0,p.throwIfAborted)(e);const{dataElement:t}=this.utilityNetwork;if(!t)throw new h.default("no-data-element","No data element found on utility network");for(const a of t.domainNetworks)for(const e of[...null!==(o=a.edgeSources)&&void 0!==o?o:[],...null!==(r=a.junctionSources)&&void 0!==r?r:[]]){var o,r,i;this.layerIdToSourceIdLookup.set(e.layerId,e.sourceId),this.sourceIdToLayerIdLookup.set(e.sourceId,e.layerId);const t=(null!==(i=e.assetGroups)&&void 0!==i?i:[]).map((e=>{const t=new w.A;for(const r of null!==(o=e.assetTypes)&&void 0!==o?o:[]){var o;t.set(r.assetTypeCode,r)}return(0,m.A)((0,m.A)({},e),{},{assetTypeLookup:t})})),s=new w.A;for(const e of t)s.set(e.assetGroupCode,e);const n=(0,m.A)((0,m.A)({},e),{},{assetGroupLookup:s,assetGroups:t});this.sourceIdToNetworkInfo.set(n.sourceId,n)}const s=await this.utilityNetwork.getRulesTable();(0,p.throwIfAborted)(e);for(const a of null!==(n=null===s||void 0===s?void 0:s.rules)&&void 0!==n?n:[]){var n;switch(a.ruleType){case T.D2.RTAttachment:case T.D2.RTContainment:this._registerRule(a.fromNetworkSource.sourceId,a.fromAssetGroup.assetGroupCode,a.fromAssetType.assetTypeCode,a),this._registerRule(a.toNetworkSource.sourceId,a.toAssetGroup.assetGroupCode,a.toAssetType.assetTypeCode,a);break;case T.D2.RTEdgeJunctionEdgeConnectivity:this._registerRule(a.fromNetworkSource.sourceId,a.fromAssetGroup.assetGroupCode,a.fromAssetType.assetTypeCode,a),this._registerRule(a.toNetworkSource.sourceId,a.toAssetGroup.assetGroupCode,a.toAssetType.assetTypeCode,a),this._registerRule(a.viaNetworkSource.sourceId,a.viaAssetGroup.assetGroupCode,a.viaAssetType.assetTypeCode,a);break;case T.D2.RTJunctionEdgeConnectivity:case T.D2.RTJunctionJunctionConnectivity:this._registerRule(a.fromNetworkSource.sourceId,a.fromAssetGroup.assetGroupCode,a.fromAssetType.assetTypeCode,a),this._registerRule(a.toNetworkSource.sourceId,a.toAssetGroup.assetGroupCode,a.toAssetType.assetTypeCode,a)}}this._makeTerminalConfigurationLookups(t)}_makeTerminalConfigurationLookups(e){const t={};for(const n of null!==(o=e.terminalConfigurations)&&void 0!==o?o:[]){var o;t[n.terminalConfigurationId]=n}for(const n of null!==(r=e.domainNetworks)&&void 0!==r?r:[]){var r;for(const e of n.junctionSources)if("esriUNFCUTJunctionObject"===e.utilityNetworkFeatureClassUsageType||"esriUNFCUTDevice"===e.utilityNetworkFeatureClassUsageType)for(const o of null!==(i=e.assetGroups)&&void 0!==i?i:[]){var i;for(const r of null!==(s=o.assetTypes)&&void 0!==s?s:[]){var s;if(null!=r.terminalConfigurationId&&r.terminalConfigurationId>=0){const i=t[r.terminalConfigurationId];if(i){const t=(0,a.tE)(this._terminalConfigurationsBySourceId,e.sourceId,(()=>new Map));(0,a.tE)(t,o.assetGroupCode,(()=>new Map)).set(r.assetTypeCode,i)}}}}}}_registerRule(e,t,o,r){const i=(0,a.tE)(this._rulesBySourceId,e,(()=>new Map)),s=(0,a.tE)(i,t,(()=>({generalRules:[],typeSpecificRules:new Map})));-1===o?s.generalRules.push(r):(0,a.tE)(s.typeSpecificRules,o,(()=>[])).push(r)}};(0,r._)([(0,d.MZ)()],k.prototype,"layerIdToSourceIdLookup",void 0),(0,r._)([(0,d.MZ)()],k.prototype,"sourceIdToLayerIdLookup",void 0),(0,r._)([(0,d.MZ)()],k.prototype,"sourceIdToNetworkInfo",void 0),(0,r._)([(0,d.MZ)()],k.prototype,"utilityNetwork",void 0),k=(0,r._)([(0,c.$)("esri.networks.support.UtilityNetworkLookupHelper")],k);var S=o(5874),I=o(42052);const A=new Map;function b(e,t){return(0,a.tE)(A,e,(()=>{var o,r;const i=new C({layerResolver:null!==(o=null===t||void 0===t?void 0:t.layerResolver)&&void 0!==o?o:G(e),makeSharedTemplateFromJSON:t.makeSharedTemplateFromJSON,utilityNetworkResolver:null!==(r=null===t||void 0===t?void 0:t.utilityNetworkResolver)&&void 0!==r?r:R(e),view:e});return e.addHandles((0,n.hA)((()=>{A.delete(e),i.destroy()}))),i}))}let C=class extends s.default{constructor(e){super(e),this._abortController=null,this._cache=new Map,this._pending=new Map,this._utilityNetworkLookupHelperCache=new Map,this.layerResolver=null,this.makeSharedTemplateFromJSON=null,this.utilityNetworkResolver=null,this.view=null}initialize(){this.addHandles((0,u.watch)((()=>this.view.spatialReference),(()=>this._reset())))}destroy(){this._abortController=(0,l.DC)(this._abortController)}async getTemplates(e){let{templateIds:t,featureService:o,signal:r}=e;const i=this._cache,s=this._pending,n=[],a=new Set,l=new Set,u=Symbol();for(const f of new Set(t)){const e=M(o,f);if(i.has(e))n.push(i.get(e));else if(s.has(e)){const t=s.get(e);t.subscribers.add(u),l.add(t)}else a.add(f),s.set(e,{resolver:(0,p.createResolver)(),subscribers:new Set})}if(n.length===t.length)return n;const d=()=>{for(const{subscribers:e}of l)e.delete(u)},c=(0,p.onAbort)(r,d);try{const e=await this._loadTemplates({templateIds:Array.from(a),featureService:o,signal:r}),t=await Promise.all(Array.from(l).map((e=>{let{resolver:t}=e;return t.promise})));n.push(...e),n.push(...t)}catch(y){d();for(const e of a){const t=M(o,e),r=s.get(t);null!==r&&void 0!==r&&r.resolver.reject(y),s.delete(t)}throw y}finally{null===c||void 0===c||c.remove()}return(0,p.throwIfAborted)(r),n}async _loadTemplates(e){let{templateIds:t,featureService:o,signal:r}=e;if(0===t.length)return[];const s=this._cache,n=this._pending,a=this._abortController=new AbortController,l=(0,p.onAbort)(r,(()=>{for(const e of t)if(N(n.get(M(o,e))))return;a.abort()})),u=await async function(e){var t,o;let{templateIds:r,featureService:s,spatialReference:n,signal:a}=e;const l="".concat(s.url,"/sharedTemplates/templates"),u=await(0,i.default)(l,{query:{f:"json",outSR:n,ids:r.join(",")},signal:a}).catch((e=>{throw(0,p.throwIfAbortError)(e),new f.Br(r,e)}));return null!==(t=null===(o=u.data)||void 0===o?void 0:o.templates)&&void 0!==t?t:[]}({featureService:o,templateIds:t,signal:a.signal,spatialReference:this.view.spatialReference});if(u.length<t.length)throw new f.dG(t,u);const d=await Promise.all(u.map((e=>this._makeTemplate({json:e,featureService:o}))));for(const i of d){const e=M(o,i.templateId),t=n.get(e);null===r||void 0===r||!r.aborted||N(t)?(s.set(e,i),null===t||void 0===t||t.resolver.resolve(i)):null===t||void 0===t||t.resolver.reject((0,p.createAbortError)()),n.delete(e)}return null!==l&&void 0!==l&&l.remove(),d}async _makeTemplate(e){var t,o;let{json:r,featureService:i}=e;const{view:s}=this,n=this.makeSharedTemplateFromJSON(r);n.featureService=i,n.view=s;const{layerIds:a,subtypeCode:l}=n;try{n.layer=await this.layerResolver({featureService:i,layerIds:a,subtypeCode:l})}catch(d){throw new f.Zm(n.templateId,d)}if((0,y.Dt)(n)&&null!==(t=n.definition)&&void 0!==t&&t.createUtilityNetworkAssociations){let e=null;try{e=await this.utilityNetworkResolver(i)}catch(d){throw new f.G6(n.templateId,d)}if(e){n.definition.utilityNetwork=await this._getOrCreateUtilityNetworkLookupHelper(e);const t=await e.loadAssociationsTable();n.definition.utilityNetworkAssociationsTable=t,(0,S.Z)(s).additionalLayers.add(t)}}if((0,y.JC)(n)&&n.definition){n.definition.spatialReference=s.spatialReference;for(const e of n.definition.allParts)e.geometry&&(e.geometry.spatialReference=s.spatialReference)}if((0,y.Cq)(n)&&null!==(o=n.definition)&&void 0!==o&&o.defaultValues){const e=n.definition.defaultValues,t={},{fieldsIndex:o}=n.layer;for(const r in n.definition.defaultValues){var p,u;t[null!==(p=null===(u=o.get(r))||void 0===u?void 0:u.name)&&void 0!==p?p:r]=e[r]}n.definition.defaultValues=t}return n}async _getOrCreateUtilityNetworkLookupHelper(e){const t=this._utilityNetworkLookupHelperCache.get(e);if(t)return t;const o=await new k({utilityNetwork:e}).load();this._utilityNetworkLookupHelperCache.set(e,o);const r=(0,n.hA)((()=>{o.destroy(),this._utilityNetworkLookupHelperCache.delete(e)}));return e.addHandles(r),this.addHandles(r),o}_reset(){var e;null!==(e=this._abortController)&&void 0!==e&&e.abort(),this._cache.clear(),this._pending.clear()}};function N(e){return null!=e&&e.subscribers.size>0}function M(e,t){return"".concat(e.url,"/").concat(t)}function G(e){return async t=>{let{featureService:o,layerIds:r}=t;const i=new Set(r),{allLayers:s,allTables:n}=e.map,a=s.concat(n).find((e=>e.url===o.url&&function(e){return(0,v.yZ)(e)||(0,v.F2)(e)}(e)&&i.has(e.layerId)));if(null==a)throw new f.$W(r);return a}}function R(e){return async t=>{const{map:o}=e;if(!(0,I.r)(o)||!o.utilityNetworks)return null;for(const e of o.utilityNetworks)if(e.featureServiceUrl===t.url)return e.load();return null}}(0,r._)([(0,d.MZ)()],C.prototype,"_abortController",void 0),(0,r._)([(0,d.MZ)()],C.prototype,"_cache",void 0),(0,r._)([(0,d.MZ)()],C.prototype,"_pending",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],C.prototype,"layerResolver",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],C.prototype,"makeSharedTemplateFromJSON",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],C.prototype,"utilityNetworkResolver",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],C.prototype,"view",void 0),C=(0,r._)([(0,c.$)("esri.editing.sharedTemplates.SharedTemplateProvider")],C)}}]);
//# sourceMappingURL=49750.be3ee949.chunk.js.map