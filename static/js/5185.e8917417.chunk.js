"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[5185],{5185:(e,a,r)=>{r.r(a),r.d(a,{createRenderer:()=>F,createRendererForClustering:()=>G,regenerateRenderer:()=>B});var n=r(89379),t=r(69539),i=r(18690),l=r(59784),o=r(50076),s=r(76931),u=r(63860),c=r(3522),d=r(22993),m=r(41626),p=r(79364),f=r(59536),h=r(84563),y=r(33766),b=r(31650),v=r(87990),g=r(53680),w=r(51006),z=r(15231),S=r(28383),E=r(90494),C=r(42633),T=r(11563),x=r(37590),V=r(38996),k=r(29632);const O=[T.mb.CSVLayer,T.mb.FeatureLayer,T.mb.GeoJSONLayer,T.mb.KnowledgeGraphSublayer,T.mb.OGCFeatureLayer,T.mb.OrientedImageryLayer,T.mb.ParquetLayer,T.mb.StreamLayer,T.mb.WFSLayer];async function I(e){var a,r;if(!(null!==e&&void 0!==e&&e.layer&&e.view&&null!==(a=e.attributes)&&void 0!==a&&a.length))throw new o.default("pie-chart-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(e.attributes.length>10)throw new o.default("pie-chart-renderer:invalid-parameters","PieChart renderer does not support more than 10 attributes");e.forBinning&&(0,E.p)(e,"pie-chart-renderer");const t=(0,n.A)((0,n.A)({},e),{},{layer:e.layer,view:e.view,attributes:e.attributes});t.shape=t.shape||"pie",null!==(r=t.othersCategoryEnabled)&&void 0!==r||(t.othersCategoryEnabled=!0),t.includeSizeVariable=e.includeSizeVariable||!1;const i=e.forBinning?T.Mi:O,l=(0,T.Jg)(t.layer,i,e.forBinning);if(!l)throw new o.default("pie-chart-renderer:invalid-parameters","'layer' must be one of these types: "+(0,T.Ho)(i).join(", "));const s=null!=t.signal?{signal:t.signal}:null;await Promise.all([e.view.when(),l.load(s)]);const u=l.geometryType,c="polygon"===u,d="point"===u||"multipoint"===u||c;if(t.outlineOptimizationEnabled=!!c&&t.outlineOptimizationEnabled,t.sizeOptimizationEnabled=!!d&&t.sizeOptimizationEnabled,!d)throw new o.default("pie-chart-renderer:not-supported","PieChart renderer is only supported for point and polygon layers");const m=[],p=t.attributes;for(const n of p){const e=await(0,C.EG)({field:n.field,valueExpression:n.valueExpression});m.push(...e)}const f=(0,w.MH)(l,m.filter(Boolean),"pie-chart-renderer:invalid-parameters");if(f)throw f;return(0,n.A)((0,n.A)({},t),{},{layer:l})}async function q(e){let a=e.pieChartScheme,r=null,n=null;const t=await(0,w.Ib)(e.basemap,e.view);if(r=null!=t.basemapId?t.basemapId:null,n=null!=t.basemapTheme?t.basemapTheme:null,a)return{scheme:(0,x.cloneScheme)(a),basemapId:r,basemapTheme:n};const i=(0,x.getSchemes)({numColors:e.attributes.length,geometryType:e.layer.geometryType,basemapTheme:n});return i&&(a=i.primaryScheme,r=i.basemapId,n=i.basemapTheme),{scheme:a,basemapId:r,basemapTheme:n}}async function A(e,a){const{valueExpression:r,sqlExpression:n,sqlWhere:t}=(0,S.D9)(e.attributes),i=await(0,u.ud)("esri/smartMapping/t9n/smartMapping");return(0,v.createVisualVariables)({layer:e.layer,basemap:e.basemap,valueExpression:r,sqlExpression:n,sqlWhere:t,sizeScheme:a,sizeOptimizationEnabled:e.sizeOptimizationEnabled,legendOptions:{title:i.sumOfCategories},view:e.view,signal:e.signal})}async function F(e){var a,r;const[n,t]=await Promise.all([I(e),(0,u.ud)("esri/smartMapping/t9n/smartMapping")]),c=await q(n),d=null===c||void 0===c?void 0:c.scheme;if(!d)throw new o.default("pie-chart-renderer:insufficient-info","Unable to find pie-chart scheme");const{layer:v,includeSizeVariable:g,sizeOptimizationEnabled:S,outlineOptimizationEnabled:E,view:C,signal:T,filter:k}=n,O=d.sizeScheme,F=n.attributes,B=F.map((e=>e.field)).filter(i.Ru),[M,R,_,j]=await Promise.all([B.length>1?(0,z.default)({layer:v,fields:B,view:C,signal:T,filter:k}):null,g?A(n,O):null,!g&&S?(0,b.default)({layer:v,view:C,signal:T,filter:k}).catch(w.ou):null,E?(0,y.A)({layer:v,view:C,signal:T,filter:k}).catch(w.ou):null]),G=null!==M&&void 0!==M&&M.predominantCategoryInfos?{uniqueValueInfos:M.predominantCategoryInfos}:{uniqueValueInfos:B.map((e=>({value:e,count:0})))},H=(0,l.Iy)(d.colors,F.length),J=F.map(((e,a)=>new p.default({field:e.field,valueExpression:e.valueExpression,label:e.label,valueExpressionTitle:e.valueExpressionTitle,color:H[a]}))),N=v.geometryType,$=null!=O&&"background"in O&&O.background,D=new m.default({attributes:J,othersCategory:new f.i({label:t.other,color:n.othersCategoryEnabled?d.colorForOthersCategory:null,threshold:.04}),holePercentage:"donut"===n.shape?.45:0,backgroundFillSymbol:$?(0,w.v5)(N,{type:"2d",color:$.color,outline:(0,w.qc)($,N,null===j||void 0===j?void 0:j.opacity)}):null,size:(0,s.cr)(d.size),outline:new V.default((0,w.qc)(d,"point",null===j||void 0===j?void 0:j.opacity)),legendOptions:h.A.from(n.legendOptions)});if(R&&(P(R,S,N),D.authoringInfo=R.authoringInfo.clone(),D.visualVariables=null===(a=R.visualVariables)||void 0===a?void 0:a.map((e=>e.clone()))),null!==j&&void 0!==j&&null!==(r=j.visualVariables)&&void 0!==r&&r.length){const e=j.visualVariables.map((e=>e.clone())).filter((e=>"color"!==e.type&&"rotation"!==e.type));D.visualVariables?D.visualVariables.push(...e):D.visualVariables=e}return null!==_&&void 0!==_&&_.minSize&&(L(_,N),D.visualVariables?D.visualVariables.push(_.minSize):D.visualVariables=[_.minSize]),{renderer:D,pieChartScheme:(0,x.cloneScheme)(d),size:R,basemapId:c.basemapId,basemapTheme:c.basemapTheme,statistics:G}}async function B(e){var a,r;const{creatorParameters:t,view:i,signal:l,filter:s,renderer:u}=await async function(e){const a="regenerate-pie-chart-renderer";await(0,g.AC)(e,a);const r=await(0,g.mE)(e);if("pie-chart"!==(0,g.UJ)(r))throw new o.default("".concat(a,":invalid-parameters"),"Renderer is invalid");const{visualVariables:t}=r,{layer:i,forBinning:l,filter:s,view:u,signal:c}=e,d=(0,g.DW)(r),m=(0,g.Rv)(r),p=null===t||void 0===t?void 0:t.some(g.OW),f=r.attributes.map((e=>({field:e.field,label:e.label,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle}))),h=await I({layer:i,attributes:f,outlineOptimizationEnabled:d,sizeOptimizationEnabled:m,includeSizeVariable:p,forBinning:l,filter:s,view:u,signal:c});return(0,n.A)((0,n.A)({},e),{},{creatorParameters:h,renderer:r})}(e),{layer:c,outlineOptimizationEnabled:d,includeSizeVariable:m,sizeOptimizationEnabled:p}=t,f=await q(t),h=null===f||void 0===f||null===(a=f.scheme)||void 0===a?void 0:a.sizeScheme,[v,z,S]=await Promise.all([d?(0,y.A)({layer:c,view:i,signal:l,filter:s}).catch(w.ou):null,m?A(t,h):null,!m&&p?(0,b.default)({layer:c,view:i,signal:l,filter:s}).catch(w.ou):null]),E=c.geometryType;if(z&&(P(z,p,E),(0,g.ke)(u,null===z||void 0===z?void 0:z.visualVariables,g.Jy),(0,g.Hj)(u,null===z||void 0===z?void 0:z.authoringInfo,"size")),null!==v&&void 0!==v&&null!==(r=v.visualVariables)&&void 0!==r&&r.length){const e=v.visualVariables.map((e=>e.clone())).filter((e=>"color"!==e.type&&"rotation"!==e.type));(0,g.ke)(u,e,g._i)}return null!==S&&void 0!==S&&S.minSize&&(L(S,E),(0,g.ke)(u,null===S||void 0===S?void 0:S.minSize,g.kc)),{renderer:u}}function P(e,a,r){a||e.visualVariables.forEach((e=>{"number"==typeof e.minSize&&"number"==typeof e.maxSize&&(e.minSize*=2.5,e.maxSize*=1.8)})),a&&"point"===r&&e.visualVariables.forEach((e=>{var a;(null===e||void 0===e?void 0:e.minSize)&&"object"==typeof e.minSize&&(null===(a=e.minSize)||void 0===a||null===(a=a.stops)||void 0===a||a.forEach((e=>{e.size*=1.8})))}))}function L(e,a){var r,n;"point"===a&&null!==(r=e.minSize.stops)&&void 0!==r&&r.forEach((e=>{e.size*=2.5})),"polygon"===a&&(null===(n=e.minSize.stops)||void 0===n||n.forEach((e=>{e.size*=1.8})))}const M=new Set(["unique-value","class-breaks"]),R=new t.default("#aaaaaa"),_=new t.default("#5c5c5c"),j=[new t.default("#e60049"),new t.default("#0bb4ff"),new t.default("#50e991"),new t.default("#e6d800"),new t.default("#9b19f5"),new t.default("#ffa300"),new t.default("#dc0ab4"),new t.default("#b3d4ff"),new t.default("#00bfa0"),new t.default("#f0cccc")];async function G(e){const a=await async function(e){var a;if(!e||!e.layer)throw new o.default("pie-chart-cluster-renderer:missing-parameters","'layer' parameter is required");const r=(0,n.A)({},e);r.shape=r.shape||"pie",null!==(a=r.defaultSymbolEnabled)&&void 0!==a||(r.defaultSymbolEnabled=!0);const t=e.layer;if(!(0,T.nn)(O).includes(t.type))throw new o.default("pie-chart-cluster-renderer:invalid-parameters","'layer' must be one of these types: "+(0,T.Ho)(O).join(", "));const i=null!=r.signal?{signal:r.signal}:null;if(await t.load(i),"point"!==t.geometryType)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","Cluster renderers are only supported for point layers");const l="renderer"in t?t.renderer:void 0;if(!l)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","input layer does not have a renderer.");if(!M.has(l.type))throw new o.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters based on a ".concat(l.type," renderer."));if("valueExpression"in l&&l.valueExpression)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a layer whose renderer contains a valueExpression.");if("unique-value"===l.type){if(l.field2)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a UniqueValueRenderer using more than one field.");if(null!=l.uniqueValueInfos&&l.uniqueValueInfos.length>10)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer cannot be created from a UniqueValueRenderer with more than 10 unique value infos.")}if("class-breaks"===l.type){var s;if(l.classBreakInfos.length<2)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a layer renderer with a continuous color or size gradient.");if(l.classBreakInfos.length>10)throw new o.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer can not be created from a ClassBreaksRenderer with more than 10 class break infos.");if("class-breaks-size"===(null===l||void 0===l||null===(s=l.authoringInfo)||void 0===s?void 0:s.type))throw new o.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer can not be created from a ClassBreaksRenderer with breaks varied by size instead of color.")}return r}(e),{layer:r,shape:t,defaultSymbolEnabled:i,legendOptions:s}=a,f="renderer"in r?r.renderer:void 0,y=(await(0,u.ud)("esri/smartMapping/t9n/smartMapping")).other;let b=[];"unique-value"===(null===f||void 0===f?void 0:f.type)&&(b=function(e){var a,r;const{renderer:n,defaultSymbolEnabled:t,defaultLabelBackup:i}=e,{field:o,defaultSymbol:s,defaultLabel:u}=n,m=null!==(a=n.uniqueValueInfos)&&void 0!==a?a:[],p=s&&t,f=p?9:10,h=(0,l.Iy)(j,f),y=null!==(r=o?m.slice(0,f).map(((e,a)=>{var r;const n=e.label,t=h[a];return{field:new c.default({name:H(null===(r=e.value)||void 0===r?void 0:r.toString()),alias:n,onStatisticExpression:new d.default({title:"Field definition - ".concat(n),expression:N(o,e),returnType:"number"}),statisticType:"sum"}),color:J(e.symbol,t)}})):null)&&void 0!==r?r:[];if(p){const e="cluster_default",a=u||i;y.push({field:new c.default({name:H(e),alias:a,onStatisticExpression:new d.default({title:"Field definition - ".concat(a),expression:$(o,m),returnType:"number"}),statisticType:"sum"}),color:J(s,_)})}return y}({renderer:f,defaultSymbolEnabled:i,defaultLabelBackup:y})),"class-breaks"===(null===f||void 0===f?void 0:f.type)&&(b=function(e){const{renderer:a,defaultSymbolEnabled:r,defaultLabelBackup:n}=e,{field:t,classBreakInfos:i,defaultSymbol:o,defaultLabel:s}=a,u=o&&r,m=u?9:10,p=(0,l.Iy)(j,m),f=i.slice(0,m).map(((e,a)=>{const r=e.label||"".concat(e.minValue," - ").concat(e.maxValue),n=p[a];return{field:new c.default({name:H(r),alias:r,onStatisticExpression:new d.default({title:"Field definition - ".concat(r),expression:D(t,e),returnType:"number"}),statisticType:"sum"}),color:J(e.symbol,n)}}));if(u){const e="cluster_default",a=s||n;f.push({field:new c.default({name:H(e),alias:a,onStatisticExpression:new d.default({title:"Field definition - ".concat(a),expression:U(t,i),returnType:"number"}),statisticType:"sum"}),color:J(o,_)})}return f}({renderer:f,defaultSymbolEnabled:i,defaultLabelBackup:y}));const v=[],g=[];for(const n of b){const{field:e,color:a}=n;v.push(e),g.push(new p.default({color:a,field:e.name,label:e.alias}))}return{fields:v,renderer:new m.default({attributes:g,legendOptions:h.A.from(s),holePercentage:"donut"===t?.45:0,outline:null,size:9,othersCategory:null})}}function H(e){return"SUM_"+(e+"").replaceAll(/[^a-zA-Z0-9_]/g,"_")}function J(e,a){if("simple-marker"===(null===e||void 0===e?void 0:e.type)&&e.color)return e.color.clone();if("cim"===(null===e||void 0===e?void 0:e.type)){const a=(0,k.getCIMSymbolColor)(e);if(a)return a.clone()}return a?a.clone():R.clone()}function N(e,a){return'Number(Text($feature["'.concat(e,'"]) == "').concat(a.value+"",'")')}function $(e,a){return"Number(!(".concat(a.map((a=>'(Text($feature["'.concat(e,'"]) == "').concat(a.value+"",'")'))).join(" || "),"))")}function D(e,a){return'Number($feature["'.concat(e,'"] >= ').concat(a.minValue,' && $feature["').concat(e,'"] < ').concat(a.maxValue,")")}function U(e,a){return"Number(!(".concat(a.map((a=>'($feature["'.concat(e,'"] >= ').concat(a.minValue,' && $feature["').concat(e,'"] < ').concat(a.maxValue,")"))).join(" || "),"))")}},15231:(e,a,r)=>{r.r(a),r.d(a,{default:()=>d});var n=r(89379),t=r(53986),i=r(50076),l=r(28383),o=r(90494),s=r(11563);const u=["layer"],c=["layerAdapter"];async function d(e){const a=await async function(e){if(!(e&&e.layer&&e.view&&e.fields))throw new i.default("predominant-categories:missing-parameters","'layer', 'view' and 'fields' parameters are required");e.forBinning&&(0,o.p)(e,"predominant-categories");const{layer:a}=e,r=(0,t.A)(e,u),c=e.forBinning?s.Mi:s.G3,d=(0,s.Jg)(a,c,e.forBinning);if(!d)throw new i.default("predominant-categories:invalid-parameters","'layer' must be one of these types: "+(0,s.Ho)(c).join(", "));const m=(0,n.A)({layerAdapter:d},r);await Promise.all([m.view.when(),d.load({signal:m.signal})]);const p=(0,l.MH)(d,m.fields,"predominant-categories:invalid-parameters");if(p)throw p;return m}(e),{layerAdapter:r}=a,d=(0,t.A)(a,c);return r.predominantCategories(d)}},37590:(e,a,r)=>{r.r(a),r.d(a,{cloneScheme:()=>g,getSchemeByName:()=>b,getSchemes:()=>y,getSchemesByTag:()=>v,getThemes:()=>h});var n=r(89379),t=r(69539),i=r(18690),l=r(59784),o=r(76281),s=r(89132),u=r(770);const c="#aaaaaa",d="25px",m={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},p=["vibrant-rainbow","cat-dark","predominant-v2","predominant-v5","predominance-race","desert-blooms","tropical-bliss","under-the-sea","ocean-bay","cat-light","predominant-v4","predominance-money","predominant-v3","predominance-race-ethnic","pastel-chalk","predominance-rainbow","predominance-sequence","cat-popup-olympic-sunset"],f=(0,u.bG)({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for visualizing features using a pie chart of categories.",schemes:{point:{light:{primary:"predominant-v1",secondary:p,common:{outline:m.light,colorForOthersCategory:c,size:d}},dark:{primary:"predominant-v2",secondary:p.map((e=>"predominant-v2"===e?"predominant-v1":e)),common:{outline:m.darker,colorForOthersCategory:c,size:d}}},polygon:{light:{primary:"predominant-v1",secondary:p,common:{colorForOthersCategory:c,outline:m.light,size:d}},dark:{primary:"predominant-v2",secondary:p.map((e=>"predominant-v2"===e?"predominant-v1":e)),common:{colorForOthersCategory:c,outline:m.dark,size:d}}}}}}});function h(e){return(0,u.vt)(f,e)}function y(e){const a=(0,u.Fq)({basemap:e.basemap,basemapTheme:e.basemapTheme,geometryType:e.geometryType,theme:f.get("default")});if(!a)return;const{schemesInfo:r,basemapId:n,basemapTheme:t}=a,l=r.common,s=e.numColors,c=(0,o.getSchemes)({basemap:e.basemap,geometryType:e.geometryType}),d=null===c||void 0===c?void 0:c.primaryScheme;return{primaryScheme:w(r.primary,l,s,d),secondarySchemes:r.secondary.map((e=>w(e,l,s,d))).filter(i.Ru),basemapId:n,basemapTheme:t}}function b(e){return(0,u.Ty)(e.name,y(e))}function v(e){return(0,u.YJ)(e.includedTags,e.excludedTags,y(e))}function g(e){if(!e)return;const a=(0,n.A)({},e);return a.tags=[...a.tags],a.colors&&(a.colors=a.colors.map((e=>new t.default(e)))),a.colorForOthersCategory&&(a.colorForOthersCategory=new t.default(a.colorForOthersCategory)),a.outline&&(a.outline={color:a.outline.color&&new t.default(a.outline.color),width:a.outline.width}),"sizeScheme"in a&&a.sizeScheme&&(a.sizeScheme=(0,o.cloneScheme)(a.sizeScheme)),a}function w(e,a,r,n){const i=s.A[e];if(i)return function(e){return{name:e.name,tags:[...e.tags],colors:e.colors.map((e=>new t.default(e))),colorForOthersCategory:new t.default(e.colorForOthersCategory),outline:{color:new t.default(e.outline.color),width:e.outline.width},size:e.size,sizeScheme:e.sizeScheme}}({name:i.name,tags:i.tags,colors:i[r]||(0,l.Iy)(i.stops,r),colorForOthersCategory:a.colorForOthersCategory,outline:a.outline,size:a.size,sizeScheme:n})}}}]);
//# sourceMappingURL=5185.e8917417.chunk.js.map