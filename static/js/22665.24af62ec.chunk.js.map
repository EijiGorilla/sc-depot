{"version":3,"file":"static/js/22665.24af62ec.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js","../node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as a,isAbortError as s}from\"../../../core/promiseUtils.js\";import o from\"../../../core/Warning.js\";import{equals as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as i,convertToGeometry as u}from\"../featureConversionUtils.js\";import{executeQueryForSnapping as l}from\"../data/executeQueryForSnapping.js\";import h from\"../data/FeatureStore.js\";import{checkProjectionSupport as c,project as m}from\"../data/projectionSupport.js\";import{QueryEngine as p}from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as d}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as y,getFeatureCount as _,getFeature as x}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";import{isNumber as C}from\"../../../support/guards.js\";import{utc as R}from\"../../../time/constants.js\";const F=\"esri.layers.WFSLayer\";class S{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:s,getFeatureOutputFormat:o,fields:n,geometryType:i,featureType:u,maxRecordCount:l,maxTotalRecordCount:m,maxPageCount:g,objectIdField:d,customParameters:f}=e,{spatialReference:_,getFeatureSpatialReference:x}=y(s,u,e.spatialReference);try{await c(x,_)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:x,outSpatialReference:_})}a(r),this._customParameters=f,this._featureType=u,this._fieldsIndex=w.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:R}:null}),this._geometryType=i,this._getFeatureUrl=s,this._getFeatureOutputFormat=o,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=m,this._maxPageCount=g,this._objectIdField=d,this._spatialReference=_;let C=await this._snapshotFeatures(r);if(C.errors.length>0&&(this._supportsPagination=!1,C=await this._snapshotFeatures(r),C.errors.length>0))throw C.errors[0];return this._queryEngine=new p({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,objectIdField:d,spatialReference:_,timeInfo:null,featureStore:new h({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(C.features),{warnings:E(C),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){await this._waitSnapshotComplete();return(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(C)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),l(this._queryEngine,e,t.signal)}async queryAttributeBins(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures({signal:e}))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of E(e))r.getLogger(F).warn(new o(\"wfs-layer:refresh-warning\",t.message,t.details));e.errors?.length&&r.getLogger(F).warn(new o(\"wfs-layer:refresh-error\",\"Refresh completed with errors\",{errors:e.errors}))}),(()=>{this._queryEngine.featureStore.clear()})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,o=this._maxPageCount,n=this._supportsPagination?await _(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let i=[];const u=[];if(null==n)try{i=await this._singleQuery(t)}catch(l){s(l)||u.push(l)}else{const e=Math.min(n,r),a=T(this,Math.max(1,Math.min(Math.ceil(e/this._maxRecordCount),o)),t);await Promise.allSettled(Array.from({length:10}).map((()=>j(a,i,u))))}return a(t),{features:i,totalRecordCount:n,maxTotalRecordCount:r,maxPageCount:o,errors:u}}async _singleQuery(e){const t=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:e});return this._processGeoJSON(t,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){g(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:s}=t;a(s);const o=d(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!n(this._spatialReference,this._getFeatureSpatialReference))for(const a of o)null!=a.geometry&&(a.geometry=i(m(u(a.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let l=r??1;for(const a of o){const e={};f(this._fieldsIndex,e,a.attributes,!0),a.attributes=e,null==e[this._objectIdField]&&(a.objectId=e[this._objectIdField]=l++)}return o}}function*T(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}async function j(e,t,r){let a=e.next();for(;!a.done;){try{const e=await a.value;t.push(...e)}catch(o){s(o)||r.push(o)}a=e.next()}}function E(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:\"wfs-layer:maxRecordCount-too-low\",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:\"wfs-layer:large-dataset\",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{parseDate as t}from\"../../../../core/date.js\";import{isValid as e}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as n,validationErrorToString as r,isNumericField as o,isStringField as i,isDateField as s,sanitizeNullFieldValue as l}from\"../../../support/fieldUtils.js\";class u{constructor(){this.code=null,this.description=null}}class a{constructor(t){this.error=new u,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=t}}function p(t){return new a(t)}class c{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function f(t){return new c(t)}const d=new Set;function g(t,e,o,i=!1){d.clear();for(const s in o){const l=t.get(s);if(!l)continue;const u=m(l,o[s]);if(d.add(l.name),l&&(i||l.editable)){const t=n(l,u);if(t)return p(r(t,l,u));e[l.name]=u}}for(const n of t.requiredFields??[])if(!d.has(n.name))return p(`missing required field \"${n.name}\"`);return null}function m(e,n){let r=n;return o(e)&&\"string\"==typeof n?r=parseFloat(n):i(e)&&null!=n&&\"string\"!=typeof n?r=String(n):s(e)&&\"string\"==typeof n&&(r=t(n)),l(r)}let y;function h(t,n){if(!t||!e(n))return t;if(\"rings\"in t||\"paths\"in t){if(null==y)throw new TypeError(\"geometry engine not loaded\");return y.simplify(n,t)}return t}async function I(){return null==y&&(y=await import(\"../../../../geometry/geometryEngineJSON.js\")),y}async function E(t,n){!e(t)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await I()}const S={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:[\"COUNT\",\"SUM\",\"AVG\",\"VAR\",\"STDDEV\",\"MIN\",\"MAX\",\"PERCENTILE_CONT\",\"PERCENTILE_DISC\",\"CentroidAggregate\",\"EnvelopeAggregate\",\"ConvexHullAggregate\"],supportedNormalizationTypes:[\"field\",\"log\",\"naturalLog\",\"percentOfTotal\",\"squareRoot\"]};export{p as createFeatureEditErrorResult,f as createFeatureEditSuccessResult,E as loadGeometryEngineForSimplify,g as mixAttributes,S as queryBinsCapabilities,h as simplify};\n"],"names":["F","S","constructor","this","_customParameters","_queryEngine","_supportsPagination","destroy","_this$_queryEngine","load","e","r","arguments","length","undefined","getFeatureUrl","s","getFeatureOutputFormat","o","fields","n","geometryType","i","featureType","u","maxRecordCount","l","maxTotalRecordCount","m","maxPageCount","g","objectIdField","d","customParameters","f","spatialReference","_","getFeatureSpatialReference","x","y","c","_unused","t","inSpatialReference","outSpatialReference","a","_featureType","_fieldsIndex","w","fromLayerJSON","dateFieldsTimeReference","some","type","timeZoneIANA","R","_geometryType","_getFeatureUrl","_getFeatureOutputFormat","_getFeatureSpatialReference","_maxRecordCount","_maxTotalRecordCount","_maxPageCount","_objectIdField","_spatialReference","C","_snapshotFeatures","errors","p","fieldsIndex","hasM","hasZ","timeInfo","featureStore","h","addMany","features","warnings","E","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","signal","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","filter","queryExtent","executeQueryForExtent","querySnapping","queryAttributeBins","executeAttributeBinsQuery","refresh","_this$_snapshotTask","_snapshotTask","abort","promise","then","_e$errors","clear","getLogger","warn","message","details","finished","_unused2","typeName","_singleQuery","push","Math","min","_pageQuery","T","max","ceil","Promise","allSettled","Array","from","map","async","next","done","value","j","totalRecordCount","_processGeoJSON","startIndex","count","wkid","geometry","attributes","objectId","name","concat","recordCount","code","description","error","globalId","success","uniqueId","Set","get","add","editable","_t$requiredFields","requiredFields","has","parseFloat","String","TypeError","simplify","I","supportsAutoIntervalBin","supportsFixedIntervalBin","supportsFixedBoundariesBin","supportsDateBin","supportsStackBy","supportsSplitBy","supportsNormalization","supportedStatisticTypes","supportedNormalizationTypes"],"sourceRoot":""}