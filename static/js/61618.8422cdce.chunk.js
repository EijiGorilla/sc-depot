"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[9805,32186,56203,61618,70961],{4852:(e,t,i)=>{i.d(t,{Ad:()=>v,O_:()=>p,m6:()=>g,wF:()=>m,y0:()=>h});var a=i(89379),r=i(3825),n=i(50076),o=i(15941),s=i(50346),l=i(90534),c=i(97572),u=i(44538),d=i(38338);const h=e=>"FA"===e,p=async(e,t,a)=>{var r;const o=new(await Promise.resolve().then(i.bind(i,9708)).then((e=>e.default)))({objectIds:[t]}),s=null===(r=(await e.queryAttachments(o,a))["".concat(t)])||void 0===r?void 0:r[0],l=null===s||void 0===s?void 0:s.url;if(!l)throw new n.default("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:s.contentType.split("/")[1].toUpperCase(),url:l}};async function m(e,t){var a;const r="string"==typeof e,n=r?e:e.url,{pathname:o,searchParams:c,origin:u}=new URL(n);let h=r?(0,l.getPathExtension)(o):e.datasetFormat;h||(h=await(0,d.gt)(n));const p=await Promise.resolve().then(i.bind(i,80068)).then((e=>e.default)),m=await p.open({ioConfig:{customFetchParameters:Object.fromEntries(c),skipMapInfo:!0},datasetFormat:null===(a=h)||void 0===a?void 0:a.toUpperCase(),url:"".concat(u).concat(o),signal:null===t||void 0===t?void 0:t.signal});return m?async function(e,t){const{level:i,offset:a,size:r}=function(e){const{storageInfo:t,width:i,height:a}=e.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:n}=t,o=null!==n&&void 0!==n?n:2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(i/o**r),height:Math.ceil(a/o**r)}}}(e),{pixelBlock:n}=await e.fetchRawPixels(i,a,r,t);return(0,s.throwIfAborted)(t),n}(m,{signal:null===t||void 0===t?void 0:t.signal}):null}async function g(e,t,i){if(!e)throw new n.default("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:o,url:s}=await p(e,+t,i);return(0,d.RP)(o)?await m({datasetFormat:o,url:s},i):(await(0,r.default)(s,(0,a.A)((0,a.A)({},i),{},{useRequestQueue:!0,responseType:"image",query:{w:u.RK}}))).data}function v(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{height:a,width:r}=e;t.width=r,t.height=a;const n=t.getContext("2d");if(!n)return;const s=function(e,t,i){const a=document.createElement("canvas"),r=a.getContext("2d");if(e instanceof HTMLImageElement)a.width=e.width,a.height=e.height,null===r||void 0===r||r.drawImage(e,0,0);else{const n=i.createImageData(t.width,t.height);n&&(n.data.set(e.getAsRGBA()),a.width=n.width,a.height=n.height,null===r||void 0===r||r.putImageData(n,0,0))}return a}(e,t,n);s.getContext("2d")&&(i>0?function(e,t,i,a,r){const n=(0,o.kU)(r),s=[(0,c.cC)(0,0,n),(0,c.cC)(i,0,n),(0,c.cC)(i,a,n),(0,c.cC)(0,a,n)],l=Math.max(...s.map((e=>e[0])))-Math.min(...s.map((e=>e[0]))),u=Math.max(...s.map((e=>e[1])))-Math.min(...s.map((e=>e[1]))),d=Math.min(i/l,a/u);e.save(),e.clearRect(0,0,i,a),e.translate(i/2,a/2),e.rotate(n),e.scale(d,d),e.drawImage(t,-i/2,-a/2,i,a),e.restore()}(n,s,r,a,i):n.drawImage(s,0,0))}},11113:(e,t,i)=>{i.d(t,{Ee:()=>l,Jd:()=>y,Nk:()=>h,OM:()=>v,Oo:()=>g,W4:()=>c,ix:()=>p,t_:()=>d,tr:()=>u,yh:()=>m,zJ:()=>o});var a=i(73582),r=i(24648),n=i(96820);function o(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,n.zJ)(e,(0,r.kM)(t,i).value,i,a,o)}function s(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,n.nD)(e,(0,r.kM)(t,i).value,i,a,o)}function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Ee)(e,t.value,t.unit,i,a)}function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.W4)(e,t.value,t.unit,i,a)}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.tr)(e,t.value,t.unit,i,a)}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.t_)(e,t.value,t.unit,i,a)}function h(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.ie,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,n.Me)(e.value,e.unit,e.rotationType,t,i,r,o)}function p(e,t,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(a=null!==a&&void 0!==a?a:2,i){case"imperial":return u(e,t,a,r);case"metric":return l(e,t,a,r);default:return o(e,t,i,a,r)}}function m(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.J1)(e,t.value,t.unit,i,a)}(e,t,a,r);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Mm)(e,t.value,t.unit,i,a)}(e,t,a,r);default:return s(e,t,i,a,r)}}function g(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return d(e,t,a,r);case"metric":return c(e,t,a,r);default:return o(e,t,i,a,r)}}function v(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.LF)(e,t.value,t.unit,i,a)}(e,t,a,r);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.e_)(e,t.value,t.unit,i,a)}(e,t,a,r);default:return s(e,t,i,a,r)}}function y(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Sz)(e,t.value,t.unit,i,a)}(e,t,a,r);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.zq)(e,t.value,t.unit,i,a)}(e,t,a,r);default:return o(e,t,i,a,r)}}},19562:(e,t,i)=>{i.d(t,{C1:()=>F,FT:()=>M,Fz:()=>_,IL:()=>x,Jb:()=>C,Mi:()=>A,OO:()=>y,P1:()=>w,PR:()=>R,Tu:()=>S,Xg:()=>P,at:()=>f,dg:()=>Z,fg:()=>O,ov:()=>b,pB:()=>I,ph:()=>k});var a=i(69539),r=i(19276),n=i(59784),o=i(89465),s=i(84847),l=i(27796),c=i(34913),u=i(94918),d=i(47943),h=i(54347),p=i(37471),m=i(86875),g=i(38996),v=i(76940);const y=new v.default({size:15,style:"circle",color:[255,102,102,.5],outline:null}),f=new v.default({size:10,style:"circle",color:[0,128,192,.5],outline:null}),w=new m.default({style:"solid",color:[0,128,192,.5],outline:null}),_=new m.default({style:"solid",color:[255,102,102,.5],outline:null}),M=new v.default({size:10,style:"diamond",color:[255,102,102],outline:null}),b=new p.default({symbolLayers:new r.default([new l.default({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),x=new p.default({symbolLayers:new r.default([new d.default({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),I=new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),P=new u.default({symbolLayers:new r.default([new s.default({material:{color:[255,102,102,.5]},edges:null})])}),A=new u.default({symbolLayers:new r.default([new s.default({material:{color:[0,128,192,.25]},edges:null})])}),F=new v.default({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),R=new p.default({symbolLayers:new r.default([new d.default({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3.5;return new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:(0,n.bJ)(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}})},S=new c.default({symbolLayers:new r.default([new h.default({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),O=e=>new m.default({color:(0,n._L)(e,.3),outline:{color:e,width:2}});function Z(e){switch(e){case"point":return e=>new v.default({size:10,style:"circle",color:null!==e&&void 0!==e?e:V(),outline:new g.default({color:[0,0,0],width:2})});case"polygon":return e=>new m.default({color:null,outline:z(e),style:"none"});case"polyline":return e=>z(e)}}function V(){return new a.default([255,0,0])}function z(e){return new g.default({color:null!==e&&void 0!==e?e:V(),width:2})}function k(e,t,i){return e===t?i:"polyline"===e?z(null===i||void 0===i?void 0:i.color):function(e){return new m.default({color:null,outline:z(e),style:"none"})}(null===i||void 0===i?void 0:i.color)}},32186:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var a,r=i(35143),n=i(42553),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),l=i(34761),c=i(13191),u=i(60008),d=i(4336),h=i(9392),p=i(52896);let m=a=class extends n.A{constructor(e){super(e),this.translation=(0,h.vt)(),this.rotationAxis=(0,h.ci)(p.up),this.rotationAngle=0,this.scale=(0,h.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,h.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(g,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,g,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,h.o8)(this.translation),rotationAxis:(0,h.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,h.o8)(this.scale)};return new a(e)}};(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"translation",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAxis",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAngle",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"scale",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"rotation",null),(0,r._)([(0,o.MZ)()],m.prototype,"localMatrix",null),(0,r._)([(0,o.MZ)()],m.prototype,"localMatrixInverse",null),m=a=(0,r._)([(0,s.$)("esri.geometry.support.MeshTransform")],m);const g=(0,d.vt)(),v=m},39839:(e,t,i)=>{i.d(t,{$0:()=>U,AG:()=>S,AX:()=>ee,CN:()=>re,EH:()=>$,Fj:()=>X,Md:()=>ie,QI:()=>te,QV:()=>ne,Qu:()=>R,WB:()=>Y,Z9:()=>D,_I:()=>E,bO:()=>V,cG:()=>Q,eY:()=>z,gO:()=>J,jr:()=>Z,lW:()=>B,mf:()=>C,uH:()=>K,wv:()=>q,yP:()=>ae});var a=i(89379),r=i(53986),n=i(50346),o=i(11113),s=i(24648),l=i(19555),c=i(63391),u=i(19247),d=i(65215),h=i(23701),p=i(9624),m=i(13312),g=i(7137),v=i(20749),y=i(97572),f=i(85367);const w=["averageElevation","cameraPitch","cameraRoll","farDistance"],_=["updateElevationProps"],M=["averageElevation","cameraPitch","cameraRoll","farDistance"],b=["averageElevation","horizontalFieldOfView","verticalFieldOfView","farDistance"],x=["updateElevationProps"],I=["updateElevationProps"],P=["averageElevation","cameraPitch","cameraRoll","farDistance"],A=["updateElevationProps"],F=1e5;function R(e,t){let i=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return i<0&&(i+=180),i*Math.PI/180}function C(e,t){let i=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return i<0&&(i+=180),i*Math.PI/180}function S(e,t,i){if(null===e||void 0===e||!e.length||null===t||void 0===t||!t.length||!i)return;const[a,r]=e,[,n]=t,o=n-r;return[a+o*Math.cos(i),r+o*Math.sin(i)]}function O(e,t,i){if((0,g.isSupported)(e)){const e=(0,g.geodesicLengths)([t],"meters")[0];return{area:(0,g.geodesicAreas)([i],"square-meters")[0],perimeter:e}}const a=m.default.WGS84,r=(0,p.project)(t,a),n=(0,p.project)(i,a);let o=(0,c.geodesicDensify)(n,F);if(o=(0,c.simplify)(o),!o)return null;const s=(0,g.geodesicLengths)([r],"meters")[0];return{area:(0,g.geodesicAreas)([o],"square-meters")[0],perimeter:s}}async function Z(e,t,i,a){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;if(t.length<2||!a||!i||!e)return null;const s=J(i,e);if(!s)return null;const l=t.map((e=>[e.x,e.y])),c=l.at(0),u=l.at(-1);if(!c||!u)return null;const d=s.map((t=>ee([c,u],t,e,r,!1))),h=await Promise.all(d);(0,n.throwIfAborted)(o);let p=0;for(const n of h){if(!n)return null;const e=Math.abs(n-a);p=Math.max(e,p)}return p}async function V(e,t,i,a,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(t.length<2||!a||!i||!e)throw new Error("Missing parameters");const l=Q(i,e),c=t.map((e=>[e.x,e.y])),u=c.at(0),d=c.at(-1),h=l.map((t=>te([u,d],t,e,r,o,!1))),p=await Promise.all(h);(0,n.throwIfAborted)(s);let m=0;for(const n of p){if(!n)return 0;const e=Math.abs(n-a);m=Math.max(e,m)}return m}function z(e,t){const i=U(e,!1);if(null!==i&&void 0!==i&&i.length)return 20*(0,l.Io)([i[0].x,i[0].y],[i.at(-1).x,i.at(-1).y])/t}function k(e){const t=e.spatialReference;if(t.isGeographic){if((0,g.isSupported)(t))return(0,g.geodesicLengths)([e],"meters")[0];const i=(0,p.project)(e,m.default.WGS84);return(0,g.geodesicLengths)([i],"meters")[0]}return t.isWebMercator?(0,c.geodesicLength)(e,"meters"):(0,c.planarLength)(e,"meters")}function G(e,t){const i=(0,c.simplify)(t);if(!i)return null;const a=(0,c.planarLength)(e,"meters");return{area:(0,c.planarArea)(i,"square-meters"),perimeter:a}}function L(e,t){let i=(0,c.geodesicDensify)(t,F,"meters");if(i=(0,c.simplify)(i),!i)return null;const a=(0,c.geodesicLength)(e,"meters");return{area:(0,c.geodesicArea)(i,"square-meters"),perimeter:a}}async function E(e,t,i){if(!t||!e)throw new Error("Missing required parameters");const a=await(0,v.imageToWorld)(e,t);(0,n.throwIfAborted)(i);const o=a.clone();o.z?o.z+=20:o.z=20;const{averageElevation:s,cameraPitch:l,cameraRoll:c,farDistance:u}=t,d=(0,r.A)(t,w);return(0,f.worldToImage)(o,d)}async function D(e,t,i,o){const{attributes:s}=i,{location:l}=s,{updateElevationProps:c}=t,u=(0,r.A)(t,_);if(!e||!t)throw new Error("Missing parameters");let d=l.clone();d.spatialReference.isGeographic&&(d=await(0,p.projectWithZConversion)(d,m.default.WebMercator));const h=await(0,v.imageToWorldPanoramic)(e,(0,a.A)((0,a.A)({},u),{},{cameraLocation:d}),c);(0,n.throwIfAborted)(o);const g=h.clone();return g.z?g.z+=20:g.z=20,(0,f.worldToImagePanoramic)(g,u)}function T(e,t,i,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,cameraPitch:c,cameraRoll:d,farDistance:h}=a,p=(0,r.A)(a,M);if(n>=5||o<=.1)return{value:e};const m=new u.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:a.cameraLocation.spatialReference}),g=(0,f.worldToImage)(m,p),v=(0,l.Io)([i[0].x,i[0].y],[g.x,g.y]),y=i.at(0),w=i.at(-1);if(!y||!w)return null;const _=(0,l.Io)([y.x,y.y],[w.x,w.y])*e/v;return T(_,t,i,a,n+1,Math.abs(e-_))}function H(e,t,i,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,horizontalFieldOfView:c,verticalFieldOfView:d,farDistance:h}=a,p=(0,r.A)(a,b);if(n>=5||o<=.1)return{value:e};const m=new u.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:a.cameraLocation.spatialReference}),g=(0,f.worldToImagePanoramic)(m,p),v=(0,l.Io)([i[0].x,i[0].y],[g.x,g.y]),y=i.at(0),w=i.at(-1);if(!y||!w)return null;const _=(0,l.Io)([y.x,y.y],[w.x,w.y])*e/v;return H(_,t,i,a,n+1,Math.abs(e-_))}async function N(e,t){const{updateElevationProps:i}=t,a=(0,r.A)(t,x);return await(0,v.imageToWorld)(e,a,i)}async function j(e,t){const{updateElevationProps:i}=t,a=(0,r.A)(t,I);return(0,v.imageToWorldPanoramic)(e,a,i)}function B(e){navigator.clipboard.writeText(e).catch((e=>{throw e}))}function W(e){const t=e.map((e=>[e.x,e.y])),i=e[0].spatialReference;return new h.default({paths:[t],spatialReference:i})}function U(e,t){return e.map((e=>({x:t?.5+e[0]:e[0],y:t?.5-e[1]:e[1]})))}function q(e,t,i,a,r){const n="measurement"===e?t:i;if(r&&n)return(0,o.ix)(a,(0,s.d_)(n,"meters"),r,3)||null}function J(e,t){const{cameraPitch:i,cameraRoll:r,cameraLocation:n}=e,{x:o,y:s,z:l,spatialReference:c}=n;if(t.every((e=>0===e))||!t||!t.length)return null;const[d,h,,p,m]=t,g=[-p,0,p],v=[-m,0,m],y=[-d,0,d],f=[-h,0,h],w=[];for(const _ of g)for(const t of v)for(const n of y)for(const d of y)for(const h of f){const p=(0,a.A)({},e);p.cameraPitch=i+_,p.cameraRoll=r+t,p.cameraLocation=new u.default({x:o+n,y:s+d,z:l?l+h:0,spatialReference:{wkid:c.wkid}}),w.push(p)}return w}function Q(e,t){const{cameraHeading:i,cameraLocation:r}=e,{x:n,y:o,z:s,spatialReference:l}=r;if(t.every((e=>0===e))||!t||!t.length)throw new Error("Invalid parameters");const[c,d,h]=t,p=h>0?[-h,0,h]:[],m=c>0?[-c,0,c]:[],g=d>0?[-d,0,d]:[],v=[];for(const y of p)for(const t of m)for(const r of m)for(const c of g){const d=(0,a.A)({},e);d.cameraHeading=i+y,d.cameraLocation=new u.default({x:n+t,y:o+r,z:s?s+c:0,spatialReference:{wkid:l.wkid}}),v.push(d)}return v}function $(e,t,i,a,r){const n="measurement"===e?t:Y(i);if(r&&n)return(0,o.ix)(a,(0,s.d_)(n,"meters"),r,3)||null}function K(e,t,i,a,r){const n="measurement"===e?t:i;if(r&&n)return(0,o.Jd)(a,(0,s.gT)(n,"square-meters"),r,3)||null}function Y(e){return Math.sqrt(e.reduce(((e,t)=>e+t**2),0))}function X(e,t,i){if("default"===t)return e;const a={x:e[0],y:e[1],z:e[2]},r=(0,y.pq)(a,i[0],i[1]);return[r.x,r.y]}async function ee(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;if(!e||!t||e.length<2)return null;const c=U(e,a);if(!c||c.length<2)return null;const[u,d]=[c[0],c.at(-1)];if(!d)return null;const h=[u],p=await(0,v.imageToWorld)(u,t);(0,n.throwIfAborted)(s);const m=p.clone();m.z?m.z+=20:m.z=20;const{averageElevation:g,cameraPitch:y,cameraRoll:w,farDistance:_}=t,M=(0,r.A)(t,P),b=(0,f.worldToImage)(m,M),x=(0,l.Io)([u.x,u.y],[b.x,b.y]),I=R(u,b);if(!I)return;const A=S([u.x,u.y],[d.x,d.y],I);if(null===A||void 0===A||!A.length)return;h.push({x:A[0],y:A[1]});const F=20*(0,l.Io)([h[0].x,h[0].y],[h[1].x,h[1].y])/x;if(!o)return F;const C=T(F,p,h,t,0,1);return null===C||void 0===C?void 0:C.value}async function te(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0;const{attributes:d}=o,{location:h}=d,{updateElevationProps:g}=t,y=(0,r.A)(t,A);if(!e||!t||e.length<2)throw new Error("Invalid parameters");const w=U(e,s),[_,M]=[w[0],w.at(-1)],b=[_];let x=h.clone();x.spatialReference.isGeographic&&(x=await(0,p.projectWithZConversion)(x,m.default.WebMercator));const I=await(0,v.imageToWorldPanoramic)(_,(0,a.A)((0,a.A)({},y),{},{cameraLocation:x}),g);(0,n.throwIfAborted)(u);const P=I.clone();P.z?P.z+=20:P.z=20;const F=(0,f.worldToImagePanoramic)(P,y),C=(0,l.Io)([_.x,_.y],[F.x,F.y]),O=R(_,F);if(!O)return;const Z=S([_.x,_.y],[M.x,M.y],O);if(null===Z||void 0===Z||!Z.length)return;b.push({x:Z[0],y:Z[1]});const V=20*(0,l.Io)([b[0].x,b[0].y],[b[1].x,b[1].y])/C;if(!c)return V;const z=H(V,I,b,t,0,1);return null===z||void 0===z?void 0:z.value}async function ie(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<3)return null;const a=U(e,i),r=await N(a,t),n=r.map((e=>{let{x:t,y:i}=e;return[t,i]}));e.push(e[0]),n.push(n[0]);const o=r[0].spatialReference,s=new h.default({paths:[n],spatialReference:o}),l=new d.default({rings:[n],spatialReference:o});return o.isGeographic?O(o,s,l):o.isWebMercator?L(s,l):G(s,l)}async function ae(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;if(e.length<3)return null;const r=U(e,i),o=await j(r,t);(0,n.throwIfAborted)(a);const s=o.map((e=>{let{x:t,y:i}=e;return[t,i]}));e.push(e[0]),s.push(s[0]);const l=o[0].spatialReference,c=new h.default({paths:[s],spatialReference:l}),u=new d.default({rings:[s],spatialReference:l});return l.isGeographic?O(l,c,u):l.isWebMercator?L(c,u):G(c,u)}async function re(e,t){const i=U(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return k(W(await N(i,t)))}async function ne(e,t){let i=arguments.length>3?arguments[3]:void 0;const a=U(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),r=await j(a,t);return(0,n.throwIfAborted)(i),k(W(r))}},56203:(e,t,i)=>{i.r(t),i.d(t,{buffer:()=>k,changeDefaultSpatialReferenceTolerance:()=>Y,clearDefaultSpatialReferenceTolerance:()=>X,clip:()=>g,contains:()=>y,convexHull:()=>C,crosses:()=>f,cut:()=>v,densify:()=>W,difference:()=>S,disjoint:()=>I,distance:()=>w,equals:()=>_,extendedSpatialReferenceInfo:()=>m,flipHorizontal:()=>N,flipVertical:()=>j,generalize:()=>B,geodesicArea:()=>Q,geodesicBuffer:()=>G,geodesicDensify:()=>U,geodesicLength:()=>$,intersect:()=>Z,intersectLinesToPoints:()=>K,intersects:()=>M,isSimple:()=>F,nearestCoordinate:()=>L,nearestVertex:()=>E,nearestVertices:()=>D,offset:()=>z,overlaps:()=>P,planarArea:()=>q,planarLength:()=>J,relate:()=>A,rotate:()=>H,simplify:()=>R,symmetricDifference:()=>O,touches:()=>b,union:()=>V,within:()=>x});var a=i(89379),r=i(16783),n=i(19247),o=i(19902);function s(e){var t;return Array.isArray(e)?null===(t=e[0])||void 0===t?void 0:t.spatialReference:null===e||void 0===e?void 0:e.spatialReference}function l(e){return e?Array.isArray(e)?e.map(l):e.toJSON?e.toJSON():e:e}function c(e){return Array.isArray(e)?e.map((e=>(0,o.fromJSON)(e))):(0,o.fromJSON)(e)}let u;async function d(){return u||(u=(0,r.ho)("geometryEngineWorker",{strategy:"distributed"})),u}async function h(e,t){return(await d()).invoke("executeGEOperation",{operation:e,parameters:l(t)})}async function p(e,t){const i=await d();return Promise.all(i.broadcast("executeGEOperation",{operation:e,parameters:l(t)}))}function m(e){return h("extendedSpatialReferenceInfo",[e])}async function g(e,t){return c(await h("clip",[s(e),e,t]))}async function v(e,t){return c(await h("cut",[s(e),e,t]))}function y(e,t){return h("contains",[s(e),e,t])}function f(e,t){return h("crosses",[s(e),e,t])}function w(e,t,i){return h("distance",[s(e),e,t,i])}function _(e,t){return h("equals",[s(e),e,t])}function M(e,t){return h("intersects",[s(e),e,t])}function b(e,t){return h("touches",[s(e),e,t])}function x(e,t){return h("within",[s(e),e,t])}function I(e,t){return h("disjoint",[s(e),e,t])}function P(e,t){return h("overlaps",[s(e),e,t])}function A(e,t,i){return h("relate",[s(e),e,t,i])}function F(e){return h("isSimple",[s(e),e])}async function R(e){return c(await h("simplify",[s(e),e]))}async function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(await h("convexHull",[s(e),e,t]))}async function S(e,t){return c(await h("difference",[s(e),e,t]))}async function O(e,t){return c(await h("symmetricDifference",[s(e),e,t]))}async function Z(e,t){return c(await h("intersect",[s(e),e,t]))}async function V(e){const t=function(e,t){let i;return Array.isArray(e)?i=e:(i=[],i.push(e),null!=t&&i.push(t)),i}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null);return c(await h("union",[s(t),t]))}async function z(e,t,i,a,r,n){return c(await h("offset",[s(e),e,t,i,a,r,n]))}async function k(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=[s(e),e,t,i,a];return c(await h("buffer",r))}async function G(e,t,i,a,r,n){const o=[s(e),e,t,i,a,r,n];return c(await h("geodesicBuffer",o))}async function L(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=await h("nearestCoordinate",[s(e),e,t,i]);return(0,a.A)((0,a.A)({},r),{},{coordinate:n.default.fromJSON(r.coordinate)})}async function E(e,t){const i=await h("nearestVertex",[s(e),e,t]);return(0,a.A)((0,a.A)({},i),{},{coordinate:n.default.fromJSON(i.coordinate)})}async function D(e,t,i,r){return(await h("nearestVertices",[s(e),e,t,i,r])).map((e=>(0,a.A)((0,a.A)({},e),{},{coordinate:n.default.fromJSON(e.coordinate)})))}function T(e){var t;return"xmin"in e?e.center:"x"in e?e:null===(t=e.extent)||void 0===t?void 0:t.center}async function H(e,t,i){if(null==e)throw new ee;const a=e.spatialReference;if(null==(i=null!==i&&void 0!==i?i:T(e)))throw new ee;const r=e.constructor.fromJSON(await h("rotate",[a,e,t,i]));return r.spatialReference=a,r}async function N(e,t){if(null==e)throw new ee;const i=e.spatialReference;if(null==(t=null!==t&&void 0!==t?t:T(e)))throw new ee;const a=e.constructor.fromJSON(await h("flipHorizontal",[i,e,t]));return a.spatialReference=i,a}async function j(e,t){if(null==e)throw new ee;const i=e.spatialReference;if(null==(t=null!==t&&void 0!==t?t:T(e)))throw new ee;const a=e.constructor.fromJSON(await h("flipVertical",[i,e,t]));return a.spatialReference=i,a}async function B(e,t,i,a){return c(await h("generalize",[s(e),e,t,i,a]))}async function W(e,t,i){return c(await h("densify",[s(e),e,t,i]))}async function U(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return c(await h("geodesicDensify",[s(e),e,t,i,a]))}function q(e,t){return h("planarArea",[s(e),e,t])}function J(e,t){return h("planarLength",[s(e),e,t])}function Q(e,t,i){return h("geodesicArea",[s(e),e,t,i])}function $(e,t,i){return h("geodesicLength",[s(e),e,t,i])}async function K(e,t){return c(await h("intersectLinesToPoints",[s(e),e,t]))}async function Y(e,t){await p("changeDefaultSpatialReferenceTolerance",[e,t])}async function X(e){await p("clearDefaultSpatialReferenceTolerance",[e])}class ee extends Error{constructor(){super("Illegal Argument Exception")}}},70961:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var a,r=i(35143),n=i(31633),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),l=i(34111),c=i(19247),u=i(65215),d=i(13312),h=i(7137),p=i(45417),m=i(85996);let g=a=class extends u.default{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){var e;const t=this.center,i=this.numberOfPoints;if(this.hasZ=null!==(e=null===t||void 0===t?void 0:t.hasZ)&&void 0!==e&&e,0!==this.rings.length||!t)return;const a=(0,n.oU)(this.radius,this.radiusUnit,"meters"),r=t.spatialReference;let o,s="geographic";if(r.isWebMercator?s="webMercator":(null!=(r.wkid&&m.A[r.wkid])||(r.wkt2||r.wkt)&&(0,n.x1)(r.wkt2||r.wkt))&&(s="projected"),this.geodesic){let e;switch(s){case"webMercator":e=(0,p.webMercatorToGeographic)(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":e=t}o=this._createGeodesicCircle(e,a,i),"webMercator"===s&&(o=(0,p.geographicToWebMercator)(o))}else{let e;"webMercator"===s||"projected"===s?e=a/(0,n.Ao)(t.spatialReference):"geographic"===s&&(e=(0,n.vl)(a,"meters",(0,l.tO)(t.spatialReference).radius)),o=this._createPlanarCircle(t,e,i)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:n}=this;return new a({center:null===e||void 0===e?void 0:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:n})}_createGeodesicCircle(e,t,i){const a=[],r=[e.x,e.y];for(let o=0;o<360;o+=360/i){var n;const i=this.hasZ?[0,0,null!==(n=e.z)&&void 0!==n?n:0]:[0,0];(0,h.directGeodeticSolver)(i,r,o,t,d.default.WGS84),a.push(i)}return a.push(a[0]),new u.default({rings:[a]})}_createPlanarCircle(e,t,i){const a=[],r=2*Math.PI/i;for(let o=0;o<i;++o){var n;const i=r*o,s=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&s.push(null!==(n=e.z)&&void 0!==n?n:0),a.push(s)}return a.push(a[0]),new u.default({spatialReference:e.spatialReference,rings:[a]})}};(0,r._)([(0,o.MZ)({type:c.default})],g.prototype,"center",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"geodesic",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"numberOfPoints",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"radius",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"radiusUnit",void 0),g=a=(0,r._)([(0,s.$)("esri.geometry.Circle")],g);const v=g},71523:(e,t,i)=>{i.d(t,{Cy:()=>s,UT:()=>d,hs:()=>c,lR:()=>l,wW:()=>u});var a=i(15941),r=i(2413),n=i(65391),o=i(5262);function s(e,t,i,a){var r,n;if(null==a||e.hasZ||(a=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=a&&(e.z+=a),e;if("multipoint"===e.type){const r=e.points;for(let e=0;e<r.length;e++)r[e]=h(r[e],t,i,a);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=a&&(null!==(r=e.zmin)&&void 0!==r||(e.zmin=0),e.zmin+=a,null!==(n=e.zmax)&&void 0!==n||(e.zmax=0),e.zmax+=a),e;const s=(0,o.$K)(e),l="polyline"===e.type?e.paths:e.rings;for(let o=0;o<s.length;o++){const e=s[o];for(let r=0;r<e.length;r++)e[r]=h(e[r],t,i,a)}return"paths"in e?e.paths=l:e.rings=l,e}function l(e,t,i,a,r){const n=e.clone(),l=a.resolution;if("point"===n.type){if(r)s(n,t*l,-i*l);else{const e=a.state.transform,r=a.state.inverseTransform,o=e[0]*n.x+e[2]*n.y+e[4],s=e[1]*n.x+e[3]*n.y+e[5];n.x=r[0]*(o+t)+r[2]*(s+i)+r[4],n.y=r[1]*(o+t)+r[3]*(s+i)+r[5]}return n}if("multipoint"===n.type){if(r)s(n,t*l,-i*l);else{const e=n.points,r=a.state.transform,o=a.state.inverseTransform;for(let a=0;a<e.length;a++){const n=e[a],s=r[0]*n[0]+r[2]*n[1]+r[4],l=r[1]*n[0]+r[3]*n[1]+r[5],c=o[0]*(s+t)+o[2]*(l+i)+o[4],u=o[1]*(s+t)+o[3]*(l+i)+o[5];e[a]=p(n,c,u,void 0)}}return n}if("extent"===n.type){if(r)s(n,t*l,-i*l);else{const e=a.state.transform,r=a.state.inverseTransform,o=e[0]*n.xmin+e[2]*n.ymin+e[4],s=e[1]*n.xmin+e[3]*n.ymin+e[5],l=e[0]*n.xmax+e[2]*n.ymax+e[4],c=e[1]*n.xmax+e[3]*n.ymax+e[5];n.xmin=r[0]*(o+t)+r[2]*(s+i)+r[4],n.ymin=r[1]*(o+t)+r[3]*(s+i)+r[5],n.xmax=r[0]*(l+t)+r[2]*(c+i)+r[4],n.ymax=r[1]*(l+t)+r[3]*(c+i)+r[5]}return n}if(r)s(n,t*l,-i*l);else{const e=(0,o.$K)(n),r="polyline"===n.type?n.paths:n.rings,s=a.state.transform,l=a.state.inverseTransform;for(let a=0;a<e.length;a++){const r=e[a];for(let e=0;e<r.length;e++){const a=r[e],n=s[0]*a[0]+s[2]*a[1]+s[4],o=s[1]*a[0]+s[3]*a[1]+s[5],c=l[0]*(n+t)+l[2]*(o+i)+l[4],u=l[1]*(n+t)+l[3]*(o+i)+l[5];r[e]=p(a,c,u,void 0)}}"paths"in n?n.paths=r:n.rings=r}return n}function c(e,t,i,a){if("point"===e.type){const{x:r,y:n}=e,o=a?a[0]:r,s=a?a[1]:n,l=e.clone(),c=(r-o)*t+o,u=(n-s)*i+s;return l.x=c,l.y=u,l}if("multipoint"===e.type){const s=(0,o.$K)(e),l=(0,r.vt)(),[c,u,d,h]=(0,n.Yz)(l,[s]),m=a?a[0]:(c+d)/2,g=a?a[1]:(h+u)/2,v=e.clone(),y=v.points;for(let e=0;e<y.length;e++){const a=y[e],[r,n]=a,o=(r-m)*t+m,s=(n-g)*i+g;y[e]=p(a,o,s,void 0)}return v}if("extent"===e.type){const{xmin:r,xmax:n,ymin:o,ymax:s}=e,l=a?a[0]:(r+n)/2,c=a?a[1]:(s+o)/2,u=e.clone();if(u.xmin=(r-l)*t+l,u.ymax=(s-c)*i+c,u.xmax=(n-l)*t+l,u.ymin=(o-c)*i+c,u.xmin>u.xmax){const e=u.xmin,t=u.xmax;u.xmin=t,u.xmax=e}if(u.ymin>u.ymax){const e=u.ymin,t=u.ymax;u.ymin=t,u.ymax=e}return u}const s=(0,o.$K)(e),l=(0,r.vt)(),[c,u,d,h]=(0,n.Yz)(l,s),m=a?a[0]:(c+d)/2,g=a?a[1]:(h+u)/2,v=e.clone(),y="polyline"===v.type?v.paths:v.rings;for(let r=0;r<s.length;r++){const e=s[r];for(let a=0;a<e.length;a++){const n=e[a],[o,s]=n,l=(o-m)*t+m,c=(s-g)*i+g;y[r][a]=p(n,l,c,void 0)}}return"paths"in v?v.paths=y:v.rings=y,v}function u(e,t,i,a,r,n){const o=Math.sqrt((i-e)*(i-e)+(a-t)*(a-t));return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))/o}function d(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(e.y-i.y,e.x-i.x),o=Math.atan2(Math.sin(n),Math.cos(n));return r?o:(0,a.KJ)(o)}function h(e,t,i,a){return p(e,e[0]+t,e[1]+i,null!=e[2]&&null!=a?e[2]+a:void 0)}function p(e,t,i,a){const r=[t,i];return e.length>2&&r.push(null!=a?a:e[2]),e.length>3&&r.push(e[3]),r}},77357:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Pt});var a=i(53986),r=i(89379),n=i(35143),o=i(39356),s=i(18690),l=i(98773),c=i(19276),u=i(63241),d=i(50076),h=i(54099),p=i(42553),m=i(53084),g=i(76460),v=i(15941),y=i(30726),f=i(91291),w=i(50346),_=i(67993),M=i(68134),b=i(34154),x=i(31633),I=i(46053),P=(i(81806),i(85842)),A=i(19555),F=i(19451),R=i(56203),C=i(66388),S=i(19247),O=i(65215),Z=i(23701),V=i(9624),z=i(13312),k=i(5262),G=i(45417),L=i(63733),E=i(76797),D=i(13014),T=i(69098),H=i(21403),N=i(6409),j=i(28379),B=i(17707),W=i(86729),U=i(59913),q=(i(47249),i(7839)),J=i(8595);let Q=class{static getCameraOrientation(e){return(0,J.y4)(e)}static register(e,t,i){q.A.set(e,{desc:t,constructor:i})}};Q=(0,n._)([(0,P.$)("esri.layers.orientedImagery.core.cameraOrientationFactory")],Q);const $=Q;var K=i(40350),Y=i(97572);const X=e=>({cast:e=>{const t=parseFloat(e);return Number.isFinite(t)?t:void 0},json:{name:e,write:{writer:(e,t,i)=>{t[i]=Number.isFinite(e)?e:void 0}}}}),ee=e=>({cast:e=>"string"==typeof e?e.split(";").map(Number):e,json:{default:e,write:{writer:(e,t,i)=>{t[i]=null===e||void 0===e?void 0:e.join(";")}}}});let te=class extends(T.A.ClonableMixin(p.A)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,t){const i={},{attributes:a,layer:n,geometry:o}=e,s={};for(const r in a)i[r.toLowerCase()]=a[r],s[r.toLowerCase()]=r;super.read((0,r.A)({geometry:o,layer:null!==n&&void 0!==n?n:{},sourceMap:s},i),t)}write(e,t){const i=super.write(e,t),{sourceMap:a}=this;if(!a||!i)return i;const r={};for(const n in i){const e=a[n.toLowerCase()];e&&(r[e]=i[n])}return r}readCameraHeading(e,t){var i;const{cameraheading:a,camheading:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.cameraHeading}readCameraHeight(e,t){var i;const{cameraheight:a,avghtag:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.cameraHeight}readCamOffset(e,t){var i,a;const{cameraoffset:r,camoffset:n}=t;return null!==(i=null!==(a=null===r||void 0===r?void 0:r.split(";").map(Number))&&void 0!==a?a:null===n||void 0===n?void 0:n.split(";").map(Number))&&void 0!==i?i:null}writeCameraOffset(e,t){e&&(t.cameraOffset=e.join(";"))}readCameraOrientation(e,t){const{cameraorientation:i,camori:a}=t;return null!==i&&void 0!==i?i:a}readCameraPitch(e,t){var i;const{camerapitch:a,campitch:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.cameraPitch}readCameraRoll(e,t){var i;const{cameraroll:a,camroll:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.cameraRoll}readDepthImage(e,t){var i;const{depthimage:a,depthimg:r,layer:n}=t,o=null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:null,{depthImagePathPrefix:s,depthImagePathSuffix:l}=null!==n&&void 0!==n?n:{};return(0,J.Rf)(o,s,l)}readElevationSource(e,t){const{elevationsource:i,layer:a}=t,{demPathSuffix:r,demPathPrefix:n}=a;if(i){const e=this._parseIfJSON(i);return(0,J.eR)(e,n,r)}return a.effectiveElevationSource}readFarDistance(e,t){var i;const{fardistance:a,fardist:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.farDistance}readHFOV(e,t){var i;const{horizontalfieldofview:a,hfov:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.horizontalFieldOfView}readImageURL(e,t){const{imagepath:i,layer:a}=t;i||function(e,t){throw new d.default("exposure-point:missing-attribute-value","a value for ".concat(e," is missing in attribute table"),{exposurePoint:t})}("imagePath",this);const{imagePathPrefix:r,imagePathSuffix:n}=a;return(0,J.Rf)(i,r,n)}readImageRotation(e,t){var i;const{imagerotation:a,imgrot:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,cameraHeight:t,elevation:i}=this;if(e){const{type:t,x:i,y:a,z:r,horizontalWKID:n,verticalWKID:o}=e,s="number"==typeof n?{wkid:n}:{wkt:n};if(t===K.g.LTP){const{latitude:t,longitude:i,ellipsoidRadius:a,squaredEccentricity:r,properties:n}=e,{x:o,y:s,z:l}=n;return new S.default((0,Y.Zq)([o,s,l],[t,i,a,r]))}const l=new S.default({x:i,y:a,z:r,spatialReference:s}),c=o?(0,W.N)("point",{wkid:o},s):null;return c&&c(l),l}if("number"!=typeof t)throw function(e){throw new d.default("exposure-point:missing-default-value","a value for ".concat(e," is missing in default properties"))}("cameraHeight");const a=this.geometry.clone();return a.z=a.hasZ?a.z:(null!==i&&void 0!==i?i:0)+t,a}set matrix(e){if(!e||9!==e.length)return g.A.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:e}),void this._set("matrix",null);this._set("matrix",e)}readNearDistance(e,t){var i;const{neardistance:a,neardist:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.nearDistance}readOrientationAccuracy(e,t){var i,a;const{accuracy:r,orientationaccuracy:n}=t;return null!==(i=null!==(a=null===n||void 0===n?void 0:n.split(";").map(Number))&&void 0!==a?a:null===r||void 0===r?void 0:r.split(";").map(Number))&&void 0!==i?i:null}writeOrientationAccuracy(e,t){e&&(t.orientationAccuracy=e.join(";"))}readOIType(e,t){var i,a;const{orientedimagerytype:r,oitype:n,camerapitch:o,campitch:s,layer:l}=t,c=J.fs.read(null!==(i=null!==r&&void 0!==r?r:n)&&void 0!==i?i:l.orientedImageryType),u=null!==(a=null!==o&&void 0!==o?o:s)&&void 0!==a?a:l.cameraPitch;return"oblique"===c?u<10?"nadir":"oblique":c}set radial(e){if(e)if("string"!=typeof e)this._set("radial",e);else{const[t,i,a]=e.split(";").map(Number);this._set("radial",[null!==t&&void 0!==t?t:0,null!==i&&void 0!==i?i:0,null!==a&&void 0!==a?a:0])}else this._set("radial",[0,0,0])}set tangential(e){if(e)if("string"!=typeof e)this._set("tangential",e);else{const[t,i]=e.split(";").map(Number);this._set("tangential",[null!==t&&void 0!==t?t:0,null!==i&&void 0!==i?i:0])}else this._set("tangential",[0,0])}readVFOV(e,t){var i;const{verticalfieldofview:a,vfov:r,layer:n}=t;return null!==(i=null!==a&&void 0!==a?a:r)&&void 0!==i?i:n.verticalFieldOfView}_parseIfJSON(e){let t=null;try{t=JSON.parse(e)}catch(i){g.A.getLogger(this).error("couldn't parse the given elevation source JSON",e,i)}return t}};(0,n._)([(0,I.MZ)(X())],te.prototype,"a0",void 0),(0,n._)([(0,I.MZ)(X())],te.prototype,"a1",void 0),(0,n._)([(0,I.MZ)(X())],te.prototype,"a2",void 0),(0,n._)([(0,I.MZ)({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],te.prototype,"acquisitionDate",void 0),(0,n._)([(0,I.MZ)(X())],te.prototype,"b0",void 0),(0,n._)([(0,I.MZ)(X())],te.prototype,"b1",void 0),(0,n._)([(0,I.MZ)(X())],te.prototype,"b2",void 0),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],te.prototype,"cameraHeading",void 0),(0,n._)([(0,j.w)("cameraHeading")],te.prototype,"readCameraHeading",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"cameraHeight",void 0),(0,n._)([(0,j.w)("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],te.prototype,"readCameraHeight",null),(0,n._)([(0,I.MZ)()],te.prototype,"cameraOffset",void 0),(0,n._)([(0,j.w)("cameraOffset",["cameraoffset","camoffset"])],te.prototype,"readCamOffset",null),(0,n._)([(0,B.K)("cameraOffset")],te.prototype,"writeCameraOffset",null),(0,n._)([(0,I.MZ)({json:{write:{writer:(e,t,i)=>{t[i]=e.toString()}}},type:U.A}),(0,H.w)((e=>e?$.getCameraOrientation(e):null))],te.prototype,"cameraOrientation",void 0),(0,n._)([(0,j.w)("cameraOrientation",["cameraorientation","camori"])],te.prototype,"readCameraOrientation",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"cameraPitch",void 0),(0,n._)([(0,j.w)("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],te.prototype,"readCameraPitch",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"cameraRoll",void 0),(0,n._)([(0,j.w)("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],te.prototype,"readCameraRoll",null),(0,n._)([(0,I.MZ)({json:{write:!0},type:String})],te.prototype,"depthImage",void 0),(0,n._)([(0,j.w)("depthImage",["depthimage","depthimg"])],te.prototype,"readDepthImage",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"elevation",void 0),(0,n._)([(0,I.MZ)({json:{write:!0},clonable:"reference"})],te.prototype,"elevationSource",void 0),(0,n._)([(0,j.w)("elevationSource",["elevationsource","layer.effectiveElevationSource"])],te.prototype,"readElevationSource",null),(0,n._)([(0,I.MZ)({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],te.prototype,"exposureStationId",void 0),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"farDistance",void 0),(0,n._)([(0,j.w)("farDistance",["fardistance","fardist","layer.farDistance"])],te.prototype,"readFarDistance",null),(0,n._)([(0,I.MZ)(X("focallength"))],te.prototype,"focalLength",void 0),(0,n._)([(0,I.MZ)({type:S.default,json:{name:"geometry"}})],te.prototype,"geometry",void 0),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"horizontalFieldOfView",void 0),(0,n._)([(0,j.w)("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],te.prototype,"readHFOV",null),(0,n._)([(0,I.MZ)({json:{write:!0},type:String})],te.prototype,"imagePath",void 0),(0,n._)([(0,j.w)("imagePath",["imagepath"])],te.prototype,"readImageURL",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"imageRotation",void 0),(0,n._)([(0,j.w)("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],te.prototype,"readImageRotation",null),(0,n._)([(0,I.MZ)()],te.prototype,"isHorizontal",null),(0,n._)([(0,I.MZ)()],te.prototype,"isInspection",null),(0,n._)([(0,I.MZ)()],te.prototype,"isNadir",null),(0,n._)([(0,I.MZ)()],te.prototype,"isOblique",null),(0,n._)([(0,I.MZ)()],te.prototype,"isSpherical",null),(0,n._)([(0,I.MZ)()],te.prototype,"location",null),(0,n._)([(0,I.MZ)(ee())],te.prototype,"matrix",null),(0,n._)([(0,I.MZ)({json:{write:!0},type:String})],te.prototype,"name",void 0),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"nearDistance",void 0),(0,n._)([(0,j.w)("nearDistance",["neardistance","neardist","layer.nearDistance"])],te.prototype,"readNearDistance",null),(0,n._)([(0,I.MZ)({json:{write:!0,name:"objectid"},type:Number})],te.prototype,"objectId",void 0),(0,n._)([(0,I.MZ)()],te.prototype,"orientationAccuracy",void 0),(0,n._)([(0,j.w)("orientationAccuracy",["accuracy","orientationaccuracy"])],te.prototype,"readOrientationAccuracy",null),(0,n._)([(0,B.K)("orientationAccuracy")],te.prototype,"writeOrientationAccuracy",null),(0,n._)([(0,N.e)(J.fs)],te.prototype,"orientedImageryType",void 0),(0,n._)([(0,j.w)("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],te.prototype,"readOIType",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0,read:{source:"principalx"}}})],te.prototype,"principalX",void 0),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0,read:{source:"principaly"}}})],te.prototype,"principalY",void 0),(0,n._)([(0,I.MZ)(ee([0,0,0]))],te.prototype,"radial",null),(0,n._)([(0,I.MZ)({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],te.prototype,"sortOrder",void 0),(0,n._)([(0,I.MZ)({type:Object})],te.prototype,"sourceMap",void 0),(0,n._)([(0,I.MZ)(ee([0,0]))],te.prototype,"tangential",null),(0,n._)([(0,I.MZ)({type:Number,json:{write:!0}})],te.prototype,"verticalFieldOfView",void 0),(0,n._)([(0,j.w)("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],te.prototype,"readVFOV",null),te=(0,n._)([(0,P.$)("esri.layers.orientedImagery.core.ExposurePoint")],te);const ie=te;var ae=i(68295);const re={};async function ne(e,t){var i,a,n,o,s;const{point:l,queryParams:c}=e;if(null==l)return null;const u={};let d=e.layerInstanceOrURL;const h=l.spatialReference.isGeographic?(0,G.geographicToWebMercator)(l.clone()):l.clone();if(u.outSpatialReference=h.spatialReference,c&&(u.maxRecordCountFactor=null!==(i=c.maxRecordCountFactor)&&void 0!==i?i:5,u.outFields=null!==(a=c.outFields)&&void 0!==a?a:["*"],u.where=null!==(n=c.where)&&void 0!==n?n:"1=1",u.returnGeometry=null===(o=c.returnGeometry)||void 0===o||o,u.outSpatialReference=c.outSpatialReference),"string"==typeof d&&(re.layer&&re.layer.url===d?d=re.layer:(null!==(s=re.layer)&&void 0!==s&&s.destroy(),d=re.layer=new D.default({url:d}))),d)try{var p,m;await d.load();const e=d,i=function(e,t){const i=e.x-t,a=e.x+t,r=e.y-t,n=e.y+t;return new E.default({xmin:i,xmax:a,ymin:r,ymax:n,spatialReference:e.spatialReference})}(h,null!==(p=null!==(m=null===c||void 0===c?void 0:c.maximumDistance)&&void 0!==m?m:e.maximumDistance)&&void 0!==p?p:1e3);u.returnZ=e.hasZ;const a=new ae.default((0,r.A)({geometry:i},u)),n=await e.queryFeatures(a,t);return function(e){return t=>{const{features:i,spatialReference:a}=t;return i.forEach((t=>{t.geometry&&(t.geometry.spatialReference=a);const i=ie.fromJSON((0,r.A)((0,r.A)({},t.toJSON()),{},{layer:e}));i&&(t.attributes=i),t.layer=e,t.spatialReference=a})),t}}(e)(n)}catch(g){(0,w.throwIfNotAbortError)(g)}return null}var oe=i(14556),se=i(12294);function le(e){var t;const{camera:i,features:a,selectedPoint:r}=e;if(!a.length)return[];null!==(t=e.currentImage)&&void 0!==t||(e.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});const n=function(e,t,i){var a,r;return null!==(a=t.z)&&void 0!==a||(t.z=0),null!==(r=t.elevation)&&void 0!==r||(t.elevation=0),a=>{var r,n,o,s;const{hfovWeight:l,vfovWeight:c,distanceWeight:u}=ce(a.attributes,e?"3d":"2d"),d=a.attributes,{cameraHeight:h,cameraHeading:p,cameraPitch:m,farDistance:g,horizontalFieldOfView:v,verticalFieldOfView:y,isOblique:f}=d,w=d.geometry,_=180*Math.atan2(w.y-t.y,w.x-t.x)/Math.PI,M=(0,se.Io)(t,w);let b,x,I=v,P=y,A=!1;e?(b=e.heading,x=e.tilt,I=180,P=180,A=!0):!f||m<10?(b=p,x=m,A=!1):(b=i.attributes.cameraHeading,x=m,A=!0,I=180),b>180&&(b-=360);let F=1;w.spatialReference.isWebMercator&&(F=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*w.y/oe.$O.radius))));const R=Math.sqrt((Math.sqrt((t.x-w.x)**2+(t.y-w.y)**2)/F)**2+((null!==(r=t.z)&&void 0!==r?r:0)-(null!==(n=t.elevation)&&void 0!==n?n:0)-h)**2),C=90-180*Math.atan2(t.y-w.y,t.x-w.x)/Math.PI;let S=(Math.abs(C-b)>180?Math.abs(360-Math.abs(C-b)):Math.abs(C-b))/I;S=4*S+1;const O=180*Math.acos((d.cameraHeight-(null!==(o=t.z)&&void 0!==o?o:0)+(null!==(s=t.elevation)&&void 0!==s?s:0))/R)/Math.PI;let Z=Math.abs(O-x)/P;Z=4*Z+1;let V=R/Math.sqrt(g**2+h**2);V=4*V+1;const z=l*S+c*Z+u*V;let k;if(A){const e=p>180?p-360:p;k=l*((Math.abs(C-e)>180?Math.abs(360-Math.abs(C-e)):Math.abs(C-e))/v*4+1)+c*(Math.abs(O-m)/y*4+1)+u*V}else k=z;return{suitability:z,trueSuitability:k,feature:a,angle:_,distance:M,verticalAngle:Math.abs(180*Math.atan(M/h)/Math.PI)}}}(i,r,e.currentImage);return a.map(n)}function ce(e,t){const i="isOblique"in e?e:new ie(e),{isOblique:a,isSpherical:r,isNadir:n}=i;return r?{hfovWeight:"2d"===t?0:1,vfovWeight:"2d"===t?0:.6,distanceWeight:"2d"===t?1:.5}:n?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:a?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}var ue=i(86017),de=i(58872),he=i(20749),pe=i(42269),me=i(36116),ge=i(85367),ve=i(46530),ye=i(38996),fe=i(48280),we=i(71523),_e=i(57308),Me=i(7989),be=i(25329),xe=i(18364),Ie=i(58963),Pe=i(3825),Ae=i(45802),Fe=i(75939),Re=i(38338),Ce=i(57134);let Se=class extends(T.A.ClonableMixin(p.A)){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(0===this.minFOV||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(0===this.maxFOV||this.view.camera.fov<this.maxFOV)}};(0,n._)([(0,I.MZ)({type:Boolean,readOnly:!0})],Se.prototype,"canZoomIn",null),(0,n._)([(0,I.MZ)({type:Boolean,readOnly:!0})],Se.prototype,"canZoomOut",null),(0,n._)([(0,I.MZ)({type:Number})],Se.prototype,"maxFOV",void 0),(0,n._)([(0,I.MZ)({type:Number})],Se.prototype,"minFOV",void 0),(0,n._)([(0,I.MZ)()],Se.prototype,"view",void 0),(0,n._)([(0,I.MZ)({type:Number})],Se.prototype,"zoomFactor",void 0),Se=(0,n._)([(0,P.$)("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Se);const Oe=Se;var Ze=i(75657);let Ve=class extends Ze.default{constructor(e){super(e),this.panoramicZoomConditions=new Oe,this.zoomTo=e=>{this.view.camera.fov=this.constrainFOV(e),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([(0,M.watch)((()=>{var e;return[null===(e=this.view)||void 0===e?void 0:e.ready,this.panoramicZoomConditions]}),(()=>{var e;(null===(e=this.view)||void 0===e?void 0:e.ready)&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))}),M.syncAndInitial),(0,M.watch)((()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV]),(e=>{let[t,i]=e;null!=t&&null!=i&&this.zoomTo(this.view.camera.fov)}),M.sync)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"disabled"}set view(e){this._set("view",e)}constrainFOV(e){const{maxFOV:t,minFOV:i}=this.panoramicZoomConditions;return(0,v.qE)(e,i,t)}zoomIn(){if(!this.canZoomIn)return;const e=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}zoomOut(){if(!this.canZoomOut)return;const e=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}};(0,n._)([(0,I.MZ)()],Ve.prototype,"canZoomIn",null),(0,n._)([(0,I.MZ)()],Ve.prototype,"canZoomOut",null),(0,n._)([(0,I.MZ)({type:Oe})],Ve.prototype,"panoramicZoomConditions",void 0),(0,n._)([(0,I.MZ)()],Ve.prototype,"state",null),(0,n._)([(0,I.MZ)()],Ve.prototype,"view",null),Ve=(0,n._)([(0,P.$)("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ve);const ze=Ve;var ke=i(10851),Ge=i(33905),Le=i(75257),Ee=i(84847),De=i(94918);function Te(e,t){return 2*(0,v.KJ)(Math.atan(Math.tan((0,v.kU)(e/2))*Math.sqrt(t**2+1)))}const He="default",Ne="navigation",je="fov-constraint",Be="image-click-action";let We=class extends h.A.EventedAccessor{constructor(e){super(e),this._startPosition=null,this._targetPosition=null,this._graphics=new L.default({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new Ie.default({ground:new xe.default({opacity:0,navigationConstraint:null}),layers:new c.default([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(Ne),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",(e=>{const t=e.key;["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t)&&e.stopPropagation()}))],Ne)},this._addHFOVHandles=()=>{this.removeHandles(je),this.addHandles((0,M.watch)((()=>[this.maxHFOV,this.minHFOV]),(()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new Oe({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))}),M.syncAndInitial),je)},this._addZoomHandles=()=>{this._zoomViewModel=new ze({view:this.imageRenderer,panoramicZoomConditions:new Oe({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const e=this.imageRenderer.ui.find("zoom");e&&(e.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{var e;null!==(e=this._loadController)&&void 0!==e&&e.abort(),this._loadController=null},this._handleDoubleClick=e=>{e.stopPropagation(),e.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=e=>{e.stopPropagation();const{action:t,x:i,y:a}=e;switch(t){case"start":this._startPosition=this._targetPosition={x:i,y:a};break;case"update":this._targetPosition={x:i,y:a},this._updateCameraHeadingAndTilt()}},this._handleImageClick=e=>{if("image-loaded"===this.state&&this.imageRenderer.ready)switch(this.clickAction){case"emit":e.stopPropagation(),this.emit("click",e);break;case"hittest":e.stopPropagation(),e.async((async()=>{const t=await this.imageRenderer.hitTest(e.screenPoint,{include:this._graphics});this.emit("hittest-response",t)}));break;case"pixel-location":{if(e.stopPropagation(),!this.imageSize||!e.mapPoint)return void this.emit("pixel-location",null);const t=(0,Y.pq)(e.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",(0,r.A)((0,r.A)({},t),{},{spatialReference:z.default.WebMercator}));break}}},this._handleWheel=e=>{var t;const i=null!==(t=e.deltaX)&&void 0!==t?t:e.native.deltaX;e.stopPropagation(),i>0||e.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>{var e;return null===(e=this._zoomViewModel)||void 0===e?void 0:e.zoomIn()},this._zoomOut=()=>{var e;return null===(e=this._zoomViewModel)||void 0===e?void 0:e.zoomOut()},this.addGraphic=(e,t)=>"image-loaded"===this.state&&!this._graphics.graphics.includes(e)&&(this._graphics.graphics.add(e,t),!0),this.addManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>!this._graphics.graphics.includes(e)));return this._graphics.graphics.addMany(t),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=e=>!("image-loaded"!==this.state||!this._graphics.graphics.includes(e))&&(this._graphics.remove(e),!0),this.removeManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>this._graphics.graphics.includes(e)));return this._graphics.removeMany(t),!0},this._imageRenderer=new Fe.default({map:this._map,viewingMode:"local",camera:{position:Ce.ZH},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:z.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,M.watch)((()=>this.imageSource),(()=>{this.imageSource&&this.autoLoad&&this._loadWithController()}),M.syncAndInitial),(0,M.watch)((()=>this.fov),(()=>{this._reloadCamera()}),M.syncAndInitial),(0,M.watch)((()=>this.yaw),(e=>{this.camera.heading=e,this._reloadCamera()}),M.syncAndInitial),(0,M.watch)((()=>this.pitch),(e=>{this.camera.tilt=e,this._reloadCamera()}),M.syncAndInitial),(0,M.when)((()=>this.imageRenderer.ready),(()=>{this._addNavigationHandles(),this._addZoomHandles()}),M.syncAndInitial),(0,M.watch)((()=>this.clickAction),(e=>{this.removeHandles(Be),"none"!==e&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))}),M.syncAndInitial)],He)}get camera(){return this.imageRenderer.camera}set camera(e){e&&(this.imageRenderer.camera=e.clone())}get fov(){return this.camera.fov}set fov(e){var t;Number.isFinite(e)&&(null===(t=this._zoomViewModel)||void 0===t||t.zoomTo(e))}get hfov(){const{fov:e}=this.camera,{size:[t,i]}=this.imageRenderer,a=t/i,r=Math.atan(a);return 2*(0,v.KJ)(Math.atan(Math.tan((0,v.kU)(e/2))*Math.sin(r)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,t]}=this.imageRenderer;return Te(Ce.EA,e/t)}get minHFOV(){const{size:[e,t]}=this.imageRenderer;return Te(Ce.li,e/t)}get vfov(){const{fov:e}=this.camera,{size:[t,i]}=this.imageRenderer,a=t/i,r=Math.atan(a);return 2*(0,v.KJ)(Math.atan(Math.tan((0,v.kU)(e/2))*Math.cos(r)))}async _loadImageInternal(e,t){let i;this.state="image-loading";try{i=(await(0,Pe.default)(e,(0,r.A)({responseType:"image"},t))).data}catch(a){throw(0,w.isAbortError)(a)?this.state="image-load-aborted":this.state="image-load-error",a}return this._updateImageSphere(i,t)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=(0,y.pR)(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const t=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,t)),this._startPosition=this._targetPosition}async _updateImageSphere(e,t){await(0,w.waitTick)(t);const{size:[i,a]}=this.imageRenderer;return this._imageGraphic=function(e){return new o.default({geometry:e,symbol:new De.default({symbolLayers:new c.default([new Ee.default])})})}(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce.ZH,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ce.vK;const a=t.clone();a.z=-500;const r=ke.default.createSphere(a,{size:i,densificationFactor:2,vertexSpace:"georeferenced",material:new Ge.default({colorTexture:new Le.default({data:e})})});if(r.components[0].trustSourceNormals=!0,r.vertexAttributes.uv){var n;const e=null!==(n=r.vertexAttributes.uv.length)&&void 0!==n?n:0;for(let t=0;t<e;t++)r.vertexAttributes.uv[2*t+0]=1-r.vertexAttributes.uv[2*t+0],r.vertexAttributes.uv[2*t+1]=r.vertexAttributes.uv[2*t+1]}return r.centerAt(a),r}(e)),this._graphics.add(this._imageGraphic),this.fov=Te(Ce.EF,i/a),this.state="image-loaded",this.imageSize=[e.width,e.height],this._imageGraphic.geometry}async loadImage(e){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,e):(0,Re.EW)(this.declaredClass,new d.default((0,Re.Fe)("panoramic-viewer"),(0,Re.br)("PanoramicViewerViewModel","imageSource")))}};(0,n._)([(0,I.MZ)()],We.prototype,"_graphics",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"_imageGraphic",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"_imageRenderer",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"_loadController",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"_map",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"_zoomViewModel",void 0),(0,n._)([(0,I.MZ)({type:Boolean})],We.prototype,"autoLoad",void 0),(0,n._)([(0,I.MZ)({type:Me.default})],We.prototype,"camera",null),(0,n._)([(0,N.e)(new Ae.J({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],We.prototype,"clickAction",void 0),(0,n._)([(0,I.MZ)({type:Number})],We.prototype,"fov",null),(0,n._)([(0,I.MZ)({readOnly:!0})],We.prototype,"hfov",null),(0,n._)([(0,I.MZ)({readOnly:!0})],We.prototype,"imageRenderer",null),(0,n._)([(0,I.MZ)()],We.prototype,"imageSize",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"imageSource",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],We.prototype,"maxHFOV",null),(0,n._)([(0,I.MZ)({readOnly:!0})],We.prototype,"minHFOV",null),(0,n._)([(0,I.MZ)({type:Number})],We.prototype,"pitch",void 0),(0,n._)([(0,I.MZ)()],We.prototype,"state",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],We.prototype,"vfov",null),(0,n._)([(0,I.MZ)({type:Number})],We.prototype,"yaw",void 0),We=(0,n._)([(0,P.$)("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],We);const Ue=We;var qe=i(98108),Je=(i(76099),i(12254)),Qe=i(54761);let $e=class extends be.default{constructor(e){super(e),this.viewModel=new Ue,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return(0,Qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(qe.D.widget,"esri-panoramic-viewer")})}};(0,n._)([(0,I.MZ)({type:Boolean})],$e.prototype,"autoLoad",null),(0,n._)([(0,I.MZ)({type:Me.default})],$e.prototype,"camera",null),(0,n._)([(0,I.MZ)()],$e.prototype,"clickAction",null),(0,n._)([(0,I.MZ)({type:Number})],$e.prototype,"fov",null),(0,n._)([(0,I.MZ)({readOnly:!0,type:Number})],$e.prototype,"hfov",null),(0,n._)([(0,I.MZ)()],$e.prototype,"icon",null),(0,n._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"imageRenderer",null),(0,n._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"imageSize",null),(0,n._)([(0,I.MZ)()],$e.prototype,"imageSource",null),(0,n._)([(0,I.MZ)({type:Number})],$e.prototype,"pitch",null),(0,n._)([(0,I.MZ)({readOnly:!0})],$e.prototype,"state",null),(0,n._)([(0,I.MZ)({readOnly:!0,type:Number})],$e.prototype,"vfov",null),(0,n._)([(0,Je.U)(["click","hittest-response","pixel-location"]),(0,I.MZ)({type:Ue})],$e.prototype,"viewModel",void 0),(0,n._)([(0,I.MZ)({type:Number})],$e.prototype,"yaw",null),$e=(0,n._)([(0,P.$)("esri.widgets.PanoramicViewer")],$e);const Ke=$e;var Ye=i(44538),Xe=i(99464),et=i(4852),tt=i(39839),it=i(19562),at=i(42810),rt=i(63391),nt=i(33562),ot=i(44038),st=i(17941),lt=i(88235),ct=i(28632);const ut="click-handle",dt="enhancements-handle";let ht=class extends h.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new L.default({blendMode:"source-atop"}),this._map=new Ie.default,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{var e;null!==(e=this._loadController)&&void 0!==e&&e.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(dt),this.addHandles((0,M.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(e=>{var t;let[i,a,r]=e;(null===(t=this.image)||void 0===t?void 0:t.loaded)&&(this.image.effect="contrast(".concat(10*(a+10),"%) brightness(").concat(10*(i+10),"%)"),this.sharpenImage(this.image,r))}),M.syncAndInitial))},this._createPanConstraint=()=>{const{image:e,imageRenderer:t}=this,i=i=>{if(!(e&&t&&i.targetGeometry&&e.serviceRasterInfo))return i;const{extent:a}=e.serviceRasterInfo,{constraints:r,rotation:n,width:o,height:s}=t,{extent:l}=(0,rt.rotate)(O.default.fromExtent(a),n),{width:c,height:u}=l,d=i.targetGeometry.clone(),h=r.scaleToZoom(i.scale),p=1/2**h,m=o/s;let g=p*c,v=p*u;h&&(c/o>u/s?v=g/m:g=v*m);const y=l.clone();return y.xmin+=g/2,y.xmax-=g/2,y.ymin+=v/2,y.ymax-=v/2,i.targetGeometry=(0,rt.nearestCoordinate)(y,d).coordinate,this.state="image-loaded",i};return{constrain:i,applyPanConstraint:i}},this._createResizeHandles=e=>{e.removeHandles("resize"),e.addHandles((0,M.watch)((()=>{if(!this.imageRenderer.ready)return;const{extent:t}=e.serviceRasterInfo,{width:i,height:a,rotation:r}=this.imageRenderer,{extent:n}=(0,rt.rotate)(O.default.fromExtent(t),r),{width:o,height:s}=n;return Math.max(o/i,s/a)}),(e=>{if(!this.imageRenderer||null==e)return;const{constraints:t,scale:i,spatialReference:a}=this.imageRenderer,r=t.minScale,n=(0,ct.fr)(a),o=.25*n,s=n*e;let l=s;const c=[];for(;l>o;)c.push(l),l/=2;c.push(l);const{lods:u}=lt.default.create({scales:c});if(t.set({minScale:s,lods:u}),this._imageChanged)return this.imageRenderer.scale=s,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(i-r)<=1e-6?s:i}),M.syncAndInitial),"resize")},this._loadImageInternal=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.state="image-loading",t.clearImage(),t.error=null,t._imageChanged=!0;const a="string"==typeof e,r=a?void 0:e.datasetFormat,n=a?e:e.url,{customParameters:o,options:s}=i;return t._image=new nt.default({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:r},url:n,customParameters:o}),t._image.when((async e=>{t._updatePanConstraint(),t._createResizeHandles(e),t._map.add(e),t.state="image-loaded"}),(i=>{(0,w.isAbortError)(i)?t.state="image-load-aborted":(t.state="image-load-error",t.error=i,g.A.getLogger(t).error("error occurred while loading image ".concat(a?e:JSON.stringify(e)),i),t.imageSource=null)})),t._image.load(s)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(e,t)=>{this._overlays.graphics.add(e,t)},this.addManyGraphics=e=>{this._overlays.addMany(e)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=(0,y.pR)(this._image))},this.loadImage=e=>{const{customParameters:t,imageSource:i}=this;return i?this._loadImageInternal(i,{customParameters:t,options:e}):(0,Re.EW)(this.declaredClass,new d.default((0,Re.Fe)("image-viewer"),(0,Re.br)("ImageViewerViewModel","imageSource")))},this.removeGraphic=e=>{this._overlays.remove(e)},this.removeManyGraphics=e=>{this._overlays.removeMany(e)},this._imageRenderer=new at.default({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:z.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,M.watch)((()=>this.imageSource),(e=>{e&&this.autoLoad&&this._loadWithController()}),M.syncAndInitial),(0,M.watch)((()=>{var e;return null===(e=this.image)||void 0===e?void 0:e.loaded}),(()=>{this._createImageHandles()})),(0,M.watch)((()=>this.imageRotation),(()=>{this._rotateImage()})),(0,M.watch)((()=>this.imageRenderer.map),((e,t)=>{null!==t&&void 0!==t&&t.layers.remove(this._overlays),null===e||void 0===e||e.layers.add(this._overlays)}),M.initial),(0,M.watch)((()=>this.imageRenderer.map.allLayers.length),(e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)}),M.syncAndInitial),(0,M.watch)((()=>this.clickAction),(e=>{this.removeHandles(ut),"none"!==e&&this.addHandles(this.imageRenderer.on("click",(t=>{var i;if(null!==(i=this.image)&&void 0!==i&&i.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async((async()=>{const e=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",e)}));break;case"pixel-location":{var a;if(t.stopPropagation(),null===(a=this.image)||void 0===a||!a.serviceRasterInfo||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:e,pixelSize:i}=this.image.serviceRasterInfo,r=(t.mapPoint.x-e.xmin)*i.x,n=(e.ymax-t.mapPoint.y)*i.y,o=new S.default({x:r,y:n,spatialReference:e.spatialReference});this.emit("pixel-location",o);break}}})))}),M.syncAndInitial)])}get brightness(){var e;return null!==(e=this._get("brightness"))&&void 0!==e?e:0}set brightness(e){this._set("brightness",(0,v.qE)(e,-10,10))}get contrast(){var e;return null!==(e=this._get("contrast"))&&void 0!==e?e:0}set contrast(e){this._set("contrast",(0,v.qE)(e,-10,10))}get image(){return this._image}get imagePointsInView(){var e,t,i;const{extent:a,ready:r}=this.imageRenderer,n=this.imageRotation,o=null===(e=this.image)||void 0===e?void 0:e.fullExtent,s=null===(t=this.image)||void 0===t?void 0:t.serviceRasterInfo,l=!0===(null===(i=this._imageRenderer.allLayerViews.find((e=>{let{layer:t}=e;return t===this.image})))||void 0===i?void 0:i.attached);if(!(r&&a&&o&&s&&l))return null;const c=(0,rt.rotate)(O.default.fromExtent(a),n),u=O.default.fromExtent(o),d=(0,rt.intersect)(c,u),{rings:h}=d;return h.flat().map((e=>{let[t,i]=e;return{x:(t-s.extent.xmin)*s.pixelSize.x,y:(s.extent.ymax-i)*s.pixelSize.y}}))}get imageSize(){const{image:e}=this;if(null===e||void 0===e||!e.raster)return null;const{width:t,height:i}=e.raster.rasterInfo;return[t,i]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find((e=>e.layer===this.image))}get sharpness(){var e;return null!==(e=this._get("sharpness"))&&void 0!==e?e:0}set sharpness(e){this._set("sharpness",(0,v.qE)(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const i=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],a=new ot.default({functionName:"Convolution",functionArguments:{type:st.convolutionKernel.userDefined,cols:3,rows:3,kernel:i,convolutionType:st.convolutionKernel.userDefined}});e.rasterFunction=a}};(0,n._)([(0,I.MZ)()],ht.prototype,"_image",void 0),(0,n._)([(0,I.MZ)()],ht.prototype,"_imageRenderer",void 0),(0,n._)([(0,I.MZ)()],ht.prototype,"_loadController",void 0),(0,n._)([(0,I.MZ)()],ht.prototype,"_overlays",void 0),(0,n._)([(0,I.MZ)()],ht.prototype,"_map",void 0),(0,n._)([(0,I.MZ)({type:Boolean})],ht.prototype,"autoLoad",void 0),(0,n._)([(0,I.MZ)({type:Number})],ht.prototype,"brightness",null),(0,n._)([(0,I.MZ)()],ht.prototype,"clickAction",void 0),(0,n._)([(0,I.MZ)({type:Number})],ht.prototype,"contrast",null),(0,n._)([(0,I.MZ)({type:Object})],ht.prototype,"customParameters",void 0),(0,n._)([(0,I.MZ)({type:d.default})],ht.prototype,"error",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"image",null),(0,n._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"imagePointsInView",null),(0,n._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"imageSize",null),(0,n._)([(0,I.MZ)({cast:Re.mz})],ht.prototype,"imageSource",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"imageRenderer",null),(0,n._)([(0,I.MZ)({type:Number})],ht.prototype,"imageRotation",void 0),(0,n._)([(0,I.MZ)()],ht.prototype,"imageView",null),(0,n._)([(0,I.MZ)({type:Number})],ht.prototype,"sharpness",null),(0,n._)([(0,I.MZ)()],ht.prototype,"state",void 0),ht=(0,n._)([(0,P.$)("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],ht);const pt=ht;let mt=class extends be.default{constructor(){super(...arguments),this.viewModel=new pt,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){var e;const t=null===(e=this.viewModel.image)||void 0===e?void 0:e.serviceRasterInfo;return t?[t.width,t.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return(0,Qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(qe.D.widget,"esri-image-viewer")})}};(0,n._)([(0,I.MZ)({type:Boolean})],mt.prototype,"autoLoad",null),(0,n._)([(0,I.MZ)({type:Number}),(0,I.MZ)()],mt.prototype,"brightness",null),(0,n._)([(0,I.MZ)()],mt.prototype,"clickAction",null),(0,n._)([(0,I.MZ)({type:Number})],mt.prototype,"contrast",null),(0,n._)([(0,I.MZ)({type:Object})],mt.prototype,"customParameters",null),(0,n._)([(0,I.MZ)({readOnly:!0})],mt.prototype,"error",null),(0,n._)([(0,I.MZ)()],mt.prototype,"imageSize",null),(0,n._)([(0,I.MZ)({readOnly:!0})],mt.prototype,"imagePointsInView",null),(0,n._)([(0,I.MZ)({readOnly:!0,type:at.default})],mt.prototype,"imageRenderer",null),(0,n._)([(0,I.MZ)()],mt.prototype,"imageRotation",null),(0,n._)([(0,I.MZ)()],mt.prototype,"imageSource",null),(0,n._)([(0,Je.U)(["click","hittest-response","pixel-location"]),(0,I.MZ)({type:pt})],mt.prototype,"viewModel",void 0),(0,n._)([(0,I.MZ)({type:Number})],mt.prototype,"sharpness",null),(0,n._)([(0,I.MZ)({readOnly:!0})],mt.prototype,"state",null),mt=(0,n._)([(0,P.$)("esri.widgets.OrientedImageryViewer.components.ImageViewer")],mt);const gt=mt,vt=["updateElevationProps"],yt=["updateElevationProps"],ft="view-click",wt="image-click",_t="interaction-handles",Mt=new Set(["JPG","JPEG"]),bt=/\.(\w+)$/,xt=()=>new d.default("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let It=class extends(h.A.EventedMixin(f.A)){constructor(e){super(e),this.additionalFeatures=new c.default,this.additionalCameraLocations=new c.default,this.additionalFootprints=new c.default,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new c.default,this.coveragePolygons=new c.default,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(e,t,i)=>{const{currentBestFeature:a,selectedPoint:r,view:n}=this;if(null!==n&&void 0!==n&&n.closePopup(),a&&r){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(i),await this._loadImage(i)}catch(o){(0,w.isAbortError)(o)||(this.loadImageError(o),g.A.getLogger(this).error("#loadIImage()","error occured while loading image",o))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new c.default,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new c.default,this.overlayedMapFeatures=new _.A,this.pixelCoordinates=null,this.pointSources=new c.default,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(e,t)=>{var i;"image-loaded"===this.state&&await(null===(i=this._adapter)||void 0===i?void 0:i.updateFootprint(e,t))},this.updateFootprintPanorama=async(e,t)=>{var i;await(null===(i=this._adapter)||void 0===i?void 0:i.updateFootprintPanorama(e,t))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new gt,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new L.default({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new Ke,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new F.U,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=e=>{},this.highlight=e=>{var t;if(!this._overlaysView)return;this.removeHighlight();const i=this.additionalFootprints.find((t=>{let{attributes:{imageID:i}}=t;return i===Number(e)}));this._highlightedFeatureHandle=i?null===(t=this._overlaysView)||void 0===t?void 0:t.highlight(i):null},this.loadDataCaptureAdapter=async e=>{await this.loadSketch(e);const t=i.e(26964).then(i.bind(i,4583)),{default:a}=await t;return(0,w.throwIfAborted)(e),this.sketchAdapter=new a({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(e,t)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(e,t)),this.loadImageViewer=e=>{this._imageViewer.container=e},this.loadPanoramicViewer=e=>{this._panoramicViewer.container=e},this.removeHighlight=()=>{var e;return null===(e=this._highlightedFeatureHandle)||void 0===e?void 0:e.remove()},this.revealImageGeometry=e=>{},this.toggleImageAttributes=()=>{(0,y.DC)(this._openPopupTask),this._openPopupTask=(0,l.UT)((async e=>{const{currentBestFeature:t,popupEnabled:i,layer:a,view:r}=this;if(null!==r&&void 0!==r&&r.closePopup(),!(r&&t&&i&&a))return;const{attributes:n,geometry:s}=t,l=new o.default({geometry:s,attributes:n.toJSON(),layer:a});(0,w.throwIfAborted)(e),await r.openPopup({features:[l],location:n.location.clone()})}))},this._createViewClickHandle=()=>{if(this.removeHandles(ft),"disabled"===this.state||null==this.view)return;const e=this.mapImageConversionToolState&&"image-loaded"===this.state?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",e,_e.o.WIDGET),ft)},this._createImageClickHandle=()=>{this.removeHandles(wt);const{mapImageConversionToolState:e,mode:t,activeViewer:i,currentBestFeature:a,footprintExtent:r}=this,n=null===i||void 0===i?void 0:i.imageSize;if(!(e&&"none"!==t&&n&&r&&a))return;i.clickAction="pixel-location";let o=null;const s=(0,M.on)((()=>i),"pixel-location",(e=>{var i;this.plotReferencePointOnImage(e),null!==(i=o)&&void 0!==i&&i.abort(),o=(0,l.UT)((async i=>{if(!e)return;const r=await this.getMapPoint(e,{feature:a,imageSize:n,mode:t}).then((e=>{var t;const i=null===(t=this.view)||void 0===t?void 0:t.spatialReference;return(0,Y.or)(!i,e.spatialReference.equals(i))?e:(0,V.projectWithZConversion)(e,i)}));(0,w.throwIfAborted)(i),this.plotReferencePointOnGround(r)}))}));this.addHandles(s,wt)},this._createImageLocationHandle=()=>{this.removeHandles(wt);const{imageLocationToolState:e,mode:t,activeViewer:i,currentBestFeature:a,footprintExtent:r}=this,n=null===i||void 0===i?void 0:i.imageSize;if(!(e&&"none"!==t&&n&&r&&a))return;i.clickAction="pixel-location";let o=null;const s=(0,M.on)((()=>i),"pixel-location",(e=>{var i;this.pixelCoordinates=e,this.plotLocationPointOnImage(e),null!==(i=o)&&void 0!==i&&i.abort(),o=(0,l.UT)((async i=>{var r;if(!e)return;let o=await this.getMapPoint(e,{feature:a,imageSize:n,mode:t});(0,w.throwIfAborted)(i);const s=null===(r=this.view)||void 0===r?void 0:r.spatialReference;s&&!o.spatialReference.equals(s)&&(o=await(0,V.projectWithZConversion)(o,s),(0,w.throwIfAborted)(i)),this.groundCoordinates=o}))}));this.addHandles(s,wt)},this._loadImage=async e=>{const{currentBestFeature:t,layer:i,mode:a}=this;if(this.clearGraphics(),!i||!t||"none"===a)return;const{attributes:r}=t,{imagePath:n,imageRotation:o,cameraHeading:s,cameraRoll:l,cameraPitch:c,objectId:u,cameraOrientation:d,location:h}=r,p=(null!==l&&void 0!==l?l:0)+(null!==o&&void 0!==o?o:0),m=h.spatialReference.isWGS84&&4!==(null===d||void 0===d?void 0:d.type)?(0,G.geographicToWebMercator)(h):new S.default(h);let v=n;if((0,et.y0)(n))try{v=await(0,et.O_)(i,u,e)}catch(y){if((0,w.isAbortError)(y))return;return(0,Re.NL)(y)?(g.A.getLogger(this).error(y),void this.setMessage("noAttachment","error","".concat(i.objectIdField,": ").concat(u))):(g.A.getLogger(this).error(y,{[i.objectIdField]:u,layer:i}),void this.setMessage("imageLoadError","error","query-attachments-failed:".concat(i.objectIdField," ").concat(u)))}try{await this.loadImageFromSource(v,{imageRotation:p,options:e,pitch:c,yaw:s,mode:a,cameraLocation:m}),(0,w.throwIfAborted)(e),await this.transformAndPlotSelectedLocation(e)}catch(y){(0,w.isAbortError)(y)||this.loadImageError(y)}},this._loadImageFromSourceInternal=async(e,t)=>{var i;const{mode:a,imageRotation:n,options:o}=t,s="string"==typeof e,l=s?e:e.url,{pathname:c,searchParams:u}=new URL(l);let d=s?null===(i=c.match(bt))||void 0===i?void 0:i[1]:e.datasetFormat;if(!d)try{d=await(0,Re.gt)(l,(0,r.A)({},t.options))}catch(h){(0,w.isAbortError)(h)||g.A.getLogger(this).error("#getContentType()",h)}switch(null!==d&&void 0!==d||(d="UNKNOWN FORMAT"),a){case"default":this._imageViewer.imageSource={datasetFormat:d.toUpperCase(),url:l.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(u),this._imageViewer.imageRotation=null!==n&&void 0!==n?n:0,await this._imageViewer.loadImage(o);break;case"panoramic":if(Mt.has(d.toUpperCase())){const{selectedPoint:e}=this,{pitch:i,yaw:a,cameraLocation:r,viewAngle:n}=t;this._panoramicViewer.imageSource=l;let s=null!==a&&void 0!==a?a:0;"number"==typeof n?s=n-s:r&&e&&(s=await(0,Y.ox)(r,e)-s),this._panoramicViewer.pitch=null!==i&&void 0!==i?i:0,this._panoramicViewer.yaw=s,await this._panoramicViewer.loadImage(o)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:d})}},this._loadViewAdapter=async e=>{const{view:t}=this;if(t)switch(t.type){case"2d":{const{default:t}=await i.e(15208).then(i.bind(i,15208));(0,w.throwIfAborted)(e),this._adapter=new t(this);break}case"3d":{const{default:t}=await i.e(11334).then(i.bind(i,11334));(0,w.throwIfAborted)(e),this._adapter=new t(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=e=>{e.stopPropagation(),e.preventDefault(),e.mapPoint&&this.plotMapPoint(e.mapPoint)},this._viewClickHandler=e=>{var t;null!==(t=this._clickTask)&&void 0!==t&&t.abort(),this._clickTask=(0,l.UT)((async t=>{const{pointerType:i,button:a,mapPoint:r}=e;if(("mouse"!==i||0===a)&&r)return e.stopPropagation(),e.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(r,{signal:t}))}))},this.plotSelectedPointOnImage=async(e,t)=>{if(await(0,w.waitTick)(t),!e)return;const i=new S.default((0,r.A)({},p.A.isSerializable(e)?e.toJSON():e));if("default"===this.mode)i.x-=.5,i.y=.5-i.y,i.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new o.default({geometry:i,symbol:it.pB}),this._imageViewer.addGraphic(this._crossSymbol,0);else if("panoramic"===this.mode){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[i,a]=t,{heading:r,pitch:n}=(0,Y.dM)(e,i,a),s=(0,Y.id)(r,n);this._crossSymbol=new o.default({geometry:new S.default(s,z.default.WebMercator),symbol:it.ov}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([(0,M.watch)((()=>this.view),(()=>{this.load()}),M.syncAndInitial),(0,M.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),((e,t)=>{null!==t&&void 0!==t&&t.layers.remove(this._overlays),null===e||void 0===e||e.layers.add(this._overlays)}),M.initial),(0,M.watch)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.map)||void 0===e||null===(e=e.allLayers)||void 0===e?void 0:e.length}),(e=>{var t;e&&(null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t||t.layers.reorder(this._overlays,e-1))}),M.initial),(0,M.watch)((()=>[this.state,this.mapImageConversionToolState,this.view]),(()=>{this._createViewClickHandle(),this._createImageClickHandle()}),M.syncAndInitial),(0,M.watch)((()=>[this.state,this.imageLocationToolState,this.view]),(()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()}),M.syncAndInitial),(0,M.watch)((()=>this.measureType),(()=>{this.clearPreviousMeasurements()}),M.syncAndInitial),(0,M.watch)((()=>this.bestFeatureAngle),((e,t)=>{this.previousFeatureAngle=null!==t&&void 0!==t?t:0}),M.syncAndInitial),(0,M.watch)((()=>this.currentBestFeature),(async(e,t)=>{(0,y.DC)(this._featureChangedTask),this._featureChangedTask=(0,l.UT)((async i=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:i}]))),await this._featureChangedTask.promise}),{sync:!0}),(0,M.watch)((()=>this.mode),(e=>{switch(this.removeHandles(_t),e){case"default":this.addHandles((0,M.watch)((()=>{const{state:e}=this;return"image-loaded"===e?this._imageViewer.imagePointsInView:null}),(e=>{e&&((0,y.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,l.UT)((async t=>{await this.updateFootprint(e,{signal:t})})))}),(0,r.A)((0,r.A)({},M.syncAndInitial),{},{equals:(e,t)=>(0,s.aI)(e,t,m.equalsShallow)})),_t);break;case"panoramic":this.addHandles((0,M.watch)((()=>{const{currentBestFeature:e,state:t}=this,{imageSize:i,vfov:a,hfov:r,pitch:n,yaw:o}=this._panoramicViewer;return e&&i&&!t.includes("loading")?[a,r,o,n]:null}),(e=>{if(!e||this.state.includes("loading"))return;const[t,i,a,r]=e;(0,y.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,l.UT)((async e=>{await this.updateFootprintPanorama({verticalFieldOfView:t,horizontalFieldOfView:i,yaw:a,pitch:r},{signal:e})}))}),(0,r.A)((0,r.A)({},M.syncAndInitial),{},{equals:(e,t)=>(0,s.aI)(e,t,m.equalsShallow)})),_t)}}),M.syncAndInitial),(0,M.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(()=>{const{_imageViewer:e,brightness:t,contrast:i,mode:a,sharpness:r}=this;"default"===a&&(e.brightness=t,e.contrast=i,e.sharpness=r)}),M.syncAndInitial),(0,M.watch)((()=>{var e;return null===(e=this.activeViewer)||void 0===e?void 0:e.imageRenderer}),(()=>{var e;this.sketch&&(this.sketch.view=null===(e=this.activeViewer)||void 0===e?void 0:e.imageRenderer)}))]),this.when().finally((()=>{this.notifyChange("state")}))}destroy(){var e;this._updateFootprintTask=(0,y.DC)(this._updateFootprintTask),this._clickTask=(0,y.DC)(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=(0,y.pR)(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=(0,y.pR)(this.bestFeatureCurrentFootprint),this._crossSymbol=(0,y.pR)(this._crossSymbol),this._referencePointOnGround=(0,y.pR)(this._referencePointOnGround),this._referencePointOnImage=(0,y.pR)(this._referencePointOnImage),this._locationPointOnImage=(0,y.pR)(this._locationPointOnImage),this._overlays&&null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._overlays),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return(0,u.Lx)(g.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){(0,u.Lx)(g.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:i}=this;switch(i){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){var e,t;return null===(e=null===(t=this.layer)||void 0===t||null===(t=t.orientationAccuracy)||void 0===t?void 0:t.every((e=>0===e)))||void 0===e||e}get brightness(){var e;return null!==(e=this._get("brightness"))&&void 0!==e?e:0}set brightness(e){this._set("brightness",(0,v.qE)(e,-10,10))}get contrast(){var e;return null!==(e=this._get("contrast"))&&void 0!==e?e:0}set contrast(e){this._set("contrast",(0,v.qE)(e,-10,10))}get featureCount(){var e,t;return null!==(e=null===(t=this.features)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get imageGalleryEnabled(){var e;const{currentBestFeature:t}=this;if(!t)return!1;const i=null===(e=t.attributes.imagePath)||void 0===e?void 0:e.trim();return(0,Re._U)(i)||(0,et.y0)(i)}get imageLoaded(){return(0,u.Lx)(g.A.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),"image-loaded"===this.state}get invalidCameraHeading(){var e;return(null===(e=this.currentBestFeature)||void 0===e||null===(e=e.attributes)||void 0===e?void 0:e.cameraHeading)===Ye.BH}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return"default"===e?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find((0,Re.FL)(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?(0,ve.E)(e):null}get mode(){var e;const t=null===(e=this.currentBestFeature)||void 0===e?void 0:e.attributes;if(!t)return"none";const{horizontalFieldOfView:i,isSpherical:a}=t;return 360===i||a?"panoramic":"default"}get popupEnabled(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.popupEnabled)}get referencePoint(){var e;return null===(e=this._referencePointOnGround)||void 0===e?void 0:e.geometry}get sectorData(){const{_sectorData:e}=this;return e?Ye.PD.map((t=>e[t])):null}get sharpness(){var e;return null!==(e=this._get("sharpness"))&&void 0!==e?e:0}set sharpness(e){this._set("sharpness",(0,v.qE)(e,0,1))}get sketchGraphicsLayer(){var e;return null===(e=this.sketch)||void 0===e?void 0:e.layer}get state(){var e;const{mode:t,disabled:i,_updatingHandles:{updating:a},_featureChangedTask:r}=this;if(i)return"disabled";if(!this.isFulfilled()||a||!1===(null===r||void 0===r?void 0:r.finished))return"loading";if(this.isRejected())return"error";if("error"===(null===(e=this.displayMessage)||void 0===e?void 0:e.type))return"image-load-error";switch(t){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new c.default(e.map((e=>{let{attributes:{imagePath:t,objectId:i,cameraRoll:a,imageRotation:r}}=e;const n=null===t||void 0===t?void 0:t.trim();return(0,Re._U)(n)||(0,et.y0)(n)?{url:n,objectId:i,rotation:(null!==a&&void 0!==a?a:0)+(null!==r&&void 0!==r?r:0)}:null})).filter(s.Ru)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new L.default({elevationInfo:{mode:"absolute-height"}});case"default":return new L.default;case"none":return}}get _overlaysView(){var e;return null===(e=this.view)||void 0===e?void 0:e.layerViews.find((e=>{let{layer:t}=e;return t===this._overlays}))}async computeHeight(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{currentBestFeature:a,activeViewer:r,layer:n,footprintExtent:o}=this,s=null===r||void 0===r?void 0:r.imageSize,l=null===a||void 0===a?void 0:a.attributes,c=null===n||void 0===n?void 0:n.orientationAccuracy;if(!l||!s||!e||e.length<2||!c)return;const u="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Y.Mm)(l,s[0],s[1]),d=e.at(0),h=e.at(-1);if(!(u&&d&&h&&c&&o))return;const p=[h,d],m=(0,tt.$0)(p,!1),g="panoramic"===t?await(0,tt.QI)(p,u,c,a,!0,!1):await(0,tt.AX)(p,u,c,!0,i);if(!g)return;const v="panoramic"===t?await(0,tt.bO)(c,m,u,g,a,!0):await(0,tt.jr)(c,m,u,g,!0);return v?{value:g,accuracy:v}:{value:g}}async calculateAreaMeasurement(e,t,i){var a;if(e.length<3||!this.currentBestFeature||null===(a=this.activeViewer)||void 0===a||!a.imageSize||"none"===t)return null;const r="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,w.throwIfAborted)(i),r?"default"===t?await(0,tt.Md)(e,r,!0):await(0,tt.yP)(e,r,!0,i):null}async calculateDistanceMeasurement(e,t,i){const{currentBestFeature:a,activeViewer:r}=this;if(e.length<2||!a||null===r||void 0===r||!r.imageSize||"none"===t)return null;const n="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,w.throwIfAborted)(i),n?"default"===t?await(0,tt.CN)([e.at(0),e.at(-1)],n,!0):await(0,tt.QV)([e.at(0),e.at(-1)],n,!0):null}async calculateAccuracy(e,t,i){const{layer:n,currentBestFeature:o,activeViewer:s}=this,l=null===n||void 0===n?void 0:n.orientationAccuracy,c=(null===l||void 0===l?void 0:l.every((e=>0===e)))||!(null!==l&&void 0!==l&&l.length);if("area"===t&&e.length<3||"distance"===t&&e.length<2||!o||null===s||void 0===s||!s.imageSize||c)return null;const u=await this.getMeasurementProperties();if((0,w.throwIfAborted)(i),!u)return null;const d="area"===t?await(0,tt.Md)(e,u,!0):await(0,tt.CN)([e.at(0),e.at(-1)],u,!0);(0,w.throwIfAborted)(i);const{updateElevationProps:h}=u,p=(0,a.A)(u,vt),m=(0,tt.gO)(p,l);if(null===m||void 0===m||!m.length)return null;const g=m.map((e=>(0,r.A)((0,r.A)({},e),{},{updateElevationProps:h}))).map((async a=>{const r="area"===t?await(0,tt.Md)(e,a,!0):await(0,tt.CN)([e.at(0),e.at(-1)],a,!0);if((0,w.throwIfAborted)(i),r&&d){if("area"===t){const e="number"!=typeof r?r.area:null;return e?Math.abs(e-d.area):null}return Math.abs(r-d)}return null})),v=await Promise.all(g);(0,w.throwIfAborted)(i);const y=v.filter((e=>null!==e));return 0===y.length?null:(0,tt.WB)(y)}async calculateAccuracyPanoramic(e,t,i){const{layer:n,currentBestFeature:o,activeViewer:s,mode:l}=this,c=null===n||void 0===n?void 0:n.orientationAccuracy,u=(null===c||void 0===c?void 0:c.every((e=>0===e)))||!(null!==c&&void 0!==c&&c.length);if("area"===t&&e.length<3||"distance"===t&&e.length<2||!o||null===s||void 0===s||!s.imageSize||u||"panoramic"!==l)return null;const d=await this.getMeasurementPropertiesPanoramic();if((0,w.throwIfAborted)(i),!d)return null;const h="area"===t?await(0,tt.yP)(e,d,!0):await(0,tt.QV)([e.at(0),e.at(-1)],d,!0);(0,w.throwIfAborted)(i);const{updateElevationProps:p}=d,m=(0,a.A)(d,yt),g=(0,tt.cG)(m,c);if(null===g||void 0===g||!g.length)return null;const v=g.map((e=>(0,r.A)((0,r.A)({},e),{},{updateElevationProps:p}))).map((async a=>{const r="area"===t?await(0,tt.yP)(e,a,!0):await(0,tt.QV)([e.at(0),e.at(-1)],a,!0);if((0,w.throwIfAborted)(i),r&&h){if("area"===t){const e="number"!=typeof r?r.area:null;return e?Math.abs(e-h.area):null}return Math.abs(r-h)}return null})),y=await Promise.all(v);(0,w.throwIfAborted)(i);const f=y.filter((e=>null!==e));return 0===f.length?null:(0,tt.WB)(f)}async calculateHeightMeasurementInfo(e,t,i){const{currentBestFeature:a,activeViewer:r}=this,n=null===r||void 0===r?void 0:r.imageSize;if(!a||!r||null===n||void 0===n||!n.length||"none"===t)return;const{attributes:o}=a,[s]=(0,tt.$0)([e],"panoramic"!==t),l="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Y.Mm)(o,n[0],n[1]);if("panoramic"===t){if(!l)return;const e=await(0,tt.Z9)(s,l,a,i);if(!e)return;(null===e||void 0===e?void 0:e.heading)>180&&(e.heading-=360);const t=(0,tt.mf)(s,e),r=(0,A.Io)([s.x,s.y],[e.x,e.y]);if(!t||!r)return;return{measurementAngle:t,tempDistance:r}}const c=await(0,tt._I)(s,l,i);if(!c)return;const u=(0,tt.Qu)(s,c),d=(0,A.Io)([s.x,s.y],[c.x,c.y]);return u&&d?{measurementAngle:u,tempDistance:d}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){var e,t;this.measurementGraphic&&(null!==(e=this.activeViewer)&&void 0!==e&&e.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&(null!==(t=this.activeViewer)&&void 0!==t&&t.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){var e;return null===(e=this.sketch)||void 0===e?void 0:e.cancel()}digitizeCanRedo(){var e,t;return null!==(e=null===(t=this.sketch)||void 0===t?void 0:t.canRedo())&&void 0!==e&&e}digitizeCanUndo(){var e,t;return null!==(e=null===(t=this.sketch)||void 0===t?void 0:t.canUndo())&&void 0!==e&&e}digitizeComplete(){var e;return null===(e=this.sketch)||void 0===e?void 0:e.complete()}async digitizeCreate(e,t){const{sketch:i,dataCaptureLayer:a}=this;if(!i)throw xt();(0,Xe.DV)(a,e,i),await i.create(e,(0,r.A)((0,r.A)({},t),{},{defaultZ:0}))}async digitizeDelete(){if(!this.sketch)throw xt();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw xt();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw xt();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw xt();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw xt();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw xt();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:i,mode:a}=this,r=null===t||void 0===t?void 0:t.imageSize;if(!(null===e||void 0===e?void 0:e.attributes)||!r)return;const n=await this.computeHeight(i,a);(null===n||void 0===n?void 0:n.value)&&(null===n||void 0===n?void 0:n.accuracy)&&(this.heightMeasurementResult=n.value,this.heightMeasurementAccuracy=n.accuracy)}filterByFootprints(e,t){const i=[],a=[],r=[];return e.forEach((e=>{const{layer:{coveragePercent:n},attributes:o}=e;let s;const l=(0,x.GA)(e.geometry.spatialReference);o.cameraHeight/=l,o.farDistance/=l,o.nearDistance/=l,(0,de.E1)(o.elevationSource)&&(o.elevationSource.constantElevation/=l);const{polygon:c,frustum:u}=(0,ue.ns)(o);if(s=c.clone(),o.isInspection&&(s=(0,ue.nt)(o)),n&&(s=(0,ue.v3)(s,n)),(0,ue.Eh)(s,t)){r.push(e);const{geometry:t,objectId:n,cameraHeight:s,cameraHeading:l}=o,d=t.clone();d.z=s,d.imageID=n,this.pointSources.push(d),l!==Ye.BH&&(i.push(c),u&&a.push(u))}})),{features:r,polygons:i,frustums:a}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||null===t||void 0===t||!t.imageSize)return;const{elevationSample:i,attributes:a}=e,{elevationSource:n,cameraHeight:o}=a,s=(0,Y.Mm)(a,t.imageSize[0],t.imageSize[1]);let l=s.cameraLocation;return(l.spatialReference.isGeographic?(0,V.projectWithZConversion)(l,z.default.WebMercator):Promise.resolve(l)).then((e=>{var t;return l=e,(0,Y.Ns)((null!==(t=l.z)&&void 0!==t?t:0)-o,{elevationSample:i,elevationSource:n,extent:this.footprintExtent})})).then((t=>("elevationSample"in t&&(0,Y.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),(0,r.A)((0,r.A)({},s),{},{cameraLocation:l,updateElevationProps:t}))))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||null===t||void 0===t||!t.imageSize)return;const{elevationSample:i,attributes:a}=e,{elevationSource:n,cameraHeight:o}=a,s=(0,Y.m0)(a,t.imageSize[0],t.imageSize[1]);let l=s.cameraLocation;return(l.spatialReference.isGeographic?(0,V.projectWithZConversion)(l,z.default.WebMercator):Promise.resolve(l)).then((e=>{var t;return l=e,(0,Y.Ns)((null!==(t=l.z)&&void 0!==t?t:0)-o,{elevationSample:i,elevationSource:n,extent:this.footprintExtent})})).then((t=>("elevationSample"in t&&(0,Y.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),(0,r.A)((0,r.A)({},s),{},{cameraLocation:l,updateElevationProps:t}))))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new d.default("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then((e=>{let{features:i}=e;return t.applyEdits({deleteFeatures:i})}))}handleSectorClick(e){var t;if(isNaN(e))return;const i=null===(t=this._sectorData)||void 0===t?void 0:t[Ye.PD[e]];(null===i||void 0===i?void 0:i.length)&&this._updateCurrentBestFeature(i.at(0))}handleFeatureClick(e){var t;const{sector:i,featureIndexInSector:a}=e;if(isNaN(a))return;const r=null===(t=this._sectorData)||void 0===t?void 0:t[i];(null===r||void 0===r?void 0:r.length)&&this._updateCurrentBestFeature(r.at(a))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:i,heightMeasurementPixels:a,mode:r,activeViewer:n}=this,o=null===n||void 0===n?void 0:n.imageSize;if(!e.vertices||!o)return;const s=(0,tt.Fj)(e.vertices.at(-1),r,o);if(a.length<1||!s||!i||!t||"none"===r)return;const l=(0,tt.AG)(a[0],s,t);if(null===l||void 0===l||!l.length)return;this.heightMeasurementPixels.push(l),"panoramic"===r?this.createPolylineGraphicPano():this.createPolylineGraphic();const c=(0,tt.eY)(this.heightMeasurementPixels,i);c&&(this.heightMeasurementResult=c)}async handleDrawVertexAddEvents(e,t){var i;const{currentBestFeature:a,activeViewer:r,heightMeasurementPixels:n,mode:o}=this;if(!a||!r||null===(i=e.vertices)||void 0===i||!i.length||"none"===o)return;const s=null===r||void 0===r?void 0:r.imageSize;if(!n.length&&s){const i=(0,tt.Fj)(e.vertices.at(-1),o,s);this.heightMeasurementPixels.push(i);const a=await this.calculateHeightMeasurementInfo(i,o,t);if(null===a||void 0===a||!a.measurementAngle||null===a||void 0===a||!a.tempDistance)return;this.measurementAngle=a.measurementAngle,this.tempDistance=a.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch((e=>{if(!(0,w.isAbortError)(e))throw e}))),this}async loadBestImage(e,t){var i,a;return null!==(i=this.view)&&void 0!==i&&i.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?(0,G.geographicToWebMercator)(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=(0,y.pR)(this.bestFeatureCurrentFootprint),null!==(a=this._overlays)&&void 0!==a&&a.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){g.A.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){if(!this.sketch){var t;const a=i.e(81257).then(i.bind(i,81257)),{default:r}=await a;(0,w.throwIfAborted)(e),this.sketch=new r({layer:this._sketchGraphicsLayer,view:null===(t=this.activeViewer)||void 0===t?void 0:t.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=i.e(41526).then(i.bind(i,41526)),{default:a}=await t;if((0,w.throwIfAborted)(e),this.sketchAdapter=new a({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){var i;await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:a,sketchAdapter:r,activeViewer:n,mode:o}=this;if(!a||!r||!n||"none"===o)return;if(this.displayNewMeasurementButton=!1,"panoramic"===o&&(a.defaultCreateOptions.defaultZ=0),await a.create(e),"panoramic"===o){const{drawOperation:e}=a.view.activeTool;e.constraintsEnabled=!1,e._set("elevationDrawSurface",null)}const s=null===(i=this.activeViewer)||void 0===i?void 0:i.imageRenderer.effectiveTheme.accentColor;s&&this.sketch&&(this.sketch.polygonSymbol=(0,it.fg)(s),this.sketch.polylineSymbol="panoramic"===o?it.Tu:(0,it.Jb)(s))}startHeightMeasurement(){var e,t;this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,null!==(e=this.draw)&&void 0!==e||(this.draw=new fe.default({view:null===(t=this.activeViewer)||void 0===t?void 0:t.imageRenderer})),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],(e=>this.handleDrawEvents(e)))}createPolylineGraphic(){var e;const t=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],i=null===(e=this.activeViewer)||void 0===e?void 0:e.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new Z.default({paths:[t],spatialReference:i});else{var a,r;const e=new Z.default({paths:[t],spatialReference:i}),n=null===(a=this.activeViewer)||void 0===a?void 0:a.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new o.default({geometry:e,symbol:(0,it.Jb)(n,2.5)}),null===(r=this.activeViewer)||void 0===r||r.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){var e,t;const i=null===(e=this.activeViewer)||void 0===e?void 0:e.imageRenderer.spatialReference,a=null===(t=this.activeViewer)||void 0===t?void 0:t.imageSize;if(!a)return;const r={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},n={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:s,pitch:l}=(0,Y.dM)(r,a[0],a[1]),{heading:c,pitch:u}=(0,Y.dM)(n,a[0],a[1]),d=[[...(0,Y.id)(s,l)],[...(0,Y.id)(c,u)]];if(this.heightGraphic)this.heightGraphic.geometry=new Z.default({paths:[d],spatialReference:i});else{const e=new Z.default({paths:[d],spatialReference:i});this.heightGraphic=new o.default({geometry:e,symbol:it.Tu}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:i,overlayedCameraLocations:a,layer:r,mode:n,state:s}=this,l=null===t||void 0===t?void 0:t.imageSize;if(!l||!i||!r||"none"===n||s.includes("loading"))return;const{polygon:c}=(0,ue.ns)(i.attributes);if(t.removeManyGraphics(a.toArray()),a.removeAll(),e){const{features:e}=await r.queryFeatures({where:"".concat(r.objectIdField," <> ").concat(i.attributes.objectId),geometry:c,returnGeometry:!0,outFields:[r.objectIdField]}),s=await Promise.all(e.map((async e=>{const{attributes:t,geometry:a}=e,r=await this.getPixels(a,{feature:i,imageSize:l,mode:n}),s=it.at.clone();return s.outline=new ye.default({color:[0,0,0],width:1}),new o.default({attributes:t,symbol:s,geometry:r})})));a.addMany(s),t.addManyGraphics(a.toArray())}}overlayGraphicsOnImage(e,t){var i;this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),null===(i=this.activeViewer)||void 0===i||i.addManyGraphics(t.toArray())}async overlayMapFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{activeViewer:i,currentBestFeature:a,mode:r,state:n,layer:l}=this,u=null===i||void 0===i?void 0:i.imageSize;if(!u||!a||"none"===r||n.includes("loading")||!l)return;const{polygon:d}=(0,ue.ns)(a.attributes);try{const{imageGeometryField:t,oiObjectIdField:i}=(0,Xe.Qv)(e,l.imageGeometryField,l.imageReferenceField);this.imageGeometryField=t.name,this.oiObjectIdField=i.name}catch(m){g.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",m)}const{features:h}=await e.queryFeatures({geometry:d,returnGeometry:!0,outFields:["*"]}),p=new c.default((await Promise.all(h.map((async i=>{var n,s,l;const c=null!==(n=null===(s=i.symbol)||void 0===s?void 0:s.clone())&&void 0!==n?n:null===(l=e.renderer)||void 0===l||null===(l=l.getSymbol(i))||void 0===l?void 0:l.clone(),{attributes:d,geometry:h}=i,p=h,{imageGeometryField:v,oiObjectIdField:y}=this;if(v&&y&&(0,Xe.gE)(e,v,y)&&"".concat(d[y])=="".concat(a.attributes.objectId))try{return(0,Xe.jQ)(d,v,e,t,u,r,c)}catch(m){g.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:m,feature:i,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(null===p||void 0===p?void 0:p.type){case"point":{const i=await this.getPixels(p,{feature:a,imageSize:u,mode:r});return new o.default({attributes:d,layer:e,symbol:c,geometry:i,visible:e.visible&&t})}case"polygon":{const{rings:i,spatialReference:n}=p,s=i.map((e=>e.map((e=>{let[t,i,a]=e;return new S.default({x:t,y:i,z:a,spatialReference:n})})))),l=await Promise.all(s.map((async e=>this.getPixels(e,{feature:a,imageSize:u,mode:r}).then((e=>e.map(Y.n3))))));return new o.default({attributes:d,layer:e,symbol:c,geometry:new O.default({rings:l,spatialReference:z.default.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:i,spatialReference:n}=p,s=i.map((e=>e.map((e=>{let[t,i,a]=e;return new S.default({x:t,y:i,z:a,spatialReference:n})})))),l=await Promise.all(s.map((async e=>this.getPixels(e,{feature:a,imageSize:u,mode:r}).then((e=>e.map(Y.n3))))));return new o.default({attributes:d,layer:e,symbol:c,geometry:new Z.default({paths:l,spatialReference:z.default.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:i,spatialReference:n}=p,s=i.map((e=>{let[t,i,a]=e;return new S.default({x:t,y:i,z:a,spatialReference:n})})),l=await this.getPixels(s,{feature:a,imageSize:u,mode:r}).then((e=>e.map(Y.n3)));return new o.default({attributes:d,layer:e,symbol:c,geometry:new C.default({points:l,spatialReference:z.default.WebMercator}),visible:e.visible&&t})}}return null})))).filter(s.Ru));this.overlayGraphicsOnImage("".concat(e.id),p)}async getPixels(e,t){const{imageSize:i,mode:a}=t,r=(await this.worldToImage(Array.isArray(e)?e:[e])).map((e=>{if("default"===a)return new S.default({x:e.x-.5,y:.5-e.y,spatialReference:z.default.WebMercator});const[t,r]=i,{heading:n,pitch:o}=(0,Y.dM)(e,t,r),s=(0,Y.id)(n,o);return new S.default(s,z.default.WebMercator)}));return Array.isArray(e)?r:r[0]}async getMapPoint(e,t){var i;const{feature:a,mode:n,imageSize:o}=t,{elevationSample:s,attributes:l}=a,{elevationSource:c,location:u,elevation:d,cameraHeight:h}=l;let p=u.clone();p.spatialReference.isGeographic&&(p=await(0,V.projectWithZConversion)(p,z.default.WebMercator));const m=await(0,Y.Ns)(null!==d&&void 0!==d?d:(null!==(i=u.z)&&void 0!==i?i:0)-h,{elevationSample:s,elevationSource:c,extent:this.footprintExtent});let g;if("elevationSample"in m&&(0,Y.sp)(m.elevationSample)&&(a.elevationSample=m.elevationSample),"default"===n){const t=(0,Y.Mm)(l,o[0],o[1]);g=await(0,he.imageToWorld)(Array.isArray(e)?e:[e],(0,r.A)((0,r.A)({},t),{},{cameraLocation:p}),m)}else{const t=(0,Y.m0)(l,o[0],o[1]);g=await(0,he.imageToWorldPanoramic)(Array.isArray(e)?e:[e],(0,r.A)((0,r.A)({},t),{},{cameraLocation:p}),m)}return Array.isArray(e)?g:g[0]}async plotMapPoint(e){var t;return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:null===(t=this._transformController)||void 0===t?void 0:t.signal}})}plotReferencePointOnGround(e){var t,i,a;this._referencePointOnGround&&(null!==(t=this._overlays)&&void 0!==t&&t.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),null!=e&&(this._referencePointOnGround=new o.default({geometry:new S.default((0,r.A)({},e.toJSON())),symbol:it.FT}),this.view?null===(i=this._overlays)||void 0===i||i.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:null===(a=this._referencePointOnGround)||void 0===a?void 0:a.geometry}}))}plotReferencePointOnImage(e){if("image-loaded"===this.state)switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=p.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new o.default({geometry:new S.default((0,r.A)({spatialReference:this._imageViewer.imageRenderer.spatialReference},t)),symbol:it.FT}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[i,a]=t,{heading:r,pitch:n}=(0,Y.dM)(e,i,a),s=(0,Y.id)(r,n);this._referencePointOnImage=new o.default({geometry:new S.default(s,z.default.WebMercator),symbol:it.IL}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if("image-loaded"===this.state)switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach((e=>{this._imageViewer.removeManyGraphics(e.toArray())})),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){var t;const i=this.overlayedMapFeatures.get(e);(null===i||void 0===i?void 0:i.length)&&(null!==(t=this.activeViewer)&&void 0!==t&&t.removeManyGraphics(i.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=(0,y.DC)(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||"data-capture"!==(null===t||void 0===t?void 0:t.type))return;const{pendingGraphics:i,savedGraphics:a}=t,r=i.get(e.id),n=null===r||void 0===r?void 0:r.toArray();if(!r||null===n||void 0===n||!n.length)return;const{addFeatureResults:o}=await this.saveDataCaptureFeatures(n),s=o.reduce(((t,i,a)=>{let{objectId:r,globalId:o,error:s}=i;const l=n[a],{attributes:c}=l;return s?t.error.push(l):(r&&(c[e.objectIdField]=r),o&&e.globalIdField&&(c[e.globalIdField]=o),t.success.push(l)),t}),{success:[],error:[]});a.addMany(s.success),r.removeAll(),r.addMany(s.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:a,dataCaptureLayer:n,mode:o}=this,l=null===t||void 0===t?void 0:t.imageSize;if(!l||!a||"none"===o)throw new d.default("Image size, current best feature and mode are required to save data capture features");if(!n)throw new d.default("Data capture layer is not available");const c=await Promise.all(e.map((async e=>{const t=e.clone(),{geometry:r}=t;if(!r)return;const s=r.type,c=n.hasZ,u=n.geometryType,d=s!==u,h=d?await i.e(71083).then(i.bind(i,71083)):null,p=null===h||void 0===h?void 0:h.default[u],m=d?null===p||void 0===p?void 0:p(r):r;if(m)switch(m.type){case"point":return t.geometry=await this.getMapPoint((0,Y.Dy)(o,m,l),{feature:a,imageSize:l,mode:o}),c||(delete t.geometry.z,t.geometry.hasZ=!1),t.geometry.hasM=!1,t;case"polygon":{const e=await Promise.all(m.rings.map((async e=>this.getMapPoint(e.map((e=>{let[t,i,a]=e;return(0,Y.Dy)(o,{x:t,y:i,z:a},l)})),{feature:a,imageSize:l,mode:o}))));return t.geometry=new O.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,rings:e.map((e=>e.map(Y.n3)))}),t}case"polyline":{const e=await Promise.all(m.paths.map((async e=>this.getMapPoint(e.map((e=>{let[t,i,a]=e;return(0,Y.Dy)(o,{x:t,y:i,z:a},l)})),{feature:a,imageSize:l,mode:o}))));return t.geometry=new Z.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,paths:e.map((e=>e.map(Y.n3)))}),t}}}))),u=c.filter(s.Ru);return n.applyEdits({addFeatures:u}).then((e=>{const{addFeatureResults:t}=e;let i=0;const a=c.map((e=>{const a=t[i++];return e?a:{error:new d.default("Error in saving data capture features"),objectId:null,globalId:null}}));return(0,r.A)((0,r.A)({},e),{},{addFeatureResults:a})}))}async searchBestImage(e,t){try{const i=await ne(e,t);i&&await this._processFeatureResponse(i,e.point,{signal:null===t||void 0===t?void 0:t.signal})}catch(i){(0,w.isAbortError)(i)||(this.setMessage("imageLoadError","error",i.message),g.A.getLogger(this).error("error occurred while finding best image",i))}}selectBestFeature(e){var t;this.currentBestFeature=null===(t=this.features)||void 0===t?void 0:t.find((t=>{let{attributes:i}=t;return i.objectId===Number(e)}))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach((t=>{t.visible=e}))}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach((t=>{t.visible=e}))}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){var i,a,r;const n=null===(i=this.activeViewer)||void 0===i?void 0:i.imageRenderer,{oiObjectIdField:o,currentBestFeature:s}=this;if(!n||!s||!o)return;const{attributes:{objectId:l}}=s,u=null!==(a=null===(r=this.overlayedMapFeatures.get(e.id))||void 0===r?void 0:r.toArray())&&void 0!==a?a:[],d=[],h=[];for(const c of u)"".concat(c.getAttribute(o))=="".concat(l)?d.push(c):h.push(c);this.overlayGraphicsOnImage(e.id,new c.default(h)),this.collectionId=e.id;const p=await this.loadSketch(t),m=await this.loadDataCaptureAdapter(t);(0,w.throwIfAborted)(t),p.layer.addMany(d),p.layer.blendMode="source-atop",m.savedGraphics.addMany(d),n.ui.find("zoom").visible=!1,n.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(){var e,t,i;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!==(e=this.sketch)&&void 0!==e&&e.cancel(),null!==(t=this.sketchGraphicsLayer)&&void 0!==t&&t.removeAll(),this.sketchAdapter=(0,y.pR)(this.sketchAdapter),this.sketch=(0,y.pR)(this.sketch),this.collectionId=null;const{dataCaptureLayer:r}=this,n=null===(i=this.activeViewer)||void 0===i?void 0:i.imageRenderer;if(!n||n.destroyed)return;n.map.layers.remove(this.sketchGraphicsLayer),a&&r&&await this.overlayMapFeatures(r,!0);const o=n.ui.find("zoom");o&&(o.visible=!0)}stopMeasurement(){var e,t;this.heightMeasurementPixels=[],null!==(e=this.draw)&&void 0!==e&&e.reset(),null===(t=this.sketch)||void 0===t||t.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach((t=>{this._toggleVisiblity(t,e)}))}toggleOverlayMapFeatures(e,t){const i=this.overlayedMapFeatures.get(e);i&&this._toggleVisiblity(i,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){var t;const{selectedLocation:i,options:a}=e;let r=!1,n=!1;const o=null===(t=this.bestFeatureFootprint)||void 0===t?void 0:t.geometry;switch(null===o||void 0===o?void 0:o.type){case"polygon":{const e=i.spatialReference.equals(o.spatialReference)?i:await(0,V.projectWithZConversion)(i,o.spatialReference);r=o.contains(e);break}case"mesh":{const e=i.spatialReference.equals(o.spatialReference)?i:await(0,V.projectWithZConversion)(i,o.spatialReference);n=o.extent.contains(e);break}}if(!r&&!n)return void this.clearReferencePointOnImage();const s=await this.worldToImage(i,a);if(s)return(0,w.throwIfAborted)(a),this.plotReferencePointOnImage(s),{x:s.x,y:s.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort(((e,t)=>e.suitability-t.suitability)),this._suitabilities=e;const t=this._suitabilities.map((e=>{let{feature:t}=e;return t}));this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const i=this.layer;if(i){const a={include:i},r=this.view.toScreen(e);if(!r)return;const n=await this.view.hitTest(r,a);return this._processHitTestResults(i,n,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(i){if((0,w.isAbortError)(i))return;this.setMessage("imageLoadError","error"),g.A.getLogger(this).error("error occurred while fetching features",i)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:i,features:a,invalidCameraHeading:n}=this;if(!e||!t||!i||!a||n)return void(this._sectorData=null);this._sectorData={};for(const r of Ye.PD)this._sectorData[r]=new c.default;const o=e.map(((e,t)=>(0,r.A)((0,r.A)({},e),{},{featureIndex:t})));o.sort(((e,t)=>e.trueSuitability-t.trueSuitability));const s=o.map((e=>{let{distance:t}=e;return t})),l=Math.max(...s);o.forEach((e=>{var t,i;const{distance:r,angle:n,featureIndex:o}=e,s=r/l*Ye.rV[2],c=(0,Re.Cg)(r,l),u=(0,Re.wB)(n);if(!this._sectorData)return;const d=Ye.rV[3]+s*Math.sin(n*Math.PI/180),h=Ye.rV[3]+s*Math.cos(n*Math.PI/180);let p;const m=a.at(o),g=m===this.currentBestFeature,v=(null===(t=this.currentBestFeature)||void 0===t?void 0:t.attributes.cameraPitch)&&(null===(i=this.currentBestFeature)||void 0===i?void 0:i.attributes.cameraPitch)<5;if(g&&v)p=-90;else{const e=d-Ye.rV[3],t=h-Ye.rV[3],i=t/Math.sqrt(e**2+t**2);let a=180*Math.acos(i)/Math.PI;(e<0&&t<0||e<0&&t>0)&&(a*=-1),p=a}const y=""===c?u:"".concat(c,"_").concat(u);g&&(p===this.bestFeatureAngle?this.previousFeatureAngle=p:this.bestFeatureAngle=p,this.navigatorCurrentBestFeature=v?null:{x:d,y:h,direction:u});const f=this._sectorData[y];f.add({angle:n,featureIndex:o,x:d,y:h,objectID:m.attributes.objectId,sector:y,featureIndexInSector:f.length})}))}_plotLocationPointOnDefaultImage(e){const t=p.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new o.default({geometry:new S.default((0,r.A)({spatialReference:this._imageViewer.imageRenderer.spatialReference},t)),symbol:it.C1}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[i,a]=t,{heading:r,pitch:n}=(0,Y.dM)(e,i,a),s=(0,Y.id)(r,n);this._locationPointOnImage=new o.default({geometry:new S.default(s,z.default.WebMercator),symbol:it.PR}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,i){const{features:a}=e;if(null===a||void 0===a||!a.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:r,polygons:n,frustums:o}=this.filterByFootprints(a,t);if(!r.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let s;if(this.coveragePolygons.addMany(n),this.coverageFrustums.addMany(o),n[0]){var l;let e=new O.default({spatialReference:n[0].spatialReference});for(const i of n)e=await(0,R.union)(e,i);const t=[];for(const{geometry:i}of r)e.contains(i)||t.push([i.x,i.y]);if(t.sort(((e,t)=>+(0,k.$3)([e,t]))),e.addRing(t),this.footprintExtent=(0,we.hs)(e.extent,2,2),null!==(l=this.view)&&void 0!==l&&l.supportsGround)try{s=await this.view.map.ground.createElevationSampler(this.footprintExtent,i)}catch(u){(0,w.isAbortError)(u)||g.A.getLogger(this).error(u)}}if((s||r[0].attributes.elevationSource)&&this.footprintExtent){var c;const e=r[0].attributes.elevationSource;(0,de.jV)(e)&&!s&&(s=await(0,me.gm)({extent:this.footprintExtent,lod:e.lod,url:e.url,rasterFunction:e.rasterFunction}));const i=await(0,Y.Ns)((null!==(c=r[0].attributes.location.z)&&void 0!==c?c:0)-r[0].attributes.cameraHeight,{elevationSample:s,elevationSource:e,extent:this.footprintExtent}),[a,...n]=await(0,pe.A)([t,...r.map((e=>e.attributes.geometry.clone()))],i);r[0].elevationSample=null!==s&&void 0!==s?s:i.elevationSample,t.elevation=a.z,r.forEach(((e,t)=>{e.attributes.elevation=n[t].z}))}r[0].elevationSample&&r.forEach((e=>{e.elevationSample=r[0].elevationSample})),this._suitabilities=le({features:r,selectedPoint:t,camera:(0,Re.Gd)(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,i){var a,r;const{screenPoint:n,results:[o]}=t,s="graphic"===(null===o||void 0===o?void 0:o.type)&&this.shouldShowSelectedImage,l=null!==(a=null===o||void 0===o?void 0:o.mapPoint)&&void 0!==a?a:null===(r=this.view)||void 0===r?void 0:r.toMap(n);if(!l)return;const{layerFloorFilterClause:c}=this,u=e.spatialReference.equals(l.spatialReference)?l:await(0,V.projectWithZConversion)(l,e.spatialReference),d=(0,b.sqlAnd)("1=1",(0,b.sqlAnd)(e.definitionExpression,c)),h=u.spatialReference.isGeographic?1:(0,x.GA)(u.spatialReference),p={layerInstanceOrURL:e,point:u,queryParams:{where:d,maximumDistance:e.maximumDistance?e.maximumDistance/h:void 0,objectIds:s?[o.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(p,i)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach((e=>{e.visible=t}))}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){const{pointSources:t,currentBestFeature:i,currentCoverageVisible:a,isAdditionalPointSourcesVisible:r}=this;if(i&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){var n;await(null===(n=this._adapter)||void 0===n?void 0:n.createFootprints(e)),(0,w.throwIfAborted)(e);for(const e of t)e.imageID===i.attributes.objectId?this.currentBestFeatureLocation=new o.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:it.OO,visible:a}):this.additionalCameraLocations.push(new o.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:it.at,visible:r}))}}_updateCurrentBestFeature(e){var t,i,a;if(!e)return;this.currentBestFeature=null===(t=this.features)||void 0===t?void 0:t.at(e.featureIndex);const r=(null===(i=this.currentBestFeature)||void 0===i?void 0:i.attributes.cameraPitch)&&(null===(a=this.currentBestFeature)||void 0===a?void 0:a.attributes.cameraPitch)<5;let n;if(r)n=-90;else{const t=e.x-Ye.rV[3],i=e.y-Ye.rV[3],a=i/Math.sqrt(t**2+i**2);let r=180*Math.acos(a)/Math.PI;(t<0&&i<0||t<0&&i>0)&&(r*=-1),n=r}n===this.bestFeatureAngle?this.previousFeatureAngle=n:this.bestFeatureAngle=n,this.navigatorCurrentBestFeature=r?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=(0,y.pR)(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=(0,y.pR)(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,i,a){this.displayMessage={key:e,type:t,data:i,map:a}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:i,selectedPoint:a,activeViewer:r}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=(0,y.pR)(this._crossSymbol)),!a||!t||"image-loaded"!==(null===r||void 0===r?void 0:r.state)||i)return;let n;try{n=await this.worldToImage(a,e),(0,w.throwIfAborted)(e),await this.plotSelectedPointOnImage(n,e)}catch(o){(0,w.isAbortError)(o)||g.A.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:o,selectedPoint:a,feature:t})}}async worldToImage(e,t){var i;const{footprintExtent:a}=this,{imageSize:n}=this.activeViewer;if("none"===this.mode||!this.currentBestFeature||!n||!a)return;const{attributes:{location:o,elevationSource:s,cameraHeading:l,elevation:c,cameraHeight:u},elevationSample:d}=this.currentBestFeature;let h=o.clone();const p=await(0,Y.Ns)(null!==c&&void 0!==c?c:(null!==(i=o.z)&&void 0!==i?i:0)-u,{elevationSample:d,elevationSource:s});this.currentBestFeature.elevationSample=p.elevationSample;const m=Array.isArray(e)?e:[e];let g,v=await Promise.all(m.map((e=>new Promise((t=>{if(!e.hasZ)return t((0,pe.A)(e,p));t(e)})))));if(o.spatialReference.isGeographic&&(h=await(0,V.projectWithZConversion)(h,z.default.WebMercator,t)),v=await Promise.all(v.map((async e=>h.spatialReference.equals(e.spatialReference)?e:await(0,V.projectWithZConversion)(e,h.spatialReference,t)))),(0,w.throwIfAborted)(t),"panoramic"===this.mode)g=(0,ge.worldToImagePanoramic)(v,{imageHeight:n[1],imageWidth:n[0],cameraHeading:l,cameraLocation:h});else{const e=(0,Y.cb)(this.currentBestFeature.attributes,n[0],n[1]);g=(0,ge.worldToImage)(v,(0,r.A)((0,r.A)({},e),{},{cameraLocation:h}))}return Array.isArray(e)?g:g[0]}updateCurrentCoveragePolygon(e){const{additionalFootprints:t,additionalCameraLocations:i,currentBestFeature:a,currentBestFeatureLocation:r,currentCoverageVisible:n,selectedPoint:s,view:l,_adapter:c,mode:u}=this,{attributes:{objectId:d},elevationSample:h}=a;var p;if(this._initialCurrentCoverageUpdate){if(null!==(p=this._overlays)&&void 0!==p&&p.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=(0,y.pR)(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=n,this.bestFeatureCurrentFootprint=e),l){const e=[...t,...i,r].filter(Re.DU);l.supportsGround&&h&&null!==c&&void 0!==c&&c.updateGroundElevation&&(this._updateGroundElevation&&c.updateGroundElevation(e,h),"panoramic"===u&&c.updateGroundElevation([this.bestFeatureCurrentFootprint],h)),this._updateGroundElevation=!1,s&&(e.splice(-2,0,this.bestFeatureCurrentFootprint),e.push(new o.default({geometry:s.clone(),symbol:it.pB.clone(),attributes:{imageID:d}}))),this._overlays.graphics.addMany(e)}}else if(l){var m,g;if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&(null!==(m=this._overlays)&&void 0!==m&&m.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=(0,y.pR)(this.bestFeatureCurrentFootprint));const t=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,null!==l&&void 0!==l&&l.supportsGround&&h&&null!==c&&void 0!==c&&c.updateGroundElevation&&"panoramic"===u&&c.updateGroundElevation([e],h),e.visible=this.currentCoverageVisible,null===(g=this._overlays)||void 0===g||g.graphics.add(this.bestFeatureCurrentFootprint,t>=0?t:this._overlays.graphics.length-1))}}};(0,n._)([(0,I.MZ)()],It.prototype,"activeLayer",null),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"activeViewer",null),(0,n._)([(0,I.MZ)()],It.prototype,"accuracyParametersMissing",null),(0,n._)([(0,I.MZ)()],It.prototype,"additionalFeatures",void 0),(0,n._)([(0,I.MZ)({type:c.default.ofType(o.default)})],It.prototype,"additionalCameraLocations",void 0),(0,n._)([(0,I.MZ)({type:c.default.ofType(o.default)})],It.prototype,"additionalFootprints",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"areaMeasurementResult",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"areaMeasurementAccuracy",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"bestFeatureAngle",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"bestFeatureCurrentFootprint",void 0),(0,n._)([(0,I.MZ)({type:o.default})],It.prototype,"bestFeatureFootprint",void 0),(0,n._)([(0,I.MZ)({type:Number})],It.prototype,"brightness",null),(0,n._)([(0,I.MZ)()],It.prototype,"collectionId",void 0),(0,n._)([(0,I.MZ)({type:Number})],It.prototype,"contrast",null),(0,n._)([(0,I.MZ)()],It.prototype,"conversionProps",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"coverageFrustums",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"coveragePolygons",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"currentBestFeature",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"currentBestFeatureLocation",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"currentCoverageVisible",void 0),(0,n._)([(0,I.MZ)({json:{write:!1}})],It.prototype,"determineWorkflowForFeature",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"disabled",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"displayMessage",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"displayNewMeasurementButton",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"distanceMeasurementResult",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"distanceAccuracyArray",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"dataCaptureLayer",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"featureCount",null),(0,n._)([(0,I.MZ)()],It.prototype,"features",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"groundCoordinates",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"heightMeasurementPixels",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"heightGraphic",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"heightMeasurementResult",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"heightMeasurementAccuracy",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"measurementAngle",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"tempDistance",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"imageGalleryEnabled",null),(0,n._)([(0,I.MZ)()],It.prototype,"imageGeometryField",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"imageLoaded",null),(0,n._)([(0,I.MZ)()],It.prototype,"imageLocationToolState",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"invalidCameraHeading",null),(0,n._)([(0,I.MZ)()],It.prototype,"imagePointsInView",null),(0,n._)([(0,I.MZ)()],It.prototype,"isAdditionalCoverageVisible",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"isAdditionalPointSourcesVisible",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"layer",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"layerView",null),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"layerFloorFilterClause",null),(0,n._)([(0,I.MZ)({type:Number})],It.prototype,"localPort",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"mapImageConversionToolState",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"measureType",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"measurementGraphic",void 0),(0,n._)([(0,I.MZ)({readOnly:!0,value:"none"})],It.prototype,"mode",null),(0,n._)([(0,I.MZ)()],It.prototype,"navigatorCurrentBestFeature",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"oiObjectIdField",void 0),(0,n._)([(0,I.MZ)({type:c.default.ofType(o.default)})],It.prototype,"overlayedCameraLocations",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"overlayedMapFeatures",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"pixelCoordinates",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"pointSources",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"popupEnabled",null),(0,n._)([(0,I.MZ)()],It.prototype,"previousFeatureAngle",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"referencePoint",null),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"sectorData",null),(0,n._)([(0,I.MZ)()],It.prototype,"selectedPoint",void 0),(0,n._)([(0,I.MZ)({type:Number})],It.prototype,"sharpness",null),(0,n._)([(0,I.MZ)()],It.prototype,"shouldShowSelectedImage",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"sketch",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"draw",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"sketchAdapter",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"sketchGraphicsLayer",null),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"state",null),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"thumbnails",null),(0,n._)([(0,I.MZ)()],It.prototype,"updateFootprint",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"updateFootprintPanorama",void 0),(0,n._)([(0,I.MZ)({value:null})],It.prototype,"view",null),(0,n._)([(0,I.MZ)()],It.prototype,"_adapter",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_sketchGraphicsLayer",null),(0,n._)([(0,I.MZ)()],It.prototype,"_highlightedFeatureHandle",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_imageViewer",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_initialCurrentCoverageUpdate",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_locationPointOnImage",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_overlays",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"_overlaysView",null),(0,n._)([(0,I.MZ)()],It.prototype,"_panoramicViewer",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_previousCursor",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_referencePointOnGround",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_referencePointOnImage",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_sectorData",void 0),(0,n._)([(0,I.MZ)({readOnly:!0})],It.prototype,"_updatingHandles",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"footprintExtent",void 0),(0,n._)([(0,I.MZ)()],It.prototype,"_featureChangedTask",void 0),It=(0,n._)([(0,P.$)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],It);const Pt=It},86017:(e,t,i)=>{i.d(t,{Eh:()=>I,PT:()=>V,WD:()=>S,ns:()=>M,nt:()=>F,v3:()=>C});var a=i(50346),r=i(44680),n=i(9392),o=i(63919),s=i(20664),l=i(70961),c=i(10851),u=i(66388),d=i(65215),h=i(9624),p=i(13312),m=i(14556),g=i(79629),v=i(56623),y=i(13927),f=i(80963),w=i(97572);const _=Math.PI/180;function M(e){return e.isSpherical?function(e){const{geometry:t,farDistance:i,objectId:a,nearDistance:r,cameraHeight:n}=e,o=(0,w.i2)(t.y,t.spatialReference),s=new l.default({center:t.clone(),radius:i*o});if(s.imageID=a,r){const e=new l.default({center:t.clone(),radius:r*o});s.addRing(e.rings[0])}const u=t.clone();u.z=n-i*o;const d=c.default.createSphere(u,{size:2*i*o});return d.imageID=a,{polygon:s,frustum:d}}(e):function(e){var t;const{horizontalFieldOfView:i,verticalFieldOfView:a,geometry:r,cameraHeading:n}=e,o=(0,w.i2)(r.y,r.spatialReference);let s=e.cameraPitch,l=null!==(t=e.cameraRoll)&&void 0!==t?t:0,c=150;i>150&&(s=90,l=0,c=5);const u=Math.ceil(i/c),h=function(e,t,i){const a=[];if(e%2==0)for(let r=0;r<e/2;r++)a.push(t-i/e*(r+.5),t+i/e*(r+.5));else{a.push(t);for(let r=1;r<e/2;r++)a.push(t-i/e*r,t+i/e*r)}return a.sort(),a}(u,n,i);let p=e.farDistance?e.farDistance*o:e.cameraHeight*o/Math.cos(s*_);e.cameraPitch+a/2>=90&&(p=(e.farDistance||20)*o);const m=new d.default({spatialReference:null===r||void 0===r?void 0:r.spatialReference});m.imageID=e.objectId;let g=null;for(const d of h)g=b(d,s,e.cameraHeight,r,p,o,a,i,u,m,l,e.nearDistance);return g.imageID=e.objectId,{polygon:m,frustum:g}}(e)}function b(e,t,i,a,l,c,u,d,h,p){let m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0;const v=(0,o.mg)((0,r.vt)(),(0,w._i)([e,t,null!==m&&void 0!==m?m:0])),y=A({cameraHeight:i,cameraPitch:t,farDistance:l,location:a,horizontalFieldOfView:d,nearDistance:g,verticalFieldOfView:u},v),f=(0,w.ei)([0,0,-1],v),{x:M,y:b}=a,I=(0,w.MY)([M,b,i],f,l,c),P=2*Math.tan(u*_/2)*l,F=2*Math.tan(d/h*_/2)*l,R=(0,w.ei)([0,1,0],v),C=(0,w.ei)([1,0,0],v),S=(0,w.Qu)(R,P/2,c),O=(0,w.Qu)(C,F/2,c),Z=(0,s.a)((0,n.Ul)(),S,O),V=(0,s.g)((0,n.Ul)(),S,O),z=x([(0,s.g)((0,n.Ul)(),I,Z),(0,s.g)((0,n.Ul)(),I,V),(0,s.a)((0,n.Ul)(),I,Z),(0,s.a)((0,n.Ul)(),I,V)],i,a,c);return z.push(z[0]),p.addRing(z),y}function x(e,t,i,a){return e.map((e=>function(e,t,i,a){{const r=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-i.x)**2+(e[1]-i.y)**2)/a)**2)*a,o=(0,w.Qu)((0,s.a)((0,n.Ul)(),[e[0],e[1],e[2]],[i.x,i.y,t]),1/r,1/a),l=t/(t-e[2]),c={x:(1-l)*i.x+l*e[0],y:(1-l)*i.y+l*e[1],z:(1-l)*t+l*e[2]},u=Math.sqrt((c.z-t)**2+(Math.sqrt((c.x-i.x)**2+(c.y-i.y)**2)/a)**2)*a,d=(0,w.Qu)((0,s.a)((0,n.Ul)(),[c.x,c.y,c.z],[i.x,i.y,t]),1/u,1/a);return P(o[0],d[0])&&P(o[1],d[1])&&P(o[2],d[2])||e[2]>=0?[e[0],e[1],0]:[c.x,c.y,c.z]}}(e,t,i,a)))}function I(e,t){return e.contains(t)}function P(e,t){return Math.sign(e)!==Math.sign(t)}function A(e,t,i){const{cameraHeight:a,cameraPitch:r,farDistance:o,location:l,horizontalFieldOfView:u,nearDistance:d,verticalFieldOfView:h}=e,p=R(l),m=r+h/2>=90==0,g=2*Math.tan(h*_/2)*d,y=2*Math.tan(u*_/2)*d,f=2*Math.tan(h*_/2)*o,M=2*Math.tan(u*_/2)*o;let b,x;x=[0,0,-1],x=(0,w.ei)(x,t),b=(0,w.MY)([l.x,l.y,a],x,o,p),m&&(b[2]=0);const I=(0,w.MY)([l.x,l.y,a],x,d,p);let P=[0,1,0];P=(0,w.ei)(P,t);let A=[1,0,0];A=(0,w.ei)(A,t);let F=[],C=[];d?(C=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],F=F.concat((0,s.g)((0,n.Ul)(),I,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(A,y/2,p)))),F=F.concat((0,s.g)((0,n.Ul)(),I,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(A,y/2,p)))),F=F.concat((0,s.a)((0,n.Ul)(),I,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(A,y/2,p)))),F=F.concat((0,s.a)((0,n.Ul)(),I,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(A,y/2,p))))):(F=[l.x,l.y,a],C=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),F=F.concat((0,s.g)((0,n.Ul)(),b,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,f/2,p),(0,w.Qu)(A,M/2,p)))),F=F.concat((0,s.g)((0,n.Ul)(),b,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,f/2,p),(0,w.Qu)(A,M/2,p)))),F=F.concat((0,s.a)((0,n.Ul)(),b,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,f/2,p),(0,w.Qu)(A,M/2,p)))),F=F.concat((0,s.a)((0,n.Ul)(),b,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,f/2,p),(0,w.Qu)(A,M/2,p))));const S=new v.H({position:Float64Array.from(F)});return new c.default({vertexAttributes:S,components:C,spatialReference:l.spatialReference})}function F(e){const{spatialReference:t,x:i,y:a}=e.geometry,{cameraHeading:r,cameraPitch:n,farDistance:o,nearDistance:s}=e,l=R(e.geometry),c=new d.default({spatialReference:t}),u=Math.abs(1.44*o*l);let h=Math.abs(1.44*s*l);(n<20||null==r)&&(h=u);const p=[];return p[0]={x:i+u*Math.sin((r-45)*_),y:a+u*Math.cos((r-45)*_)},p[1]={x:i+u*Math.sin((r+45)*_),y:a+u*Math.cos((r+45)*_)},p[2]={x:i+h*Math.sin((r+135)*_),y:a+h*Math.cos((r+135)*_)},p[3]={x:i+h*Math.sin((r+225)*_),y:a+h*Math.cos((r+225)*_)},c.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),c}function R(e){return e&&(0,f.K8)(null===e||void 0===e?void 0:e.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/m.$O.radius))):1}function C(e,t){const i=1+t/100;if("esri.geometry.Circle"===e.declaredClass){const{radius:t,center:a}=e,r=new l.default({radius:t*i,center:a});return e.rings.length>1&&r.addRing(e.rings[1]),r}if("esri.geometry.Polygon"===e.declaredClass){const t=new d.default({spatialReference:e.spatialReference}),a=e.centroid;if(a){const r=[];for(let t=0;t<e.rings[0].length;t++){const o=Math.sqrt((a.x-e.rings[0][t][0])**2+(a.y-e.rings[0][t][1])**2),l=(0,w.Qu)((0,s.a)((0,n.Ul)(),[e.rings[0][t][0],e.rings[0][t][1],0],[a.x,a.y,0]),1/o,1),c=(0,w.MY)([a.x,a.y,0],l,o*i,1);r.push({x:c[0],y:c[1]})}t.addRing([[r[0].x,r[0].y,0],[r[1].x,r[1].y,0],[r[2].x,r[2].y,0],[r[3].x,r[3].y,0],[r[0].x,r[0].y,0]])}return t}return e}async function S(e,t,i){const{cameraHeight:a,cameraLocation:r,cameraPitch:n,frustumVertices:o,horizontalFieldOfView:s,imageHeight:l,imageWidth:u,inSRS:d,outSRS:h,verticalFieldOfView:m,cameraRoll:g,options:y}=i,f=new p.default(d),_=new p.default(h),M=(0,w.x1)(s,m,null!==g&&void 0!==g?g:0),b=o.length>15;return n+M.vfov/2>=90?await async function(e,t,i,a,r,n,o,s){let l,u=o?new Array:[e[0],e[1],e[2]],d=new Array;for(const c of t)o?(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),u=u.concat(...l),l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),d=d.concat(...l)):(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[i,0,1],[i,a,1],[0,a,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),u=u.concat(...l));u=u.concat(d);const h=await V(u,r,n,s),p=E(h);return new c.default({vertexAttributes:new v.H({position:h}),components:L(o?k(p,!0):G(p,!0)),spatialReference:n})}(o,e,u,l,f,_,b,y):await async function(e,t,i,a,r,n,o,s,l){var u;const d=function(e,t,i,a,r){const n=z(e),o=z(e,"near");if(!n)return;const s=t.length;for(let c=0;c<s;c++){var l;const e=Array.from(i[c]),t=[e[0]-a[0],e[1]-a[1],e[2]-(null!==(l=a[2])&&void 0!==l?l:r)];Z(a,t,c,o),O(a,t,c,n)}return{farPlane:n,nearPlane:o}}(e,t,i,a,r);if(!d)return;const{farPlane:h,nearPlane:p}=d,m=await V([...null!==(u=null===p||void 0===p?void 0:p.vertexPositions)&&void 0!==u?u:e.slice(0,3),...h.vertexPositions],o,s,l),g=E(m);return new c.default({vertexAttributes:new v.H({position:m}),components:L(n?k(g,!0):G(g,!0)),spatialReference:s})}(o,e,t,r,a,b,f,_,y)}function O(e,t,i,a){const{coefficients:r,vertexPositions:o}=a,s=(0,n.Ul)();(0,y.Ui)(r,{origin:e,direction:t},s)&&o.splice(3*i,3,...s)}function Z(e,t,i,a){if(!a)return;const r=(0,n.Ul)();(0,y.Ui)(a.coefficients,{origin:e,direction:t},r)&&a.vertexPositions.splice(3*i,3,...r)}async function V(e,t,i,r){if(t.equals(i))return e;const n=e.reduce(((e,t,i)=>{const a=Math.floor(i/3);return e[a]||(e[a]=new Array),e[a].push(t),e}),new Array),{points:o}=await(0,h.projectWithZConversion)(new u.default(n,t),i,r);return(0,a.throwIfAborted)(r),o.flat()}function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"far";const i=(0,y.vt)();let a;switch(t){case"far":if(a=Array.from(15===e.length?e.slice(3):e.slice(12)),(0,y.ci)(i,a,!1))return{coefficients:i,vertexPositions:a};break;case"near":if(a=Array.from(e.slice(0,12)),15===e.length||!(0,y.ci)(i,a,!1))return;return{coefficients:i,vertexPositions:a}}}const k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const i=[],a=e/2,r=Math.round((t?e-2:e)/2);for(let n=0;n<r;n++){const r=n+a,o=t?r+1:r,s=o%e,l=(t?r:o+1)%e;i.push({faces:new Uint32Array([n,l,s,n,n+1,s])})}return i};function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const i=[],a=t?e-2:e-1;for(let r=0;r<a;r++)i.push({faces:new Uint32Array([0,r+1,r+2])});return i}const L=e=>e.map((e=>new g.default(e))),E=e=>e.length/3},99464:(e,t,i)=>{i.d(t,{DV:()=>p,Qv:()=>m,gE:()=>d,gl:()=>h,jQ:()=>g,zT:()=>v});var a=i(39356),r=i(50076),n=i(65215),o=i(19902),s=i(97572),l=i(44538),c=i(19562);function u(e,t,i){const a=e.toLowerCase(),r=t.toLowerCase()===a,n=(null===i||void 0===i?void 0:i.toLowerCase())===a;return(0,s.or)(r,n)}function d(e,t,i){return function(e){return"point"===e||"polygon"===e||"polyline"===e}(e.geometryType)&&2===e.fields.filter((e=>{let{name:a,type:r,alias:n}=e;return u(null!==i&&void 0!==i&&i.length?i:l.uS,a,n)||u(null!==t&&void 0!==t&&t.length?t:l.j5,a,n)&&"blob"===r})).length}function h(e){return"feature"===e.type&&function(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}(e)}function p(e,t,i){var a;if(!e)return;const{renderer:r}=e,n=(0,c.dg)(t),o=r?"symbol"in r?r.symbol:"defaultSymbol"in r?r.defaultSymbol:r.getSymbol():null,s=n(null===o||void 0===o?void 0:o.color);i["".concat(t,"Symbol")]=null!==(a=t===e.geometryType?o:null)&&void 0!==a?a:s}function m(e,t,i){const a=e.fields.find((e=>{let{name:i,alias:a,type:r}=e;return u(null!==t&&void 0!==t&&t.length?t:l.j5,i,a)&&"blob"===r})),n=e.fields.find((e=>{let{name:t,alias:a}=e;return u(null!==i&&void 0!==i&&i.length?i:l.uS,t,a)}));if(!a||!n)throw new r.default("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:a,oiObjectIdField:n});return{imageGeometryField:a,oiObjectIdField:n}}function g(e,t,i,n,s,l,u){let d=function(e,t){const{geometry:i}=JSON.parse(atob(e[t]));return(0,o.fromJSON)(i)}(e,t);if(!d)throw new r.default("InvalidGeometry");return d=function(e,t,i){switch(t){case"default":return function(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,i]=e;return[t-.5,.5-i]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,i]=e;return[t-.5,.5-i]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,i]=e;return[t-.5,.5-i]}));break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return f(e,i)}}(d,l,s),new a.default({attributes:e,layer:i,symbol:(0,c.ph)(d.type,i.geometryType,u),geometry:d,visible:i.visible&&n})}function v(e,t,i){switch(t){case"default":return function(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,i]=e;return[t+.5,.5-i]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,i]=e;return[t+.5,.5-i]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,i]=e;return[t+.5,.5-i]}));break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return y(e,i)}}function y(e,t){switch(e.type){case"point":{const{x:i,y:a}=(0,s.pq)(e,t[0],t[1]);e.x=i,e.y=a,delete e.z;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const{x:i,y:a}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[i,a]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const{x:i,y:a}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[i,a]}))));break;case"multipoint":e.points=e.points.map((e=>{const{x:i,y:a}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[i,a]}));break;case"extent":{const{xmin:i,xmax:a,ymin:r,ymax:o}=y(n.default.fromExtent(e),t).extent;e.xmax=a,e.xmin=i,e.ymax=o,e.ymin=r;break}}return e}function f(e,t){switch(e.type){case"point":{const[i,a,r]=(0,s.D5)(e,t[0],t[1]);e.x=i,e.y=a,e.z=r;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const[i,a,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[i,a,r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const[i,a,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[i,a,r]}))));break;case"multipoint":e.points=e.points.map((e=>{const[i,a,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[i,a,r]}));break;case"extent":{const{xmin:i,xmax:a,ymin:r,ymax:o}=f(n.default.fromExtent(e),t).extent;e.xmax=a,e.xmin=i,e.ymax=o,e.ymin=r}}return e}}}]);
//# sourceMappingURL=61618.8422cdce.chunk.js.map