"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[87606,98156],{43543:(e,t,i)=>{i.d(t,{F:()=>r});var n=i(98156);function r(e,t,i){if(null==(null===e||void 0===e?void 0:e.timeInfo))return null;const{datesInUnknownTimezone:r=!1,timeOffset:a,useViewTime:s}=e;let l=e.timeExtent;r&&(l=(0,n.toLocalTimeExtent)(l));let o=s?t&&l?t.intersection(l):t||l:l;return!o||o.isEmpty||o.isAllTime?o:(a&&(o=o.offset(-a.value,a.unit)),r&&(o=(0,n.toUTCTimeExtent)(o)),o.equals(i)?i:o)}},56287:(e,t,i)=>{i.d(t,{r:()=>o});var n=i(35143),r=i(91967),a=i(46053),s=(i(81806),i(76460),i(47249),i(85842));const l={visible:"visibleSublayers"};let o=class extends r.default{constructor(e){super(e),this.scale=0}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.sublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("wms-sublayer-update",(e=>this.notifyChange(l[e.propertyName])))],"layer"))}get layers(){return this.visibleSublayers.filter((e=>{let{name:t}=e;return t})).map((e=>{let{name:t}=e;return t})).join()}get version(){this.commitProperty("layers");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:t}=this,i=null===e||void 0===e?void 0:e.sublayers,n=[],r=e=>{const{minScale:i,maxScale:a,sublayers:s,visible:l}=e;l&&(0===t||(0===i||t<=i)&&(0===a||t>=a))&&(s?s.forEach(r):n.push(e))};return null!==i&&void 0!==i&&i.forEach(r),n}toJSON(){const{layer:e,layers:t}=this,{imageFormat:i,imageTransparency:n,version:r}=e;return{format:i,request:"GetMap",service:"WMS",styles:"",transparent:n?"TRUE":"FALSE",version:r,layers:t}}};(0,n._)([(0,a.MZ)()],o.prototype,"layer",null),(0,n._)([(0,a.MZ)({readOnly:!0})],o.prototype,"layers",null),(0,n._)([(0,a.MZ)({type:Number})],o.prototype,"scale",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],o.prototype,"version",null),(0,n._)([(0,a.MZ)({readOnly:!0})],o.prototype,"visibleSublayers",null),o=(0,n._)([(0,s.$)("esri.layers.support.ExportWMSImageParameters")],o)},87606:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var n=i(89379),r=i(35143),a=i(76460),s=i(30726),l=i(50346),o=i(68134),u=i(46053),d=(i(81806),i(47249),i(85842)),m=i(76797),c=i(14509),p=i(2101),h=i(4176),f=i(91196),y=i(771),v=i(96537);let g=class extends((0,v.A)((0,y.A)((0,p.e)(f.default)))){constructor(){super(...arguments),this.bitmapContainer=new c.l}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}update(e){this.strategy.update(e).catch((e=>{(0,l.isAbortError)(e)||a.A.getLogger(this).error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:i}=e;this.bitmapContainer=new c.l,this.container.addChild(this.bitmapContainer),this.strategy=new h.A({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,o.watch)((()=>this.exportImageVersion),(()=>this.requestUpdate())))}detach(){this.strategy=(0,s.pR)(this.strategy),this.container.removeAllChildren()}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t,bitmapContainer:i}=this,{x:n,y:r}=e,{spatialReference:a}=t;let s,l=0,o=0;if(i.children.some((e=>{const{width:t,height:i,resolution:u,x:d,y:c}=e,p=d+u*t,h=c-u*i;return n>=d&&n<=p&&r<=c&&r>=h&&(s=new m.default({xmin:d,ymin:h,xmax:p,ymax:c,spatialReference:a}),l=t,o=i,!0)})),!s)return null;const u=s.width/l,d=Math.round((n-s.xmin)/u),c=Math.round((s.ymax-r)/u);return{extent:s,width:l,height:o,x:d,y:c}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,i,r){return this.layer.fetchImageBitmap(e,t,i,(0,n.A)({timeExtent:this.timeExtent},r))}};(0,r._)([(0,u.MZ)()],g.prototype,"strategy",void 0),(0,r._)([(0,u.MZ)()],g.prototype,"updating",void 0),g=(0,r._)([(0,d.$)("esri.views.2d.layers.WMSLayerView2D")],g);const w=g},96537:(e,t,i)=>{i.d(t,{A:()=>m});var n=i(35143),r=i(50076),a=i(30726),s=i(50346),l=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),u=i(56287),d=i(43543);const m=e=>{let t=class extends e{initialize(){this.exportImageParameters=new u.r({layer:this.layer})}destroy(){this.exportImageParameters=(0,a.pR)(this.exportImageParameters)}get exportImageVersion(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var e;return(0,d.F)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new r.default("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:n}=i;if(!n)throw new r.default("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:n});const a=this.createFetchPopupFeaturesQuery(e);if(!a)return[];const{extent:l,width:o,height:u,x:d,y:m}=a;if(!(l&&o&&u))throw new r.default("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:l,width:o,height:u});const c=await i.fetchFeatureInfo(l,o,u,d,m);return(0,s.throwIfAborted)(t),c}};return(0,n._)([(0,l.MZ)()],t.prototype,"exportImageParameters",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,n._)([(0,l.MZ)()],t.prototype,"layer",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),t=(0,n._)([(0,o.$)("esri.views.layers.WMSLayerView")],t),t}},98156:(e,t,i)=>{i.r(t),i.d(t,{getTimeExtentFromLayers:()=>c,getTimeSliderSettingsFromWebDocument:()=>h,toLocalTimeExtent:()=>y,toUTCTimeExtent:()=>f});var n=i(18690),r=i(53084),a=i(18288),s=i(59187),l=i(42052),o=i(72027);function u(e){return void 0!==e.timeInfo}async function d(e,t){var i,n;return null!==(i=null===(n=e.widgets)||void 0===n||null===(n=n.timeSlider)||void 0===n?void 0:n.fullTimeExtent)&&void 0!==i?i:c(e.allLayers,t)}function m(e){const{numStops:t,stopInterval:i,stops:n}=e;return n?{dates:(0,r.clone)(n)}:i?{interval:i.clone()}:{count:null!==t&&void 0!==t?t:5}}async function c(e,t){if(0===e.length)return s.default.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const i=e.filter(u),r=e.filter((e=>!u(e)&&null!=e.visibilityTimeExtent));if(0===i.length&&0===r.length)return s.default.allTime;const a=[],l=[];for(const n of i){var o;"feature"!==(null===n||void 0===n?void 0:n.type)&&"map-image"!==(null===n||void 0===n?void 0:n.type)||null===(o=n.timeInfo)||void 0===o||!o.hasLiveData?l.push(n):a.push(n)}const d=e=>null==e||e.isAllTime,m=[...l.map((e=>{var t,i;const n=null===(t=e.timeInfo)||void 0===t?void 0:t.fullTimeExtent,{visibilityTimeExtent:r}=e;return null!==(i=null===n||void 0===n?void 0:n.intersection(r))&&void 0!==i?i:r})),...r.map((e=>e.visibilityTimeExtent))];if(m.some(d))return s.default.allTime;const c=a.map((async e=>{var i,n,r,a;const s=null!==(i=null===(n=await e.fetchRecomputedExtents({signal:t}))||void 0===n?void 0:n.timeExtent)&&void 0!==i?i:null===(r=e.timeInfo)||void 0===r?void 0:r.fullTimeExtent,{visibilityTimeExtent:l}=e;return null!==(a=null===s||void 0===s?void 0:s.intersection(l))&&void 0!==a?a:l})),p=(await Promise.allSettled(c)).map((e=>"fulfilled"===e.status?e.value:null));if(p.some(d))return s.default.allTime;const h=[...p,...m].filter(n.Ru);return 0===h.length?s.default.allTime:h.reduce(((e,t)=>e.union(t)))}function p(e,t){var i;const n=e.currentTimeExtent;if(!n)return null;const{start:r,end:a}=n,l=null!==(i=null!==r&&void 0!==r?r:a)&&void 0!==i?i:null;switch(t){case"time-window":return new s.default({start:r,end:a});case"cumulative-from-start":return new s.default({start:null,end:l});case"cumulative-from-end":return new s.default({start:l,end:null});case"instant":return new s.default({start:l,end:l})}}async function h(e,t){var i,n;if(!(0,l.r)(e)&&!function(e){return null!=e&&"object"==typeof e&&o.X in e}(e))return null;await e.load({signal:t});const r=null===e||void 0===e||null===(i=e.widgets)||void 0===i?void 0:i.timeSlider;if(!r)return null;const a=await d(e,t),s=r.loop,u=function(e){var t;const i=null!==(t=e.numThumbs)&&void 0!==t?t:2,n=e.currentTimeExtent;if(n){const{start:e,end:t}=n;return null!=e&&null!=t&&e.getTime()===t.getTime()?"instant":2===i?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===i?"time-window":"cumulative-from-start"}(r);return{fullTimeExtent:a,loop:s,mode:u,playRate:null!==(n=r.stopDelay)&&void 0!==n?n:2e3,stops:m(r),timeExtent:p(r,u)}}function f(e){if(!e)return e;const{start:t,end:i}=e;return new s.default({start:null!=t?(0,a.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,a.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}function y(e){if(!e)return e;const{start:t,end:i}=e;return new s.default({start:null!=t?(0,a.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,a.S1)(i,i.getTimezoneOffset(),"minutes"):i})}}}]);
//# sourceMappingURL=87606.ce115810.chunk.js.map