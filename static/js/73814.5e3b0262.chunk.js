"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[73814],{11668:(e,t,a)=>{a.d(t,{K:()=>p,Q:()=>i});var r=a(53986),n=a(67061);const l=["loadContext"],o=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function i(e,t){var a;const o=t||{},{loadContext:i}=o,u=(0,r.A)(o,l),s=i?await i.fetchServiceMetadata(e,u):await(0,n.V)(e,u);v(s),c(s);const d={serviceJSON:s};if((null!==(a=s.currentVersion)&&void 0!==a?a:0)<10.5)return d;const y="".concat(e,"/layers"),p=i?await i.fetchServiceMetadata(y,u):await(0,n.V)(y,u);return v(p),c(p),d.layersJSON={layers:p.layers,tables:p.tables},d}function u(e){const{type:t}=e;return!!t&&o.has(t)}function s(e){return"Table"===e.type}function c(e){var t,a;e.layers=null===(t=e.layers)||void 0===t?void 0:t.filter(u),e.tables=null===(a=e.tables)||void 0===a?void 0:a.filter(s)}function d(e){e.type||(e.type="Feature Layer")}function y(e){e.type||(e.type="Table")}function v(e){var t,a;null!==(t=e.layers)&&void 0!==t&&t.forEach(d),null===(a=e.tables)||void 0===a||a.forEach(y)}function p(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},64130:(e,t,a)=>{a.d(t,{Ju:()=>s,K8:()=>y,XH:()=>c,_r:()=>l,bO:()=>o,l:()=>d,nu:()=>v,pJ:()=>i,rc:()=>u});var r=a(39323),n=a(11668);function l(e){const t={id:e.id,name:e.name},a=(0,n.K)(e.type);return"FeatureLayer"!==a&&(t.layerType=a),t}async function o(e,t,a){var r,n;if(null==(null===(r=e)||void 0===r?void 0:r.layers)||null==(null===(n=e)||void 0===n?void 0:n.tables)){var o,u,s;const r=await a.fetchServiceMetadata(t,{customParameters:null===(o=i(e))||void 0===o?void 0:o.customParameters});(e=e||{}).layers=e.layers||(null===r||void 0===r||null===(u=r.layers)||void 0===u?void 0:u.map(l)),e.tables=e.tables||(null===r||void 0===r||null===(s=r.tables)||void 0===s?void 0:s.map(l))}return e}function i(e){if(!e)return null;const{layers:t,tables:a}=e;return null!==t&&void 0!==t&&t.length?t[0]:null!==a&&void 0!==a&&a.length?a[0]:null}function u(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find((e=>e.id===t))}function s(e,t){return[...e.layers||[],...e.tables||[]].filter((e=>{let{layerType:a}=e;return a?t.includes(a):t.includes("ArcGISFeatureLayer")}))}function c(e){var t,a,r,n;return(null!==(t=null===e||void 0===e||null===(a=e.layers)||void 0===a?void 0:a.length)&&void 0!==t?t:0)+(null!==(r=null===e||void 0===e||null===(n=e.tables)||void 0===n?void 0:n.length)&&void 0!==r?r:0)}function d(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function y(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function v(e,t,a){var n;if(null===e||void 0===e||!e.url)return null!==t&&void 0!==t?t:{};if(null!==t&&void 0!==t||(t={}),!t.layers){var o;const r=await a.fetchServiceMetadata(e.url);t.layers=null===(o=r.layers)||void 0===o?void 0:o.map(l)}const{serverUrl:u,portalItem:s}=await(0,r.L)(e.url,{sceneLayerItem:e,customParameters:null===(n=i(t))||void 0===n?void 0:n.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(null==u)return t.tables=[],t;if(!t.tables&&s){const e=await s.fetchData().catch((()=>null));if(null!==e&&void 0!==e&&e.tables)t.tables=e.tables.map(l);else{var c,d;const r=await a.fetchServiceMetadata(u,{customParameters:null===(c=i(e))||void 0===c?void 0:c.customParameters}).catch((()=>null));t.tables=null===r||void 0===r||null===(d=r.tables)||void 0===d?void 0:d.map(l)}}if(t.tables)for(const r of t.tables)r.url="".concat(u,"/").concat(r.id);return t}},67061:(e,t,a)=>{a.d(t,{V:()=>l});var r=a(89379),n=a(3825);async function l(e,t){const{data:a}=await(0,n.default)(e,{responseType:"json",query:(0,r.A)((0,r.A)({f:"json"},null===t||void 0===t?void 0:t.customParameters),{},{token:null===t||void 0===t?void 0:t.apiKey})});return a}},73814:(e,t,a)=>{a.d(t,{load:()=>v});var r=a(50076),n=a(13096),l=a(11668),o=a(77491),i=a(24883),u=a(79942),s=a(64130),c=a(72945),d=a(81589),y=a(67061);async function v(e,t){const a=e.instance.portalItem;if(null!==a&&void 0!==a&&a.id)return await a.load(t),function(e){const t=e.instance.portalItem;if(null===t||void 0===t||!t.type||!e.supportedTypes.includes(t.type))throw new r.default("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:null===t||void 0===t?void 0:t.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(a),async function(e,t){var a;const n=e.instance,i=n.portalItem;if(!i)return;const{url:v,title:f}=i,h=(0,u.v)(i,"portal-item");if("group"===n.type)return async function(e,t,a){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:d}=n;if("Group Layer"===d){if(!(0,c.Y)(n,"Map"))throw new r.default("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){var a;const n=e.portalItem,l=await n.fetchData("json");if(!l)return;if(!t.populateGroupLayer)throw new r.default("portal:missing-populate-group-layer","Missing populate group layer");const o=(0,u.v)(n,"web-map");e.read(l,o),await t.populateGroupLayer(e,l,{context:o}),e.resourceReferences={portalItem:n,paths:null!==(a=o.readResourcePaths)&&void 0!==a?a:[]}}(e,a)}return e.read({title:i},t),async function(e,t){let a;const{portalItem:n}=e;if(!n)return;const i=n.type,u=t.layerModuleTypeMap;if(!u)throw new r.default("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(i){case"Feature Service":case"Feature Collection":a=u.FeatureLayer;break;case"Stream Service":a=u.StreamLayer;break;case"Scene Service":a=u.SceneLayer;break;default:throw new r.default("portal:unsupported-item-type-as-group","The item type '".concat(i,"' is not supported as a 'IGroupLayer'"))}const c=new o.v;let[d,v]=await Promise.all([a(),m(t,c)]),f=()=>d;if("Feature Service"===i){var h;const t=null===(h=(0,s.pJ)(v))||void 0===h?void 0:h.customParameters;v=n.url?await(0,s.bO)(v,n.url,c):{},f=await async function(e,t){const{layers:a,tables:r}=e,n=[...null!==a&&void 0!==a?a:[],...null!==r&&void 0!==r?r:[]];if(!n.length)return;const l=new Set,o=[];for(const{layerType:c}of n){const e=null!==c&&void 0!==c?c:"ArcGISFeatureLayer";if(l.has(e))continue;l.add(e);const a=t[(0,s.K8)(e)];o.push(a())}const i=await Promise.all(o),u=new Map;return Array.from(l).forEach(((e,t)=>{u.set(e,i[t])})),e=>{let{layerType:t}=e;const a=null!==t&&void 0!==t?t:"ArcGISFeatureLayer";return u.get(a)}}(v,u)||f;const a=await async function(e,t){const{layersJSON:a}=await(0,l.Q)(e,t);if(!a)return null;const r=[...a.layers,...a.tables];return e=>r.find((t=>t.id===e.id))}(n.url,{customParameters:t,loadContext:c});return await p(e,f,f,v,u,a)}return"Scene Service"===i&&n.url&&(v=await(0,s.nu)(n,v,c)),(0,s.XH)(v)>0?await p(e,f,null,v,u):await async function(e,t,a){var r,n;const{portalItem:l}=e;if(null===l||void 0===l||!l.url)return;const o=await(0,y.V)(l.url);o&&p(e,t,null,{layers:null===(r=o.layers)||void 0===r?void 0:r.map(s._r),tables:null===(n=o.tables)||void 0===n?void 0:n.map(s._r)},a)}(e,f,u)}(e,a)}(n,h,e);v&&"media"!==n.type&&n.read({url:v},h);const w=new o.v,b=await m(e,w,t);return b&&n.read(b,h),n.resourceReferences={portalItem:i,paths:null!==(a=h.readResourcePaths)&&void 0!==a?a:[]},"subtype-group"!==n.type&&n.read({title:f},h),(0,d.L)(n,h)}(e,t)}async function p(e,t,a,r,n,l){var o;let i=r.layers||[];const u=r.tables||[];if("Feature Collection"===(null===(o=e.portalItem)||void 0===o?void 0:o.type)?(i.forEach(((e,t)=>{var a;e.id=t,"Table"===(null===e||void 0===e||null===(a=e.layerDefinition)||void 0===a?void 0:a.type)&&u.push(e)})),i=i.filter((e=>{var t;return"Table"!==(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)}))):(i.reverse(),u.reverse()),i.forEach((a=>{const n=null===l||void 0===l?void 0:l(a);if(n||!l){const l=f(e,t(a),r,a,n);e.add(l)}})),u.length){const t=a?null:await n.FeatureLayer();u.forEach((n=>{const o=null===l||void 0===l?void 0:l(n);if(o||!l){const l=f(e,a?a(n):t,r,n,o);e.tables.add(l)}}))}}function f(e,t,a,r,n){const l=e.portalItem,o={portalItem:l.clone(),layerId:r.id};null!=r.url&&(o.url=r.url);const u=new t(o);if("sourceJSON"in u&&(u.sourceJSON=n),"subtype-group"!==u.type&&"catalog"!==u.type&&(u.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const e={origin:"portal-item",portal:l.portal||i.default.getDefault()};u.read(r,e);const t=a.showLegend;null!=t&&u.read({showLegend:t},e)}return u}async function m(e,t,a){if(!1===e.supportsData)return;const r=e.instance,l=r.portalItem;if(!l)return;let o=null;try{o=await l.fetchData("json",a)}catch(d){}if(function(e){return"stream"!==e.type&&"layerId"in e}(r)){var i,u;let e=null;const a=await async function(e,t,a){var r,l,o,i,u,c,d,y,v;if(null!==t&&void 0!==t&&t.layers&&null!==t&&void 0!==t&&t.tables)return(0,s.XH)(t);const p=(0,n.qg)(e.url);if(!p)return 1;const f=await a.fetchServiceMetadata(p.url.path,{customParameters:null===(r=(0,s.pJ)(t))||void 0===r?void 0:r.customParameters}).catch((()=>null));return(null!==(l=null!==(o=null===t||void 0===t||null===(i=t.layers)||void 0===i?void 0:i.length)&&void 0!==o?o:null===f||void 0===f||null===(u=f.layers)||void 0===u?void 0:u.length)&&void 0!==l?l:0)+(null!==(c=null!==(d=null===t||void 0===t||null===(y=t.tables)||void 0===y?void 0:y.length)&&void 0!==d?d:null===f||void 0===f||null===(v=f.tables)||void 0===v?void 0:v.length)&&void 0!==c?c:0)}(l,o,t);if((null!==(i=o)&&void 0!==i&&i.layers||null!==(u=o)&&void 0!==u&&u.tables)&&a>0){var c;if(null==r.layerId){const e=(0,s.l)(r.type),t=null!==e&&void 0!==e&&e.length?(0,s.Ju)(o,e)[0]:(0,s.pJ)(o);t&&(r.layerId=t.id)}e=function(e,t){var a,r;const{layerId:n}=t,l=(null===(a=e.layers)||void 0===a?void 0:a.find((e=>e.id===n)))||(null===(r=e.tables)||void 0===r?void 0:r.find((e=>e.id===n)));return l&&function(e,t){const a="layerType"in e&&e.layerType,{type:r}=t;return!("feature"===r&&a&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===r&&!a||"oriented-imagery"===r&&!a||"subtype-group"===r&&!a)}(l,t)?l:null}(o,r),"OrientedImageryLayer"===(null===(c=e)||void 0===c?void 0:c.layerType)&&"oriented-imagery"===r.type&&r.supportedSourceTypes.add("Feature Layer"),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return a>1&&"sublayerTitleMode"in r&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),e}return o}},77491:(e,t,a)=>{a.d(t,{v:()=>n});var r=a(67061);class n{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){const a=this._serviceMetadatas.get(e);if(a)return a;const n=await(0,r.V)(e,t);return this._serviceMetadatas.set(e,n),n}async fetchItemData(e){const{id:t}=e;if(!t)return null;const{_itemDatas:a}=this;if(a.has(t))return a.get(t);const r=await e.fetchData();return a.set(t,r),r}async fetchCustomParameters(e,t){const a=await this.fetchItemData(e);return a&&"object"==typeof a&&(t?t(a):a.customParameters)||null}}}}]);
//# sourceMappingURL=73814.5e3b0262.chunk.js.map