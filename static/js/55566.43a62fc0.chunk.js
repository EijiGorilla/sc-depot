"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[55566],{44371:(e,t,i)=>{i.d(t,{A:()=>a});var s=i(35143),o=i(46053),n=(i(81806),i(76460),i(47249),i(85842)),r=i(68999);let l=class extends r.A{constructor(e){super(e),this.visible=!1}};(0,s._)([(0,o.MZ)()],l.prototype,"visible",void 0),l=(0,s._)([(0,n.$)("esri.widgets.Spinner.SpinnerViewModel")],l);const a=l},55051:(e,t,i)=>{i.d(t,{A:()=>o});const s="esri-features",o={icon:"".concat(s,"__icon"),actionImage:"".concat(s,"__action-image"),base:s,container:"".concat(s,"__container"),contentContainer:"".concat(s,"__content-container"),contentFeature:"".concat(s,"__content-feature"),flowItemCollapsed:"".concat(s,"__flow-item--collapsed"),header:"".concat(s,"__header"),footer:"".concat(s,"__footer"),featureMenuObserver:"".concat(s,"__feature-menu-observer"),actionExit:"".concat(s,"__action--exit"),loader:"".concat(s,"__loader"),featuresHeading:"".concat(s,"__heading"),paginationText:"".concat(s,"__pagination-text"),paginationActionBar:"".concat(s,"__pagination-action-bar"),paginationMenuButton:"".concat(s,"__pagination-menu-button"),paginationPrevious:"".concat(s,"__pagination-previous"),paginationNext:"".concat(s,"__pagination-next")}},55191:(e,t,i)=>{i.d(t,{A:()=>_});var s=i(35143),o=i(50346),n=i(68134),r=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),a=i(25329),c=i(44371),d=(i(76099),i(54761));const u="esri-spinner",h=u,p="".concat(u,"--start"),g="".concat(u,"--finish");let v=class extends a.default{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new c.A}initialize(){this.addHandles((0,n.watch)((()=>this.visible),(e=>this._visibleChange(e))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:i}=null!==e&&void 0!==e?e:{};t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,s=e&&i,o=!e&&i,n={[p]:s,[g]:o},r=this._getPositionStyles();return(0,d.K)("div",{class:this.classes(h,n),styles:r})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,o.after)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(null==t||null==e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,s._)([(0,r.MZ)()],v.prototype,"location",null),(0,s._)([(0,r.MZ)()],v.prototype,"view",null),(0,s._)([(0,r.MZ)({type:c.A})],v.prototype,"viewModel",void 0),(0,s._)([(0,r.MZ)()],v.prototype,"visible",null),v=(0,s._)([(0,l.$)("esri.widgets.Spinner")],v);const _=v},55566:(e,t,i)=>{i.r(t),i.d(t,{default:()=>te});var s=i(35143),o=i(63241),n=i(76460),r=i(68134),l=i(46053),a=(i(81806),i(47249),i(85842)),c=i(19451),d=i(72599),u=i(31933),h=i(68295),p=i(25329),g=i(94126),v=i(98108),_=i(76099),w=i(63582),m=i(12254),b=i(54761),y=(i(11265),i(19276)),f=i(79468),M=i(63860),T=(i(75900),i(56362),i(87015),i(81940),i(6929),i(7198),i(93616),i(53539),i(91904)),A=i(38623),k=i(73757),S=i(55191),F=i(54062),C=i(30899),N=i(55051),R=i(17483),K=i(85012),I=i(61640),x=i(87540),P=i(39348);const B=K.RP.clone(),Z="esri-utility-network-trace",O={base:Z,featureContent:"".concat(Z,"__feature-content")};let W=class extends p.default{constructor(e,t){super(e,t),this._utilityNetworkTraceMessages=null,this.closed=!1,this.closable=!0,this.messages=null,this.messagesCommon=null,this._handleAddNonspatialTraceLocation=e=>{this.emit("add-nso-trace-location",{featureWidget:e})},this._handleOpenFeature=e=>{this.emit("open-feature",{feature:e})},this._handleZoomToFeature=e=>{this.emit("zoom-to-feature",{featureWidget:e})}}initialize(){(async()=>{this._utilityNetworkTraceMessages=await(0,M.ud)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")})()}loadDependencies(){return(0,g.W)({action:()=>Promise.resolve().then(i.bind(i,85375)),"action-bar":()=>Promise.resolve().then(i.bind(i,143)),"action-group":()=>Promise.resolve().then(i.bind(i,97577)),"flow-item":()=>i.e(68445).then(i.bind(i,68445))})}get mode(){return this._get("mode")||"show-feature-info"}set mode(e){this._set("mode",e)}render(){const{flowItems:e}=this,t=null===e||void 0===e?void 0:e.toArray();return(0,b.K)(b.w,null,null===t||void 0===t?void 0:t.map(((t,i)=>this._renderFlowItem(t,i===e.length-1))))}_renderAddNonspatialTraceLocationAction(e){const{_utilityNetworkTraceMessages:t}=this;return(0,b.K)("calcite-action",{appearance:"solid",bind:this,icon:"utility-network-trace",onclick:()=>this._handleAddNonspatialTraceLocation(e),scale:"s",text:t.inputsStrings.addNonspatialOption,textEnabled:!0,title:t.inputsStrings.addNonspatialOption})}_renderFlowItem(e,t){var i,s;const{messages:o,closable:n,closed:r}=this,l="graphic"in e&&!e.isTable,a="feature-association"===e.flowType,c=this._getExitMessage(e),d=o.selectFeature,u=e?null===(i=e.graphic)||void 0===i?void 0:i.layer:null,h=!(u&&u.geometryType);return(0,b.K)("calcite-flow-item",{bind:this,closable:n,closed:r,description:this._getDrillInFlowItemDescription(e),heading:null!==(s=e.title)&&void 0!==s?s:"",key:"flow-item-".concat(e.viewModel.uid),selected:t,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleDrillInBackClick()}},(0,b.K)("calcite-action",{appearance:"transparent",bind:this,class:N.A.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:c,title:c}),l?(0,b.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(e),slot:"header-actions-end",text:d,title:d}):null,"show-feature-info"===this.mode?(0,b.K)("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,a&&"add-nso"===this.mode?(0,b.K)("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,b.K)("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},h?this._renderAddNonspatialTraceLocationAction(e):this._renderZoomToFeatureAction(e))):null,(0,b.K)("div",{class:this.classes(N.A.container,O.featureContent)},e.render()))}_renderZoomToFeatureAction(e){var t;const i=this._getActionTitle(B);return(0,b.K)("calcite-action",{active:B.active,appearance:"solid",bind:this,"data-action-uid":B.uid,disabled:B.disabled,icon:null!==(t=B.icon)&&void 0!==t?t:"question",indicator:B.indicator,key:"action-".concat(B.uid),loading:B.active,onclick:()=>this._handleZoomToFeature(e),scale:"s",text:i,textEnabled:!0,title:i})}_getActionTitle(e){var t;const{messages:i}=this,{id:s}=e,o=null!==(t=e.title)&&void 0!==t?t:"";return"zoom-to-feature"===s?(0,P.V)(o,{messages:i}):o}_getDrillInFlowItemDescription(e){var t,i;switch(e.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return null!==(t=e.viewModel.description)&&void 0!==t?t:"";case"feature-relationship":return e.allItemsDescription;case"feature-utility-network-association-type":return null!==(i=e.description)&&void 0!==i?i:""}}_getExitMessage(e){switch(e.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_handleDrillInBackClick(){var e;const t=null===(e=this.flowItems)||void 0===e?void 0:e.pop();t&&("showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}_handleExitClick(){this.emit("exit")}};(0,s._)([(0,l.MZ)()],W.prototype,"closed",void 0),(0,s._)([(0,l.MZ)()],W.prototype,"closable",void 0),(0,s._)([(0,l.MZ)()],W.prototype,"flowItems",void 0),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/widgets/Features/t9n/Features")],W.prototype,"messages",void 0),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/t9n/common")],W.prototype,"messagesCommon",void 0),(0,s._)([(0,l.MZ)()],W.prototype,"mode",null),W=(0,s._)([(0,a.$)("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeaturesDrillIn")],W);const E=W,D="features-spinner",L="esri-utility-network-trace",G={base:L,blockContainer:"".concat(L,"__block-container"),blockContent:"".concat(L,"__block-content"),featureContent:"".concat(L,"__feature-content"),paddingBottom:"".concat(L,"__pad-bottom"),paddingTop:"".concat(L,"__pad-top")};let H=class extends((0,C.j)(p.default)){constructor(e,t){super(e,t),this._actionBarMenuNode=null,this._drillInFlowItems=new y.default,this._drillInWidget=new E({flowItems:this._drillInFlowItems}),this._feature=null,this._featureMenuViewportNode=null,this._spinner=null,this._utilityNetworkTraceMessages=null,this.featureNavigationTop=!1,this.headerActions=new K.E$,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new R.default,this._renderAction=(e,t)=>{const i=this._getActionTitle(e),{type:s,active:o,uid:n,disabled:r,indicator:l}=e;return e.visible?(0,b.K)("calcite-action",{active:"toggle"===s&&e.value,appearance:"solid",bind:this,"data-action-uid":n,disabled:"zoom-to-feature"===e.id?!this.feature.geometry:r,icon:this._getActionIcon(e),indicator:l,key:"action-".concat(t),loading:o,onclick:this._triggerAction,scale:"s",text:i,title:this._hideActionText?i:void 0},this._renderFallbackIcon(e)):null},this._renderAddNsoBlock=()=>{const{_utilityNetworkTraceMessages:e,messagesCommon:t}=this;return(0,b.K)("calcite-block",{class:G.blockContent,heading:null===e||void 0===e?void 0:e.inputsStrings.addNonspatialOption,open:!this.feature},(0,b.K)("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:t.close}),(0,b.K)("calcite-notice",{icon:"information",kind:"info",open:!this.feature},(0,b.K)("div",{slot:"message"},null===e||void 0===e?void 0:e.inputsStrings.addNonspatialHint)))},this._renderNoAssociationNotice=()=>{const{_utilityNetworkTraceMessages:e}=this;return(0,b.K)("calcite-notice",{class:this.classes(G.paddingBottom,G.paddingTop),icon:"exclamation-mark-triangle",kind:"danger",open:!0},(0,b.K)("div",{slot:"message"},e.alertsStrings.noAssociationsConfigured))},this._renderNoPopupErrorBlock=()=>{const{_utilityNetworkTraceMessages:e,messagesCommon:t}=this;return(0,b.K)("calcite-block",{description:void 0,heading:"show-feature-info"===this.mode?t.warning:void 0,open:!0},(0,b.K)("calcite-notice",{class:this.classes(G.paddingBottom,G.paddingTop),icon:"exclamation-mark-triangle",kind:"danger",open:!0},(0,b.K)("div",{slot:"message"},e.alertsStrings.noPopupConfigured)),"show-feature-info"===this.mode?(0,b.K)("calcite-action",{icon:"x",onclick:()=>this.emit("close-un-trace-feature-block"),slot:"control",text:t.close}):void 0)},this._displaySpinnerThrottled=(0,f.n)((()=>this._displaySpinner()),0),this.addHandles([this._displaySpinnerThrottled,(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.active}),(e=>this._drillInWidget.closed=!e)),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.view}),((e,t)=>this._viewChange(e,t))),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.ready}),((e,t)=>this._viewReadyChange(null!==e&&void 0!==e&&e,null!==t&&void 0!==t&&t))),(0,r.watch)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.waitingForResult,null===(t=this.viewModel)||void 0===t?void 0:t.location]}),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.screenLocation}),(()=>this._closeOpenActionMenu())),(0,r.watch)((()=>this.selectedFeatureWidget),(()=>this._destroyDrillInFlowItemWidgets())),(0,r.watch)((()=>{var e;const t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.title,null===t||void 0===t?void 0:t.state]}),(()=>this._setTitleFromFeatureWidget())),(0,r.watch)((()=>{var e;const t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.content,null===t||void 0===t?void 0:t.state]}),(()=>this._setContentFromFeatureWidget())),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.featureViewModels}),(()=>this._featureMenuViewportScrollTop())),this._drillInWidget.on("close",(()=>{this.emit("close")})),this._drillInWidget.on("exit",(()=>this._destroyDrillInFlowItemWidgets())),this._drillInWidget.on("open-feature",(e=>{let{feature:t}=e;return this._openRelatedFeature(t)})),this._drillInWidget.on("zoom-to-feature",(e=>{let{featureWidget:t}=e;return(0,I.Qb)(this.viewModel,t)})),this._drillInWidget.on("add-nso-trace-location",(e=>{let{featureWidget:t}=e;return this.emit("add-nso-trace-location",{featureWidget:t})}))])}initialize(){(async()=>{this._utilityNetworkTraceMessages=await(0,M.ud)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")})(),this._drillInWidget.mode=this.mode,this._drillInWidget.closable=!1}loadDependencies(){return(0,g.W)({action:()=>Promise.resolve().then(i.bind(i,85375)),"action-bar":()=>Promise.resolve().then(i.bind(i,143)),"action-group":()=>Promise.resolve().then(i.bind(i,97577)),block:()=>i.e(75502).then(i.bind(i,75502)),flow:()=>i.e(87473).then(i.bind(i,87473)),"flow-item":()=>i.e(68445).then(i.bind(i,68445)),notice:()=>i.e(12261).then(i.bind(i,12261))})}destroy(){var e;this._destroyDrillInFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),null===(e=this._drillInWidget)||void 0===e||e.destroy()}get _hideActionText(){var e;if(!this.responsiveActionsEnabled)return!1;const t=null===(e=this.view)||void 0===e?void 0:e.widthBreakpoint;return"xsmall"===t||"small"===t||"medium"===t}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get feature(){return this.viewModel.features.length?this.viewModel.features[0]:null}set feature(e){this.viewModel.features=e?[e]:[]}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get hasAssociationsPopupElement(){var e,t,i,s;const o=(0,u.yZ)(null===(e=this.feature)||void 0===e?void 0:e.layer)?null===(t=this.feature)||void 0===t?void 0:t.layer:void 0,n=(0,u.Sv)(null===(i=this.feature)||void 0===i?void 0:i.layer)?null===(s=this.feature)||void 0===s?void 0:s.layer:void 0,r=(null===o||void 0===o?void 0:o.popupTemplate)||(null===n||void 0===n?void 0:n.popupTemplate)||null,l=null===r||void 0===r?void 0:r.content;return!(Array.isArray(l)&&!l.some((e=>e instanceof T.default)))}get hasPopupInfo(){var e,t,i,s;const o=(0,u.yZ)(null===(e=this.feature)||void 0===e?void 0:e.layer)?null===(t=this.feature)||void 0===t?void 0:t.layer:void 0,n=(0,u.Sv)(null===(i=this.feature)||void 0===i?void 0:i.layer)?null===(s=this.feature)||void 0===s?void 0:s.layer:void 0;return!((null===o||void 0===o||!o.popupTemplate)&&(null===n||void 0===n||!n.popupTemplate))}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get mode(){return this._get("mode")||"add-nso"}set mode(e){this._set("mode",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){var e;const t=Array.from(this._drillInFlowItems).at(-1);if(!t)return null;const{flowType:i}=t;return("feature-association"===i||"feature-relationship"===i)&&null!==(e=t.graphic)&&void 0!==e?e:null}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_drillInFlowItems:i,timeZone:s}=this,{selectedFeatureViewModel:o}=this.viewModel,n={title:!1};return o?(e?(e.viewModel=o,e.visibleElements=n):this._feature=new k.default({flowItems:i,headingLevel:t+1,timeZone:s,viewModel:o,visibleElements:n}),this._feature):null}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}open(e){this.removeHandles("selected-index"),this.viewModel.open({features:[e]})}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return(0,b.K)("div",{bind:this,class:this.classes(N.A.base,v.D.widget,v.D.panel,G.blockContainer)},"add-nso"===this.mode?this._renderAddNsoBlock():void 0,this.feature?this.hasPopupInfo?this._renderContentContainer():this._renderNoPopupErrorBlock():void 0)}_renderActionBar(){var e;return null!==(e=this.viewModel.allActions)&&void 0!==e&&e.length?(0,b.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,b.K)("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var e;const t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?(0,b.K)("div",{class:F.A.contentNode,innerHTML:t,key:t}):this.renderNodeContent(t):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._drillInWidget.render()];return(0,b.K)("calcite-flow",{key:"content-container"},e)}_renderContentFeature(){const{_drillInFlowItems:e,headingLevel:t,featureNavigationTop:i}=this,{title:s,active:o}=this.viewModel,n=s||"";return(0,b.K)("calcite-flow-item",{bind:this,class:this.classes({[N.A.contentFeature]:!0}),closed:!o,collapseDirection:i?"down":"up",headingLevel:t,key:"root-flow-item",loading:this.viewModel.waitingForContents,selected:0===e.length},"show-feature-info"===this.mode?(0,b.K)("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,n?(0,b.K)(x.D,{class:this.classes(N.A.featuresHeading,v.D.heading),innerHTML:n,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),this.hasAssociationsPopupElement?void 0:this._renderNoAssociationNotice(),(0,b.K)("div",{class:"add-nso"===this.mode?this.classes(N.A.container,N.A.contentContainer):this.classes(N.A.container,N.A.contentContainer,G.featureContent)},this._renderContent()))}_renderFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const s=(0,A.CA)({action:e,feature:this.selectedFeature}),o={[N.A.icon]:!!t,[N.A.actionImage]:!!s};return t&&(o[t]=!0),s||t?(0,b.K)("span",{"aria-hidden":"true",class:this.classes(N.A.icon,o),key:"icon",styles:(0,A.p5)(s)}):null}_renderHeaderAction(e,t){var i;const s=e.title||"";return e.visible?(0,b.K)("calcite-action",{active:"toggle"===e.type&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled||!this.feature.geometry,icon:null!==(i=e.icon)&&void 0!==i?i:void 0,indicator:e.indicator,key:"header-action-".concat(t),loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:s,title:s}):null}_renderHeaderActions(){return this.headerActions.map(((e,t)=>this._renderHeaderAction(e,t))).toArray()}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_createSpinner(e){e&&(this._spinner=new S.A({view:e}),e.ui.add(this._spinner,{key:D,position:"manual",internal:!0}))}_destroyDrillInFlowItemWidgets(){this._drillInFlowItems.drain((e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_destroySpinner(){var e;const{_spinner:t,view:i}=this;t&&(null!==i&&void 0!==i&&null!==(e=i.ui)&&void 0!==e&&e.remove(t,D),t.destroy(),this._spinner=null)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){var t;const{messages:i,selectedFeature:s,messagesCommon:o}=this,{id:n}=e,r=null===s||void 0===s?void 0:s.attributes,l=null!==(t=e.title)&&void 0!==t?t:"",a="zoom-to-feature"===n?(0,P.V)(l,{messages:i}):"remove-selected-feature"===n?(0,P.V)(l,{messages:o}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?(0,P.V)(l,{messages:i}):e.title;return a&&r?(0,P.V)(a,r):null!==a&&void 0!==a?a:""}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=null===t||void 0===t?void 0:t.geometry;null!=i&&null!=t&&(this._destroyDrillInFlowItemWidgets(),await this.viewModel.zoomTo({target:i}),this.open(t))}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=null===e||void 0===e?void 0:e.viewModel;e&&(this.viewModel.title="error"===(null===i||void 0===i?void 0:i.state)?null===t||void 0===t?void 0:t.errorMessage:(null===i||void 0===i?void 0:i.title)||"")}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:s}=this.viewModel,o=s.findIndex((e=>e.uid===i)),n=s.at(o);n&&"toggle"===n.type&&(n.value=!n.value),this.viewModel.triggerAction(o)}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,s=this.headerActions.find((e=>{let{uid:t}=e;return t===i}));s&&!s.disabled&&("toggle"===(null===s||void 0===s?void 0:s.type)&&(s.value=!s.value),this.emit("trigger-header-action",{action:s}))}_viewReadyChange(e,t){var i;e?this._wireUpView(null===(i=this.viewModel)||void 0===i?void 0:i.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_wireUpView(e){this._destroySpinner(),e&&this._createSpinner(e)}};(0,s._)([(0,l.MZ)()],H.prototype,"_drillInFlowItems",void 0),(0,s._)([(0,l.MZ)()],H.prototype,"_hideActionText",null),(0,s._)([(0,l.MZ)({readOnly:!0})],H.prototype,"active",null),(0,s._)([(0,l.MZ)()],H.prototype,"content",null),(0,s._)([(0,l.MZ)()],H.prototype,"feature",null),(0,s._)([(0,l.MZ)()],H.prototype,"featureNavigationTop",void 0),(0,s._)([(0,l.MZ)()],H.prototype,"goToOverride",null),(0,s._)([(0,l.MZ)()],H.prototype,"hasAssociationsPopupElement",null),(0,s._)([(0,l.MZ)()],H.prototype,"hasPopupInfo",null),(0,s._)([(0,l.MZ)({type:K.E$})],H.prototype,"headerActions",void 0),(0,s._)([(0,l.MZ)()],H.prototype,"headingLevel",void 0),(0,s._)([(0,l.MZ)()],H.prototype,"location",null),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/widgets/Features/t9n/Features")],H.prototype,"messages",void 0),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/t9n/common")],H.prototype,"messagesCommon",void 0),(0,s._)([(0,l.MZ)()],H.prototype,"mode",null),(0,s._)([(0,l.MZ)()],H.prototype,"promises",null),(0,s._)([(0,l.MZ)()],H.prototype,"responsiveActionsEnabled",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],H.prototype,"selectedFeature",null),(0,s._)([(0,l.MZ)({readOnly:!0})],H.prototype,"selectedDrillInFeature",null),(0,s._)([(0,l.MZ)({readOnly:!0})],H.prototype,"selectedFeatureWidget",null),(0,s._)([(0,l.MZ)()],H.prototype,"timeZone",null),(0,s._)([(0,l.MZ)()],H.prototype,"view",null),(0,s._)([(0,l.MZ)({type:R.default}),(0,m.U)(["triggerAction","trigger-action"])],H.prototype,"viewModel",void 0),H=(0,s._)([(0,a.$)("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeature")],H);const V=H;var j=i(2504),U=i(94560);const z="esri-utility-network-trace",$={base:z,addButtonContainer:"".concat(z,"__add-button-container"),blockContainer:"".concat(z,"__block-container"),blockContent:"".concat(z,"__block-content"),clearPrompt:"".concat(z,"__reset-prompt"),doublePaddingTop:"".concat(z,"__double-pad-top"),flow:"".concat(z,"__flow"),listContainer:"".concat(z,"__list-container"),noticeContainer:"".concat(z,"__notice-container"),numberInput:"".concat(z,"__number-input"),promptDivider:"".concat(z,"__divider")};function q(e){return{height:e+"px"}}function Q(e){return{width:e+"px"}}function J(e){return{width:"100%",height:window.getComputedStyle(e).getPropertyValue("max-height")}}function X(e){return{display:"flex",flexDirection:e}}const Y=-2147208474;let ee=class extends p.default{constructor(e,t){super(e,t),this._activeTab="input",this._activeTrace=null,this._activeSwatch="",this._addNonspatialObjectActive=!1,this._alertRemoveModal=!1,this._assetGroupHeader="",this._assetTypeHeader="",this._confirmReset=!1,this._errorMessage="",this._swatchNode=null,this._selectToolActive=!1,this._showFeatureInfoActive=!1,this._traceHeaderForFlow="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._traceResultsState="result",this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._findNonspatialFeatureWidget=new V({mode:"add-nso"}),this._individualResultNode=null,this._loadUnError=!0,this._resultDisplayField="objectid",this._resultFeatureWidget=new V({mode:"show-feature-info"}),this._resultObjectIdField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._showResultOptions=!1,this._symbolStartFlag=null,this._symbolBarrier=null,this._traceLocationType="starting-point",this._updatingHandles=new c.U,this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1,this._warningNoTerminal=!1,this._wasPopupEnabled=!1,this._watchHandler=null,this.disabled=!0,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new j.default,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles([(0,r.watch)((()=>this.view),(()=>this._viewChangeHandle()),r.initial),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.resultAreaProperties}),(()=>this.scheduleRender())),(0,r.watch)((()=>this._addNonspatialObjectActive),(e=>{this._findNonspatialFeatureWidget.feature=null,e?this._changeCursor("crosshair"):this.view.popupEnabled=this._wasPopupEnabled})),(0,r.watch)((()=>this._showFeatureInfoActive),(e=>{e||(this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled)})),(0,r.on)((()=>this._findNonspatialFeatureWidget),"add-nso-trace-location",(e=>{let{featureWidget:t}=e;this.viewModel.addNonspatialTraceLocation(t.graphic,this._traceLocationType),this._warningNoFlag=!1,this._addNonspatialObjectActive=!1})),(0,r.on)((()=>this._findNonspatialFeatureWidget),"close-un-trace-feature-block",(()=>{this._changeCursor("default"),this._addNonspatialObjectActive=!1,this.viewModel.cancelAddFlagByHit()})),(0,r.on)((()=>this._resultFeatureWidget),"close-un-trace-feature-block",(()=>{this._showFeatureInfoActive=!1})),(0,r.on)((()=>this._resultFeatureWidget),"close",(()=>{this._resetResultFeatureWidget()}))])}destroy(){var e,t;null!==(e=this._findNonspatialFeatureWidget)&&void 0!==e&&e.destroy(),null===(t=this._resultFeatureWidget)||void 0===t||t.destroy()}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get gdbVersion(){return(0,o.eO)(n.A.getLogger(this),"gdbVersion will be removed and the gdbVersion of the UtilityNetwork will be consumed directly.",{replacement:"UtilityNetwork.gdbVersion",version:"4.31"}),this.viewModel.gdbVersion}set gdbVersion(e){(0,o.eO)(n.A.getLogger(this),"gdbVersion will be removed and the gdbVersion of the UtilityNetwork will be consumed directly.",{replacement:"UtilityNetwork.gdbVersion",version:"4.31"}),this.viewModel.gdbVersion=e}get icon(){return"utility-network-trace"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1,this._resetResultFeatureWidget();const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._traceResultsState="result",this.switchTab("results"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach((e=>{switch(e){case"noStartingPoints":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}}))}confirmReset(){this._confirmReset=!0}render(){return this._mixCustomStrings(),this._overrideFlagSymbol(),(0,b.K)("div",{class:this.classes($.base,v.D.widget,v.D.panel,{[v.D.widgetDisabled]:this.disabled})},this._renderUtilityNetworkTrace())}loadDependencies(){return(0,g.W)({action:()=>Promise.resolve().then(i.bind(i,85375)),"action-group":()=>Promise.resolve().then(i.bind(i,97577)),"action-pad":()=>i.e(4535).then(i.bind(i,4535)),block:()=>i.e(75502).then(i.bind(i,75502)),"block-section":()=>i.e(23948).then(i.bind(i,23948)),button:()=>Promise.resolve().then(i.bind(i,43285)),checkbox:()=>i.e(64990).then(i.bind(i,64990)),"color-picker-swatch":()=>i.e(73596).then(i.bind(i,73596)),combobox:()=>Promise.all([i.e(65641),i.e(64880)]).then(i.bind(i,64880)),"combobox-item":()=>i.e(73438).then(i.bind(i,73438)),"dropdown-group":()=>Promise.resolve().then(i.bind(i,5368)),"dropdown-item":()=>Promise.resolve().then(i.bind(i,84660)),fab:()=>i.e(87473).then(i.bind(i,87473)),flow:()=>i.e(58862).then(i.bind(i,58862)),"flow-item":()=>i.e(68445).then(i.bind(i,68445)),icon:()=>Promise.resolve().then(i.bind(i,16702)),"input-number":()=>Promise.all([i.e(46870),i.e(41763)]).then(i.bind(i,41763)),label:()=>Promise.resolve().then(i.bind(i,11839)),list:()=>Promise.all([i.e(46870),i.e(38841),i.e(65641),i.e(75802)]).then(i.bind(i,75802)),"list-item":()=>Promise.resolve().then(i.bind(i,70205)),loader:()=>Promise.resolve().then(i.bind(i,35688)),notice:()=>i.e(12261).then(i.bind(i,12261)),option:()=>i.e(46422).then(i.bind(i,46422)),panel:()=>Promise.resolve().then(i.bind(i,32647)),popover:()=>Promise.resolve().then(i.bind(i,51866)),scrim:()=>Promise.resolve().then(i.bind(i,32263)),select:()=>i.e(2253).then(i.bind(i,2253)),"split-button":()=>i.e(34964).then(i.bind(i,34964)),tab:()=>Promise.resolve().then(i.bind(i,26204)),"tab-nav":()=>Promise.resolve().then(i.bind(i,57748)),"tab-title":()=>Promise.resolve().then(i.bind(i,6013)),tabs:()=>Promise.resolve().then(i.bind(i,51345))})}switchTab(e){this._activeTab=e}switchToFromAssetGroup(e,t,i){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._traceResultsState=i}switchToFromAssetType(e,t,i){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._traceResultsState=i}switchToFromFunctions(e,t){this._traceResultsFunctions=e,this._traceResultsState=t}switchToFromIndividualRecords(e,t,i){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._traceResultsState=i}_renderAddNonspatialLocationBlock(){const{messages:e}=this;return(0,b.K)("calcite-block",{key:"".concat(this.id,"__add-spatial-location-block"),label:e.inputsStrings.addNonspatialOption,open:!0},this._findNonspatialFeatureWidget.render())}_renderAddSpatialLocationBlock(){const{messages:e,messagesCommon:t}=this;return(0,b.K)("calcite-block",{class:$.blockContent,heading:"starting-point"===this._traceLocationType?e.inputsStrings.headerStartingPoint:e.inputsStrings.headerBarrier,key:"".concat(this.id,"__add-nonspatial-location-block"),label:"starting-point"===this._traceLocationType?e.inputsStrings.headerStartingPoint:e.inputsStrings.headerBarrier,open:!0},(0,b.K)("calcite-action",{icon:"x",onclick:()=>{var e;this.viewModel.removeClickHandler(),null!==(e=this.view)&&void 0!==e&&e.popup&&(this.view.popupEnabled=this._wasPopupEnabled),this._changeCursor("default"),this._selectToolActive=!1},slot:"control",text:t.close}),(0,b.K)("calcite-notice",{icon:"starting-point"===this._traceLocationType?"pin-plus":"x-circle-f",kind:"info",open:!0},(0,b.K)("div",{slot:"message"},e.inputsStrings.addPointHint)))}_renderClearTraceResultsBlock(){const{messages:e,messagesCommon:t}=this;return(0,b.K)("calcite-scrim",{key:"prompt"},(0,b.K)("div",{class:$.clearPrompt},(0,b.K)("h3",{slot:"header"},e.resultsStrings.startOverButton),(0,b.K)("div",{slot:"content"},e.resultsStrings.startOverValidation),(0,b.K)("div",{class:$.promptDivider}),(0,b.K)("div",{styles:X("row")},(0,b.K)("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),(0,b.K)("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok))))}_renderExecutingTraceBlock(){const{messages:e}=this;return(0,b.K)("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"})}_renderInputBlock(){const{messages:e}=this;return(0,b.K)("calcite-block",{class:$.blockContainer,key:"".concat(this.id,"__inputs-block"),label:e.inputsStrings.headerTabInputs,open:!0},(0,b.K)("calcite-flow",{class:$.flow},(0,b.K)("calcite-flow-item",{key:"".concat(this.id,"__inputs-flow-item"),selected:!this._selectToolActive&&!this._addNonspatialObjectActive},this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?(0,b.K)("div",{styles:q(10)}):null,(0,b.K)("calcite-fab",{appearance:"solid",icon:"utility-network-trace",kind:"brand",onclick:()=>{this.checkCanTrace()},slot:"fab",text:e.tracingStrings.runTrace,textEnabled:!0,title:e.tracingStrings.runTrace,type:"button"}))))}_renderInputsTab(){const{messagesCommon:e}=this;let t="input";return this._selectToolActive&&!this._addNonspatialObjectActive&&(t="add-spatial-location"),!this._selectToolActive&&this._addNonspatialObjectActive&&(t="add-nso-location"),this.disabled&&(t="loading"),(0,b.K)("calcite-tab",{key:"".concat(this.id,"__inputs-tab-item"),selected:"input"===this._activeTab},"loading"===t?(0,b.K)("calcite-loader",{label:e.loading,type:"indeterminate"}):null,"input"===t?this._renderInputBlock():null,"add-spatial-location"===t?this._renderAddSpatialLocationBlock():null,"add-nso-location"===t?this._renderAddNonspatialLocationBlock():null)}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"barrier"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"barrier"))}));let s=null;return this._symbolBarrier&&(s=this._getSymbolIcon(this._symbolBarrier)),(0,b.K)("calcite-block",{class:$.blockContent,collapsible:!0,heading:e.inputsStrings.headerBarrier+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},(0,b.K)("div",{slot:"icon"},s||(0,b.K)("calcite-icon",{icon:"x-circle-f",scale:"s"})),(0,b.K)("div",null,e.inputsStrings.barrierPointHint),(0,b.K)("div",{class:$.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,this._warningNoBarrierAssetNsoFound?this._renderWarningMessage("noBarrierAssetNso",!0):null,(0,b.K)("div",{class:$.addButtonContainer},(0,b.K)("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:e.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("barrier")}},(0,b.K)("calcite-dropdown-group",{selectionMode:"none"},(0,b.K)("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("barrier")}},e.inputsStrings.addNonspatialOption)))))}_renderFlagRow(e,t){var i,s;const{messages:o,messagesCommon:n}=this,r=[];let l=!1;return null!=e.allTerminals&&e.allTerminals.terminals.length>0&&(l=!0,e.allTerminals.terminals.forEach((t=>{var i;let s=!1;null!==e&&void 0!==e&&null!==(i=e.selectedTerminals)&&void 0!==i&&i.includes(t.id)&&(s=!0),r.push((0,b.K)("calcite-combobox-item",{key:t.name,selected:s,textLabel:t.name,value:t.id}))}))),(0,b.K)("calcite-block",{collapsible:null!==e.allTerminals||"barrier"===e.type,heading:null!==(i=null===(s=e.displayValue)||void 0===s?void 0:s.value)&&void 0!==i?i:"",key:"pop"+e.globalId+e.type+e.id+t,overlayPositioning:"fixed"},(0,b.K)("calcite-action",{icon:"trash",label:n.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:n.remove,textEnabled:!0}),e.mapGraphic&&e.mapPoint?(0,b.K)("calcite-action",{icon:"zoom-to-object",label:o.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:o.globalStrings.zoomToFeature,textEnabled:!0}):null,"barrier"===e.type?(0,b.K)("calcite-label",{layout:"inline",scale:"s"},(0,b.K)("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),o.inputsStrings.barrierFilter):null,l?(0,b.K)("calcite-combobox",{label:o.globalStrings.selectTerminalPlaceholder,maxItems:0,overlayPositioning:"fixed",placeholder:o.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:t=>{t.currentTarget.selectedItems.length>0?(e.selectedTerminals=[],t.currentTarget.selectedItems.forEach((t=>{this.viewModel.addTerminal(t.value,e)}))):e.selectedTerminals=[]},onCalciteComboboxChipClose:t=>{t.preventDefault(),this.viewModel.removeTerminal(t.currentTarget.value,e)}},r):null)}_renderHighlightColorPicker(e,t,i){const{messages:s}=this,{graphicHandler:o}=this.viewModel,n=[],r=new RegExp("^".concat(e.hex,"$"),"i"),l=o.highlightColor.length>U.K9.length?5:4;for(const a of o.highlightColor)n.push((0,b.K)("calcite-action",{active:r.test(a.hex),key:a.hex,label:s.resultsStrings.graphicColor,onclick:()=>{"aggregate"===i?this.viewModel.changeResultGraphicColor(a,t):this.viewModel.changeResultAreaColor(t,a)},scale:"s",text:s.resultsStrings.graphicColor},(0,b.K)("calcite-color-picker-swatch",{active:r.test(a.hex),color:a.hex,scale:"s"})));return(0,b.K)("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},(0,b.K)("calcite-action-group",{columns:l},n))}_renderRemoveTraceContainer(e){const{messages:t}=this;return(0,b.K)("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderResultsTab(){let e="results";return this._showFeatureInfoActive&&(e="show-feature-info"),this.viewModel._activeProgress&&(e="executing"),this._confirmReset&&(e="clear-trace-results"),(0,b.K)("calcite-tab",{key:"".concat(this.id,"__results-tab-item")},"executing"===e?this._renderExecutingTraceBlock():null,"results"===e?this.viewModel.traceResults.length?this._renderResultsPanel():this._renderWarningMessage("noTraceExecuted",!1):null,"show-feature-info"===e?this._renderShowFeatureInfoBlock():null,"clear-trace-results"===e?this._renderClearTraceResultsBlock():null)}_renderResultsPanel(){const{messages:e}=this;return(0,b.K)("calcite-block",{class:$.blockContainer,key:"".concat(this.id,"__results-block"),label:e.resultsStrings.headerTabResults,open:!0},(0,b.K)("calcite-flow",{class:$.flow},this._renderTraceResults(),this._renderTraceResultFunctions(),this._renderTraceResultByAssetGroup(),this._renderTraceResultByAssetType(),this._renderTraceResultIndividual()))}_renderResultRowFunctions(e){return(0,b.K)("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return(0,b.K)("calcite-list-item",{key:"".concat(t,"-").concat(e.assetGroupCode),label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")","assetType")}},(0,b.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return(0,b.K)("calcite-list-item",{key:"".concat(t,"-").concat(e.assetTypeCode),label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this._updatingHandles.addPromise(this.viewModel.queryFeaturesById(e).then((i=>{if(null!==i&&void 0!==i&&i.length){this._resultObjectIdField=i[0].layer.objectIdField,"objectid"===this._resultDisplayField&&(this._resultDisplayField=i[0].layer.objectIdField),"objectid"===this._resultSortField&&(this._resultSortField=i[0].layer.objectIdField);const s=this._appendAttributes(e,i,"objectId");this.switchToFromIndividualRecords(s,t+" ("+e.length+")","records")}else this.switchToFromIndividualRecords(e,t+" ("+e.length+")","records")})))}},(0,b.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){var t,i,s,o,n;const{messages:r}=this;let l,a=null;if(a=null===e||void 0===e||null===(t=e.details)||void 0===t?void 0:t.fields.find((e=>{let{name:t}=e;return t===this._resultDisplayField})),"date"===(null===(i=a)||void 0===i?void 0:i.type))l=new Date(e.details.attributes[this._resultDisplayField]).toDateString();else if("assetgroup"===this._resultDisplayField.toLowerCase())l=this._getAssetGroupName(e);else if("assettype"===this._resultDisplayField.toLowerCase())l=this._getAssetTypeName(e);else if(null!==(s=a)&&void 0!==s&&s.domain&&function(e){return e instanceof d.default}(a.domain)){const t=a.domain.codedValues.find((t=>{let{code:i}=t;return i===e.details.attributes[this._resultDisplayField]}));l=null===t||void 0===t?void 0:t.name}else l=null!==(o=null===(n=e.details)||void 0===n?void 0:n.attributes[this._resultDisplayField])&&void 0!==o?o:e.objectId;return l&&""!==l&&null!==l?"string"==typeof l&&(l.trim()||(l=r.resultsStrings.noValue)):l=r.resultsStrings.noValue,(0,b.K)("calcite-list-item",{key:e.details.uid,label:l,onCalciteListItemSelect:async()=>{var t,i;this._disablePopup(),this._showFeatureInfoActive=!0;const s=(0,u.F2)(null===(t=e.details)||void 0===t?void 0:t.layer)?null===(i=e.details)||void 0===i?void 0:i.layer:null;if(s){var o,n;const t=null!==(o=Object.keys(e.details.attributes).find((e=>e.toLowerCase()===s.subtypeField.toLowerCase())))&&void 0!==o?o:"assetgroup",i=s.sublayers.find((i=>i.subtypeCode===e.details.attributes[t])),r=null!==(n=Object.keys(e.details.attributes).find((e=>e.toLowerCase()===s.objectIdField.toLowerCase())))&&void 0!==n?n:"objectid",l=new h.default;l.outFields=["*"],l.returnGeometry=!0,l.where=r+" = "+e.details.attributes[r];const a=await(null===i||void 0===i?void 0:i.queryFeatures(l));a&&this._resultFeatureWidget.open(a.features[0])}else this._resultFeatureWidget.open(e.details)}},(0,b.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderShowFeatureInfoBlock(){const{messages:e}=this;return(0,b.K)("calcite-block",{class:$.blockContainer,key:"".concat(this.id,"__show-feature-info-block"),label:e.resultsStrings.headerFeatureInfo,open:!0},this._resultFeatureWidget.render())}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"starting-point"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"start"))}));let s=null;return this._symbolStartFlag&&(s=this._getSymbolIcon(this._symbolStartFlag)),(0,b.K)("calcite-block",{class:$.blockContent,collapsible:!0,heading:e.inputsStrings.headerStartingPoint+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},(0,b.K)("div",{slot:"icon"},s||(0,b.K)("calcite-icon",{icon:"pin",scale:"s"})),(0,b.K)("div",null,e.inputsStrings.startingPointHint),(0,b.K)("div",{class:$.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,this._warningNoStartAssetNsoFound?this._renderWarningMessage("noStartAssetNso",!0):null,(0,b.K)("div",{class:$.addButtonContainer},(0,b.K)("calcite-split-button",{appearance:"outline-fill",primaryIconStart:"select",primaryText:e.inputsStrings.addPointOption,onCalciteSplitButtonPrimaryClick:()=>{this._setupAddTraceLocation("starting-point")}},(0,b.K)("calcite-dropdown-group",{selectionMode:"none"},(0,b.K)("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>{this._setupAddNonspatialObject("starting-point")}},e.inputsStrings.addNonspatialOption)))))}_renderStartOverContainer(){const{messages:e}=this;return(0,b.K)("calcite-fab",{appearance:"solid",icon:"trash",kind:"brand",onclick:()=>{this.confirmReset()},slot:"fab",text:e.resultsStrings.startOverButton,textEnabled:!0,title:e.resultsStrings.startOverButton,type:"button"})}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const i in e){const s=e[i];for(const e in s)t.push(this._renderResultRowAssetGroup(s[e]))}return(0,b.K)("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",selected:"assetGroup"===this._traceResultsState,onCalciteFlowItemBack:()=>{this.switchToFromAssetGroup([],"","result")}},(0,b.K)("calcite-list",{label:""},t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const i in e)e[i].length>0&&t.push(this._renderResultRowAssetType(e[i]));return(0,b.K)("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",loading:this._updatingHandles.updating,selected:"assetType"===this._traceResultsState,onCalciteFlowItemBack:()=>{this.switchToFromAssetType([],"","assetGroup")}},(0,b.K)("calcite-list",{label:"",selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultFunctions(){if("functions"!==this._traceResultsState)return null;const{messages:e}=this,t=this._traceResultsFunctions,i=[];return t.forEach((e=>{i.push(this._renderResultRowFunctions(e))})),(0,b.K)("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",selected:"functions"===this._traceResultsState,onCalciteFlowItemBack:()=>{this.switchToFromFunctions([],"result")}},i,this._renderStartOverContainer())}_renderTraceResultIndividual(){const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const i=[];var s,o;t.length>0&&(null!==(s=null===(o=t[0].details)||void 0===o?void 0:o.fields.some((e=>{let{name:t}=e;return t.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()})))&&void 0!==s&&s||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach((e=>{(null===e||void 0===e?void 0:e.details)&&i.push(this._renderResultRowIndividual(e))})),0===i.length&&i.push((0,b.K)("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap})));return(0,b.K)("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",selected:"records"===this._traceResultsState,onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToFromIndividualRecords([],"","assetType")}},(0,b.K)("calcite-action",{afterCreate:_.cA,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),this._renderTraceResultIndividualPopover(),(0,b.K)("calcite-list",{label:"",selectionMode:"none"},i),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,i=[],s=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach((e=>{let{name:t,alias:o}=e;i.push((0,b.K)("calcite-option",{key:"display-".concat(t),label:null!==o&&void 0!==o?o:t,selected:t===this._resultDisplayField,value:t})),s.push((0,b.K)("calcite-option",{key:"sort-".concat(t),label:null!==o&&void 0!==o?o:t,selected:t===this._resultSortField,value:t}))})):(i.push((0,b.K)("calcite-option",{key:"display-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})),s.push((0,b.K)("calcite-option",{key:"sort-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})))),(0,b.K)("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:null!==this.domNode?Q(.75*this.domNode.clientWidth):{width:"75%"}},(0,b.K)("calcite-block",{label:e.resultsStrings.displayAttribute,open:!0,overlayPositioning:"fixed"},(0,b.K)("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,(0,b.K)("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:e=>{const t=e.currentTarget;this._resultDisplayField=t.selectedOption.value,this._showResultOptions=!1}},i)),(0,b.K)("calcite-label",{scale:"s"},e.resultsStrings.sortBy,(0,b.K)("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:e=>{const i=e.currentTarget;this._resultSortField=i.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},s))))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:i}=e.resultsStrings,s=this.viewModel.traceResults,o=[];return s.forEach(((t,s)=>{var n,r,l,a,c,d,u;let h=[],p=[],g=!1,v=!1,_=!1,w="";null!==t.results&&t.results.hasOwnProperty("elements")?(null!==t.results.aggregatedGeometry&&(v=!0),null!==t.results.globalFunctionResults&&t.results.globalFunctionResults.length>0&&(p=t.results.globalFunctionResults,p.length>0&&(_=!0)),t.results.elements&&t.results.elements.length>0&&(h=t.results.elements,h.length>0&&(g=!0)),(v||g)&&(w=null===(n=this.messagesUnits.units[null===(r=t.resultArea)||void 0===r?void 0:r.unit])||void 0===n?void 0:n.abbr),o.push((0,b.K)("calcite-block",{class:$.blockContent,collapsible:!0,description:null!==(l=t.trace.description)&&void 0!==l?l:"",heading:t.trace.title,key:"".concat(t.trace.title).concat(s),open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),(0,b.K)("calcite-list",{label:""},_?(0,b.K)("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+p.length+")",onCalciteListItemSelect:()=>{this.switchToFromFunctions(p,"functions")}},(0,b.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,g&&this.viewModel.showSelectionAttributes?(0,b.K)("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+h.length+")",onCalciteListItemSelect:()=>{this.switchToFromAssetGroup(this._groupResultsByAssetGroup(t),t.trace.title+" ("+h.length+")","assetGroup")}},(0,b.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?(0,b.K)("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),g?(0,b.K)("div",{class:$.doublePaddingTop},(0,b.K)("calcite-label",{layout:"inline",onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)},scale:"s"},(0,b.K)("calcite-checkbox",{checked:t.selectionEnabled,onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)}}),this.viewModel.showSelectionAttributes?i:"".concat(i," (").concat(h.length,")"))):null,v?(0,b.K)("calcite-block-section",{key:"aggregate-".concat(t.trace.title,"-").concat(s),open:t.graphicEnabled,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.currentTarget.open?this.viewModel.changeResultGraphicColor(t.graphicColor,t):this.viewModel.removeResultGraphicFromView(t)}},(0,b.K)("calcite-list",{label:e.resultsStrings.graphicColor,selectionMode:"none"},(0,b.K)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{this._swatchNode=e.currentTarget,this._activeSwatch="aggGeom_"+s}},(0,b.K)("calcite-color-picker-swatch",{color:t.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(v||g)?(0,b.K)("calcite-block-section",{key:"area-".concat(t.trace.title,"-").concat(s),open:null===(a=t.resultArea)||void 0===a?void 0:a.show,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.currentTarget.open?t.resultAreaGraphic?this.viewModel.addResultAreaToMap(t,t.resultAreaGraphic):this.viewModel.addResultAreaToMap(t):this.viewModel.removeResultAreaFromMap(t)}},(0,b.K)("calcite-list",{label:"",selectionMode:"none"},(0,b.K)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{const t=e.currentTarget;this._swatchNode=t,this._activeSwatch="resultArea_"+s}},(0,b.K)("calcite-color-picker-swatch",{color:null===(c=t.resultArea)||void 0===c?void 0:c.color.hex,scale:"s",slot:"actions-end"}))),(0,b.K)("calcite-list",{label:"",selectionMode:"none"},(0,b.K)("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},(0,b.K)("calcite-input-number",{afterCreate:this._afterComponentCreate,class:$.numberInput,max:999999,min:0,scale:"s",slot:"actions-end",suffixText:w,value:null===(d=t.resultArea)||void 0===d?void 0:d.distance.toString(),onCalciteInputNumberChange:e=>{var i;if(null===(i=this.view)||void 0===i||!i.popup)return;this.view.popup.visible&&this.view.closePopup();const s=e.currentTarget;t.resultArea.distance>=0?(t.resultArea.distance=parseInt(s.value,10),this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t)):(t.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t))}})))):null,(0,b.K)("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+s||this._activeSwatch==="resultArea_"+s,overlayPositioning:"fixed",placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+s?null===(u=t.resultArea)||void 0===u?void 0:u.color:t.graphicColor,t,this._activeSwatch==="resultArea_"+s?"resultArea":"aggregate"))))):o.push((0,b.K)("calcite-block",{collapsible:!1,heading:t.trace.title,key:"error-"+s,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),this._renderWarningMessage("noController",!1,t.status)))})),(0,b.K)("calcite-flow-item",{key:"traceResults",selected:"result"===this._traceResultsState},o,this._renderStartOverContainer(),this._alertRemoveModal?(0,b.K)("calcite-scrim",{key:"prompt"},(0,b.K)("div",{class:$.clearPrompt},(0,b.K)("h3",{slot:"header"},e.globalStrings.clearResults),(0,b.K)("div",{slot:"content"},e.alertsStrings.clearResultsAlert),(0,b.K)("div",{class:$.promptDivider}),(0,b.K)("div",{styles:X("row")},(0,b.K)("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),(0,b.K)("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,0===this.viewModel.traceResults.length?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._traceResultsState="result")},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceSelectorContainer(){const{messages:e}=this,t=this.viewModel.traces.map((e=>{var t;return this._renderComboboxItem({value:e.globalId,text:e.title,selected:null!==(t=e.selected)&&void 0!==t&&t})})),i=this.viewModel.traces.filter((e=>e.selected)),s=e.tracingStrings.traceOperation+" (".concat(i.length,")");return(0,b.K)("calcite-block",{class:$.blockContent,collapsible:!0,heading:s,open:!0,overlayPositioning:"fixed"},(0,b.K)("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),(0,b.K)("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:e=>{this.viewModel.traces.forEach((t=>{t.selected=e.currentTarget.selectedItems.some((e=>e.value===t.globalId))})),e.currentTarget.selectedItems.length&&(this._warningNoTraceSelected=!1)}},t))}_renderUtilityNetworkTrace(){var e,t;const{viewModel:i,viewModel:{utilityNetwork:s}}=this,o=null===(e=i.view)||void 0===e?void 0:e.map,{messages:n}=this;let r=(0,b.K)("calcite-tabs",{layout:"center",position:"top",styles:J(this.container)},(0,b.K)("calcite-tab-nav",{slot:"title-group"},(0,b.K)("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:"input"===this._activeTab},n.inputsStrings.headerTabInputs),(0,b.K)("calcite-tab-title",{onclick:()=>{this.switchTab("results")},selected:"results"===this._activeTab},n.resultsStrings.headerTabResults)),this._renderInputsTab(),this._renderResultsTab());return(!(null!==(t=o.utilityNetworks)&&void 0!==t&&t.length)&&!s||s&&!s.sharedNamedTraceConfigurations.length)&&(r=(0,b.K)("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUnError||(r=(0,b.K)("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),r}_renderWarningMessage(e,t,i){const{messages:s}=this;let o=s.alertsStrings.NoRunAlertHeader,n=s.alertsStrings.noResultsInfo;switch(e){case"flag":o=s.alertsStrings.startingPointAlertHeader,n=s.alertsStrings.startingPointAlert;break;case"noTerminal":o=s.alertsStrings.noTerminalDefinedHeader,n=s.alertsStrings.noTerminalDefined;break;case"trace":o=s.alertsStrings.selectTraceAlertHeader,n=s.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":o=s.alertsStrings.NoRunAlertHeader,n=s.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":o=s.alertsStrings.noAssetsFoundHeader,n=s.alertsStrings.noAssetFound;break;case"noBarrierAssetNso":case"noStartAssetNso":o="",n=s.alertsStrings.noAssetFound;break;case"noTraceConfig":o="",n=s.alertsStrings.noTraceSupported;break;default:o=s.alertsStrings.genericErrorHeader,n=i||""}return(0,b.K)("div",{class:$.noticeContainer,key:e},(0,b.K)("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>this._handleWarningNoticeClose(e)},(0,b.K)("div",{slot:"title"},o),(0,b.K)("div",{slot:"message"},n)))}_afterComponentCreate(e){"value"in e&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_appendAttributes(e,t,i){const s=[];return e.forEach((e=>{t.forEach((t=>{t.featureSet.features.forEach((o=>{e[i]===o.attributes[this._resultObjectIdField]&&(e.details=o,e.details.fields=t.featureSet.fields,s.push(e))}))}))})),s}_changeCursor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";const i=null===(e=this.view)||void 0===e||null===(e=e.container)||void 0===e?void 0:e.style;i&&(i.cursor=t)}_disablePopup(){const{view:e}=this;e.popupEnabled=!1,e.closePopup()}_compare(e,t){return(i,s)=>{var o,n,r,l;let a=0,c=null!==(o=null===(n=i.details)||void 0===n?void 0:n.attributes[e])&&void 0!==o?o:i.objectId,d=null!==(r=null===(l=s.details)||void 0===l?void 0:l.attributes[e])&&void 0!==r?r:s.objectId;return isNaN(c)&&(c=c.toLowerCase()),isNaN(d)&&(d=d.toLowerCase()),"desc"===t?c>d?a=1:c<d&&(a=-1):c<d?a=1:c>d&&(a=-1),a}}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(s){const e=s.assetGroups.find((e=>e.assetGroupCode===i));e&&(t=e.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(s){const o=s.assetGroups.find((e=>e.assetGroupCode===i));if(o){const i=o.assetTypes.find((t=>t.assetTypeCode===e.assetTypeCode));i&&(t=i.assetTypeName)}}return t}_getSymbolIcon(e){var t;return"picture-marker"===e.type?(0,b.K)("img",{height:e.height,src:null!==(t=e.url)&&void 0!==t?t:void 0,width:e.width}):null}_groupBy(e,t){return e.reduce(((e,i)=>((e[i[t]]=e[i[t]]||[]).push(i),e)),{})}_groupResultsByAssetGroup(e){var t;const i=[],s=null===(t=e.results)||void 0===t?void 0:t.elements,o=this._groupBy(null!==s&&void 0!==s?s:[],"networkSourceId");for(const n in o)i.push(this._groupBy(o[n],"assetGroupCode"));return i}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_handleWarningNoticeClose(e){switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noStartAssetNso":this._warningNoStartAssetNsoFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1;break;case"noBarrierAssetNso":this._warningNoBarrierAssetNsoFound=!1}}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach((t=>{"starting-point"===t.type&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),"barrier"===t.type&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)}))}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach((e=>{"starting-point"===e.type?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)}))}_processFlagOnLoad(){var e;return null===(e=this.view)||void 0===e?void 0:e.when().then((()=>{this._watchHandler=(0,r.when)((()=>{var e;return!(null!==(e=this.view)&&void 0!==e&&e.updating)}),(async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const e=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),e.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),e.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,null!==this._watchHandler&&this._watchHandler.remove()}))}))}_registerWatchers(){this.addHandles([(0,r.watch)((()=>this.selectedTraces),(()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()})),(0,r.watch)((()=>this.defaultGraphicColor),(()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach((e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)})),this.scheduleRender()}))])}_renderComboboxItem(e){let{text:t,value:i,selected:s}=e;return(0,b.K)("calcite-combobox-item",{key:i,selected:s,textLabel:t,value:i})}_resetResultFeatureWidget(){this._showFeatureInfoActive=!1,this._resultFeatureWidget.feature=null,this.view.popupEnabled=this._wasPopupEnabled}_resetTraceLocationWarnings(){this._warningNoBarrierAssetFound=!1,this._warningNoBarrierAssetNsoFound=!1,this._warningNoStartAssetFound=!1,this._warningNoStartAssetNsoFound=!1}_setupAddNonspatialObject(e){this._disablePopup(),this._traceLocationType=e,this._addNonspatialObjectActive=!0,this._resetTraceLocationWarnings(),this.viewModel.getNonspatialTraceLocationInitialFeature().then((e=>{this._findNonspatialFeatureWidget.feature=null;const t=e.graphic;this._findNonspatialFeatureWidget.open(t)})).catch((()=>{this._warningNoStartAssetNsoFound="starting-point"===e,this._warningNoBarrierAssetNsoFound="barrier"===e,this._addNonspatialObjectActive=!1})).finally((()=>this._changeCursor("default")))}_setupAddTraceLocation(e){this._traceLocationType=e,this._changeCursor("crosshair"),this._selectToolActive=!0,this._addNonspatialObjectActive=!1,this._resetTraceLocationWarnings(),this.viewModel.addFlagByHit(this._traceLocationType,this._symbolStartFlag).then((e=>{this._changeCursor("default"),e?this._warningNoFlag=!1:(this._warningNoStartAssetFound="starting-point"===this._traceLocationType,this._warningNoBarrierAssetFound="barrier"===this._traceLocationType),this._selectToolActive=!1}))}_utilityNetworkTraceInitialized(){this.viewModel.loadUtilityNetwork().then((e=>{e&&(this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&this._processFlagOnLoad()),this.disabled=!1})).catch((e=>{var t;const{messages:i}=this;this._loadUnError=!1,"utility-network:no-user-type-extension"===e.name||(null===(t=e.details.raw)||void 0===t?void 0:t.extendedCode)===Y?this._errorMessage=i.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1}))}_viewChangeHandle(){var e,t;this._wasPopupEnabled=null!==(e=null===(t=this.view)||void 0===t?void 0:t.popupEnabled)&&void 0!==e&&e,this._findNonspatialFeatureWidget.view=this.view,this._resultFeatureWidget.view=this.view}};(0,s._)([(0,l.MZ)()],ee.prototype,"_activeTab",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_activeTrace",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_activeSwatch",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_addNonspatialObjectActive",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_alertRemoveModal",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_assetGroupHeader",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_assetTypeHeader",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_confirmReset",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_errorMessage",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_swatchNode",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_selectToolActive",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_showFeatureInfoActive",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceHeaderForFlow",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceResultsFunctions",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceResultsAssetGroup",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceResultsAssetType",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceResultsIndividual",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_traceResultsState",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_warningNoFlag",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_warningNoTraceSelected",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"_updatingHandles",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"defaultGraphicColor",null),(0,s._)([(0,l.MZ)()],ee.prototype,"disabled",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"enableResultArea",null),(0,s._)([(0,l.MZ)()],ee.prototype,"flags",null),(0,s._)([(0,l.MZ)()],ee.prototype,"gdbVersion",null),(0,s._)([(0,l.MZ)()],ee.prototype,"icon",null),(0,s._)([(0,l.MZ)()],ee.prototype,"inputSettings",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"label",null),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],ee.prototype,"messages",void 0),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/t9n/common")],ee.prototype,"messagesCommon",void 0),(0,s._)([(0,l.MZ)(),(0,w.G)("esri/core/t9n/Units")],ee.prototype,"messagesUnits",void 0),(0,s._)([(0,l.MZ)()],ee.prototype,"resultAreaProperties",null),(0,s._)([(0,l.MZ)()],ee.prototype,"selectedTraces",null),(0,s._)([(0,l.MZ)()],ee.prototype,"selectOnComplete",null),(0,s._)([(0,l.MZ)()],ee.prototype,"showGraphicsOnComplete",null),(0,s._)([(0,l.MZ)()],ee.prototype,"showSelectionAttributes",null),(0,s._)([(0,l.MZ)()],ee.prototype,"utilityNetwork",null),(0,s._)([(0,l.MZ)()],ee.prototype,"view",null),(0,s._)([(0,m.U)(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area","reset"]),(0,l.MZ)({type:j.default})],ee.prototype,"viewModel",void 0),ee=(0,s._)([(0,a.$)("esri.widgets.UtilityNetworkTrace")],ee);const te=ee}}]);
//# sourceMappingURL=55566.43a62fc0.chunk.js.map